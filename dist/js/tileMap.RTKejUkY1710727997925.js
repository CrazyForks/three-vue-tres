var S=Object.defineProperty;var T=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>(T(s,typeof e!="symbol"?e+"":e,t),t);import{ar as w,as as g,$ as v,ak as P,aw as h,bk as z,b0 as b,a5 as I,w as _,a4 as Z,o as f,c as L,K as C,a0 as k,an as U,a2 as j,a3 as A,v as M,D as x,a7 as y,a8 as D,ag as E,a as R}from"./vendor.Whz5JOL71710727997925.js";import{U as O,b as G,c as B,M as Q,P as V,a as Y,T as $,O as F,d as H}from"./TerrainMeshProvider.5K_NPgN51710727997925.js";function K(s){return new Worker(""+new URL("../static/MartiniWorker-8mf_OiU3.js",import.meta.url).href,{name:s==null?void 0:s.name})}class N{constructor(){c(this,"maxZoom",12);c(this,"coordType",O);c(this,"utmZone",50);c(this,"_worker");c(this,"_useWorker",!0);c(this,"source","https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp")}set useWorker(e){var t;this._useWorker=e,this._useWorker||((t=this._worker)==null||t.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(e){return this._useWorker?this.getInWorkerThread(e):this.getInMainThread()}async getInMainThread(){return new w}async getInWorkerThread(e){this._worker||(this._worker=new G(K));const t={tileNo:e,id:this.getId(e),url:this.getUrl(e),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},o=await this._worker.postMessage(t),a=new w;return a.setAttribute("position",new g(o.positions,3)),a.setAttribute("uv",new g(o.uv,2)),a.setIndex(new g(o.triangles,1)),a}async abort(e){var t;this._useWorker&&((t=this._worker)==null||t.postMessage({id:this.getId(e),abort:!0}))}async dispose(e,t){var o;t.dispose(),this._useWorker&&((o=this._worker)==null||o.postMessage({id:this.getId(e),dispose:!0}))}getId(e){return e.join("-")}getUrl(e){const[t,o,a]=e;return this.source.replace("[x]",t+"").replace("[y]",o+"").replace("[z]",a+"")}}const q=["object","rotation"],J=v({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},camera:{}},setup(s){const e=s,{renderer:t,scene:o}=P(),a=new V;a.coordType=B;const m=new N;m.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",m.coordType=B;const u=new Y;u.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",u.showTileNo=!1,u.useWorker=!0;const n=new $(m,u);if(n.showBoundingBox=!1,n.wireframe=!1,n.flatShading=!1,n.useStandardMaterial=!1,n.filter={opposite:e.opposite,monochrome:e.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:e.genBright,genContrast:e.genContrast,genSaturation:e.genSaturation},e.monochrome){let i=new h(e.monochrome);n.filter.monochrome={r:i.r,g:i.g,b:i.b}}const l=new Q;l.provider=n,l.bbox=e.bbox,l.maxZoom=e.maxZoom;const r=new z(60,window.innerWidth/window.innerHeight,1,1e7*10);r.up=new b(0,1,0),r.position.set(e.mapCenter[0],e.mapCenter[2],-e.mapCenter[1]),r.lookAt(new b(r.position.x,0,r.position.z-2e3)),l.camera=r;let p=null;I(()=>{if(t.value&&(p=new F(r,t.value.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.minDistance=600,p.position0.set(r.position.x,r.position.y,r.position.z),p.target.set(r.position.x,0,r.position.z-2e3)),e.genBright&&(n.filter.genBright=e.genBright),e.genContrast&&(n.filter.genContrast=e.genContrast),e.genSaturation&&(n.filter.genSaturation=e.genSaturation),e.isMonochrome&&e.monochrome){let i=new h(e.monochrome);n.filter.monochrome={r:i.r,g:i.g,b:i.b}}}),_(()=>e.opposite,i=>{n.filter.opposite=i}),_(()=>e.isMonochrome,i=>{let d=new h(e.monochrome);n.filter.monochrome=i?{r:d.r,g:d.g,b:d.b}:null});const{onLoop:W}=Z();return W(()=>{if(t.value){p&&p.update(),l.update();const i=Math.abs(r.position.y)*50;r.far=i+5e3,r.updateProjectionMatrix(),p.target.y=0,t.value.render(o.value,r)}}),(i,d)=>(f(),L("primitive",{object:C(l),rotation:[-Math.PI/2,0,0]},null,8,q))}}),oe=v({__name:"tileMap",setup(s){const e=H(118.779958,32.017136),t=[e[0],e[1],5e3],o=k({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:t}),a=new U({title:"参数"});a.addBinding(o,"opposite",{label:"反色"}),a.addBinding(o,"genBright",{label:"高亮",min:.1,max:3,step:.1}),a.addBinding(o,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),a.addBinding(o,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),a.addBinding(o,"isMonochrome",{label:"单色滤镜"}),a.addBinding(o,"monochrome",{label:"滤镜颜色"});const m=k({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,disableRender:!0,outputColorSpace:j,toneMapping:A,precision:"highp"});return(u,n)=>(f(),M(C(D),y(m,{"window-size":""}),{default:x(()=>[(f(),M(E,null,{default:x(()=>[R(J,y({bbox:[104.955976,20.149765,120.998419,30.528687]},o),null,16)]),_:1}))]),_:1},16))}});export{oe as default};
