import{be as D,bc as W,bd as E,b0 as y,$ as M,k as T,bL as G,ak as B,a5 as S,a4 as z,o as w,c as P,W as v,K as _,aO as R,aw as h,b1 as j,a0 as L,a as x,a7 as O,ab as k,E as N,a1 as F,a2 as H,a3 as $,v as C,D as b,a8 as V,ag as Z}from"./vendor.XGv6VLQP1710427390950.js";import{C as U}from"./vanilla-307d3a93.esm.W9iFJdnw1710427390950.js";import{L as q,a as A,b as I}from"./LineSegments2.DPJZS-vk1710427390950.js";import{T as K}from"./TilesRenderer.ajPq0WkJ1710427390950.js";import{U as J,M as Q,P as X,a as Y,T as ee}from"./TerrainMeshProvider.uPzF0T0v1710427390950.js";import"./_commonjsHelpers.5-cIlDoe1710427390950.js";import"./BufferGeometryUtils.wwsQwazN1710427390950.js";const te=n=>{n.onLoadTileSet=i=>{const s=new D,a=new W,e=new E;let r=null,u=0;n.getOrientedBounds(s,e)?(r=new y().setFromMatrixPosition(e),u=r.length()):n.getBoundingSphere(a)&&(r=a.center.clone(),u=r.length()),n.group.matrix.copy(e).invert(),n.group.updateMatrix(),n.group.position.y=-u}},oe="varying vec4 vPosition;\nvoid main(){\n	vPosition=modelMatrix*vec4(position,1.);\n	csm_Position=position*vec3(1.);\n}",ae="uniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor;//顶部颜色\nuniform bool uGradient;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main(){\n	// 转世界坐标\n	uMax_world=modelMatrix*vec4(uMax,1.);\n	uMin_world=modelMatrix*vec4(uMin,1.);\n	vec3 distColor=uColor;\n	float residue=uTime-floor(uTime/uCircleTime)*uCircleTime;\n	float rate=residue/uCircleTime;\n	float lightOffset=rate*(uMax_world.z-uMin_world.z);\n	\n	if(uMin_world.z+lightOffset<vPosition.z&&uMin_world.z+lightOffset+uBorderWidth>vPosition.z){\n		csm_DiffuseColor=vec4(uLightColor,uOpacity);\n	}else{\n		csm_DiffuseColor=vec4(distColor,uOpacity);\n	}\n	\n	//根据高度计算颜色\n	if(uGradient){\n		float rateHight=(vPosition.z-uMin_world.z)/(uMax_world.z-uMin_world.z);\n		// if(rateHight<=.007){\n			// 	rateHight=1.;\n		// }\n		float mixNumber=clamp(rateHight*2.3-1.5,0.,1.);\n		vec3 outColor=mix(csm_DiffuseColor.xyz,uTopColor,mixNumber);\n		csm_DiffuseColor=vec4(outColor,uOpacity);\n	}\n}",re=["object"],ne=M({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0}},setup(n){const i=n,s=T(0),a=o=>{const{geometry:t}=o;t.computeBoundingBox(),t.computeBoundingSphere();const{max:l,min:p}=t.boundingBox,d=new U({baseMaterial:new R,vertexShader:oe,fragmentShader:ae,silent:!0,uniforms:{uMax:{value:l},uMin:{value:p},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new h(i.bulidingsColor)},uOpacity:{value:i.opacity},uLightColor:{value:new h("#ffffff")},uTopColor:{value:new h(i.topColor)},uTime:s,uGradient:{value:i.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:j});o.material.dispose(),o.material=d},e=new K("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");e.errorTarget=2,e.onLoadModel=o=>{o.traverse(t=>{if(t.isMesh){a(t),t.receiveShadow=!1,t.castShadow=!1;const l=new G(t.geometry.clone());let d=new q().fromEdgesGeometry(l),g=new A({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});g.resolution.set(window.innerWidth,window.innerHeight);const m=new I(d,g);m.applyMatrix4(t.matrix.clone()),t.parent.add(m)}})},te(e);const{camera:r,renderer:u,sizes:f}=B();S(()=>{f.width.value&&(e.setCamera(r.value),e.setResolutionFromRenderer(r.value,u.value))});const{onBeforeLoop:c}=z();return c(({delta:o})=>{s.value+=o*2,r.value&&f.width.value&&(r.value.updateMatrixWorld(),e.update())}),(o,t)=>(w(),P("TresGroup",null,[v("primitive",{object:_(e).group},null,8,re)]))}}),ie=["object"],se=M({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20}},setup(n){const i=n,s=L({enableDamping:!0,dampingFactor:.05}),a=T(),{camera:e,renderer:r,scene:u}=B(),f=new X;f.coordType=J;const c=new Y;c.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",c.showTileNo=!1,c.useWorker=!0;const o=new ee(f,c);o.showBoundingBox=!1,o.wireframe=!1,o.flatShading=!1,o.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let t=new h("#4688b5");o.filter.monochrome={r:t.r,g:t.g,b:t.b};const l=new Q;l.provider=o,l.bbox=i.bbox,l.maxZoom=i.maxZoom;let p=!1,d=!1;S(()=>{e.value&&!p&&(p=!0,l.camera=e.value),a.value&&!d&&(d=!0,a.value.value.target.x=e.value.position.x,a.value.value.target.y=e.value.position.y,a.value.value.target.z=0)});const{onLoop:g}=z();return g(()=>{if(r.value){const m=Math.abs(e.value.position.z)*50;e.value.far=m+5e3,e.value.updateProjectionMatrix(),a.value&&(a.value.value.target.z=0),l.update(),r.value.render(u.value,e.value)}}),(m,de)=>(w(),P(N,null,[x(_(k),O(s,{ref_key:"orbitControlRef",ref:a}),null,16),v("primitive",{object:_(l)},null,8,ie)],64))}}),le=["position"],ue=v("TresAmbientLight",{color:"#ffffff"},null,-1),ce=v("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1),_e=M({__name:"mapBuildings",setup(n){const i=L({clearColor:"#000000",disableRender:!0,alpha:!1,shadowMapType:F,outputColorSpace:H,toneMapping:$}),s=[185098.52598346426,2494608945635518e-9,4712.578125399592];return(a,e)=>(w(),C(_(V),O(i,{"window-size":""}),{default:b(()=>[v("TresPerspectiveCamera",{position:new y(s[0],s[1],s[2]),fov:60,near:1,far:1e8,up:[0,0,1]},null,8,le),ue,ce,x(ne,{position:[185507.52598346426,2494899945635518e-9,21]}),(w(),C(Z,null,{default:b(()=>[x(se,{bbox:[104.955976,20.149765,120.998419,30.528687]})]),_:1}))]),_:1},16))}});export{_e as default};
