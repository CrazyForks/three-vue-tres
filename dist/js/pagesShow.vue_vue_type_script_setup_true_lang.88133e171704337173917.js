import{bh as T,Z as C,k as _,a3 as x,a4 as M,w as A,o as d,c as f,J as s,aM as p,aF as b,aS as S,aT as L,$ as B,a0 as R,a1 as N,a2 as D,aB as G,v as E,C as O,a6 as k,a7 as F,V as v,a as g,a8 as W,a9 as H,aa as I,D as j,W as w,Y as U}from"./vendor.a5074f6a1704337173917.js";import{C as V}from"./vanilla-307d3a93.esm.cc3a48791704337173917.js";import{v as $,f as P,L as Y,a as X,b as z}from"./LineSegments2.11d0123c1704337173917.js";const J=async()=>{const e=await T("./plugins/digitalCity/model/shanghai.FBX");let a=null,t=null,r=null;return e.traverse(o=>{o.name==="CITY_UNTRIANGULATED"&&(a=o),o.name==="LANDMASS"&&(t=o),o.name==="ROADS"&&(r=o)}),{model:e,city:a,land:t,roads:r}},Z=["object"],q=C({__name:"buildingsModelCustomShader",props:{model:{},bulidingsColor:{default:"#e523ff"},landColor:{default:"#112233"},topColor:{default:"#ffff00"},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(n){const e=n,a=_(0),t=e.model.city;t.renderOrder=1001;const r=e.model.land,o=(i,c)=>{let m;i==="cu"||i==="land"&&(m=Array.isArray(r.material)?r.material:[r.material],m.forEach(y=>{y[c].setStyle(e.landColor),y.side=b}))};(()=>{const{geometry:i}=t;i.computeBoundingBox(),i.computeBoundingSphere();const{max:c,min:m}=i.boundingBox;if(t.material.__csm)return;const y=new V({baseMaterial:t.material,vertexShader:$,fragmentShader:P,silent:!0,uniforms:{uMax:{value:c},uMin:{value:m},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new p(e.bulidingsColor)},uOpacity:{value:e.opacity},uLightColor:{value:new p("#ffffff")},uTopColor:{value:new p(e.topColor)},uTime:a,uGradient:{value:e.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:b});t.material.dispose(),t.material=y})();const{onLoop:u}=x();u(({delta:i})=>{a.value+=i}),M(()=>{e.bulidingsColor&&t.material.uniforms.uColor.value.setStyle(e.bulidingsColor),e.landColor&&o("land","color"),e.opacity&&(t.material.uniforms.uOpacity.value=e.opacity)}),A(e,(i,c)=>{t.material.uniforms.uGradient.value=i.gradient});const h=e.model.model.clone();return(i,c)=>(d(),f("primitive",{object:s(h)},null,8,Z))}}),K=["object"],Q=C({__name:"buildingsLines",props:{builds:{},width:{default:1},color:{default:"#FFF"},opacity:{default:1},style:{default:"Wireframe"}},setup(n){const e=n;let a=null,t=null;if(e.style==="Wireframe"){const r=new S(e.builds.geometry);let l=new Y().fromEdgesGeometry(r),u=new X({color:e.color,linewidth:e.width,opacity:e.opacity,transparent:!0,depthWrite:!0,depthTest:!0});u.resolution.set(window.innerWidth,window.innerHeight),a=new z(l,u),a.applyMatrix4(e.builds.matrix.clone())}else{t={transparent:!0,uniforms:{uColor:{value:new p(e.color)},uOpacity:{value:e.opacity}},vertexShader:"\n       void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:" \n        uniform vec3 uColor;\n				uniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "};const r=new S(e.builds.geometry),o=new L(t);a=new LineSegments(r,o),a.applyMatrix4(e.builds.matrix.clone()),a.material.linewidth=e.width,a.renderOrder=1e3}return M(()=>{e.style==="Shader"&&(e.color&&(t.uniforms.uColor.value=new p(e.color)),e.opacity&&(t.uniforms.uOpacity.value=e.opacity)),e.style==="Wireframe"&&(e.color&&(a.material.color=new p(e.color)),e.opacity&&(a.material.opacity=e.opacity)),e.width&&(a.material.linewidth=e.width)}),(r,o)=>(d(),f("primitive",{object:s(a)},null,8,K))}}),ee=v("TresAmbientLight",{color:"#ffffff"},null,-1),te=v("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1),ae={key:1,args:[1e3],position:[0,19,0]},oe={key:2,args:[6e3,100],position:[0,19,0]},se=C({__name:"pagesShow",props:{showBuildings:{type:Boolean,default:!0},autoRotate:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},showGridHelper:{type:Boolean,default:!0},disableRender:{type:Boolean,default:!1}},async setup(n){let e,a;const t=n,r=B({clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0,shadowMapType:R,outputColorSpace:N,toneMapping:D,disableRender:t.disableRender}),o=B({autoRotate:t.autoRotate,enableDamping:!0});let l=null;t.showBuildings&&(l=([e,a]=G(()=>J()),e=await e,a(),e));const u=_(),h=_();return(i,c)=>(d(),E(s(F),k({ref_key:"tcRef",ref:h},r,{"window-size":""}),{default:O(()=>[v("TresPerspectiveCamera",{ref_key:"perspectiveCameraRef",ref:u,position:[600,750,-1221],fov:45,near:1,far:1e5},null,512),g(s(I),W(H(o)),null,16),ee,te,t.showBuildings&&s(l)?(d(),f(j,{key:0},[g(q,{model:s(l)},null,8,["model"]),g(Q,{builds:s(l).city,color:"#000"},null,8,["builds"])],64)):w("",!0),U(i.$slots,"ability"),t.showAxesHelper?(d(),f("TresAxesHelper",ae)):w("",!0),t.showGridHelper?(d(),f("TresGridHelper",oe)):w("",!0)]),_:3},16))}});export{se as _,q as a,Q as b,J as l};
