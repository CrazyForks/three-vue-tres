var yt=Object.defineProperty,Mt=Object.defineProperties;var Tt=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var ue=(r,o,n)=>o in r?yt(r,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[o]=n,_e=(r,o)=>{for(var n in o||(o={}))wt.call(o,n)&&ue(r,n,o[n]);if(Re)for(var n of Re(o))xt.call(o,n)&&ue(r,n,o[n]);return r},De=(r,o)=>Mt(r,Tt(o));var l=(r,o,n)=>(ue(r,typeof o!="symbol"?o+"":o,n),n);import{bh as Pt,a$ as Et,aQ as vt,cA as Ot,b0 as M,cB as K,cC as G,bm as Ae,ck as Le,aE as S,cj as Ze,be as Ct,at as He,cD as jt,bd as Y,b_ as St,br as kt,as as Rt,a2 as _t,au as Dt,cE as At,b9 as Lt,cF as It}from"./vendor.Whz5JOL71710727997925.js";const Ie={type:"change"},de={type:"start"},Ne={type:"end"},ie=new Pt,Fe=new Et,Nt=Math.cos(70*vt.DEG2RAD);class so extends Ot{constructor(o,n){super(),this.object=o,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new M,this.cursor=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:K.ROTATE,MIDDLE:K.DOLLY,RIGHT:K.PAN},this.touches={ONE:G.ROTATE,TWO:G.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",he),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",he),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Ie),e.update(),a=i.NONE},this.update=function(){const t=new M,s=new Ae().setFromUnitVectors(o.up,new M(0,1,0)),d=s.clone().invert(),f=new M,T=new Ae,B=new M,C=2*Math.PI;return function(bt=null){const ke=e.object.position;t.copy(ke).sub(e.target),t.applyQuaternion(s),c.setFromVector3(t),e.autoRotate&&a===i.NONE&&F(te(bt)),e.enableDamping?(c.theta+=u.theta*e.dampingFactor,c.phi+=u.phi*e.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let L=e.minAzimuthAngle,I=e.maxAzimuthAngle;isFinite(L)&&isFinite(I)&&(L<-Math.PI?L+=C:L>Math.PI&&(L-=C),I<-Math.PI?I+=C:I>Math.PI&&(I-=C),L<=I?c.theta=Math.max(L,Math.min(I,c.theta)):c.theta=c.theta>(L+I)/2?Math.max(L,c.theta):Math.min(I,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(m,e.dampingFactor):e.target.add(m),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor),e.zoomToCursor&&N||e.object.isOrthographicCamera?c.radius=ce(c.radius):c.radius=ce(c.radius*p),t.setFromSpherical(c),t.applyQuaternion(d),ke.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(u.theta*=1-e.dampingFactor,u.phi*=1-e.dampingFactor,m.multiplyScalar(1-e.dampingFactor)):(u.set(0,0,0),m.set(0,0,0));let oe=!1;if(e.zoomToCursor&&N){let Q=null;if(e.object.isPerspectiveCamera){const $=t.length();Q=ce($*p);const ne=$-Q;e.object.position.addScaledVector(D,ne),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const $=new M(O.x,O.y,0);$.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix(),oe=!0;const ne=new M(O.x,O.y,0);ne.unproject(e.object),e.object.position.sub(ne).add($),e.object.updateMatrixWorld(),Q=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;Q!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(Q).add(e.object.position):(ie.origin.copy(e.object.position),ie.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(ie.direction))<Nt?o.lookAt(e.target):(Fe.setFromNormalAndCoplanarPoint(e.object.up,e.target),ie.intersectPlane(Fe,e.target))))}else e.object.isOrthographicCamera&&(oe=p!==1,oe&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix()));return p=1,N=!1,oe||f.distanceToSquared(e.object.position)>h||8*(1-T.dot(e.object.quaternion))>h||B.distanceToSquared(e.target)>0?(e.dispatchEvent(Ie),f.copy(e.object.position),T.copy(e.object.quaternion),B.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",je),e.domElement.removeEventListener("pointerdown",Ee),e.domElement.removeEventListener("pointercancel",V),e.domElement.removeEventListener("wheel",ve),e.domElement.removeEventListener("pointermove",le),e.domElement.removeEventListener("pointerup",V),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",he),e._domElementKeyEvents=null)};const e=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=i.NONE;const h=1e-6,c=new Le,u=new Le;let p=1;const m=new M,b=new S,y=new S,j=new S,v=new S,w=new S,E=new S,x=new S,k=new S,_=new S,D=new M,O=new S;let N=!1;const g=[],A={};let X=!1;function te(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function U(t){const s=Math.abs(t*.01);return Math.pow(.95,e.zoomSpeed*s)}function F(t){u.theta-=t}function W(t){u.phi-=t}const z=function(){const t=new M;return function(d,f){t.setFromMatrixColumn(f,0),t.multiplyScalar(-d),m.add(t)}}(),P=function(){const t=new M;return function(d,f){e.screenSpacePanning===!0?t.setFromMatrixColumn(f,1):(t.setFromMatrixColumn(f,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(d),m.add(t)}}(),Z=function(){const t=new M;return function(d,f){const T=e.domElement;if(e.object.isPerspectiveCamera){const B=e.object.position;t.copy(B).sub(e.target);let C=t.length();C*=Math.tan(e.object.fov/2*Math.PI/180),z(2*d*C/T.clientHeight,e.object.matrix),P(2*f*C/T.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(z(d*(e.object.right-e.object.left)/e.object.zoom/T.clientWidth,e.object.matrix),P(f*(e.object.top-e.object.bottom)/e.object.zoom/T.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function ae(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?p/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function fe(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?p*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function se(t,s){if(!e.zoomToCursor)return;N=!0;const d=e.domElement.getBoundingClientRect(),f=t-d.left,T=s-d.top,B=d.width,C=d.height;O.x=f/B*2-1,O.y=-(T/C)*2+1,D.set(O.x,O.y,1).unproject(e.object).sub(e.object.position).normalize()}function ce(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function ge(t){b.set(t.clientX,t.clientY)}function et(t){se(t.clientX,t.clientX),x.set(t.clientX,t.clientY)}function be(t){v.set(t.clientX,t.clientY)}function tt(t){y.set(t.clientX,t.clientY),j.subVectors(y,b).multiplyScalar(e.rotateSpeed);const s=e.domElement;F(2*Math.PI*j.x/s.clientHeight),W(2*Math.PI*j.y/s.clientHeight),b.copy(y),e.update()}function ot(t){k.set(t.clientX,t.clientY),_.subVectors(k,x),_.y>0?ae(U(_.y)):_.y<0&&fe(U(_.y)),x.copy(k),e.update()}function nt(t){w.set(t.clientX,t.clientY),E.subVectors(w,v).multiplyScalar(e.panSpeed),Z(E.x,E.y),v.copy(w),e.update()}function it(t){se(t.clientX,t.clientY),t.deltaY<0?fe(U(t.deltaY)):t.deltaY>0&&ae(U(t.deltaY)),e.update()}function rt(t){let s=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?W(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):Z(0,e.keyPanSpeed),s=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?W(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):Z(0,-e.keyPanSpeed),s=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?F(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):Z(e.keyPanSpeed,0),s=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?F(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):Z(-e.keyPanSpeed,0),s=!0;break}s&&(t.preventDefault(),e.update())}function ye(t){if(g.length===1)b.set(t.pageX,t.pageY);else{const s=H(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);b.set(d,f)}}function Me(t){if(g.length===1)v.set(t.pageX,t.pageY);else{const s=H(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);v.set(d,f)}}function Te(t){const s=H(t),d=t.pageX-s.x,f=t.pageY-s.y,T=Math.sqrt(d*d+f*f);x.set(0,T)}function at(t){e.enableZoom&&Te(t),e.enablePan&&Me(t)}function st(t){e.enableZoom&&Te(t),e.enableRotate&&ye(t)}function we(t){if(g.length==1)y.set(t.pageX,t.pageY);else{const d=H(t),f=.5*(t.pageX+d.x),T=.5*(t.pageY+d.y);y.set(f,T)}j.subVectors(y,b).multiplyScalar(e.rotateSpeed);const s=e.domElement;F(2*Math.PI*j.x/s.clientHeight),W(2*Math.PI*j.y/s.clientHeight),b.copy(y)}function xe(t){if(g.length===1)w.set(t.pageX,t.pageY);else{const s=H(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);w.set(d,f)}E.subVectors(w,v).multiplyScalar(e.panSpeed),Z(E.x,E.y),v.copy(w)}function Pe(t){const s=H(t),d=t.pageX-s.x,f=t.pageY-s.y,T=Math.sqrt(d*d+f*f);k.set(0,T),_.set(0,Math.pow(k.y/x.y,e.zoomSpeed)),ae(_.y),x.copy(k);const B=(t.pageX+s.x)*.5,C=(t.pageY+s.y)*.5;se(B,C)}function ct(t){e.enableZoom&&Pe(t),e.enablePan&&xe(t)}function lt(t){e.enableZoom&&Pe(t),e.enableRotate&&we(t)}function Ee(t){e.enabled!==!1&&(g.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",le),e.domElement.addEventListener("pointerup",V)),ft(t),t.pointerType==="touch"?Ce(t):ht(t))}function le(t){e.enabled!==!1&&(t.pointerType==="touch"?mt(t):ut(t))}function V(t){switch(gt(t),g.length){case 0:e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",le),e.domElement.removeEventListener("pointerup",V),e.dispatchEvent(Ne),a=i.NONE;break;case 1:const s=g[0],d=A[s];Ce({pointerId:s,pageX:d.x,pageY:d.y});break}}function ht(t){let s;switch(t.button){case 0:s=e.mouseButtons.LEFT;break;case 1:s=e.mouseButtons.MIDDLE;break;case 2:s=e.mouseButtons.RIGHT;break;default:s=-1}switch(s){case K.DOLLY:if(e.enableZoom===!1)return;et(t),a=i.DOLLY;break;case K.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;be(t),a=i.PAN}else{if(e.enableRotate===!1)return;ge(t),a=i.ROTATE}break;case K.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;ge(t),a=i.ROTATE}else{if(e.enablePan===!1)return;be(t),a=i.PAN}break;default:a=i.NONE}a!==i.NONE&&e.dispatchEvent(de)}function ut(t){switch(a){case i.ROTATE:if(e.enableRotate===!1)return;tt(t);break;case i.DOLLY:if(e.enableZoom===!1)return;ot(t);break;case i.PAN:if(e.enablePan===!1)return;nt(t);break}}function ve(t){e.enabled===!1||e.enableZoom===!1||a!==i.NONE||(t.preventDefault(),e.dispatchEvent(de),it(dt(t)),e.dispatchEvent(Ne))}function dt(t){const s=t.deltaMode,d={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(s){case 1:d.deltaY*=16;break;case 2:d.deltaY*=100;break}return t.ctrlKey&&!X&&(d.deltaY*=10),d}function pt(t){t.key==="Control"&&(X=!0,e.domElement.getRootNode().addEventListener("keyup",Oe,{passive:!0,capture:!0}))}function Oe(t){t.key==="Control"&&(X=!1,e.domElement.getRootNode().removeEventListener("keyup",Oe,{passive:!0,capture:!0}))}function he(t){e.enabled===!1||e.enablePan===!1||rt(t)}function Ce(t){switch(Se(t),g.length){case 1:switch(e.touches.ONE){case G.ROTATE:if(e.enableRotate===!1)return;ye(t),a=i.TOUCH_ROTATE;break;case G.PAN:if(e.enablePan===!1)return;Me(t),a=i.TOUCH_PAN;break;default:a=i.NONE}break;case 2:switch(e.touches.TWO){case G.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;at(t),a=i.TOUCH_DOLLY_PAN;break;case G.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;st(t),a=i.TOUCH_DOLLY_ROTATE;break;default:a=i.NONE}break;default:a=i.NONE}a!==i.NONE&&e.dispatchEvent(de)}function mt(t){switch(Se(t),a){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;we(t),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;xe(t),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;ct(t),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;lt(t),e.update();break;default:a=i.NONE}}function je(t){e.enabled!==!1&&t.preventDefault()}function ft(t){g.push(t.pointerId)}function gt(t){delete A[t.pointerId];for(let s=0;s<g.length;s++)if(g[s]==t.pointerId){g.splice(s,1);return}}function Se(t){let s=A[t.pointerId];s===void 0&&(s=new S,A[t.pointerId]=s),s.set(t.pageX,t.pageY)}function H(t){const s=t.pointerId===g[0]?g[1]:g[0];return A[s]}e.domElement.addEventListener("contextmenu",je),e.domElement.addEventListener("pointerdown",Ee),e.domElement.addEventListener("pointercancel",V),e.domElement.addEventListener("wheel",ve,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",pt,{passive:!0,capture:!0}),this.update()}}var Ft=Math.PI/180,Wt=180/Math.PI;function Ke(r){var o=We(r[0]+1,r[2]),n=We(r[0],r[2]),e=Be(r[1]+1,r[2]),i=Be(r[1],r[2]);return[n,e,o,i]}function Bt(r){var o=Ke(r),n={type:"Polygon",coordinates:[[[o[0],o[3]],[o[0],o[1]],[o[2],o[1]],[o[2],o[3]],[o[0],o[3]]]]};return n}function We(r,o){return r/Math.pow(2,o)*360-180}function Be(r,o){var n=Math.PI-2*Math.PI*r/Math.pow(2,o);return Wt*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function pe(r,o,n){var e=Je(r,o,n);return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e}function Ge(r){return[[r[0]*2,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2+1,r[2]+1],[r[0]*2,r[1]*2+1,r[2]+1]]}function qe(r){return[r[0]>>1,r[1]>>1,r[2]-1]}function Ve(r){return Ge(qe(r))}function Yt(r,o){for(var n=Ve(r),e=0;e<n.length;e++)if(!Qe(o,n[e]))return!1;return!0}function Qe(r,o){for(var n=0;n<r.length;n++)if($e(r[n],o))return!0;return!1}function $e(r,o){return r[0]===o[0]&&r[1]===o[1]&&r[2]===o[2]}function Ut(r){for(var o="",n=r[2];n>0;n--){var e=0,i=1<<n-1;r[0]&i&&e++,r[1]&i&&(e+=2),o+=e.toString()}return o}function zt(r){for(var o=0,n=0,e=r.length,i=e;i>0;i--){var a=1<<i-1,h=+r[e-i];h===1&&(o|=a),h===2&&(n|=a),h===3&&(o|=a,n|=a)}return[o,n,e]}function Xt(r){var o=pe(r[0],r[1],32),n=pe(r[2],r[3],32),e=[o[0],o[1],n[0],n[1]],i=Zt(e);if(i===0)return[0,0,0];var a=e[0]>>>32-i,h=e[1]>>>32-i;return[a,h,i]}function Zt(r){for(var o=28,n=0;n<o;n++){var e=1<<32-(n+1);if((r[0]&e)!==(r[2]&e)||(r[1]&e)!==(r[3]&e))return n}return o}function Je(r,o,n){var e=Math.sin(o*Ft),i=Math.pow(2,n),a=i*(r/360+.5),h=i*(.5-.25*Math.log((1+e)/(1-e))/Math.PI);return a=a%i,a<0&&(a=a+i),[a,h,n]}var re={tileToGeoJSON:Bt,tileToBBOX:Ke,getChildren:Ge,getParent:qe,getSiblings:Ve,hasTile:Qe,hasSiblings:Yt,tilesEqual:$e,tileToQuadkey:Ut,quadkeyToTile:zt,pointToTile:pe,bboxToTile:Xt,pointToTileFraction:Je};class me extends Ze{constructor(){super();l(this,"map");l(this,"tileNo");l(this,"isDisposed",!1);l(this,"isReady",!1);l(this,"parentTile");l(this,"childrenTiles",[]);l(this,"boundingBoxWorld",new Ct);l(this,"content")}init(n,e,i){this.tileNo=n,Object.freeze(this.tileNo),this.map=e,this.parentTile=i,this.visible=!1,this.renderOrder=n[2],this.ready()}async ready(){if(this.content=await this.map.provider.getTile(this.tileNo),!this.isDisposed){if(this.add(this.content),this.boundingBoxWorld.setFromObject(this.content).applyMatrix4(this.matrixWorld.makeRotationX(-Math.PI/2)),this.map.add(this),this.visible=!0,this.isReady=!0,this.parentTile){const n=this.parentTile.childrenTiles;let e=0;for(let i=0;i<n.length;i++)n[i].isReady&&e++;e===4&&(this.parentTile.visible=!1)}this.update()}}update(){if(!this.isReady||this.isDisposed)return;const{cameraFrustum:n,cameraWorldPosition:e}=this.map;if(!n.intersectsBox(this.boundingBoxWorld)){this.simplify();return}this.content instanceof He&&this.map.provider.filter&&(this.content.material.uniforms.t_Matrix.value=this.map.provider.getTranMatrix());let i=this.boundingBoxWorld.distanceToPoint(e);const a=this.tileNo[2];i/=Math.pow(2,this.map.provider.maxZoom-a),i<60&&this.subdivide(),i>80&&this.simplify(),this.childrenTiles.sort((c,u)=>c.boundingBoxWorld.distanceToPoint(e)-u.boundingBoxWorld.distanceToPoint(e)).forEach(c=>c.update())}subdivide(){const{isReady:n,tileNo:e,map:i,childrenTiles:a}=this,h=e[2];if(!n||a.length>0||h>=i.maxZoom)return;re.getChildren(e).forEach(u=>{const p=new me;p.init(u,i,this),a.push(p)})}simplify(){this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.visible=!0}dispose(){this.map.remove(this),this.map.provider.abort(this.tileNo),this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.parentTile=void 0,this.content&&(this.map.provider.dispose(this.tileNo,this.content),this.content=void 0),this.isDisposed=!0}}let co=class extends Ze{constructor(){super(...arguments);l(this,"provider");l(this,"bbox",[74.390592,6.900905,134.071423,54.318199]);l(this,"maxZoom",20);l(this,"rootForward",0);l(this,"camera");l(this,"cameraFrustum",new jt);l(this,"cameraWorldPosition",new M);l(this,"cameraProjectionMatrix",new Y);l(this,"lastCameraProjectionMatrix",new Y);l(this,"lastCameraWorldPosition",new M);l(this,"rootTiles",[]);l(this,"lastUpdateTime",0)}initRootTiles(){this.rootForward>3&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=3),this.rootForward<0&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=0);const n=[];let e=[re.bboxToTile(this.bbox)],i=this.rootForward;for(;i>0;){const a=[...e];e=[],a.forEach(h=>{const c=re.getChildren(h);e.push(...c)}),i--}n.push(...e),n.forEach(a=>{const h=new me;h.init(a,this),this.rootTiles.push(h)})}update(){if(!this.visible||!this.camera)return;const n=Date.now();if(!(n-this.lastUpdateTime<300)){if(this.rootTiles.length===0){this.initRootTiles();return}this.camera.getWorldPosition(this.cameraWorldPosition),this.cameraProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),!(this.cameraWorldPosition.equals(this.lastCameraWorldPosition)&&this.cameraProjectionMatrix.equals(this.lastCameraProjectionMatrix))&&(this.cameraFrustum.setFromProjectionMatrix(this.cameraProjectionMatrix),this.rootTiles.forEach(e=>e.update()),this.lastCameraProjectionMatrix.copy(this.cameraProjectionMatrix),this.lastCameraWorldPosition.copy(this.cameraWorldPosition),this.lastUpdateTime=n)}}dispose(){throw new Error("[Map.dispose] Method not implemented.")}regenerate(){throw new Error("[Map.regenerate] Method not implemented.")}};const q=class q{constructor(){l(this,"_controller",new AbortController);l(this,"listeners",new Set)}fetch(o,n={}){q.pendings.has(o)||(q.pendings.set(o,this),fetch(o,De(_e({},n),{signal:this._controller.signal})).then(e=>{this.listeners.forEach(i=>i.resolve(e.clone()))}).catch(e=>{this.listeners.forEach(i=>i.reject(e))}).finally(()=>{q.pendings.delete(o)}))}abort(){this._controller.abort()}};l(q,"pendings",new Map);let ee=q;class Ht{constructor(o,n){l(this,"resolve");l(this,"reject");l(this,"promise");this.url=o,this.init=n,this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}ready(){let o=ee.pendings.get(this.url);return o||(o=new ee,o.fetch(this.url,this.init)),o.listeners.add(this),this.promise}abort(){this.reject("User abort.");const o=ee.pendings.get(this.url);o&&(o.listeners.delete(this),o.listeners.size===0&&o.abort())}}let J;async function Kt(r,o,n=!1){const i=await(await o.ready()).blob(),a=await createImageBitmap(i,n?void 0:{imageOrientation:"flipY"});if(!n)return a;J||(J=new OffscreenCanvas(256,256));const h=J.getContext("2d");if(!h)throw new Error('Offscreencanvas.getContext("2d") error!');const{width:c,height:u}=J;return h.drawImage(a,0,0),h.rect(0,0,c,u),h.strokeStyle="#00FFFF",h.font="20px Arial",h.stroke(),h.fillStyle="#FF4444",h.fillText("".concat(r[0]),10,30),h.fillStyle="#44FF44",h.fillText("".concat(r[1]),10,55),h.fillStyle="#66AAFF",h.fillText("".concat(r[2]),10,80),await createImageBitmap(J,{imageOrientation:"flipY"})}class Gt{constructor(o){l(this,"worker");l(this,"terminated",!0);l(this,"map",new Map);this.worker=new o,this.worker.onmessage=this.onMessage.bind(this),this.terminated=!1}async postMessage(o){if(!this.terminated)return this.worker.postMessage(o),new Promise((n,e)=>{this.map.set(o.id,n)})}onMessage(o){const{id:n,error:e}=o.data,i=this.map.get(n);i&&!e&&i(o.data),this.map.delete(n)}terminate(){this.worker.onmessage=null,this.worker.terminate(),this.terminated=!0,this.map.clear()}}function qt(r){return new Worker(""+new URL("../static/MapWorker-P8uJfnMJ.js",import.meta.url).href,{name:r==null?void 0:r.name})}class ho{constructor(){l(this,"maxZoom",20);l(this,"source","https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s&x=[x]&y=[y]&z=[z]");l(this,"showTileNo",!1);l(this,"_useWorker",!1);l(this,"_worker");l(this,"fetching",new Map)}set useWorker(o){var n;this._useWorker=o,this._useWorker||((n=this._worker)==null||n.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(o){const n=this.getUrl(o),e=new St;if(this._useWorker){this._worker||(this._worker=new Gt(qt));const i=this.getId(o),a=await this._worker.postMessage({id:i,tileNo:o,url:n,debug:this.showTileNo});e.image=a.bitmap}else{const i=new Ht(n,{cache:"force-cache",mode:"cors"});this.fetching.set(o,i);try{e.image=await Kt(o,i,this.showTileNo)}finally{this.fetching.delete(o)}}return e.needsUpdate=!0,e.anisotropy=4,e}abort(o){var n;if(this._useWorker)(n=this._worker)==null||n.postMessage({id:this.getId(o),abort:!0});else{const e=this.fetching.get(o);e&&e.abort(),this.fetching.delete(o)}}dispose(o,n){n.dispose()}getId(o){return o.join("-")}getUrl(o){const[n,e,i]=o;return this.source.indexOf("[x]")===-1?this.source.replace("{x}",n+"").replace("{y}",e+"").replace("{z}",i+""):this.source.replace("[x]",n+"").replace("[y]",e+"").replace("[z]",i+"")}}const Ye="utm",Vt="merc",Ue=6378137,ze=Math.PI/180;function Xe(r,o){const n=Ue*r*ze,e=Ue*Math.log(Math.tan(Math.PI*.25+o*ze*.5));return[n,e]}function R(r){return r*Math.PI/180}const Qt={a:6378137,b:6356752314245e-6,f:1/298.257223563},$t="CDEFGHJKLMNPQRSTUVWXX",Jt=5e5,eo=1e7;function to(r,o,n){if(!(-80<=o&&o<=84))throw new RangeError("latitude ‘".concat(o,"’ outside UTM limits"));let e=n||Math.floor((r+180)/6)+1,i=R((e-1)*6-180+3);const a=$t.charAt(Math.floor(o/8+10));e===31&&a==="V"&&r>=3?(e++,i+=R(6)):e===32&&a==="X"&&r<9?(e--,i-=R(6)):e===32&&a==="X"&&r>=9?(e++,i+=R(6)):e===34&&a==="X"&&r<21?(e--,i-=R(6)):e===34&&a==="X"&&r>=21?(e++,i+=R(6)):e===36&&a==="X"&&r<33?(e--,i-=R(6)):e===36&&a==="X"&&r>=33&&(e++,i+=R(6));const h=R(o),c=R(r)-i,{a:u,f:p}=Qt,m=.9996,b=Math.sqrt(p*(2-p)),y=p/(2-p),j=y*y,v=y*j,w=y*v,E=y*w,x=y*E,k=Math.cos(c),_=Math.sin(c),D=Math.tan(h),O=Math.sinh(b*Math.atanh(b*D/Math.sqrt(1+D*D))),N=D*Math.sqrt(1+O*O)-O*Math.sqrt(1+D*D),g=Math.atan2(N,k),A=Math.asinh(_/Math.sqrt(N*N+k*k)),X=u/(1+y)*(1+1/4*j+1/64*w+1/256*x),te=[null,1/2*y-2/3*j+5/16*v+41/180*w-127/288*E+7891/37800*x,13/48*j-3/5*v+557/1440*w+281/630*E-1983433/1935360*x,61/240*v-103/140*w+15061/26880*E+167603/181440*x,49561/161280*w-179/168*E+6601661/7257600*x,34729/80640*E-3418889/1995840*x,212378941/319334400*x];let U=g;for(let P=1;P<=6;P++)U+=te[P]*Math.sin(2*P*g)*Math.cosh(2*P*A);let F=A;for(let P=1;P<=6;P++)F+=te[P]*Math.cos(2*P*g)*Math.sinh(2*P*A);let W=m*X*F,z=m*X*U;return W=W+Jt,z<0&&(z=z+eo),[W,z]}class uo{constructor(){l(this,"utmZone",50);l(this,"coordType",Ye);l(this,"maxZoom",20)}async getTile(o){const n=new kt,e=re.tileToBBOX(o),i=this.convertCoordinate(e[0],e[3]),a=this.convertCoordinate(e[2],e[3]),h=this.convertCoordinate(e[0],e[1]),c=this.convertCoordinate(e[2],e[1]),u=new Float32Array([i[0],i[1],0,a[0],a[1],0,h[0],h[1],0,c[0],c[1],0]);return n.setAttribute("position",new Rt(u,3)),n}abort(o){}dispose(o,n){n.dispose()}convertCoordinate(o,n){switch(this.coordType){case Ye:return to(o,n,this.utmZone);case Vt:return Xe(o,n);default:return Xe(o,n)}}}class oo extends He{constructor(n){super(n);l(this,"center",new M)}}class po{constructor(o,n){l(this,"maxZoom",20);l(this,"showBoundingBox",!1);l(this,"wireframe",!1);l(this,"flatShading",!1);l(this,"useStandardMaterial",!1);l(this,"filter",null);this.geometryProvider=o,this.textureProvider=n}getTranMatrix(){var n,e,i,a,h;let o=new Y;if((n=this.filter)!=null&&n.opposite){let c=new Y;c.set(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),o.multiply(c)}if((e=this.filter)!=null&&e.monochrome){let c=new Y;const u=this.filter.monochrome.r,p=this.filter.monochrome.g,m=this.filter.monochrome.b;c.set(u,p,m,0,u,p,m,0,u,p,m,0,0,0,0,1),o.multiply(c)}if((i=this.filter)!=null&&i.genBright){let c=new Y;const u=this.filter.genBright;c.set(u,0,0,0,0,u,0,0,0,0,u,0,0,0,0,1),o.multiply(c)}if((a=this.filter)!=null&&a.genContrast){let c=new Y;const u=this.filter.genContrast,p=.5*(1-u);c.set(u,0,0,0,0,u,0,0,0,0,u,0,p,p,p,1),o.multiply(c)}if((h=this.filter)!=null&&h.genSaturate){let c=new Y;const u=this.filter.genSaturate,p=.3*(1-u),m=.6*(1-u),b=.1*(1-u);c.set(p+u,p,p,0,m,m+u,m,0,b,b,b+u,0,0,0,0,1),o.multiply(c)}return o}async getTile(o){const n=[this.geometryProvider.getTile(o),this.textureProvider.getTile(o)],e=await Promise.all(n),i=e[0],a=e[1];a.colorSpace=_t;const{wireframe:h,flatShading:c}=this;let u=null;const p=o[0]+o[1]+o[2];this.filter?u=new Dt({wireframe:h,depthTest:!0,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:1,uniforms:{e_Texture:{value:a},t_Matrix:{value:this.getTranMatrix()}},vertexShader:"\n                varying vec2 v_Uv;    //顶点纹理坐标\n                void main () {\n                    v_Uv = uv;\n                    // gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 ); 着色器会抖动\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n                ",fragmentShader:"\n                uniform sampler2D e_Texture;     //纹理图像\n                varying vec2 v_Uv;               //片元纹理坐标\n                uniform mat4 t_Matrix;     //接收变换矩阵\n                void main () {\n                    // gl_FragColor = texture2D( e_Texture, v_Uv );\n\n                    // vec4 textureColor = texture2D( e_Texture, v_Uv );\n                    // //计算加权平均值\n                    // float w_a = textureColor.r * 0.3 + textureColor.g * 0.6 + textureColor.b * 0.1;\n                    // gl_FragColor = vec4(w_a, w_a, w_a, 1.0);\n\n                    vec4 textureColor = texture2D( e_Texture, v_Uv );\n                    //变换矩阵乘以 vec4(R,G,B,1)    --->vec4(R,G,B,1) 是齐次坐标，原本是n维的向量用一个n+1维向量来表示\n                    //vec4(R,G,B,1)第四个分量不是透明度\n                    vec4 transColor =  vec4(textureColor.r, textureColor.g, textureColor.b, 1.0)*t_Matrix; \n                    //设置透明度\n                    transColor.a = 1.0;\n                    gl_FragColor = transColor;\n                }"}):u=this.useStandardMaterial?new At({map:a,wireframe:h,flatShading:c}):new Lt({map:a,wireframe:h});const m=new oo;if(m.renderOrder=p,i.computeBoundingBox(),i.boundingBox.getCenter(m.center),i.center(),i.computeBoundingSphere(),m.position.copy(m.center),m.geometry=i,m.material=u,this.showBoundingBox){const b=new It(i.boundingBox);m.add(b)}return m}abort(o){this.geometryProvider.abort(o),this.textureProvider.abort(o)}dispose(o,n){const e=n.geometry,i=n.material;e&&this.geometryProvider.dispose(o,e),i&&i.map&&this.textureProvider.dispose(o,i.map),i==null||i.dispose()}}export{co as M,so as O,uo as P,po as T,Ye as U,ho as a,Gt as b,Vt as c,Xe as d,to as l};
