import{aJ as Gz,bl as uf,bH as mf,bI as pf,aV as wc,bt as yf,bJ as Jz,a_ as _b,aM as mc,bK as Wz,aZ as Uz,aH as xc,b2 as xf,aY as Oz,a$ as Hz,bs as jz,aX as gf,Z as If,aN as $z,aA as Kz,aQ as qz,b6 as kc,b8 as am,bL as tm,a4 as rm,w as im,o as vb,c as om,V as sc,J as pc,D as nm,$ as em,af as sm,v as Mf,C as zf,a7 as _m,a as sb,aa as vm,ay as lm,aD as hm,a8 as cm,a9 as bm}from"./vendor.e78e09731703301023089.js";function fm(){const Ja=new Gz;return Ja.setAttribute("position",new uf([-1,3,0,-1,-1,0,3,-1,0],3)),Ja.setAttribute("uv",new uf([0,2,0,0,2,0],2)),Ja}const um="\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture(image, uv) * 0.1964825501511404;\n  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n",xm="\nfloat random(vec2 co) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(co.xy, vec2(a, b));\n    float sn = mod(dt, 3.14);\n    return fract(sin(sn) * c);\n}\n",Mm="\n".concat(xm,"\n\nvec3 dither(vec3 color) {\n    // Calculate grid position\n    float grid_position = random(gl_FragCoord.xy);\n\n    // Shift the individual colors differently, thus making it even harder to see the dithering pattern\n    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);\n\n    // Modify shift acording to grid position\n    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);\n\n    // Shift the color by dither_shift\n    return color + dither_shift_RGB;\n}\n"),zm="\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n",mm="\nin vec3 position;\nin vec2 uv;\n\nout vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = vec4(position, 1.0);\n}\n",pm="\nprecision highp float;\n\nuniform sampler2D tMap;\nuniform vec2 uDirection;\nuniform vec2 uResolution;\n\nin vec2 vUv;\n\nout vec4 FragColor;\n\n".concat(zm,"\n").concat(um,"\n\nvoid main() {\n    FragColor = blur13(tMap, vUv, uResolution, smootherstep(1.0, 0.0, vUv.y) * uDirection);\n}\n");class ym extends mf{constructor(){super({glslVersion:pf,uniforms:{tMap:{value:null},uDirection:{value:new wc(1,0)},uResolution:{value:new wc}},vertexShader:mm,fragmentShader:pm,blending:yf,depthTest:!1,depthWrite:!1})}}const gm="\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat3 uMapTransform;\nuniform mat4 uMatrix;\n\nout vec2 vUv;\nout vec4 vCoord;\nout vec3 vNormal;\nout vec3 vToEye;\n\nvoid main() {\n    vUv = (uMapTransform * vec3(uv, 1.0)).xy;\n    vCoord = uMatrix * vec4(position, 1.0);\n    vNormal = normalMatrix * normal;\n\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vToEye = cameraPosition - worldPosition.xyz;\n\n    vec4 mvPosition = viewMatrix * worldPosition;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",Im="\nprecision highp float;\n\nuniform sampler2D tReflect;\nuniform vec3 uColor;\nuniform float uReflectivity;\nuniform float uMirror;\nuniform float uMixStrength;\n\n#ifdef USE_MAP\n    uniform sampler2D tMap;\n#endif\n\n#ifdef USE_NORMALMAP\n    uniform sampler2D tNormalMap;\n    uniform vec2 uNormalScale;\n#endif\n\n#ifdef USE_FOG\n    uniform vec3 uFogColor;\n    uniform float uFogNear;\n    uniform float uFogFar;\n#endif\n\nin vec2 vUv;\nin vec4 vCoord;\nin vec3 vNormal;\nin vec3 vToEye;\n\nout vec4 FragColor;\n\n".concat(Mm,"\n\nvoid main() {\n    #ifdef USE_MAP\n        vec4 color = texture(tMap, vUv);\n    #else\n        vec4 color = vec4(uColor, 1.0);\n    #endif\n\n    #ifdef USE_NORMALMAP\n        vec4 normalColor = texture(tNormalMap, vUv * uNormalScale);\n        vec3 normal = normalize(vec3(normalColor.r * 2.0 - 1.0, normalColor.b, normalColor.g * 2.0 - 1.0));\n        vec3 coord = vCoord.xyz / vCoord.w;\n        vec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n        vec4 reflectColor = texture(tReflect, uv);\n    #else\n        vec3 normal = vNormal;\n        vec4 reflectColor = textureProj(tReflect, vCoord);\n    #endif\n\n    // Fresnel term\n    vec3 toEye = normalize(vToEye);\n    float theta = max(dot(toEye, normal), 0.0);\n    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);\n\n    reflectColor = mix(vec4(0), reflectColor, reflectance);\n\n    FragColor.rgb = color.rgb * ((1.0 - min(1.0, uMirror)) + reflectColor.rgb * uMixStrength);\n\n    #ifdef USE_FOG\n        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;\n        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);\n\n        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);\n    #endif\n\n    #ifdef DITHERING\n        FragColor.rgb = dither(FragColor.rgb);\n    #endif\n\n    FragColor.a = 1.0;\n}\n");class Vm extends mf{constructor({color:a=new mc(1052688),map:t=null,normalMap:r=null,normalScale:i=new wc(1,1),reflectivity:o=0,mirror:_=0,mixStrength:s=10,fog:h=null,dithering:v=!1}={}){const e={glslVersion:pf,defines:{},uniforms:{tMap:{value:null},tReflect:{value:null},uMapTransform:{value:new Jz},uMatrix:{value:new _b},uColor:{value:a instanceof mc?a:new mc(a)},uReflectivity:{value:o},uMirror:{value:_},uMixStrength:{value:s}},vertexShader:gm,fragmentShader:Im,blending:yf};t&&(t.updateMatrix(),e.defines=Object.assign(e.defines,{USE_MAP:""}),e.uniforms=Object.assign(e.uniforms,{tMap:{value:t},uMapTransform:{value:t.matrix}})),r&&(e.defines=Object.assign(e.defines,{USE_NORMALMAP:""}),e.uniforms=Object.assign(e.uniforms,{tNormalMap:{value:r},uNormalScale:{value:i}}),t||(r.updateMatrix(),e.uniforms=Object.assign(e.uniforms,{uMapTransform:{value:r.matrix}}))),h&&(e.defines=Object.assign(e.defines,{USE_FOG:""}),e.uniforms=Object.assign(e.uniforms,{uFogColor:{value:h.color},uFogNear:{value:h.near},uFogFar:{value:h.far}})),v&&(e.defines=Object.assign(e.defines,{DITHERING:""})),super(e)}}class km extends Wz{constructor({width:a=512,height:t=512,clipBias:r=0,blurIterations:i=8}={}){super(),this.clipBias=r,this.blurIterations=i,this.reflectorPlane=new Uz,this.normal=new xc,this.reflectorWorldPosition=new xc,this.cameraWorldPosition=new xc,this.rotationMatrix=new _b,this.lookAtPosition=new xc(0,0,-1),this.clipPlane=new xf,this.view=new xc,this.target=new xc,this.q=new xf,this.textureMatrix=new _b,this.virtualCamera=new Oz,this.textureMatrixUniform={value:this.textureMatrix},this.renderTarget=new Hz(a,t,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform={value:this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture},this.blurMaterial=new ym,this.blurMaterial.uniforms.uResolution.value.set(a,t),this.screenCamera=new jz(-1,1,1,-1,0,1),this.screenTriangle=fm(),this.screen=new gf(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1}setSize(a,t){this.renderTarget.setSize(a,t),this.renderTargetRead.setSize(a,t),this.renderTargetWrite.setSize(a,t),this.blurMaterial.uniforms.uResolution.value.set(a,t)}update(a,t,r){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(r.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(r.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=r.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(r.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const i=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+i.elements[8])/i.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+i.elements[9])/i.elements[5],this.q.z=-1,this.q.w=(1+i.elements[10])/i.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),i.elements[2]=this.clipPlane.x,i.elements[6]=this.clipPlane.y,i.elements[10]=this.clipPlane.z+1-this.clipBias,i.elements[14]=this.clipPlane.w;const o=a.getRenderTarget(),_=a.xr.enabled,s=a.shadowMap.autoUpdate;a.xr.enabled=!1,a.shadowMap.autoUpdate=!1,a.setRenderTarget(this.renderTarget),a.state.buffers.depth.setMask(!0),a.autoClear===!1&&a.clear(),a.render(t,this.virtualCamera);const h=this.blurIterations;for(let v=0;v<h;v++){v===0?this.blurMaterial.uniforms.tMap.value=this.renderTarget.texture:this.blurMaterial.uniforms.tMap.value=this.renderTargetRead.texture;const e=(h-v-1)*.5;this.blurMaterial.uniforms.uDirection.value.set(v%2===0?e:0,v%2===0?0:e),a.setRenderTarget(this.renderTargetWrite),a.autoClear===!1&&a.clear(),a.render(this.screen,this.screenCamera);const l=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=l,this.renderTargetUniform.value=this.renderTargetRead.texture}a.xr.enabled=_,a.shadowMap.autoUpdate=s,a.setRenderTarget(o)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const a in this)this[a]=null;return null}}var x=x||{};x.collision||(x.collision={});x.collision.broadphase||(x.collision.broadphase={});x.collision.broadphase.BroadPhase=class{constructor(a){this._type=a,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new x.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new x.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new x.common.Transform,this.zero=new x.common.Vec3,this.rayCastHit=new x.collision.geometry.RayCastHit}createProxy(a,t){return null}destroyProxy(a){}moveProxy(a,t,r){}isOverlapping(a,t){return a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ?a._aabbMaxZ>t._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(a,t,r){}convexCast(a,t,r,i){}aabbTest(a,t){}};x.collision.geometry||(x.collision.geometry={});x.collision.geometry.Geometry=class{constructor(a){this._type=a,this._volume=0}_updateMass(){}_computeAabb(a,t){}_rayCastLocal(a,t,r,i,o,_,s){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(a,t,r,i){var o,_,s,h,v,e,l=a;o=l.x,_=l.y,s=l.z;var u=t;h=u.x,v=u.y,e=u.z,o-=r._positionX,_-=r._positionY,s-=r._positionZ,h-=r._positionX,v-=r._positionY,e-=r._positionZ;var b,f,n;b=r._rotation00*o+r._rotation10*_+r._rotation20*s,f=r._rotation01*o+r._rotation11*_+r._rotation21*s,n=r._rotation02*o+r._rotation12*_+r._rotation22*s,o=b,_=f,s=n;var c,M,m;if(c=r._rotation00*h+r._rotation10*v+r._rotation20*e,M=r._rotation01*h+r._rotation11*v+r._rotation21*e,m=r._rotation02*h+r._rotation12*v+r._rotation22*e,h=c,v=M,e=m,this._rayCastLocal(o,_,s,h,v,e,i)){var y,V,z,I,k,X,L=i.position;y=L.x,V=L.y,z=L.z;var p=i.normal;I=p.x,k=p.y,X=p.z;var g,N,A;g=r._rotation00*y+r._rotation01*V+r._rotation02*z,N=r._rotation10*y+r._rotation11*V+r._rotation12*z,A=r._rotation20*y+r._rotation21*V+r._rotation22*z,y=g,V=N,z=A;var F,S,Y;F=r._rotation00*I+r._rotation01*k+r._rotation02*X,S=r._rotation10*I+r._rotation11*k+r._rotation12*X,Y=r._rotation20*I+r._rotation21*k+r._rotation22*X,I=F,k=S,X=Y,y+=r._positionX,V+=r._positionY,z+=r._positionZ;var R=i.position;R.x=y,R.y=V,R.z=z;var C=i.normal;return C.x=I,C.y=k,C.z=X,!0}return!1}};x.collision.geometry.ConvexGeometry=class extends x.collision.geometry.Geometry{constructor(a){super(a),this._gjkMargin=x.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(a){a<0&&(a=0),this._gjkMargin=a}computeLocalSupportingVertex(a,t){}rayCast(a,t,r,i){return this._useGjkRayCast?x.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,r,a,t,i):super.rayCast(a,t,r,i)}};x.collision.broadphase._BroadPhase||(x.collision.broadphase._BroadPhase={});x.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(a,t,r){this.c=a;var i,o,_,s=r;i=s.x,o=s.y,_=s.z;var h,v,e,l,u,b;l=t._rotation00*i+t._rotation10*o+t._rotation20*_,u=t._rotation01*i+t._rotation11*o+t._rotation21*_,b=t._rotation02*i+t._rotation12*o+t._rotation22*_,h=l,v=u,e=b,this.localTranslation=new x.common.Vec3;var f=this.localTranslation;f.x=h,f.y=v,f.z=e,this._gjkMargin=a._gjkMargin}computeLocalSupportingVertex(a,t){this.c.computeLocalSupportingVertex(a,t);var r=this.localTranslation;if(a.x*r.x+a.y*r.y+a.z*r.z>0){var i=this.localTranslation,o=t.x+i.x,_=t.y+i.y,s=t.z+i.z;t.x=o,t.y=_,t.z=s}}};x.collision.broadphase._BroadPhase.AabbGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new x.common.Vec3,this.max=new x.common.Vec3}computeLocalSupportingVertex(a,t){t.x=a.x>0?this.max.x:this.min.x,t.y=a.y>0?this.max.y:this.min.y,t.z=a.z>0?this.max.z:this.min.z}};x.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(a){}};x.collision.broadphase.BroadPhaseType=class{};x.collision.broadphase.Proxy=class{constructor(a,t){this.userData=a,this._id=t,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){var a=new x.collision.geometry.Aabb;return a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ,a}getFatAabbTo(a){a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ}};x.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};x.collision.broadphase.bruteforce||(x.collision.broadphase.bruteforce={});x.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends x.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(a,t){var r=new x.collision.broadphase.Proxy(a,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=r,this._proxyListLast=r):(this._proxyListLast._next=r,r._prev=this._proxyListLast,this._proxyListLast=r),r._aabbMinX=t._minX,r._aabbMinY=t._minY,r._aabbMinZ=t._minZ,r._aabbMaxX=t._maxX,r._aabbMaxY=t._maxY,r._aabbMaxZ=t._maxZ,r}destroyProxy(a){this._numProxies--;var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null,a.userData=null}moveProxy(a,t,r){a._aabbMinX=t._minX,a._aabbMinY=t._minY,a._aabbMinZ=t._minZ,a._aabbMaxX=t._maxX,a._aabbMaxY=t._maxY,a._aabbMaxZ=t._maxZ}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var t=this._proxyList;t!=null;){for(var r=t._next,i=t._next;i!=null;){var o=i._next;if(this._testCount++,t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){var _=this._proxyPairPool;_!=null?(this._proxyPairPool=_._next,_._next=null):_=new x.collision.broadphase.ProxyPair;var s=_;this._proxyPairList==null?this._proxyPairList=s:(s._next=this._proxyPairList,this._proxyPairList=s),s._p1=t,s._p2=i}i=o}t=r}}rayCast(a,t,r){var i,o,_,s,h,v,e=a;i=e.x,o=e.y,_=e.z;var l=t;s=l.x,h=l.y,v=l.z;for(var u=this._proxyList;u!=null;){var b=u._next,f=i,n=o,c=_,M=s,m=h,y=v,V=f<M?f:M,z=n<m?n:m,I=c<y?c:y,k=f>M?f:M,X=n>m?n:m,L=c>y?c:y,p=u._aabbMinX,g=u._aabbMinY,N=u._aabbMinZ,A=u._aabbMaxX,F=u._aabbMaxY,S=u._aabbMaxZ,Y;if(p>k||A<V||g>X||F<z||N>L||S<I)Y=!1;else{var R=M-f,C=m-n,d=y-c,Z=R<0?-R:R,$=C<0?-C:C,j=d<0?-d:d,E=(A-p)*.5,G=(F-g)*.5,B=(S-N)*.5,Q=(A+p)*.5,U=(F+g)*.5,J=(S+N)*.5,D=f-Q,H=n-U,K=c-J,ra,sa,W=H*d-K*C;if((W<0?-W:W)-(G*j+B*$)>0)sa=!0;else{var q=K*R-D*d;sa=(q<0?-q:q)-(B*Z+E*j)>0}if(sa)ra=!0;else{var na=D*C-H*R;ra=(na<0?-na:na)-(E*$+G*Z)>0}Y=!ra}Y&&r.process(u),u=b}}convexCast(a,t,r,i){for(var o=this._proxyList;o!=null;){var _=o._next,s=this._aabb.min;s.x=o._aabbMinX,s.y=o._aabbMinY,s.z=o._aabbMinZ;var h=this._aabb.max;h.x=o._aabbMaxX,h.y=o._aabbMaxY,h.z=o._aabbMaxZ,this._convexSweep.init(a,t,r);var v=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance;v.computeClosestPointsImpl(this._convexSweep,this._aabb,t,this.identity,null,!1)==0&&v.distance<=0&&i.process(o),o=_}}aabbTest(a,t){for(var r=this._proxyList;r!=null;){var i=r._next;a._minX<r._aabbMaxX&&a._maxX>r._aabbMinX&&a._minY<r._aabbMaxY&&a._maxY>r._aabbMinY&&a._minZ<r._aabbMaxZ&&a._maxZ>r._aabbMinZ&&t.process(r),r=i}}};x.collision.broadphase.bvh||(x.collision.broadphase.bvh={});x.collision.broadphase.bvh.BvhBroadPhase=class extends x.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new x.collision.broadphase.bvh.BvhTree;var a=new Array(1024);this.movedProxies=a,this.numMovedProxies=0}collide(a,t){this._testCount++;var r=a._height==0,i=t._height==0;if(a==t){if(r)return;this.collide(a._children[0],t),this.collide(a._children[1],t);return}if(a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ&&a._aabbMaxZ>t._aabbMinZ){if(r&&i){var o=a._proxy,_=t._proxy,s=this._proxyPairPool;s!=null?(this._proxyPairPool=s._next,s._next=null):s=new x.collision.broadphase.ProxyPair;var h=s;this._proxyPairList==null?this._proxyPairList=h:(h._next=this._proxyPairList,this._proxyPairList=h),h._p1=o,h._p2=_;return}i||a._height>t._height?(this.collide(a._children[0],t),this.collide(a._children[1],t)):(this.collide(t._children[0],a),this.collide(t._children[1],a))}}rayCastRecursive(a,t,r,i,o,_,s,h){var v,e,l,u,b,f;v=t,e=r,l=i,u=o,b=_,f=s;var n=v,c=e,M=l,m=u,y=b,V=f,z=n<m?n:m,I=c<y?c:y,k=M<V?M:V,X=n>m?n:m,L=c>y?c:y,p=M>V?M:V,g=a._aabbMinX,N=a._aabbMinY,A=a._aabbMinZ,F=a._aabbMaxX,S=a._aabbMaxY,Y=a._aabbMaxZ,R;if(g>X||F<z||N>L||S<I||A>p||Y<k)R=!1;else{var C=m-n,d=y-c,Z=V-M,$=C<0?-C:C,j=d<0?-d:d,E=Z<0?-Z:Z,G=(F-g)*.5,B=(S-N)*.5,Q=(Y-A)*.5,U=(F+g)*.5,J=(S+N)*.5,D=(Y+A)*.5,H=n-U,K=c-J,ra=M-D,sa,W,q=K*Z-ra*d;if((q<0?-q:q)-(B*E+Q*j)>0)W=!0;else{var na=ra*C-H*Z;W=(na<0?-na:na)-(Q*$+G*E)>0}if(W)sa=!0;else{var oa=H*d-K*C;sa=(oa<0?-oa:oa)-(G*j+B*$)>0}R=!sa}if(R){if(a._height==0){h.process(a._proxy);return}this.rayCastRecursive(a._children[0],v,e,l,u,b,f,h),this.rayCastRecursive(a._children[1],v,e,l,u,b,f,h)}}convexCastRecursive(a,t,r,i,o){var _=this._aabb.min;_.x=a._aabbMinX,_.y=a._aabbMinY,_.z=a._aabbMinZ;var s=this._aabb.max;s.x=a._aabbMaxX,s.y=a._aabbMaxY,s.z=a._aabbMaxZ,this._convexSweep.init(t,r,i);var h=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(h.computeClosestPointsImpl(this._convexSweep,this._aabb,r,this.identity,null,!1)==0&&h.distance<=0){if(a._height==0){o.process(a._proxy);return}this.convexCastRecursive(a._children[0],t,r,i,o),this.convexCastRecursive(a._children[1],t,r,i,o)}}aabbTestRecursive(a,t,r){if(a._aabbMinX<t._maxX&&a._aabbMaxX>t._minX&&a._aabbMinY<t._maxY&&a._aabbMaxY>t._minY&&a._aabbMinZ<t._maxZ&&a._aabbMaxZ>t._minZ){if(a._height==0){r.process(a._proxy);return}this.aabbTestRecursive(a._children[0],t,r),this.aabbTestRecursive(a._children[1],t,r)}}createProxy(a,t){var r=new x.collision.broadphase.bvh.BvhProxy(a,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=r,this._proxyListLast=r):(this._proxyListLast._next=r,r._prev=this._proxyListLast,this._proxyListLast=r),r._aabbMinX=t._minX,r._aabbMinY=t._minY,r._aabbMinZ=t._minZ,r._aabbMaxX=t._maxX,r._aabbMaxY=t._maxY,r._aabbMaxZ=t._maxZ;var i=x.common.Setting.bvhProxyPadding,o,_,s;o=i,_=i,s=i,r._aabbMinX-=o,r._aabbMinY-=_,r._aabbMinZ-=s,r._aabbMaxX+=o,r._aabbMaxY+=_,r._aabbMaxZ+=s;var h=this._tree,v=h._nodePool;v!=null?(h._nodePool=v._next,v._next=null):v=new x.collision.broadphase.bvh.BvhNode;var e=v;if(e._proxy=r,r._leaf=e,e._aabbMinX=r._aabbMinX,e._aabbMinY=r._aabbMinY,e._aabbMinZ=r._aabbMinZ,e._aabbMaxX=r._aabbMaxX,e._aabbMaxY=r._aabbMaxY,e._aabbMaxZ=r._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=e,h.leafListLast=e):(h.leafListLast._nextLeaf=e,e._prevLeaf=h.leafListLast,h.leafListLast=e),h._root==null)h._root=e;else{for(var l=h._root;l._height>0;){var u=h._strategy._decideInsertion(l,e);if(u==-1)break;l=l._children[u]}var b=l._parent,f=h._nodePool;f!=null?(h._nodePool=f._next,f._next=null):f=new x.collision.broadphase.bvh.BvhNode;var n=f;if(b==null)h._root=n;else{var c=l._childIndex;b._children[c]=n,n._parent=b,n._childIndex=c}var M=l._childIndex;n._children[M]=l,l._parent=n,l._childIndex=M;var m=l._childIndex^1;for(n._children[m]=e,e._parent=n,e._childIndex=m;n!=null;){if(h._strategy._balancingEnabled){var y=n._height;if(y<2)n=n;else{var V=n._parent,z=n._children[0],I=n._children[1],k=z._height,X=I._height,L=k-X,p=n._childIndex;if(L>1){var g=z._children[0],N=z._children[1],A=g._height,F=N._height;if(A>F){z._children[1]=n,n._parent=z,n._childIndex=1,n._children[0]=N,N._parent=n,N._childIndex=0;var S=z._children[0],Y=z._children[1];z._aabbMinX=S._aabbMinX<Y._aabbMinX?S._aabbMinX:Y._aabbMinX,z._aabbMinY=S._aabbMinY<Y._aabbMinY?S._aabbMinY:Y._aabbMinY,z._aabbMinZ=S._aabbMinZ<Y._aabbMinZ?S._aabbMinZ:Y._aabbMinZ,z._aabbMaxX=S._aabbMaxX>Y._aabbMaxX?S._aabbMaxX:Y._aabbMaxX,z._aabbMaxY=S._aabbMaxY>Y._aabbMaxY?S._aabbMaxY:Y._aabbMaxY,z._aabbMaxZ=S._aabbMaxZ>Y._aabbMaxZ?S._aabbMaxZ:Y._aabbMaxZ;var R=z._children[0]._height,C=z._children[1]._height;z._height=(R>C?R:C)+1;var d=n._children[0],Z=n._children[1];n._aabbMinX=d._aabbMinX<Z._aabbMinX?d._aabbMinX:Z._aabbMinX,n._aabbMinY=d._aabbMinY<Z._aabbMinY?d._aabbMinY:Z._aabbMinY,n._aabbMinZ=d._aabbMinZ<Z._aabbMinZ?d._aabbMinZ:Z._aabbMinZ,n._aabbMaxX=d._aabbMaxX>Z._aabbMaxX?d._aabbMaxX:Z._aabbMaxX,n._aabbMaxY=d._aabbMaxY>Z._aabbMaxY?d._aabbMaxY:Z._aabbMaxY,n._aabbMaxZ=d._aabbMaxZ>Z._aabbMaxZ?d._aabbMaxZ:Z._aabbMaxZ;var $=n._children[0]._height,j=n._children[1]._height;n._height=($>j?$:j)+1}else{z._children[0]=n,n._parent=z,n._childIndex=0,n._children[0]=g,g._parent=n,g._childIndex=0;var E=z._children[0],G=z._children[1];z._aabbMinX=E._aabbMinX<G._aabbMinX?E._aabbMinX:G._aabbMinX,z._aabbMinY=E._aabbMinY<G._aabbMinY?E._aabbMinY:G._aabbMinY,z._aabbMinZ=E._aabbMinZ<G._aabbMinZ?E._aabbMinZ:G._aabbMinZ,z._aabbMaxX=E._aabbMaxX>G._aabbMaxX?E._aabbMaxX:G._aabbMaxX,z._aabbMaxY=E._aabbMaxY>G._aabbMaxY?E._aabbMaxY:G._aabbMaxY,z._aabbMaxZ=E._aabbMaxZ>G._aabbMaxZ?E._aabbMaxZ:G._aabbMaxZ;var B=z._children[0]._height,Q=z._children[1]._height;z._height=(B>Q?B:Q)+1;var U=n._children[0],J=n._children[1];n._aabbMinX=U._aabbMinX<J._aabbMinX?U._aabbMinX:J._aabbMinX,n._aabbMinY=U._aabbMinY<J._aabbMinY?U._aabbMinY:J._aabbMinY,n._aabbMinZ=U._aabbMinZ<J._aabbMinZ?U._aabbMinZ:J._aabbMinZ,n._aabbMaxX=U._aabbMaxX>J._aabbMaxX?U._aabbMaxX:J._aabbMaxX,n._aabbMaxY=U._aabbMaxY>J._aabbMaxY?U._aabbMaxY:J._aabbMaxY,n._aabbMaxZ=U._aabbMaxZ>J._aabbMaxZ?U._aabbMaxZ:J._aabbMaxZ;var D=n._children[0]._height,H=n._children[1]._height;n._height=(D>H?D:H)+1}V!=null?(V._children[p]=z,z._parent=V,z._childIndex=p):(h._root=z,z._parent=null),n=z}else if(L<-1){var K=I._children[0],ra=I._children[1],sa=K._height,W=ra._height;if(sa>W){I._children[1]=n,n._parent=I,n._childIndex=1,n._children[1]=ra,ra._parent=n,ra._childIndex=1;var q=I._children[0],na=I._children[1];I._aabbMinX=q._aabbMinX<na._aabbMinX?q._aabbMinX:na._aabbMinX,I._aabbMinY=q._aabbMinY<na._aabbMinY?q._aabbMinY:na._aabbMinY,I._aabbMinZ=q._aabbMinZ<na._aabbMinZ?q._aabbMinZ:na._aabbMinZ,I._aabbMaxX=q._aabbMaxX>na._aabbMaxX?q._aabbMaxX:na._aabbMaxX,I._aabbMaxY=q._aabbMaxY>na._aabbMaxY?q._aabbMaxY:na._aabbMaxY,I._aabbMaxZ=q._aabbMaxZ>na._aabbMaxZ?q._aabbMaxZ:na._aabbMaxZ;var oa=I._children[0]._height,aa=I._children[1]._height;I._height=(oa>aa?oa:aa)+1;var T=n._children[0],ca=n._children[1];n._aabbMinX=T._aabbMinX<ca._aabbMinX?T._aabbMinX:ca._aabbMinX,n._aabbMinY=T._aabbMinY<ca._aabbMinY?T._aabbMinY:ca._aabbMinY,n._aabbMinZ=T._aabbMinZ<ca._aabbMinZ?T._aabbMinZ:ca._aabbMinZ,n._aabbMaxX=T._aabbMaxX>ca._aabbMaxX?T._aabbMaxX:ca._aabbMaxX,n._aabbMaxY=T._aabbMaxY>ca._aabbMaxY?T._aabbMaxY:ca._aabbMaxY,n._aabbMaxZ=T._aabbMaxZ>ca._aabbMaxZ?T._aabbMaxZ:ca._aabbMaxZ;var _a=n._children[0]._height,w=n._children[1]._height;n._height=(_a>w?_a:w)+1}else{I._children[0]=n,n._parent=I,n._childIndex=0,n._children[1]=K,K._parent=n,K._childIndex=1;var ta=I._children[0],ia=I._children[1];I._aabbMinX=ta._aabbMinX<ia._aabbMinX?ta._aabbMinX:ia._aabbMinX,I._aabbMinY=ta._aabbMinY<ia._aabbMinY?ta._aabbMinY:ia._aabbMinY,I._aabbMinZ=ta._aabbMinZ<ia._aabbMinZ?ta._aabbMinZ:ia._aabbMinZ,I._aabbMaxX=ta._aabbMaxX>ia._aabbMaxX?ta._aabbMaxX:ia._aabbMaxX,I._aabbMaxY=ta._aabbMaxY>ia._aabbMaxY?ta._aabbMaxY:ia._aabbMaxY,I._aabbMaxZ=ta._aabbMaxZ>ia._aabbMaxZ?ta._aabbMaxZ:ia._aabbMaxZ;var la=I._children[0]._height,va=I._children[1]._height;I._height=(la>va?la:va)+1;var xa=n._children[0],Ma=n._children[1];n._aabbMinX=xa._aabbMinX<Ma._aabbMinX?xa._aabbMinX:Ma._aabbMinX,n._aabbMinY=xa._aabbMinY<Ma._aabbMinY?xa._aabbMinY:Ma._aabbMinY,n._aabbMinZ=xa._aabbMinZ<Ma._aabbMinZ?xa._aabbMinZ:Ma._aabbMinZ,n._aabbMaxX=xa._aabbMaxX>Ma._aabbMaxX?xa._aabbMaxX:Ma._aabbMaxX,n._aabbMaxY=xa._aabbMaxY>Ma._aabbMaxY?xa._aabbMaxY:Ma._aabbMaxY,n._aabbMaxZ=xa._aabbMaxZ>Ma._aabbMaxZ?xa._aabbMaxZ:Ma._aabbMaxZ;var za=n._children[0]._height,Xa=n._children[1]._height;n._height=(za>Xa?za:Xa)+1}V!=null?(V._children[p]=I,I._parent=V,I._childIndex=p):(h._root=I,I._parent=null),n=I}else n=n}}var Za=n._children[0]._height,fa=n._children[1]._height;n._height=(Za>fa?Za:fa)+1;var ba=n._children[0],ea=n._children[1];n._aabbMinX=ba._aabbMinX<ea._aabbMinX?ba._aabbMinX:ea._aabbMinX,n._aabbMinY=ba._aabbMinY<ea._aabbMinY?ba._aabbMinY:ea._aabbMinY,n._aabbMinZ=ba._aabbMinZ<ea._aabbMinZ?ba._aabbMinZ:ea._aabbMinZ,n._aabbMaxX=ba._aabbMaxX>ea._aabbMaxX?ba._aabbMaxX:ea._aabbMaxX,n._aabbMaxY=ba._aabbMaxY>ea._aabbMaxY?ba._aabbMaxY:ea._aabbMaxY,n._aabbMaxZ=ba._aabbMaxZ>ea._aabbMaxZ?ba._aabbMaxZ:ea._aabbMaxZ,n=n._parent}}if(!r._moved){if(r._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var ha=this.numMovedProxies<<1,pa=new Array(ha),ya=pa,da=0,ma=this.numMovedProxies;da<ma;){var Ya=da++;ya[Ya]=this.movedProxies[Ya],this.movedProxies[Ya]=null}this.movedProxies=ya}this.movedProxies[this.numMovedProxies++]=r}return r}destroyProxy(a){this._numProxies--;var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null;var i=a,o=this._tree,_=i._leaf;o._numLeaves--;var s=_._prevLeaf,h=_._nextLeaf;if(s!=null&&(s._nextLeaf=h),h!=null&&(h._prevLeaf=s),_==o.leafList&&(o.leafList=o.leafList._nextLeaf),_==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),_._nextLeaf=null,_._prevLeaf=null,o._root==_)o._root=null;else{var v=_._parent,e=v._children[_._childIndex^1],l=v._parent;if(l==null)e._parent=null,e._childIndex=0,o._root=e,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=o._nodePool,o._nodePool=v;else{e._parent=l;var u=v._childIndex;l._children[u]=e,e._parent=l,e._childIndex=u,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=o._nodePool,o._nodePool=v;for(var b=l;b!=null;){if(o._strategy._balancingEnabled){var f=b._height;if(f<2)b=b;else{var n=b._parent,c=b._children[0],M=b._children[1],m=c._height,y=M._height,V=m-y,z=b._childIndex;if(V>1){var I=c._children[0],k=c._children[1],X=I._height,L=k._height;if(X>L){c._children[1]=b,b._parent=c,b._childIndex=1,b._children[0]=k,k._parent=b,k._childIndex=0;var p=c._children[0],g=c._children[1];c._aabbMinX=p._aabbMinX<g._aabbMinX?p._aabbMinX:g._aabbMinX,c._aabbMinY=p._aabbMinY<g._aabbMinY?p._aabbMinY:g._aabbMinY,c._aabbMinZ=p._aabbMinZ<g._aabbMinZ?p._aabbMinZ:g._aabbMinZ,c._aabbMaxX=p._aabbMaxX>g._aabbMaxX?p._aabbMaxX:g._aabbMaxX,c._aabbMaxY=p._aabbMaxY>g._aabbMaxY?p._aabbMaxY:g._aabbMaxY,c._aabbMaxZ=p._aabbMaxZ>g._aabbMaxZ?p._aabbMaxZ:g._aabbMaxZ;var N=c._children[0]._height,A=c._children[1]._height;c._height=(N>A?N:A)+1;var F=b._children[0],S=b._children[1];b._aabbMinX=F._aabbMinX<S._aabbMinX?F._aabbMinX:S._aabbMinX,b._aabbMinY=F._aabbMinY<S._aabbMinY?F._aabbMinY:S._aabbMinY,b._aabbMinZ=F._aabbMinZ<S._aabbMinZ?F._aabbMinZ:S._aabbMinZ,b._aabbMaxX=F._aabbMaxX>S._aabbMaxX?F._aabbMaxX:S._aabbMaxX,b._aabbMaxY=F._aabbMaxY>S._aabbMaxY?F._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=F._aabbMaxZ>S._aabbMaxZ?F._aabbMaxZ:S._aabbMaxZ;var Y=b._children[0]._height,R=b._children[1]._height;b._height=(Y>R?Y:R)+1}else{c._children[0]=b,b._parent=c,b._childIndex=0,b._children[0]=I,I._parent=b,I._childIndex=0;var C=c._children[0],d=c._children[1];c._aabbMinX=C._aabbMinX<d._aabbMinX?C._aabbMinX:d._aabbMinX,c._aabbMinY=C._aabbMinY<d._aabbMinY?C._aabbMinY:d._aabbMinY,c._aabbMinZ=C._aabbMinZ<d._aabbMinZ?C._aabbMinZ:d._aabbMinZ,c._aabbMaxX=C._aabbMaxX>d._aabbMaxX?C._aabbMaxX:d._aabbMaxX,c._aabbMaxY=C._aabbMaxY>d._aabbMaxY?C._aabbMaxY:d._aabbMaxY,c._aabbMaxZ=C._aabbMaxZ>d._aabbMaxZ?C._aabbMaxZ:d._aabbMaxZ;var Z=c._children[0]._height,$=c._children[1]._height;c._height=(Z>$?Z:$)+1;var j=b._children[0],E=b._children[1];b._aabbMinX=j._aabbMinX<E._aabbMinX?j._aabbMinX:E._aabbMinX,b._aabbMinY=j._aabbMinY<E._aabbMinY?j._aabbMinY:E._aabbMinY,b._aabbMinZ=j._aabbMinZ<E._aabbMinZ?j._aabbMinZ:E._aabbMinZ,b._aabbMaxX=j._aabbMaxX>E._aabbMaxX?j._aabbMaxX:E._aabbMaxX,b._aabbMaxY=j._aabbMaxY>E._aabbMaxY?j._aabbMaxY:E._aabbMaxY,b._aabbMaxZ=j._aabbMaxZ>E._aabbMaxZ?j._aabbMaxZ:E._aabbMaxZ;var G=b._children[0]._height,B=b._children[1]._height;b._height=(G>B?G:B)+1}n!=null?(n._children[z]=c,c._parent=n,c._childIndex=z):(o._root=c,c._parent=null),b=c}else if(V<-1){var Q=M._children[0],U=M._children[1],J=Q._height,D=U._height;if(J>D){M._children[1]=b,b._parent=M,b._childIndex=1,b._children[1]=U,U._parent=b,U._childIndex=1;var H=M._children[0],K=M._children[1];M._aabbMinX=H._aabbMinX<K._aabbMinX?H._aabbMinX:K._aabbMinX,M._aabbMinY=H._aabbMinY<K._aabbMinY?H._aabbMinY:K._aabbMinY,M._aabbMinZ=H._aabbMinZ<K._aabbMinZ?H._aabbMinZ:K._aabbMinZ,M._aabbMaxX=H._aabbMaxX>K._aabbMaxX?H._aabbMaxX:K._aabbMaxX,M._aabbMaxY=H._aabbMaxY>K._aabbMaxY?H._aabbMaxY:K._aabbMaxY,M._aabbMaxZ=H._aabbMaxZ>K._aabbMaxZ?H._aabbMaxZ:K._aabbMaxZ;var ra=M._children[0]._height,sa=M._children[1]._height;M._height=(ra>sa?ra:sa)+1;var W=b._children[0],q=b._children[1];b._aabbMinX=W._aabbMinX<q._aabbMinX?W._aabbMinX:q._aabbMinX,b._aabbMinY=W._aabbMinY<q._aabbMinY?W._aabbMinY:q._aabbMinY,b._aabbMinZ=W._aabbMinZ<q._aabbMinZ?W._aabbMinZ:q._aabbMinZ,b._aabbMaxX=W._aabbMaxX>q._aabbMaxX?W._aabbMaxX:q._aabbMaxX,b._aabbMaxY=W._aabbMaxY>q._aabbMaxY?W._aabbMaxY:q._aabbMaxY,b._aabbMaxZ=W._aabbMaxZ>q._aabbMaxZ?W._aabbMaxZ:q._aabbMaxZ;var na=b._children[0]._height,oa=b._children[1]._height;b._height=(na>oa?na:oa)+1}else{M._children[0]=b,b._parent=M,b._childIndex=0,b._children[1]=Q,Q._parent=b,Q._childIndex=1;var aa=M._children[0],T=M._children[1];M._aabbMinX=aa._aabbMinX<T._aabbMinX?aa._aabbMinX:T._aabbMinX,M._aabbMinY=aa._aabbMinY<T._aabbMinY?aa._aabbMinY:T._aabbMinY,M._aabbMinZ=aa._aabbMinZ<T._aabbMinZ?aa._aabbMinZ:T._aabbMinZ,M._aabbMaxX=aa._aabbMaxX>T._aabbMaxX?aa._aabbMaxX:T._aabbMaxX,M._aabbMaxY=aa._aabbMaxY>T._aabbMaxY?aa._aabbMaxY:T._aabbMaxY,M._aabbMaxZ=aa._aabbMaxZ>T._aabbMaxZ?aa._aabbMaxZ:T._aabbMaxZ;var ca=M._children[0]._height,_a=M._children[1]._height;M._height=(ca>_a?ca:_a)+1;var w=b._children[0],ta=b._children[1];b._aabbMinX=w._aabbMinX<ta._aabbMinX?w._aabbMinX:ta._aabbMinX,b._aabbMinY=w._aabbMinY<ta._aabbMinY?w._aabbMinY:ta._aabbMinY,b._aabbMinZ=w._aabbMinZ<ta._aabbMinZ?w._aabbMinZ:ta._aabbMinZ,b._aabbMaxX=w._aabbMaxX>ta._aabbMaxX?w._aabbMaxX:ta._aabbMaxX,b._aabbMaxY=w._aabbMaxY>ta._aabbMaxY?w._aabbMaxY:ta._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>ta._aabbMaxZ?w._aabbMaxZ:ta._aabbMaxZ;var ia=b._children[0]._height,la=b._children[1]._height;b._height=(ia>la?ia:la)+1}n!=null?(n._children[z]=M,M._parent=n,M._childIndex=z):(o._root=M,M._parent=null),b=M}else b=b}}var va=b._children[0]._height,xa=b._children[1]._height;b._height=(va>xa?va:xa)+1;var Ma=b._children[0],za=b._children[1];b._aabbMinX=Ma._aabbMinX<za._aabbMinX?Ma._aabbMinX:za._aabbMinX,b._aabbMinY=Ma._aabbMinY<za._aabbMinY?Ma._aabbMinY:za._aabbMinY,b._aabbMinZ=Ma._aabbMinZ<za._aabbMinZ?Ma._aabbMinZ:za._aabbMinZ,b._aabbMaxX=Ma._aabbMaxX>za._aabbMaxX?Ma._aabbMaxX:za._aabbMaxX,b._aabbMaxY=Ma._aabbMaxY>za._aabbMaxY?Ma._aabbMaxY:za._aabbMaxY,b._aabbMaxZ=Ma._aabbMaxZ>za._aabbMaxZ?Ma._aabbMaxZ:za._aabbMaxZ,b=b._parent}}}i._leaf=null,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=o._nodePool,o._nodePool=_,i.userData=null,i._next=null,i._prev=null,i._moved&&(i._moved=!1)}moveProxy(a,t,r){var i=a;if(!(i._aabbMinX<=t._minX&&i._aabbMaxX>=t._maxX&&i._aabbMinY<=t._minY&&i._aabbMaxY>=t._maxY&&i._aabbMinZ<=t._minZ&&i._aabbMaxZ>=t._maxZ)){i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ;var o=x.common.Setting.bvhProxyPadding,_,s,h;if(_=o,s=o,h=o,i._aabbMinX-=_,i._aabbMinY-=s,i._aabbMinZ-=h,i._aabbMaxX+=_,i._aabbMaxY+=s,i._aabbMaxZ+=h,r!=null){var v,e,l,u,b,f,n,c,M,m,y,V;u=0,b=0,f=0;var z=r;v=z.x,e=z.y,l=z.z,n=u<v?u:v,c=b<e?b:e,M=f<l?f:l,m=u>v?u:v,y=b>e?b:e,V=f>l?f:l,i._aabbMinX+=n,i._aabbMinY+=c,i._aabbMinZ+=M,i._aabbMaxX+=m,i._aabbMaxY+=y,i._aabbMaxZ+=V}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var I=this.numMovedProxies<<1,k=new Array(I),X=k,L=0,p=this.numMovedProxies;L<p;){var g=L++;X[g]=this.movedProxies[g],this.movedProxies[g]=null}this.movedProxies=X}this.movedProxies[this.numMovedProxies++]=i}}}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var t=this.numMovedProxies/this._numProxies<x.common.Setting.bvhIncrementalCollisionThreshold,r=0,i=this.numMovedProxies;r<i;){var o=r++,_=this.movedProxies[o];if(_._moved){var s=this._tree,h=_._leaf;s._numLeaves--;var v=h._prevLeaf,e=h._nextLeaf;if(v!=null&&(v._nextLeaf=e),e!=null&&(e._prevLeaf=v),h==s.leafList&&(s.leafList=s.leafList._nextLeaf),h==s.leafListLast&&(s.leafListLast=s.leafListLast._prevLeaf),h._nextLeaf=null,h._prevLeaf=null,s._root==h)s._root=null;else{var l=h._parent,u=l._children[h._childIndex^1],b=l._parent;if(b==null)u._parent=null,u._childIndex=0,s._root=u,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=s._nodePool,s._nodePool=l;else{u._parent=b;var f=l._childIndex;b._children[f]=u,u._parent=b,u._childIndex=f,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=s._nodePool,s._nodePool=l;for(var n=b;n!=null;){if(s._strategy._balancingEnabled){var c=n._height;if(c<2)n=n;else{var M=n._parent,m=n._children[0],y=n._children[1],V=m._height,z=y._height,I=V-z,k=n._childIndex;if(I>1){var X=m._children[0],L=m._children[1],p=X._height,g=L._height;if(p>g){m._children[1]=n,n._parent=m,n._childIndex=1,n._children[0]=L,L._parent=n,L._childIndex=0;var N=m._children[0],A=m._children[1];m._aabbMinX=N._aabbMinX<A._aabbMinX?N._aabbMinX:A._aabbMinX,m._aabbMinY=N._aabbMinY<A._aabbMinY?N._aabbMinY:A._aabbMinY,m._aabbMinZ=N._aabbMinZ<A._aabbMinZ?N._aabbMinZ:A._aabbMinZ,m._aabbMaxX=N._aabbMaxX>A._aabbMaxX?N._aabbMaxX:A._aabbMaxX,m._aabbMaxY=N._aabbMaxY>A._aabbMaxY?N._aabbMaxY:A._aabbMaxY,m._aabbMaxZ=N._aabbMaxZ>A._aabbMaxZ?N._aabbMaxZ:A._aabbMaxZ;var F=m._children[0]._height,S=m._children[1]._height;m._height=(F>S?F:S)+1;var Y=n._children[0],R=n._children[1];n._aabbMinX=Y._aabbMinX<R._aabbMinX?Y._aabbMinX:R._aabbMinX,n._aabbMinY=Y._aabbMinY<R._aabbMinY?Y._aabbMinY:R._aabbMinY,n._aabbMinZ=Y._aabbMinZ<R._aabbMinZ?Y._aabbMinZ:R._aabbMinZ,n._aabbMaxX=Y._aabbMaxX>R._aabbMaxX?Y._aabbMaxX:R._aabbMaxX,n._aabbMaxY=Y._aabbMaxY>R._aabbMaxY?Y._aabbMaxY:R._aabbMaxY,n._aabbMaxZ=Y._aabbMaxZ>R._aabbMaxZ?Y._aabbMaxZ:R._aabbMaxZ;var C=n._children[0]._height,d=n._children[1]._height;n._height=(C>d?C:d)+1}else{m._children[0]=n,n._parent=m,n._childIndex=0,n._children[0]=X,X._parent=n,X._childIndex=0;var Z=m._children[0],$=m._children[1];m._aabbMinX=Z._aabbMinX<$._aabbMinX?Z._aabbMinX:$._aabbMinX,m._aabbMinY=Z._aabbMinY<$._aabbMinY?Z._aabbMinY:$._aabbMinY,m._aabbMinZ=Z._aabbMinZ<$._aabbMinZ?Z._aabbMinZ:$._aabbMinZ,m._aabbMaxX=Z._aabbMaxX>$._aabbMaxX?Z._aabbMaxX:$._aabbMaxX,m._aabbMaxY=Z._aabbMaxY>$._aabbMaxY?Z._aabbMaxY:$._aabbMaxY,m._aabbMaxZ=Z._aabbMaxZ>$._aabbMaxZ?Z._aabbMaxZ:$._aabbMaxZ;var j=m._children[0]._height,E=m._children[1]._height;m._height=(j>E?j:E)+1;var G=n._children[0],B=n._children[1];n._aabbMinX=G._aabbMinX<B._aabbMinX?G._aabbMinX:B._aabbMinX,n._aabbMinY=G._aabbMinY<B._aabbMinY?G._aabbMinY:B._aabbMinY,n._aabbMinZ=G._aabbMinZ<B._aabbMinZ?G._aabbMinZ:B._aabbMinZ,n._aabbMaxX=G._aabbMaxX>B._aabbMaxX?G._aabbMaxX:B._aabbMaxX,n._aabbMaxY=G._aabbMaxY>B._aabbMaxY?G._aabbMaxY:B._aabbMaxY,n._aabbMaxZ=G._aabbMaxZ>B._aabbMaxZ?G._aabbMaxZ:B._aabbMaxZ;var Q=n._children[0]._height,U=n._children[1]._height;n._height=(Q>U?Q:U)+1}M!=null?(M._children[k]=m,m._parent=M,m._childIndex=k):(s._root=m,m._parent=null),n=m}else if(I<-1){var J=y._children[0],D=y._children[1],H=J._height,K=D._height;if(H>K){y._children[1]=n,n._parent=y,n._childIndex=1,n._children[1]=D,D._parent=n,D._childIndex=1;var ra=y._children[0],sa=y._children[1];y._aabbMinX=ra._aabbMinX<sa._aabbMinX?ra._aabbMinX:sa._aabbMinX,y._aabbMinY=ra._aabbMinY<sa._aabbMinY?ra._aabbMinY:sa._aabbMinY,y._aabbMinZ=ra._aabbMinZ<sa._aabbMinZ?ra._aabbMinZ:sa._aabbMinZ,y._aabbMaxX=ra._aabbMaxX>sa._aabbMaxX?ra._aabbMaxX:sa._aabbMaxX,y._aabbMaxY=ra._aabbMaxY>sa._aabbMaxY?ra._aabbMaxY:sa._aabbMaxY,y._aabbMaxZ=ra._aabbMaxZ>sa._aabbMaxZ?ra._aabbMaxZ:sa._aabbMaxZ;var W=y._children[0]._height,q=y._children[1]._height;y._height=(W>q?W:q)+1;var na=n._children[0],oa=n._children[1];n._aabbMinX=na._aabbMinX<oa._aabbMinX?na._aabbMinX:oa._aabbMinX,n._aabbMinY=na._aabbMinY<oa._aabbMinY?na._aabbMinY:oa._aabbMinY,n._aabbMinZ=na._aabbMinZ<oa._aabbMinZ?na._aabbMinZ:oa._aabbMinZ,n._aabbMaxX=na._aabbMaxX>oa._aabbMaxX?na._aabbMaxX:oa._aabbMaxX,n._aabbMaxY=na._aabbMaxY>oa._aabbMaxY?na._aabbMaxY:oa._aabbMaxY,n._aabbMaxZ=na._aabbMaxZ>oa._aabbMaxZ?na._aabbMaxZ:oa._aabbMaxZ;var aa=n._children[0]._height,T=n._children[1]._height;n._height=(aa>T?aa:T)+1}else{y._children[0]=n,n._parent=y,n._childIndex=0,n._children[1]=J,J._parent=n,J._childIndex=1;var ca=y._children[0],_a=y._children[1];y._aabbMinX=ca._aabbMinX<_a._aabbMinX?ca._aabbMinX:_a._aabbMinX,y._aabbMinY=ca._aabbMinY<_a._aabbMinY?ca._aabbMinY:_a._aabbMinY,y._aabbMinZ=ca._aabbMinZ<_a._aabbMinZ?ca._aabbMinZ:_a._aabbMinZ,y._aabbMaxX=ca._aabbMaxX>_a._aabbMaxX?ca._aabbMaxX:_a._aabbMaxX,y._aabbMaxY=ca._aabbMaxY>_a._aabbMaxY?ca._aabbMaxY:_a._aabbMaxY,y._aabbMaxZ=ca._aabbMaxZ>_a._aabbMaxZ?ca._aabbMaxZ:_a._aabbMaxZ;var w=y._children[0]._height,ta=y._children[1]._height;y._height=(w>ta?w:ta)+1;var ia=n._children[0],la=n._children[1];n._aabbMinX=ia._aabbMinX<la._aabbMinX?ia._aabbMinX:la._aabbMinX,n._aabbMinY=ia._aabbMinY<la._aabbMinY?ia._aabbMinY:la._aabbMinY,n._aabbMinZ=ia._aabbMinZ<la._aabbMinZ?ia._aabbMinZ:la._aabbMinZ,n._aabbMaxX=ia._aabbMaxX>la._aabbMaxX?ia._aabbMaxX:la._aabbMaxX,n._aabbMaxY=ia._aabbMaxY>la._aabbMaxY?ia._aabbMaxY:la._aabbMaxY,n._aabbMaxZ=ia._aabbMaxZ>la._aabbMaxZ?ia._aabbMaxZ:la._aabbMaxZ;var va=n._children[0]._height,xa=n._children[1]._height;n._height=(va>xa?va:xa)+1}M!=null?(M._children[k]=y,y._parent=M,y._childIndex=k):(s._root=y,y._parent=null),n=y}else n=n}}var Ma=n._children[0]._height,za=n._children[1]._height;n._height=(Ma>za?Ma:za)+1;var Xa=n._children[0],Za=n._children[1];n._aabbMinX=Xa._aabbMinX<Za._aabbMinX?Xa._aabbMinX:Za._aabbMinX,n._aabbMinY=Xa._aabbMinY<Za._aabbMinY?Xa._aabbMinY:Za._aabbMinY,n._aabbMinZ=Xa._aabbMinZ<Za._aabbMinZ?Xa._aabbMinZ:Za._aabbMinZ,n._aabbMaxX=Xa._aabbMaxX>Za._aabbMaxX?Xa._aabbMaxX:Za._aabbMaxX,n._aabbMaxY=Xa._aabbMaxY>Za._aabbMaxY?Xa._aabbMaxY:Za._aabbMaxY,n._aabbMaxZ=Xa._aabbMaxZ>Za._aabbMaxZ?Xa._aabbMaxZ:Za._aabbMaxZ,n=n._parent}}}_._leaf=null,h._next=null,h._childIndex=0,h._children[0]=null,h._children[1]=null,h._childIndex=0,h._parent=null,h._height=0,h._proxy=null,h._next=s._nodePool,s._nodePool=h;var fa=this._tree,ba=fa._nodePool;ba!=null?(fa._nodePool=ba._next,ba._next=null):ba=new x.collision.broadphase.bvh.BvhNode;var ea=ba;if(ea._proxy=_,_._leaf=ea,ea._aabbMinX=_._aabbMinX,ea._aabbMinY=_._aabbMinY,ea._aabbMinZ=_._aabbMinZ,ea._aabbMaxX=_._aabbMaxX,ea._aabbMaxY=_._aabbMaxY,ea._aabbMaxZ=_._aabbMaxZ,fa._numLeaves++,fa.leafList==null?(fa.leafList=ea,fa.leafListLast=ea):(fa.leafListLast._nextLeaf=ea,ea._prevLeaf=fa.leafListLast,fa.leafListLast=ea),fa._root==null)fa._root=ea;else{for(var ha=fa._root;ha._height>0;){var pa=fa._strategy._decideInsertion(ha,ea);if(pa==-1)break;ha=ha._children[pa]}var ya=ha._parent,da=fa._nodePool;da!=null?(fa._nodePool=da._next,da._next=null):da=new x.collision.broadphase.bvh.BvhNode;var ma=da;if(ya==null)fa._root=ma;else{var Ya=ha._childIndex;ya._children[Ya]=ma,ma._parent=ya,ma._childIndex=Ya}var Qa=ha._childIndex;ma._children[Qa]=ha,ha._parent=ma,ha._childIndex=Qa;var ga=ha._childIndex^1;for(ma._children[ga]=ea,ea._parent=ma,ea._childIndex=ga;ma!=null;){if(fa._strategy._balancingEnabled){var ua=ma._height;if(ua<2)ma=ma;else{var wa=ma._parent,ka=ma._children[0],Pa=ma._children[1],Mt=ka._height,Ha=Pa._height,Ba=Mt-Ha,nt=ma._childIndex;if(Ba>1){var Ea=ka._children[0],Fa=ka._children[1],Aa=Ea._height,ft=Fa._height;if(Aa>ft){ka._children[1]=ma,ma._parent=ka,ma._childIndex=1,ma._children[0]=Fa,Fa._parent=ma,Fa._childIndex=0;var Ua=ka._children[0],ja=ka._children[1];ka._aabbMinX=Ua._aabbMinX<ja._aabbMinX?Ua._aabbMinX:ja._aabbMinX,ka._aabbMinY=Ua._aabbMinY<ja._aabbMinY?Ua._aabbMinY:ja._aabbMinY,ka._aabbMinZ=Ua._aabbMinZ<ja._aabbMinZ?Ua._aabbMinZ:ja._aabbMinZ,ka._aabbMaxX=Ua._aabbMaxX>ja._aabbMaxX?Ua._aabbMaxX:ja._aabbMaxX,ka._aabbMaxY=Ua._aabbMaxY>ja._aabbMaxY?Ua._aabbMaxY:ja._aabbMaxY,ka._aabbMaxZ=Ua._aabbMaxZ>ja._aabbMaxZ?Ua._aabbMaxZ:ja._aabbMaxZ;var bt=ka._children[0]._height,rt=ka._children[1]._height;ka._height=(bt>rt?bt:rt)+1;var $a=ma._children[0],_t=ma._children[1];ma._aabbMinX=$a._aabbMinX<_t._aabbMinX?$a._aabbMinX:_t._aabbMinX,ma._aabbMinY=$a._aabbMinY<_t._aabbMinY?$a._aabbMinY:_t._aabbMinY,ma._aabbMinZ=$a._aabbMinZ<_t._aabbMinZ?$a._aabbMinZ:_t._aabbMinZ,ma._aabbMaxX=$a._aabbMaxX>_t._aabbMaxX?$a._aabbMaxX:_t._aabbMaxX,ma._aabbMaxY=$a._aabbMaxY>_t._aabbMaxY?$a._aabbMaxY:_t._aabbMaxY,ma._aabbMaxZ=$a._aabbMaxZ>_t._aabbMaxZ?$a._aabbMaxZ:_t._aabbMaxZ;var gt=ma._children[0]._height,mt=ma._children[1]._height;ma._height=(gt>mt?gt:mt)+1}else{ka._children[0]=ma,ma._parent=ka,ma._childIndex=0,ma._children[0]=Ea,Ea._parent=ma,Ea._childIndex=0;var Wa=ka._children[0],it=ka._children[1];ka._aabbMinX=Wa._aabbMinX<it._aabbMinX?Wa._aabbMinX:it._aabbMinX,ka._aabbMinY=Wa._aabbMinY<it._aabbMinY?Wa._aabbMinY:it._aabbMinY,ka._aabbMinZ=Wa._aabbMinZ<it._aabbMinZ?Wa._aabbMinZ:it._aabbMinZ,ka._aabbMaxX=Wa._aabbMaxX>it._aabbMaxX?Wa._aabbMaxX:it._aabbMaxX,ka._aabbMaxY=Wa._aabbMaxY>it._aabbMaxY?Wa._aabbMaxY:it._aabbMaxY,ka._aabbMaxZ=Wa._aabbMaxZ>it._aabbMaxZ?Wa._aabbMaxZ:it._aabbMaxZ;var ut=ka._children[0]._height,Da=ka._children[1]._height;ka._height=(ut>Da?ut:Da)+1;var Ta=ma._children[0],Na=ma._children[1];ma._aabbMinX=Ta._aabbMinX<Na._aabbMinX?Ta._aabbMinX:Na._aabbMinX,ma._aabbMinY=Ta._aabbMinY<Na._aabbMinY?Ta._aabbMinY:Na._aabbMinY,ma._aabbMinZ=Ta._aabbMinZ<Na._aabbMinZ?Ta._aabbMinZ:Na._aabbMinZ,ma._aabbMaxX=Ta._aabbMaxX>Na._aabbMaxX?Ta._aabbMaxX:Na._aabbMaxX,ma._aabbMaxY=Ta._aabbMaxY>Na._aabbMaxY?Ta._aabbMaxY:Na._aabbMaxY,ma._aabbMaxZ=Ta._aabbMaxZ>Na._aabbMaxZ?Ta._aabbMaxZ:Na._aabbMaxZ;var Vt=ma._children[0]._height,Pt=ma._children[1]._height;ma._height=(Vt>Pt?Vt:Pt)+1}wa!=null?(wa._children[nt]=ka,ka._parent=wa,ka._childIndex=nt):(fa._root=ka,ka._parent=null),ma=ka}else if(Ba<-1){var et=Pa._children[0],Xt=Pa._children[1],Yt=et._height,zt=Xt._height;if(Yt>zt){Pa._children[1]=ma,ma._parent=Pa,ma._childIndex=1,ma._children[1]=Xt,Xt._parent=ma,Xt._childIndex=1;var Ia=Pa._children[0],O=Pa._children[1];Pa._aabbMinX=Ia._aabbMinX<O._aabbMinX?Ia._aabbMinX:O._aabbMinX,Pa._aabbMinY=Ia._aabbMinY<O._aabbMinY?Ia._aabbMinY:O._aabbMinY,Pa._aabbMinZ=Ia._aabbMinZ<O._aabbMinZ?Ia._aabbMinZ:O._aabbMinZ,Pa._aabbMaxX=Ia._aabbMaxX>O._aabbMaxX?Ia._aabbMaxX:O._aabbMaxX,Pa._aabbMaxY=Ia._aabbMaxY>O._aabbMaxY?Ia._aabbMaxY:O._aabbMaxY,Pa._aabbMaxZ=Ia._aabbMaxZ>O._aabbMaxZ?Ia._aabbMaxZ:O._aabbMaxZ;var Va=Pa._children[0]._height,lt=Pa._children[1]._height;Pa._height=(Va>lt?Va:lt)+1;var P=ma._children[0],wt=ma._children[1];ma._aabbMinX=P._aabbMinX<wt._aabbMinX?P._aabbMinX:wt._aabbMinX,ma._aabbMinY=P._aabbMinY<wt._aabbMinY?P._aabbMinY:wt._aabbMinY,ma._aabbMinZ=P._aabbMinZ<wt._aabbMinZ?P._aabbMinZ:wt._aabbMinZ,ma._aabbMaxX=P._aabbMaxX>wt._aabbMaxX?P._aabbMaxX:wt._aabbMaxX,ma._aabbMaxY=P._aabbMaxY>wt._aabbMaxY?P._aabbMaxY:wt._aabbMaxY,ma._aabbMaxZ=P._aabbMaxZ>wt._aabbMaxZ?P._aabbMaxZ:wt._aabbMaxZ;var Bt=ma._children[0]._height,At=ma._children[1]._height;ma._height=(Bt>At?Bt:At)+1}else{Pa._children[0]=ma,ma._parent=Pa,ma._childIndex=0,ma._children[1]=et,et._parent=ma,et._childIndex=1;var yt=Pa._children[0],kt=Pa._children[1];Pa._aabbMinX=yt._aabbMinX<kt._aabbMinX?yt._aabbMinX:kt._aabbMinX,Pa._aabbMinY=yt._aabbMinY<kt._aabbMinY?yt._aabbMinY:kt._aabbMinY,Pa._aabbMinZ=yt._aabbMinZ<kt._aabbMinZ?yt._aabbMinZ:kt._aabbMinZ,Pa._aabbMaxX=yt._aabbMaxX>kt._aabbMaxX?yt._aabbMaxX:kt._aabbMaxX,Pa._aabbMaxY=yt._aabbMaxY>kt._aabbMaxY?yt._aabbMaxY:kt._aabbMaxY,Pa._aabbMaxZ=yt._aabbMaxZ>kt._aabbMaxZ?yt._aabbMaxZ:kt._aabbMaxZ;var pt=Pa._children[0]._height,ht=Pa._children[1]._height;Pa._height=(pt>ht?pt:ht)+1;var xt=ma._children[0],Ra=ma._children[1];ma._aabbMinX=xt._aabbMinX<Ra._aabbMinX?xt._aabbMinX:Ra._aabbMinX,ma._aabbMinY=xt._aabbMinY<Ra._aabbMinY?xt._aabbMinY:Ra._aabbMinY,ma._aabbMinZ=xt._aabbMinZ<Ra._aabbMinZ?xt._aabbMinZ:Ra._aabbMinZ,ma._aabbMaxX=xt._aabbMaxX>Ra._aabbMaxX?xt._aabbMaxX:Ra._aabbMaxX,ma._aabbMaxY=xt._aabbMaxY>Ra._aabbMaxY?xt._aabbMaxY:Ra._aabbMaxY,ma._aabbMaxZ=xt._aabbMaxZ>Ra._aabbMaxZ?xt._aabbMaxZ:Ra._aabbMaxZ;var st=ma._children[0]._height,Ca=ma._children[1]._height;ma._height=(st>Ca?st:Ca)+1}wa!=null?(wa._children[nt]=Pa,Pa._parent=wa,Pa._childIndex=nt):(fa._root=Pa,Pa._parent=null),ma=Pa}else ma=ma}}var vt=ma._children[0]._height,qa=ma._children[1]._height;ma._height=(vt>qa?vt:qa)+1;var at=ma._children[0],Oa=ma._children[1];ma._aabbMinX=at._aabbMinX<Oa._aabbMinX?at._aabbMinX:Oa._aabbMinX,ma._aabbMinY=at._aabbMinY<Oa._aabbMinY?at._aabbMinY:Oa._aabbMinY,ma._aabbMinZ=at._aabbMinZ<Oa._aabbMinZ?at._aabbMinZ:Oa._aabbMinZ,ma._aabbMaxX=at._aabbMaxX>Oa._aabbMaxX?at._aabbMaxX:Oa._aabbMaxX,ma._aabbMaxY=at._aabbMaxY>Oa._aabbMaxY?at._aabbMaxY:Oa._aabbMaxY,ma._aabbMaxZ=at._aabbMaxZ>Oa._aabbMaxZ?at._aabbMaxZ:Oa._aabbMaxZ,ma=ma._parent}}t&&this.collide(this._tree._root,_._leaf),_._moved=!1}this.movedProxies[o]=null}t||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}}rayCast(a,t,r){if(this._tree._root!=null){var i,o,_,s,h,v,e=a;i=e.x,o=e.y,_=e.z;var l=t;s=l.x,h=l.y,v=l.z,this.rayCastRecursive(this._tree._root,i,o,_,s,h,v,r)}}convexCast(a,t,r,i){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,a,t,r,i)}aabbTest(a,t){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,a,t)}getTreeBalance(){return this._tree._getBalance()}};x.collision.broadphase.bvh.BvhInsertionStrategy=class{};x.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var a=new Array(2);this._children=a,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};x.collision.broadphase.bvh.BvhProxy=class extends x.collision.broadphase.Proxy{constructor(a,t){super(a,t),this._leaf=null,this._moved=!1}};x.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(a,t){switch(this._insertionStrategy){case 0:var r,i,o;r=t._aabbMinX+t._aabbMaxX,i=t._aabbMinY+t._aabbMaxY,o=t._aabbMinZ+t._aabbMaxZ;var _=a._children[0],s=a._children[1],h,v,e,l,u,b;h=_._aabbMinX+_._aabbMaxX,v=_._aabbMinY+_._aabbMaxY,e=_._aabbMinZ+_._aabbMaxZ,l=s._aabbMinX+s._aabbMaxX,u=s._aabbMinY+s._aabbMaxY,b=s._aabbMinZ+s._aabbMaxZ,h-=r,v-=i,e-=o,l-=r,u-=i,b-=o;var f=h*h+v*v+e*e,n=l*l+u*u+b*b;return f<n?0:1;case 1:var c=a._children[0],M=a._children[1],m=a._aabbMaxX-a._aabbMinX,y=a._aabbMaxY-a._aabbMinY,V=a._aabbMaxZ-a._aabbMinZ,z=(m*(y+V)+y*V)*2,I,k,X,L,p,g;I=a._aabbMinX<t._aabbMinX?a._aabbMinX:t._aabbMinX,k=a._aabbMinY<t._aabbMinY?a._aabbMinY:t._aabbMinY,X=a._aabbMinZ<t._aabbMinZ?a._aabbMinZ:t._aabbMinZ,L=a._aabbMaxX>t._aabbMaxX?a._aabbMaxX:t._aabbMaxX,p=a._aabbMaxY>t._aabbMaxY?a._aabbMaxY:t._aabbMaxY,g=a._aabbMaxZ>t._aabbMaxZ?a._aabbMaxZ:t._aabbMaxZ;var N=L-I,A=p-k,F=g-X,S=(N*(A+F)+A*F)*2,Y=S*2,R=(S-z)*2,C=R;if(I=c._aabbMinX<t._aabbMinX?c._aabbMinX:t._aabbMinX,k=c._aabbMinY<t._aabbMinY?c._aabbMinY:t._aabbMinY,X=c._aabbMinZ<t._aabbMinZ?c._aabbMinZ:t._aabbMinZ,L=c._aabbMaxX>t._aabbMaxX?c._aabbMaxX:t._aabbMaxX,p=c._aabbMaxY>t._aabbMaxY?c._aabbMaxY:t._aabbMaxY,g=c._aabbMaxZ>t._aabbMaxZ?c._aabbMaxZ:t._aabbMaxZ,c._height==0){var d=L-I,Z=p-k,$=g-X;C+=(d*(Z+$)+Z*$)*2}else{var j=L-I,E=p-k,G=g-X,B=c._aabbMaxX-c._aabbMinX,Q=c._aabbMaxY-c._aabbMinY,U=c._aabbMaxZ-c._aabbMinZ;C+=(j*(E+G)+E*G)*2-(B*(Q+U)+Q*U)*2}var J=R;if(I=M._aabbMinX<t._aabbMinX?M._aabbMinX:t._aabbMinX,k=M._aabbMinY<t._aabbMinY?M._aabbMinY:t._aabbMinY,X=M._aabbMinZ<t._aabbMinZ?M._aabbMinZ:t._aabbMinZ,L=M._aabbMaxX>t._aabbMaxX?M._aabbMaxX:t._aabbMaxX,p=M._aabbMaxY>t._aabbMaxY?M._aabbMaxY:t._aabbMaxY,g=M._aabbMaxZ>t._aabbMaxZ?M._aabbMaxZ:t._aabbMaxZ,M._height==0){var D=L-I,H=p-k,K=g-X;J+=(D*(H+K)+H*K)*2}else{var ra=L-I,sa=p-k,W=g-X,q=M._aabbMaxX-M._aabbMinX,na=M._aabbMaxY-M._aabbMinY,oa=M._aabbMaxZ-M._aabbMinZ;J+=(ra*(sa+W)+sa*W)*2-(q*(na+oa)+na*oa)*2}return Y<C?Y<J?-1:1:C<J?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(a,t,r){var i=1/(r-t),o,_,s;o=0,_=0,s=0;for(var h=t,v=r;h<v;){var e=h++,l=a[e];l._tmpX=l._aabbMaxX+l._aabbMinX,l._tmpY=l._aabbMaxY+l._aabbMinY,l._tmpZ=l._aabbMaxZ+l._aabbMinZ,o+=l._tmpX,_+=l._tmpY,s+=l._tmpZ}o*=i,_*=i,s*=i;var u,b,f;u=0,b=0,f=0;for(var n=t,c=r;n<c;){var M=n++,m=a[M],y,V,z;y=m._tmpX-o,V=m._tmpY-_,z=m._tmpZ-s,y*=y,V*=V,z*=z,u+=y,b+=V,f+=z}var I=u,k=b,X=f,L=t,p=r-1;if(I>k)if(I>X)for(var g=o;;){for(;;){var N=a[L];if(N._tmpX<=g)break;++L}for(;;){var A=a[p];if(A._tmpX>=g)break;--p}if(L>=p)break;var F=a[L];a[L]=a[p],a[p]=F,++L,--p}else for(var S=s;;){for(;;){var Y=a[L];if(Y._tmpZ<=S)break;++L}for(;;){var R=a[p];if(R._tmpZ>=S)break;--p}if(L>=p)break;var C=a[L];a[L]=a[p],a[p]=C,++L,--p}else if(k>X)for(var d=_;;){for(;;){var Z=a[L];if(Z._tmpY<=d)break;++L}for(;;){var $=a[p];if($._tmpY>=d)break;--p}if(L>=p)break;var j=a[L];a[L]=a[p],a[p]=j,++L,--p}else for(var E=s;;){for(;;){var G=a[L];if(G._tmpZ<=E)break;++L}for(;;){var B=a[p];if(B._tmpZ>=E)break;--p}if(L>=p)break;var Q=a[L];a[L]=a[p],a[p]=Q,++L,--p}return L}};x.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new x.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var a=new Array(1024);this.tmp=a}_print(a,t){if(t==null&&(t=""),a!=null)if(a._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",t+a._proxy._id);else{this._print(a._children[0],t+"  ");var r,i,o,_;i=a._aabbMaxX-a._aabbMinX,o=a._aabbMaxY-a._aabbMinY,_=a._aabbMaxZ-a._aabbMinZ;var s=i,h=o,v=_;if(s*(h+v)+h*v>0){var e,l,u;e=a._aabbMaxX-a._aabbMinX,l=a._aabbMaxY-a._aabbMinY,u=a._aabbMaxZ-a._aabbMinZ;var b=e,f=l,n=u;r=((b*(f+n)+f*n)*1e3+.5|0)/1e3}else{var c,M,m;c=a._aabbMaxX-a._aabbMinX,M=a._aabbMaxY-a._aabbMinY,m=a._aabbMaxZ-a._aabbMinZ;var y=c,V=M,z=m;r=((y*(V+z)+V*z)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",t+"#"+a._height+", "+r),this._print(a._children[1],t+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(a){if(a._height==0){var t=a._prevLeaf,r=a._nextLeaf;t!=null&&(t._nextLeaf=r),r!=null&&(r._prevLeaf=t),a==this.leafList&&(this.leafList=this.leafList._nextLeaf),a==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),a._nextLeaf=null,a._prevLeaf=null,a._proxy._leaf=null,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a;return}this.deleteRecursive(a._children[0]),this.deleteRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}decomposeRecursive(a){if(a._height==0){a._childIndex=0,a._parent=null;return}this.decomposeRecursive(a._children[0]),this.decomposeRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}buildTopDownRecursive(a,t,r){var i=r-t;if(i==1){var o=a[t],_=o._proxy;return o._aabbMinX=_._aabbMinX,o._aabbMinY=_._aabbMinY,o._aabbMinZ=_._aabbMinZ,o._aabbMaxX=_._aabbMaxX,o._aabbMaxY=_._aabbMaxY,o._aabbMaxZ=_._aabbMaxZ,o}var s=this._strategy._splitLeaves(a,t,r),h=this.buildTopDownRecursive(a,t,s),v=this.buildTopDownRecursive(a,s,r),e=this._nodePool;e!=null?(this._nodePool=e._next,e._next=null):e=new x.collision.broadphase.bvh.BvhNode;var l=e;l._children[0]=h,h._parent=l,h._childIndex=0,l._children[1]=v,v._parent=l,v._childIndex=1;var u=l._children[0],b=l._children[1];l._aabbMinX=u._aabbMinX<b._aabbMinX?u._aabbMinX:b._aabbMinX,l._aabbMinY=u._aabbMinY<b._aabbMinY?u._aabbMinY:b._aabbMinY,l._aabbMinZ=u._aabbMinZ<b._aabbMinZ?u._aabbMinZ:b._aabbMinZ,l._aabbMaxX=u._aabbMaxX>b._aabbMaxX?u._aabbMaxX:b._aabbMaxX,l._aabbMaxY=u._aabbMaxY>b._aabbMaxY?u._aabbMaxY:b._aabbMaxY,l._aabbMaxZ=u._aabbMaxZ>b._aabbMaxZ?u._aabbMaxZ:b._aabbMaxZ;var f=l._children[0]._height,n=l._children[1]._height;return l._height=(f>n?f:n)+1,l}getBalanceRecursive(a){if(a==null||a._height==0)return 0;var t=a._children[0]._height-a._children[1]._height;return t<0&&(t=-t),t+this.getBalanceRecursive(a._children[0])+this.getBalanceRecursive(a._children[1])}};x.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(a,t){var r=a;this._minX=r.x,this._minY=r.y,this._minZ=r.z;var i=t;return this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){var a=new x.common.Vec3,t=a;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,a}getMinTo(a){var t=a;t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(a){var t=a;return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){var a=new x.common.Vec3,t=a;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,a}getMaxTo(a){var t=a;t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(a){var t=a;return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){var a=new x.common.Vec3,t,r,i;t=this._minX+this._maxX,r=this._minY+this._maxY,i=this._minZ+this._maxZ,t*=.5,r*=.5,i*=.5;var o=a;return o.x=t,o.y=r,o.z=i,a}getCenterTo(a){var t,r,i;t=this._minX+this._maxX,r=this._minY+this._maxY,i=this._minZ+this._maxZ,t*=.5,r*=.5,i*=.5;var o=a;o.x=t,o.y=r,o.z=i}getExtents(){var a=new x.common.Vec3,t,r,i;t=this._maxX-this._minX,r=this._maxY-this._minY,i=this._maxZ-this._minZ,t*=.5,r*=.5,i*=.5;var o=a;return o.x=t,o.y=r,o.z=i,a}getExtentsTo(a){var t,r,i;t=this._maxX-this._minX,r=this._maxY-this._minY,i=this._maxZ-this._minZ,t*=.5,r*=.5,i*=.5;var o=a;o.x=t,o.y=r,o.z=i}combine(a){return this._minX=this._minX<a._minX?this._minX:a._minX,this._minY=this._minY<a._minY?this._minY:a._minY,this._minZ=this._minZ<a._minZ?this._minZ:a._minZ,this._maxX=this._maxX>a._maxX?this._maxX:a._maxX,this._maxY=this._maxY>a._maxY?this._maxY:a._maxY,this._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,this}combined(a){var t=new x.collision.geometry.Aabb;return t._minX=this._minX<a._minX?this._minX:a._minX,t._minY=this._minY<a._minY?this._minY:a._minY,t._minZ=this._minZ<a._minZ?this._minZ:a._minZ,t._maxX=this._maxX>a._maxX?this._maxX:a._maxX,t._maxY=this._maxY>a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,t}overlap(a){return this._minX<a._maxX&&this._maxX>a._minX&&this._minY<a._maxY&&this._maxY>a._minY&&this._minZ<a._maxZ?this._maxZ>a._minZ:!1}getIntersection(a){var t=new x.collision.geometry.Aabb;return t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ,t}getIntersectionTo(a,t){t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ}copyFrom(a){return this._minX=a._minX,this._minY=a._minY,this._minZ=a._minZ,this._maxX=a._maxX,this._maxY=a._maxY,this._maxZ=a._maxZ,this}clone(){var a=new x.collision.geometry.Aabb;return a._minX=this._minX,a._minY=this._minY,a._minZ=this._minZ,a._maxX=this._maxX,a._maxY=this._maxY,a._maxZ=this._maxZ,a}};x.collision.geometry.BoxGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(1);var t=a;this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=a.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=a.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=a.z,this._updateMass();var r=a.x<a.y?a.z<a.x?a.z:a.x:a.z<a.y?a.z:a.y;this._gjkMargin>r*.2&&(this._gjkMargin=r*.2)}getHalfExtents(){var a=new x.common.Vec3,t=a;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,a}getHalfExtentsTo(a){var t=a;t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);var a,t,r;a=this._halfExtentsX*this._halfExtentsX,t=this._halfExtentsY*this._halfExtentsY,r=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(t+r),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(r+a),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+t)}_computeAabb(a,t){var r,i,o,_,s,h,v,e,l,u,b,f;u=t._rotation00*this._halfAxisXX+t._rotation01*this._halfAxisXY+t._rotation02*this._halfAxisXZ,b=t._rotation10*this._halfAxisXX+t._rotation11*this._halfAxisXY+t._rotation12*this._halfAxisXZ,f=t._rotation20*this._halfAxisXX+t._rotation21*this._halfAxisXY+t._rotation22*this._halfAxisXZ,r=u,i=b,o=f;var n,c,M;n=t._rotation00*this._halfAxisYX+t._rotation01*this._halfAxisYY+t._rotation02*this._halfAxisYZ,c=t._rotation10*this._halfAxisYX+t._rotation11*this._halfAxisYY+t._rotation12*this._halfAxisYZ,M=t._rotation20*this._halfAxisYX+t._rotation21*this._halfAxisYY+t._rotation22*this._halfAxisYZ,_=n,s=c,h=M;var m,y,V;m=t._rotation00*this._halfAxisZX+t._rotation01*this._halfAxisZY+t._rotation02*this._halfAxisZZ,y=t._rotation10*this._halfAxisZX+t._rotation11*this._halfAxisZY+t._rotation12*this._halfAxisZZ,V=t._rotation20*this._halfAxisZX+t._rotation21*this._halfAxisZY+t._rotation22*this._halfAxisZZ,v=m,e=y,l=V,r=r<0?-r:r,i=i<0?-i:i,o=o<0?-o:o,_=_<0?-_:_,s=s<0?-s:s,h=h<0?-h:h,v=v<0?-v:v,e=e<0?-e:e,l=l<0?-l:l;var z,I,k;z=r+_,I=i+s,k=o+h,z+=v,I+=e,k+=l,a._minX=t._positionX-z,a._minY=t._positionY-I,a._minZ=t._positionZ-k,a._maxX=t._positionX+z,a._maxY=t._positionY+I,a._maxZ=t._positionZ+k}computeLocalSupportingVertex(a,t){var r,i,o,_,s,h;r=this._gjkMargin,i=this._gjkMargin,o=this._gjkMargin,r=r<this._halfExtentsX?r:this._halfExtentsX,i=i<this._halfExtentsY?i:this._halfExtentsY,o=o<this._halfExtentsZ?o:this._halfExtentsZ,_=this._halfExtentsX-r,s=this._halfExtentsY-i,h=this._halfExtentsZ-o,t.x=a.x>0?_:-_,t.y=a.y>0?s:-s,t.z=a.z>0?h:-h}_rayCastLocal(a,t,r,i,o,_,s){var h=a,v=t,e=r,l=i,u=o,b=_,f=this._halfExtentsX,n=this._halfExtentsY,c=this._halfExtentsZ,M=l-h,m=u-v,y=b-e,V=0,z=0,I=0,k=1,X=1,L=1;if(M>-1e-6&&M<1e-6){if(h<=-f||h>=f)return!1}else{var p=1/M,g=(-f-h)*p,N=(f-h)*p;if(g>N){var A=g;g=N,N=A}g>0&&(V=g),N<1&&(k=N)}if(m>-1e-6&&m<1e-6){if(v<=-n||v>=n)return!1}else{var F=1/m,S=(-n-v)*F,Y=(n-v)*F;if(S>Y){var R=S;S=Y,Y=R}S>0&&(z=S),Y<1&&(X=Y)}if(y>-1e-6&&y<1e-6){if(e<=-c||e>=c)return!1}else{var C=1/y,d=(-c-e)*C,Z=(c-e)*C;if(d>Z){var $=d;d=Z,Z=$}d>0&&(I=d),Z<1&&(L=Z)}if(V>=1||z>=1||I>=1||k<=0||X<=0||L<=0)return!1;var j=V,E=k,G=0;if(z>j&&(j=z,G=1),I>j&&(j=I,G=2),X<E&&(E=X),L<E&&(E=L),j>E||j==0)return!1;switch(G){case 0:s.normal.init(M>0?-1:1,0,0);break;case 1:s.normal.init(0,m>0?-1:1,0);break;case 2:s.normal.init(0,0,y>0?-1:1);break}return s.position.init(h+j*M,v+j*m,e+j*y),s.fraction=j,!0}};x.collision.geometry.CapsuleGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(4),this._radius=a,this._halfHeight=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight,r=6.28318530717958*a*this._halfHeight,i=3.14159265358979*a*this._radius*4/3;this._volume=r+i;var o=this._volume==0?0:1/this._volume,_=o*(r*a*.5+i*a*.4),s=o*(r*(a*.25+t/3)+i*(a*.4+this._halfHeight*this._radius*.75+t));this._inertiaCoeff00=s,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=_,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=s}_computeAabb(a,t){var r,i,o;r=this._radius,i=this._radius,o=this._radius;var _,s,h;_=t._rotation01,s=t._rotation11,h=t._rotation21,_=_<0?-_:_,s=s<0?-s:s,h=h<0?-h:h,_*=this._halfHeight,s*=this._halfHeight,h*=this._halfHeight,r+=_,i+=s,o+=h,a._minX=t._positionX-r,a._minY=t._positionY-i,a._minZ=t._positionZ-o,a._maxX=t._positionX+r,a._maxY=t._positionY+i,a._maxZ=t._positionZ+o}computeLocalSupportingVertex(a,t){a.y>0?t.init(0,this._halfHeight,0):t.init(0,-this._halfHeight,0)}_rayCastLocal(a,t,r,i,o,_,s){var h=a,v=t,e=r,l=i,u=o,b=_,f=this._halfHeight,n=l-h,c=u-v,M=b-e,m=0,y=1,V=n*n+M*M,z=h*n+e*M,I=h*h+e*e-this._radius*this._radius,k=z*z-V*I;if(k<0)return!1;if(V>0){var X=Math.sqrt(k);if(m=(-z-X)/V,y=(-z+X)/V,m>=1||y<=0)return!1}else{if(I>=0)return!1;m=0,y=1}var L=v+c*m,p;if(L>-f&&L<f){if(m>0){p=m;var g=s.normal.init(h+n*p,0,e+M*p),N=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);N>0&&(N=1/N);var A=g.x*N,F=g.y*N,S=g.z*N;return g.x=A,g.y=F,g.z=S,s.position.init(h+p*n,L,e+p*M),s.fraction=p,!0}return!1}var Y=L<0?-f:f,R,C,d,Z,$,j;R=0,C=Y,d=0,Z=a-R,$=t-C,j=r-d;var E,G,B;if(E=i-a,G=o-t,B=_-r,V=E*E+G*G+B*B,z=Z*E+$*G+j*B,I=Z*Z+$*$+j*j-this._radius*this._radius,k=z*z-V*I,k<0)return!1;var Q=(-z-Math.sqrt(k))/V;if(Q<0||Q>1)return!1;var U,J,D,H,K,ra;U=Z+E*Q,J=$+G*Q,D=j+B*Q;var sa=U*U+J*J+D*D;sa>0&&(sa=1/Math.sqrt(sa)),H=U*sa,K=J*sa,ra=D*sa,U+=R,J+=C,D+=d;var W=s.position;W.x=U,W.y=J,W.z=D;var q=s.normal;return q.x=H,q.y=K,q.z=ra,s.fraction=Q,!0}};x.collision.geometry.ConeGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(3),this._radius=a,this._halfHeight=t,this.sinTheta=a/Math.sqrt(a*a+4*t*t),this.cosTheta=2*t/Math.sqrt(a*a+4*t*t),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*a+2*t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*a+2*t)}_computeAabb(a,t){var r,i,o,_,s,h,v,e,l,u,b,f;r=t._rotation01,i=t._rotation11,o=t._rotation21,_=r*r,s=i*i,h=o*o;var n=_,c=s,M=h;u=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-M),u*=this._radius,b*=this._radius,f*=this._radius,v=r*this._halfHeight,e=i*this._halfHeight,l=o*this._halfHeight;var m,y,V,z,I,k;m=-v,y=-e,V=-l,m-=u,y-=b,V-=f,z=-v,I=-e,k=-l,z+=u,I+=b,k+=f;var X,L,p,g,N,A;X=m>z?m:z,L=y>I?y:I,p=V>k?V:k,X=X>v?X:v,L=L>e?L:e,p=p>l?p:l,g=m<z?m:z,N=y<I?y:I,A=V<k?V:k,g=g<v?g:v,N=N<e?N:e,A=A<l?A:l,a._minX=t._positionX+g,a._minY=t._positionY+N,a._minZ=t._positionZ+A,a._maxX=t._positionX+X,a._maxY=t._positionY+L,a._maxZ=t._positionZ+p}computeLocalSupportingVertex(a,t){var r=a.x,i=a.y,o=a.z;if(i>0&&i*i>this.sinTheta*this.sinTheta*(r*r+i*i+o*o)){t.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),t.y<0&&(t.y=0);return}var _=a.x,s=a.z,h=_*_+s*s,v=2*this._halfHeight,e=(v-this._gjkMargin)/v*this._radius-this._gjkMargin/this.cosTheta;e<0&&(e=0);var l=h>0?e/Math.sqrt(h):0,u=this._halfHeight-this._gjkMargin;u<0&&(u=0),t.x=_*l,t.y=-u,t.z=s*l}_rayCastLocal(a,t,r,i,o,_,s){var h=a,v=t,e=r,l=i,u=o,b=_,f=this._halfHeight,n=l-h,c=u-v,M=b-e,m=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,z=(-f-v)*V,I=(f-v)*V;if(z>I){var k=z;z=I,I=k}z>0&&(m=z),I<1&&(y=I)}if(m>=1||y<=0)return!1;var X=0,L=0;v-=f;var p=this.cosTheta*this.cosTheta,g=p*(n*n+c*c+M*M)-c*c,N=p*(h*n+v*c+e*M)-v*c,A=p*(h*h+v*v+e*e)-v*v,F=N*N-g*A;if(g!=0){if(F<0)return!1;var S=Math.sqrt(F);if(g<0){if(c>0){if(X=0,L=(-N+S)/g,L<=0)return!1}else if(X=(-N-S)/g,L=1,X>=1)return!1}else if(X=(-N-S)/g,L=(-N+S)/g,X>=1||L<=0)return!1}else{var Y=-A/(2*N);if(N>0){if(X=0,L=Y,Y<=0)return!1}else if(X=Y,L=1,Y>=1)return!1}v+=f;var R;if(L<=m||y<=X)return!1;if(X<m){if(R=m,R==0)return!1;s.normal.init(0,c>0?-1:1,0)}else{if(R=X,R==0)return!1;var C=s.normal.init(h+n*R,0,e+M*R),d=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);d>0&&(d=1/d);var Z=C.x*d,$=C.y*d,j=C.z*d;C.x=Z,C.y=$,C.z=j;var E=C,G=this.cosTheta,B=E.x*G,Q=E.y*G,U=E.z*G;E.x=B,E.y=Q,E.z=U,s.normal.y+=this.sinTheta}return s.position.init(h+R*n,v+R*c,e+R*M),s.fraction=R,!0}};x.collision.geometry.ConvexHullGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(5),this._numVertices=a.length;var t=new Array(this._numVertices);this._vertices=t;var r=new Array(this._numVertices);this._tmpVertices=r;for(var i=0,o=this._numVertices;i<o;){var _=i++;this._vertices[_]=a[_],this._tmpVertices[_]=new x.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var a=this._vertices[0].x,t=this._vertices[0].y,r=this._vertices[0].z,i=this._vertices[0].x,o=this._vertices[0].y,_=this._vertices[0].z,s=1,h=this._numVertices;s<h;){var v=s++,e=this._vertices[v].x,l=this._vertices[v].y,u=this._vertices[v].z;e<a?a=e:e>i&&(i=e),l<t?t=l:l>o&&(o=l),u<r?r=u:u>_&&(_=u)}var b=i-a,f=o-t,n=_-r;this._volume=b*f*n;var c=((a+i)*(a+i)+(t+o)*(t+o)+(r+_)*(r+_))*.25;b=b*b*.25,f=f*f*.25,n=n*n*.25,this._inertiaCoeff00=.3333333333333333*(f+n)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(n+b)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(b+f)+c}_computeAabb(a,t){var r,i,o,_,s,h,v,e,l;v=this._gjkMargin,e=this._gjkMargin,l=this._gjkMargin;var u,b,f,n=this._vertices[0];u=n.x,b=n.y,f=n.z;var c,M,m,y,V,z;y=t._rotation00*u+t._rotation01*b+t._rotation02*f,V=t._rotation10*u+t._rotation11*b+t._rotation12*f,z=t._rotation20*u+t._rotation21*b+t._rotation22*f,c=y,M=V,m=z,c+=t._positionX,M+=t._positionY,m+=t._positionZ,r=c,i=M,o=m,_=c,s=M,h=m;for(var I=1,k=this._numVertices;I<k;){var X=I++,L=this._vertices[X];u=L.x,b=L.y,f=L.z;var p,g,N;p=t._rotation00*u+t._rotation01*b+t._rotation02*f,g=t._rotation10*u+t._rotation11*b+t._rotation12*f,N=t._rotation20*u+t._rotation21*b+t._rotation22*f,c=p,M=g,m=N,c+=t._positionX,M+=t._positionY,m+=t._positionZ,r=r<c?r:c,i=i<M?i:M,o=o<m?o:m,_=_>c?_:c,s=s>M?s:M,h=h>m?h:m}a._minX=r-v,a._minY=i-e,a._minZ=o-l,a._maxX=_+v,a._maxY=s+e,a._maxZ=h+l}computeLocalSupportingVertex(a,t){for(var r=this._vertices[0],i=r.x*a.x+r.y*a.y+r.z*a.z,o=0,_=1,s=this._numVertices;_<s;){var h=_++,v=this._vertices[h],e=v.x*a.x+v.y*a.y+v.z*a.z;e>i&&(i=e,o=h)}var l=this._vertices[o];t.x=l.x,t.y=l.y,t.z=l.z}};x.collision.geometry.CylinderGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(2),this._radius=a,this._halfHeight=t,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*a+t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*a+t)}_computeAabb(a,t){var r,i,o,_,s,h,v,e,l,u,b,f;r=t._rotation01,i=t._rotation11,o=t._rotation21,r=r<0?-r:r,i=i<0?-i:i,o=o<0?-o:o,_=r*r,s=i*i,h=o*o;var n=_,c=s,M=h;u=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-M),u*=this._radius,b*=this._radius,f*=this._radius,v=r*this._halfHeight,e=i*this._halfHeight,l=o*this._halfHeight;var m,y,V;m=u+v,y=b+e,V=f+l,a._minX=t._positionX-m,a._minY=t._positionY-y,a._minZ=t._positionZ-V,a._maxX=t._positionX+m,a._maxY=t._positionY+y,a._maxZ=t._positionZ+V}computeLocalSupportingVertex(a,t){var r=a.x,i=a.z,o=r*r+i*i,_=this._radius-this._gjkMargin;_<0&&(_=0);var s=o>0?_/Math.sqrt(o):0,h=this._halfHeight-this._gjkMargin;h<0&&(h=0),t.x=r*s,t.y=a.y>0?h:-h,t.z=i*s}_rayCastLocal(a,t,r,i,o,_,s){var h=a,v=t,e=r,l=i,u=o,b=_,f=this._halfHeight,n=l-h,c=u-v,M=b-e,m=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,z=(-f-v)*V,I=(f-v)*V;if(z>I){var k=z;z=I,I=k}z>0&&(m=z),I<1&&(y=I)}if(m>=1||y<=0)return!1;var X=0,L=1,p=n*n+M*M,g=h*n+e*M,N=h*h+e*e-this._radius*this._radius,A=g*g-p*N;if(A<0)return!1;if(p>0){var F=Math.sqrt(A);if(X=(-g-F)/p,L=(-g+F)/p,X>=1||L<=0)return!1}else{if(N>=0)return!1;X=0,L=1}var S;if(L<=m||y<=X)return!1;if(X<m){if(S=m,S==0)return!1;s.normal.init(0,c>0?-1:1,0)}else{if(S=X,S==0)return!1;var Y=s.normal.init(h+n*S,0,e+M*S),R=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);R>0&&(R=1/R);var C=Y.x*R,d=Y.y*R,Z=Y.z*R;Y.x=C,Y.y=d,Y.z=Z}return s.position.init(h+S*n,v+S*c,e+S*M),s.fraction=S,!0}};x.collision.geometry.GeometryType=class{};x.collision.geometry.RayCastHit=class{constructor(){this.position=new x.common.Vec3,this.normal=new x.common.Vec3,this.fraction=0}};x.collision.geometry.SphereGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(0),this._radius=a,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(a,t){var r,i,o;r=this._radius,i=this._radius,o=this._radius,a._minX=t._positionX-r,a._minY=t._positionY-i,a._minZ=t._positionZ-o,a._maxX=t._positionX+r,a._maxY=t._positionY+i,a._maxZ=t._positionZ+o}computeLocalSupportingVertex(a,t){t.zero()}_rayCastLocal(a,t,r,i,o,_,s){var h,v,e;h=i-a,v=o-t,e=_-r;var l=h*h+v*v+e*e,u=a*h+t*v+r*e,b=a*a+t*t+r*r-this._radius*this._radius,f=u*u-l*b;if(f<0)return!1;var n=(-u-Math.sqrt(f))/l;if(n<0||n>1)return!1;var c,M,m,y,V,z;c=a+h*n,M=t+v*n,m=r+e*n;var I=c*c+M*M+m*m;I>0&&(I=1/Math.sqrt(I)),y=c*I,V=M*I,z=m*I;var k=s.position;k.x=c,k.y=M,k.z=m;var X=s.normal;return X.x=y,X.y=V,X.z=z,s.fraction=n,!0}};x.collision.narrowphase||(x.collision.narrowphase={});x.collision.narrowphase.CollisionMatrix=class{constructor(){var a=new Array(8);this.detectors=a;var t=this.detectors,r=new Array(8);t[0]=r;var i=this.detectors,o=new Array(8);i[1]=o;var _=this.detectors,s=new Array(8);_[2]=s;var h=this.detectors,v=new Array(8);h[3]=v;var e=this.detectors,l=new Array(8);e[4]=l;var u=this.detectors,b=new Array(8);u[5]=b;var f=new x.collision.narrowphase.detector.GjkEpaDetector,n=0,c=1,M=2,m=3,y=4,V=5;this.detectors[n][n]=new x.collision.narrowphase.detector.SphereSphereDetector,this.detectors[n][c]=new x.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[n][M]=f,this.detectors[n][m]=f,this.detectors[n][y]=new x.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[n][V]=f,this.detectors[c][n]=new x.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[c][c]=new x.collision.narrowphase.detector.BoxBoxDetector,this.detectors[c][M]=f,this.detectors[c][m]=f,this.detectors[c][y]=f,this.detectors[c][V]=f,this.detectors[M][n]=f,this.detectors[M][c]=f,this.detectors[M][M]=f,this.detectors[M][m]=f,this.detectors[M][y]=f,this.detectors[M][V]=f,this.detectors[m][n]=f,this.detectors[m][c]=f,this.detectors[m][M]=f,this.detectors[m][m]=f,this.detectors[m][y]=f,this.detectors[m][V]=f,this.detectors[y][n]=new x.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[y][c]=f,this.detectors[y][M]=f,this.detectors[y][m]=f,this.detectors[y][y]=new x.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[y][V]=f,this.detectors[V][n]=f,this.detectors[V][c]=f,this.detectors[V][M]=f,this.detectors[V][m]=f,this.detectors[V][y]=f,this.detectors[V][V]=f}getDetector(a,t){return this.detectors[a][t]}};x.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new x.common.Vec3;var a=new Array(x.common.Setting.maxManifoldPoints);this.points=a,this.incremental=!1;for(var t=0,r=x.common.Setting.maxManifoldPoints;t<r;){var i=t++;this.points[i]=new x.collision.narrowphase.DetectorResultPoint}}getMaxDepth(){for(var a=0,t=0,r=this.numPoints;t<r;){var i=t++;this.points[i].depth>a&&(a=this.points[i].depth)}return a}clear(){this.numPoints=0;for(var a=0,t=this.points;a<t.length;){var r=t[a];++a,r.position1.zero(),r.position2.zero(),r.depth=0,r.id=0}this.normal.zero()}};x.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new x.common.Vec3,this.position2=new x.common.Vec3,this.depth=0,this.id=0}};x.collision.narrowphase.detector||(x.collision.narrowphase.detector={});x.collision.narrowphase.detector.Detector=class{constructor(a){this.swapped=a}setNormal(a,t,r,i){var o=a.normal;if(o.x=t,o.y=r,o.z=i,this.swapped){var _=a.normal,s=-_.x,h=-_.y,v=-_.z;_.x=s,_.y=h,_.z=v}}addPoint(a,t,r,i,o,_,s,h,v){var e=a.points[a.numPoints++];if(e.depth=h,e.id=v,this.swapped){var l=e.position1;l.x=o,l.y=_,l.z=s;var u=e.position2;u.x=t,u.y=r,u.z=i}else{var b=e.position1;b.x=t,b.y=r,b.z=i;var f=e.position2;f.x=o,f.y=_,f.z=s}}detectImpl(a,t,r,i,o,_){}detect(a,t,r,i,o,_){a.numPoints=0;for(var s=0,h=a.points;s<h.length;){var v=h[s];++s,v.position1.zero(),v.position2.zero(),v.depth=0,v.id=0}a.normal.zero(),this.swapped?this.detectImpl(a,r,t,o,i,_):this.detectImpl(a,t,r,i,o,_)}};x.collision.narrowphase.detector.BoxBoxDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new x.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(a,t,r,i,o,_){var s=t,h=r;a.incremental=!1;var v,e,l,u,b,f,n,c,M;v=i._positionX,e=i._positionY,l=i._positionZ,u=o._positionX,b=o._positionY,f=o._positionZ,n=u-v,c=b-e,M=f-l;var m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y,R,C,d;m=i._rotation00,y=i._rotation10,V=i._rotation20,z=i._rotation01,I=i._rotation11,k=i._rotation21,X=i._rotation02,L=i._rotation12,p=i._rotation22,g=o._rotation00,N=o._rotation10,A=o._rotation20,F=o._rotation01,S=o._rotation11,Y=o._rotation21,R=o._rotation02,C=o._rotation12,d=o._rotation22;var Z=s._halfExtentsX,$=s._halfExtentsY,j=s._halfExtentsZ,E=h._halfExtentsX,G=h._halfExtentsY,B=h._halfExtentsZ,Q,U,J,D,H,K,ra,sa,W,q,na,oa,aa,T,ca,_a,w,ta;Q=m*Z,U=y*Z,J=V*Z,D=z*$,H=I*$,K=k*$,ra=X*j,sa=L*j,W=p*j,q=g*E,na=N*E,oa=A*E,aa=F*G,T=S*G,ca=Y*G,_a=R*B,w=C*B,ta=d*B;var ia=1/0,la=-1,va=0,xa,Ma,za;xa=0,Ma=0,za=0;var Xa=Z,Za=m*q+y*na+V*oa,fa=m*aa+y*T+V*ca,ba=m*_a+y*w+V*ta;Za<0&&(Za=-Za),fa<0&&(fa=-fa),ba<0&&(ba=-ba);var ea=Za+fa+ba,ha=m*n+y*c+V*M,pa=Xa+ea,ya=ha<0,da=ya?-ha:ha;if(da<pa){var ma=pa-da;ma<ia&&(ia=ma,la=0,xa=m,Ma=y,za=V,va=ya?-1:1)}else return;Xa=$;var Ya=z*q+I*na+k*oa,Qa=z*aa+I*T+k*ca,ga=z*_a+I*w+k*ta;Ya<0&&(Ya=-Ya),Qa<0&&(Qa=-Qa),ga<0&&(ga=-ga),ea=Ya+Qa+ga,ha=z*n+I*c+k*M;var ua=Xa+ea,wa=ha<0,ka=wa?-ha:ha;if(ka<ua){var Pa=ua-ka;Pa<ia&&(ia=Pa,la=1,xa=z,Ma=I,za=k,va=wa?-1:1)}else return;Xa=j;var Mt=X*q+L*na+p*oa,Ha=X*aa+L*T+p*ca,Ba=X*_a+L*w+p*ta;Mt<0&&(Mt=-Mt),Ha<0&&(Ha=-Ha),Ba<0&&(Ba=-Ba),ea=Mt+Ha+Ba,ha=X*n+L*c+p*M;var nt=Xa+ea,Ea=ha<0,Fa=Ea?-ha:ha;if(Fa<nt){var Aa=nt-Fa;Aa<ia&&(ia=Aa,la=2,xa=X,Ma=L,za=p,va=Ea?-1:1)}else return;ia>x.common.Setting.linearSlop?ia-=x.common.Setting.linearSlop:ia=0;var ft=g*Q+N*U+A*J,Ua=g*D+N*H+A*K,ja=g*ra+N*sa+A*W;ft<0&&(ft=-ft),Ua<0&&(Ua=-Ua),ja<0&&(ja=-ja),Xa=ft+Ua+ja,ea=E,ha=g*n+N*c+A*M;var bt=Xa+ea,rt=ha<0,$a=rt?-ha:ha;if($a<bt){var _t=bt-$a;_t<ia&&(ia=_t,la=3,xa=g,Ma=N,za=A,va=rt?-1:1)}else return;var gt=F*Q+S*U+Y*J,mt=F*D+S*H+Y*K,Wa=F*ra+S*sa+Y*W;gt<0&&(gt=-gt),mt<0&&(mt=-mt),Wa<0&&(Wa=-Wa),Xa=gt+mt+Wa,ea=G,ha=F*n+S*c+Y*M;var it=Xa+ea,ut=ha<0,Da=ut?-ha:ha;if(Da<it){var Ta=it-Da;Ta<ia&&(ia=Ta,la=4,xa=F,Ma=S,za=Y,va=ut?-1:1)}else return;var Na=R*Q+C*U+d*J,Vt=R*D+C*H+d*K,Pt=R*ra+C*sa+d*W;Na<0&&(Na=-Na),Vt<0&&(Vt=-Vt),Pt<0&&(Pt=-Pt),Xa=Na+Vt+Pt,ea=B,ha=R*n+C*c+d*M;var et=Xa+ea,Xt=ha<0,Yt=Xt?-ha:ha;if(Yt<et){var zt=et-Yt;zt<ia&&(ia=zt,la=5,xa=R,Ma=C,za=d,va=Xt?-1:1)}else return;ia>x.common.Setting.linearSlop?ia-=x.common.Setting.linearSlop:ia=0;var Ia,O,Va;if(Ia=y*A-V*N,O=V*g-m*A,Va=m*N-y*g,!(Ia==0&&O==0&&Va==0)){var lt=Ia*Ia+O*O+Va*Va;lt>0&&(lt=1/Math.sqrt(lt)),Ia*=lt,O*=lt,Va*=lt;var P=Ia*D+O*H+Va*K,wt=Ia*ra+O*sa+Va*W;P<0&&(P=-P),wt<0&&(wt=-wt),Xa=P+wt;var Bt=Ia*aa+O*T+Va*ca,At=Ia*_a+O*w+Va*ta;Bt<0&&(Bt=-Bt),At<0&&(At=-At),ea=Bt+At,ha=Ia*n+O*c+Va*M;var yt=Xa+ea,kt=ha<0,pt=kt?-ha:ha;if(pt<yt){var ht=yt-pt;ht<ia&&(ia=ht,la=6,xa=Ia,Ma=O,za=Va,va=kt?-1:1)}else return}if(Ia=y*Y-V*S,O=V*F-m*Y,Va=m*S-y*F,!(Ia==0&&O==0&&Va==0)){var xt=Ia*Ia+O*O+Va*Va;xt>0&&(xt=1/Math.sqrt(xt)),Ia*=xt,O*=xt,Va*=xt;var Ra=Ia*D+O*H+Va*K,st=Ia*ra+O*sa+Va*W;Ra<0&&(Ra=-Ra),st<0&&(st=-st),Xa=Ra+st;var Ca=Ia*q+O*na+Va*oa,vt=Ia*_a+O*w+Va*ta;Ca<0&&(Ca=-Ca),vt<0&&(vt=-vt),ea=Ca+vt,ha=Ia*n+O*c+Va*M;var qa=Xa+ea,at=ha<0,Oa=at?-ha:ha;if(Oa<qa){var tt=qa-Oa;tt<ia&&(ia=tt,la=7,xa=Ia,Ma=O,za=Va,va=at?-1:1)}else return}if(Ia=y*d-V*C,O=V*R-m*d,Va=m*C-y*R,!(Ia==0&&O==0&&Va==0)){var ct=Ia*Ia+O*O+Va*Va;ct>0&&(ct=1/Math.sqrt(ct)),Ia*=ct,O*=ct,Va*=ct;var Sa=Ia*D+O*H+Va*K,Ga=Ia*ra+O*sa+Va*W;Sa<0&&(Sa=-Sa),Ga<0&&(Ga=-Ga),Xa=Sa+Ga;var Ka=Ia*q+O*na+Va*oa,La=Ia*aa+O*T+Va*ca;Ka<0&&(Ka=-Ka),La<0&&(La=-La),ea=Ka+La,ha=Ia*n+O*c+Va*M;var ot=Xa+ea,It=ha<0,or=It?-ha:ha;if(or<ot){var gr=ot-or;gr<ia&&(ia=gr,la=8,xa=Ia,Ma=O,za=Va,va=It?-1:1)}else return}if(Ia=I*A-k*N,O=k*g-z*A,Va=z*N-I*g,!(Ia==0&&O==0&&Va==0)){var ar=Ia*Ia+O*O+Va*Va;ar>0&&(ar=1/Math.sqrt(ar)),Ia*=ar,O*=ar,Va*=ar;var Ct=Ia*Q+O*U+Va*J,_r=Ia*ra+O*sa+Va*W;Ct<0&&(Ct=-Ct),_r<0&&(_r=-_r),Xa=Ct+_r;var Et=Ia*aa+O*T+Va*ca,St=Ia*_a+O*w+Va*ta;Et<0&&(Et=-Et),St<0&&(St=-St),ea=Et+St,ha=Ia*n+O*c+Va*M;var Gt=Xa+ea,jr=ha<0,vr=jr?-ha:ha;if(vr<Gt){var lr=Gt-vr;lr<ia&&(ia=lr,la=9,xa=Ia,Ma=O,za=Va,va=jr?-1:1)}else return}if(Ia=I*Y-k*S,O=k*F-z*Y,Va=z*S-I*F,!(Ia==0&&O==0&&Va==0)){var tr=Ia*Ia+O*O+Va*Va;tr>0&&(tr=1/Math.sqrt(tr)),Ia*=tr,O*=tr,Va*=tr;var Or=Ia*Q+O*U+Va*J,Xr=Ia*ra+O*sa+Va*W;Or<0&&(Or=-Or),Xr<0&&(Xr=-Xr),Xa=Or+Xr;var Mr=Ia*q+O*na+Va*oa,Zt=Ia*_a+O*w+Va*ta;Mr<0&&(Mr=-Mr),Zt<0&&(Zt=-Zt),ea=Mr+Zt,ha=Ia*n+O*c+Va*M;var ir=Xa+ea,Wt=ha<0,nr=Wt?-ha:ha;if(nr<ir){var $r=ir-nr;$r<ia&&(ia=$r,la=10,xa=Ia,Ma=O,za=Va,va=Wt?-1:1)}else return}if(Ia=I*d-k*C,O=k*R-z*d,Va=z*C-I*R,!(Ia==0&&O==0&&Va==0)){var Ut=Ia*Ia+O*O+Va*Va;Ut>0&&(Ut=1/Math.sqrt(Ut)),Ia*=Ut,O*=Ut,Va*=Ut;var Kr=Ia*Q+O*U+Va*J,Ir=Ia*ra+O*sa+Va*W;Kr<0&&(Kr=-Kr),Ir<0&&(Ir=-Ir),Xa=Kr+Ir;var mi=Ia*q+O*na+Va*oa,Wr=Ia*aa+O*T+Va*ca;mi<0&&(mi=-mi),Wr<0&&(Wr=-Wr),ea=mi+Wr,ha=Ia*n+O*c+Va*M;var Lt=Xa+ea,Kt=ha<0,Tt=Kt?-ha:ha;if(Tt<Lt){var br=Lt-Tt;br<ia&&(ia=br,la=11,xa=Ia,Ma=O,za=Va,va=Kt?-1:1)}else return}if(Ia=L*A-p*N,O=p*g-X*A,Va=X*N-L*g,!(Ia==0&&O==0&&Va==0)){var zr=Ia*Ia+O*O+Va*Va;zr>0&&(zr=1/Math.sqrt(zr)),Ia*=zr,O*=zr,Va*=zr;var vi=Ia*Q+O*U+Va*J,qt=Ia*D+O*H+Va*K;vi<0&&(vi=-vi),qt<0&&(qt=-qt),Xa=vi+qt;var fr=Ia*aa+O*T+Va*ca,dt=Ia*_a+O*w+Va*ta;fr<0&&(fr=-fr),dt<0&&(dt=-dt),ea=fr+dt,ha=Ia*n+O*c+Va*M;var ur=Xa+ea,hr=ha<0,ei=hr?-ha:ha;if(ei<ur){var Xi=ur-ei;Xi<ia&&(ia=Xi,la=12,xa=Ia,Ma=O,za=Va,va=hr?-1:1)}else return}if(Ia=L*Y-p*S,O=p*F-X*Y,Va=X*S-L*F,!(Ia==0&&O==0&&Va==0)){var io=Ia*Ia+O*O+Va*Va;io>0&&(io=1/Math.sqrt(io)),Ia*=io,O*=io,Va*=io;var Jt=Ia*Q+O*U+Va*J,fi=Ia*D+O*H+Va*K;Jt<0&&(Jt=-Jt),fi<0&&(fi=-fi),Xa=Jt+fi;var pi=Ia*q+O*na+Va*oa,Dt=Ia*_a+O*w+Va*ta;pi<0&&(pi=-pi),Dt<0&&(Dt=-Dt),ea=pi+Dt,ha=Ia*n+O*c+Va*M;var di=Xa+ea,Sr=ha<0,Di=Sr?-ha:ha;if(Di<di){var Hn=di-Di;Hn<ia&&(ia=Hn,la=13,xa=Ia,Ma=O,za=Va,va=Sr?-1:1)}else return}if(Ia=L*d-p*C,O=p*R-X*d,Va=X*C-L*R,!(Ia==0&&O==0&&Va==0)){var oo=Ia*Ia+O*O+Va*Va;oo>0&&(oo=1/Math.sqrt(oo)),Ia*=oo,O*=oo,Va*=oo;var Bi=Ia*Q+O*U+Va*J,no=Ia*D+O*H+Va*K;Bi<0&&(Bi=-Bi),no<0&&(no=-no),Xa=Bi+no;var yn=Ia*q+O*na+Va*oa,Ao=Ia*aa+O*T+Va*ca;yn<0&&(yn=-yn),Ao<0&&(Ao=-Ao),ea=yn+Ao,ha=Ia*n+O*c+Va*M;var Io=Xa+ea,xr=ha<0,qi=xr?-ha:ha;if(qi<Io){var Ai=Io-qi;Ai<ia&&(ia=Ai,la=14,xa=Ia,Ma=O,za=Va,va=xr?-1:1)}else return}if(la>=6){xa*=va,Ma*=va,za*=va;var yi=(la-6)/3|0,So=la-6-yi*3,Dr,Si,gi,Rt,Hr,Lr,Cn,zs,Ke,ms,Te,qe;switch(yi){case 0:Cn=m,zs=y,Ke=V;var D_=D*xa+H*Ma+K*za>0,gn=ra*xa+sa*Ma+W*za>0;D_?gn?(Dr=D+ra,Si=H+sa,gi=K+W):(Dr=D-ra,Si=H-sa,gi=K-W):gn?(Dr=ra-D,Si=sa-H,gi=W-K):(Dr=D+ra,Si=H+sa,gi=K+W,Dr=-Dr,Si=-Si,gi=-gi);break;case 1:Cn=z,zs=I,Ke=k;var Pr=Q*xa+U*Ma+J*za>0,No=ra*xa+sa*Ma+W*za>0;Pr?No?(Dr=Q+ra,Si=U+sa,gi=J+W):(Dr=Q-ra,Si=U-sa,gi=J-W):No?(Dr=ra-Q,Si=sa-U,gi=W-J):(Dr=Q+ra,Si=U+sa,gi=J+W,Dr=-Dr,Si=-Si,gi=-gi);break;default:Cn=X,zs=L,Ke=p;var Wi=Q*xa+U*Ma+J*za>0,ke=D*xa+H*Ma+K*za>0;Wi?ke?(Dr=Q+D,Si=U+H,gi=J+K):(Dr=Q-D,Si=U-H,gi=J-K):ke?(Dr=D-Q,Si=H-U,gi=K-J):(Dr=Q+D,Si=U+H,gi=J+K,Dr=-Dr,Si=-Si,gi=-gi)}switch(Dr=v+Dr,Si=e+Si,gi=l+gi,So){case 0:ms=g,Te=N,qe=A;var on=aa*xa+T*Ma+ca*za>0,Tn=_a*xa+w*Ma+ta*za>0;on?Tn?(Rt=aa+_a,Hr=T+w,Lr=ca+ta):(Rt=aa-_a,Hr=T-w,Lr=ca-ta):Tn?(Rt=_a-aa,Hr=w-T,Lr=ta-ca):(Rt=aa+_a,Hr=T+w,Lr=ca+ta,Rt=-Rt,Hr=-Hr,Lr=-Lr);break;case 1:ms=F,Te=S,qe=Y;var jn=q*xa+na*Ma+oa*za>0,we=_a*xa+w*Ma+ta*za>0;jn?we?(Rt=q+_a,Hr=na+w,Lr=oa+ta):(Rt=q-_a,Hr=na-w,Lr=oa-ta):we?(Rt=_a-q,Hr=w-na,Lr=ta-oa):(Rt=q+_a,Hr=na+w,Lr=oa+ta,Rt=-Rt,Hr=-Hr,Lr=-Lr);break;default:ms=R,Te=C,qe=d;var k_=q*xa+na*Ma+oa*za>0,Re=aa*xa+T*Ma+ca*za>0;k_?Re?(Rt=q+aa,Hr=na+T,Lr=oa+ca):(Rt=q-aa,Hr=na-T,Lr=oa-ca):Re?(Rt=aa-q,Hr=T-na,Lr=ca-oa):(Rt=q+aa,Hr=na+T,Lr=oa+ca,Rt=-Rt,Hr=-Hr,Lr=-Lr)}Rt=u-Rt,Hr=b-Hr,Lr=f-Lr;var Vr,Ii,ui;Vr=Dr-Rt,Ii=Si-Hr,ui=gi-Lr;var eo=Cn*ms+zs*Te+Ke*qe,Rn=Cn*Vr+zs*Ii+Ke*ui,ps=ms*Vr+Te*Ii+qe*ui,nn=1/(1-eo*eo),Qn=(eo*ps-Rn)*nn,cr=(ps-eo*Rn)*nn,ho,Fi,En,as,Qe,Ee;ho=Dr+Cn*Qn,Fi=Si+zs*Qn,En=gi+Ke*Qn,as=Rt+ms*cr,Qe=Hr+Te*cr,Ee=Lr+qe*cr;var De,he,rr;De=-xa,he=-Ma,rr=-za,this.setNormal(a,De,he,rr),this.addPoint(a,ho,Fi,En,as,Qe,Ee,ia,4);return}var ri,Qr,Fr,fo;if(la>=3){va=-va,n=-n,c=-c,M=-M;var Po=s;s=h,h=Po;var s_=Z;Z=E,E=s_;var Fe=$;$=G,G=Fe;var ts=j;j=B,B=ts,ri=v,Qr=e,Fr=l,v=u,e=b,l=f,u=ri,b=Qr,f=Fr,ri=m,Qr=y,Fr=V,m=g,y=N,V=A,g=ri,N=Qr,A=Fr,ri=z,Qr=I,Fr=k,z=F,I=S,k=Y,F=ri,S=Qr,Y=Fr,ri=X,Qr=L,Fr=p,X=R,L=C,p=d,R=ri,C=Qr,d=Fr,ri=Q,Qr=U,Fr=J,Q=q,U=na,J=oa,q=ri,na=Qr,oa=Fr,ri=D,Qr=H,Fr=K,D=aa,H=T,K=ca,aa=ri,T=Qr,ca=Fr,ri=ra,Qr=sa,Fr=W,ra=_a,sa=w,W=ta,_a=ri,w=Qr,ta=Fr,la-=3,fo=!0}else fo=!1;var Dn,co,Ft,Nr,li,Vo,ce,Xe,Le,uo,$t,Vi,si,Go;switch(la){case 0:Dn=Q,co=U,Ft=J,Nr=m,li=y,Vo=V,ce=z,Xe=I,Le=k,uo=X,$t=L,Vi=p,si=$,Go=j;break;case 1:Dn=D,co=H,Ft=K,Nr=z,li=I,Vo=k,ce=X,Xe=L,Le=p,uo=m,$t=y,Vi=V,si=j,Go=Z;break;default:Dn=ra,co=sa,Ft=W,Nr=X,li=L,Vo=p,ce=m,Xe=y,Le=V,uo=z,$t=I,Vi=k,si=Z,Go=$}if(va<0){Dn=-Dn,co=-co,Ft=-Ft,Nr=-Nr,li=-li,Vo=-Vo,ri=ce,Qr=Xe,Fr=Le,ce=uo,Xe=$t,Le=Vi,uo=ri,$t=Qr,Vi=Fr;var Ns=si;si=Go,Go=Ns}Dn+=v,co+=e,Ft+=l;var Co=1,ko=0,Ni=Nr*g+li*N+Vo*A;Ni<Co&&(Co=Ni,ko=0),-Ni<Co&&(Co=-Ni,ko=1),Ni=Nr*F+li*S+Vo*Y,Ni<Co&&(Co=Ni,ko=2),-Ni<Co&&(Co=-Ni,ko=3),Ni=Nr*R+li*C+Vo*d,Ni<Co&&(Co=Ni,ko=4),-Ni<Co&&(Co=-Ni,ko=5);var Pi,Ci,Li,Qt,Gr,Yr,Rr,Mi,qr,Gi,Ji,ao;switch(ko){case 0:Pi=q+aa,Ci=na+T,Li=oa+ca,Pi+=_a,Ci+=w,Li+=ta,Qt=q-aa,Gr=na-T,Yr=oa-ca,Qt+=_a,Gr+=w,Yr+=ta,Rr=q-aa,Mi=na-T,qr=oa-ca,Rr-=_a,Mi-=w,qr-=ta,Gi=q+aa,Ji=na+T,ao=oa+ca,Gi-=_a,Ji-=w,ao-=ta;break;case 1:Pi=aa-q,Ci=T-na,Li=ca-oa,Pi+=_a,Ci+=w,Li+=ta,Qt=aa-q,Gr=T-na,Yr=ca-oa,Qt-=_a,Gr-=w,Yr-=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr-=_a,Mi-=w,qr-=ta,Gi=q+aa,Ji=na+T,ao=oa+ca,Gi=-Gi,Ji=-Ji,ao=-ao,Gi+=_a,Ji+=w,ao+=ta;break;case 2:Pi=q+aa,Ci=na+T,Li=oa+ca,Pi+=_a,Ci+=w,Li+=ta,Qt=q+aa,Gr=na+T,Yr=oa+ca,Qt-=_a,Gr-=w,Yr-=ta,Rr=aa-q,Mi=T-na,qr=ca-oa,Rr-=_a,Mi-=w,qr-=ta,Gi=aa-q,Ji=T-na,ao=ca-oa,Gi+=_a,Ji+=w,ao+=ta;break;case 3:Pi=q-aa,Ci=na-T,Li=oa-ca,Pi+=_a,Ci+=w,Li+=ta,Qt=q+aa,Gr=na+T,Yr=oa+ca,Qt=-Qt,Gr=-Gr,Yr=-Yr,Qt+=_a,Gr+=w,Yr+=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr-=_a,Mi-=w,qr-=ta,Gi=q-aa,Ji=na-T,ao=oa-ca,Gi-=_a,Ji-=w,ao-=ta;break;case 4:Pi=q+aa,Ci=na+T,Li=oa+ca,Pi+=_a,Ci+=w,Li+=ta,Qt=aa-q,Gr=T-na,Yr=ca-oa,Qt+=_a,Gr+=w,Yr+=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr+=_a,Mi+=w,qr+=ta,Gi=q-aa,Ji=na-T,ao=oa-ca,Gi+=_a,Ji+=w,ao+=ta;break;default:Pi=q+aa,Ci=na+T,Li=oa+ca,Pi-=_a,Ci-=w,Li-=ta,Qt=q-aa,Gr=na-T,Yr=oa-ca,Qt-=_a,Gr-=w,Yr-=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr-=_a,Mi-=w,qr-=ta,Gi=aa-q,Ji=T-na,ao=ca-oa,Gi-=_a,Ji-=w,ao-=ta}Pi+=n,Ci+=c,Li+=M,Qt+=n,Gr+=c,Yr+=M,Rr+=n,Mi+=c,qr+=M,Gi+=n,Ji+=c,ao+=M;var be=this.clipper;be.w=si,be.h=Go,be.numVertices=0,be.numTmpVertices=0;var kr=this.clipper,en=kr.vertices[kr.numVertices++];en.x=Pi*ce+Ci*Xe+Li*Le,en.y=Pi*uo+Ci*$t+Li*Vi,en.wx=Pi,en.wy=Ci,en.wz=Li;var Yi=this.clipper,Jo=Yi.vertices[Yi.numVertices++];Jo.x=Qt*ce+Gr*Xe+Yr*Le,Jo.y=Qt*uo+Gr*$t+Yr*Vi,Jo.wx=Qt,Jo.wy=Gr,Jo.wz=Yr;var ys=this.clipper,In=ys.vertices[ys.numVertices++];In.x=Rr*ce+Mi*Xe+qr*Le,In.y=Rr*uo+Mi*$t+qr*Vi,In.wx=Rr,In.wy=Mi,In.wz=qr;var gs=this.clipper,Vn=gs.vertices[gs.numVertices++];Vn.x=Gi*ce+Ji*Xe+ao*Le,Vn.y=Gi*uo+Ji*$t+ao*Vi,Vn.wx=Gi,Vn.wy=Ji,Vn.wz=ao,this.clipper.clip(),this.clipper.reduce();var Cr,To,so;fo?(Cr=Nr,To=li,so=Vo):(Cr=-Nr,To=-li,so=-Vo),this.setNormal(a,Cr,To,so);for(var Fn=0,Ne=this.clipper.numVertices;Fn<Ne;){var Nn=Fn++,Wo=this.clipper.vertices[Nn],kn,Ye,Ot;kn=Wo.wx,Ye=Wo.wy,Ot=Wo.wz,kn+=v,Ye+=e,Ot+=l;var Ro,Ui,wn;Ro=Dn-kn,Ui=co-Ye,wn=Ft-Ot;var Gn=Ro*Nr+Ui*li+wn*Vo,fe,Is,Uo;fe=kn+Nr*Gn,Is=Ye+li*Gn,Uo=Ot+Vo*Gn,Gn>-x.common.Setting.contactPersistenceThreshold&&(fo?this.addPoint(a,kn,Ye,Ot,fe,Is,Uo,Gn,Nn):this.addPoint(a,fe,Is,Uo,kn,Ye,Ot,Gn,Nn))}}};x.collision.narrowphase.detector._BoxBoxDetector||(x.collision.narrowphase.detector._BoxBoxDetector={});x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};x.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var a=new Array(8);this.vertices=a;var t=new Array(8);this.tmpVertices=t,this.vertices[0]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){for(var a=0,t=this.numVertices;a<t;){var r=a++,i=this.vertices[r],o=this.vertices[(r+1)%this.numVertices],_=this.w+i.x,s=this.w+o.x;if(_>0&&s>0){var h=this.tmpVertices[this.numTmpVertices++];h.x=i.x,h.y=i.y,h.wx=i.wx,h.wy=i.wy,h.wz=i.wz}else if(_>0&&s<=0){var v=this.tmpVertices[this.numTmpVertices++];v.x=i.x,v.y=i.y,v.wx=i.wx,v.wy=i.wy,v.wz=i.wz;var e=_/(_-s),l=this.tmpVertices[this.numTmpVertices++];l.x=i.x+(o.x-i.x)*e,l.y=i.y+(o.y-i.y)*e,l.wx=i.wx+(o.wx-i.wx)*e,l.wy=i.wy+(o.wy-i.wy)*e,l.wz=i.wz+(o.wz-i.wz)*e}else if(_<=0&&s>0){var u=_/(_-s),b=this.tmpVertices[this.numTmpVertices++];b.x=i.x+(o.x-i.x)*u,b.y=i.y+(o.y-i.y)*u,b.wx=i.wx+(o.wx-i.wx)*u,b.wy=i.wy+(o.wy-i.wy)*u,b.wz=i.wz+(o.wz-i.wz)*u}}var f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var n=0,c=this.numVertices;n<c;){var M=n++,m=this.vertices[M],y=this.vertices[(M+1)%this.numVertices],V=this.w-m.x,z=this.w-y.x;if(V>0&&z>0){var I=this.tmpVertices[this.numTmpVertices++];I.x=m.x,I.y=m.y,I.wx=m.wx,I.wy=m.wy,I.wz=m.wz}else if(V>0&&z<=0){var k=this.tmpVertices[this.numTmpVertices++];k.x=m.x,k.y=m.y,k.wx=m.wx,k.wy=m.wy,k.wz=m.wz;var X=V/(V-z),L=this.tmpVertices[this.numTmpVertices++];L.x=m.x+(y.x-m.x)*X,L.y=m.y+(y.y-m.y)*X,L.wx=m.wx+(y.wx-m.wx)*X,L.wy=m.wy+(y.wy-m.wy)*X,L.wz=m.wz+(y.wz-m.wz)*X}else if(V<=0&&z>0){var p=V/(V-z),g=this.tmpVertices[this.numTmpVertices++];g.x=m.x+(y.x-m.x)*p,g.y=m.y+(y.y-m.y)*p,g.wx=m.wx+(y.wx-m.wx)*p,g.wy=m.wy+(y.wy-m.wy)*p,g.wz=m.wz+(y.wz-m.wz)*p}}var N=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=N,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var A=0,F=this.numVertices;A<F;){var S=A++,Y=this.vertices[S],R=this.vertices[(S+1)%this.numVertices],C=this.h+Y.y,d=this.h+R.y;if(C>0&&d>0){var Z=this.tmpVertices[this.numTmpVertices++];Z.x=Y.x,Z.y=Y.y,Z.wx=Y.wx,Z.wy=Y.wy,Z.wz=Y.wz}else if(C>0&&d<=0){var $=this.tmpVertices[this.numTmpVertices++];$.x=Y.x,$.y=Y.y,$.wx=Y.wx,$.wy=Y.wy,$.wz=Y.wz;var j=C/(C-d),E=this.tmpVertices[this.numTmpVertices++];E.x=Y.x+(R.x-Y.x)*j,E.y=Y.y+(R.y-Y.y)*j,E.wx=Y.wx+(R.wx-Y.wx)*j,E.wy=Y.wy+(R.wy-Y.wy)*j,E.wz=Y.wz+(R.wz-Y.wz)*j}else if(C<=0&&d>0){var G=C/(C-d),B=this.tmpVertices[this.numTmpVertices++];B.x=Y.x+(R.x-Y.x)*G,B.y=Y.y+(R.y-Y.y)*G,B.wx=Y.wx+(R.wx-Y.wx)*G,B.wy=Y.wy+(R.wy-Y.wy)*G,B.wz=Y.wz+(R.wz-Y.wz)*G}}var Q=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=Q,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var U=0,J=this.numVertices;U<J;){var D=U++,H=this.vertices[D],K=this.vertices[(D+1)%this.numVertices],ra=this.h-H.y,sa=this.h-K.y;if(ra>0&&sa>0){var W=this.tmpVertices[this.numTmpVertices++];W.x=H.x,W.y=H.y,W.wx=H.wx,W.wy=H.wy,W.wz=H.wz}else if(ra>0&&sa<=0){var q=this.tmpVertices[this.numTmpVertices++];q.x=H.x,q.y=H.y,q.wx=H.wx,q.wy=H.wy,q.wz=H.wz;var na=ra/(ra-sa),oa=this.tmpVertices[this.numTmpVertices++];oa.x=H.x+(K.x-H.x)*na,oa.y=H.y+(K.y-H.y)*na,oa.wx=H.wx+(K.wx-H.wx)*na,oa.wy=H.wy+(K.wy-H.wy)*na,oa.wz=H.wz+(K.wz-H.wz)*na}else if(ra<=0&&sa>0){var aa=ra/(ra-sa),T=this.tmpVertices[this.numTmpVertices++];T.x=H.x+(K.x-H.x)*aa,T.y=H.y+(K.y-H.y)*aa,T.wx=H.wx+(K.wx-H.wx)*aa,T.wy=H.wy+(K.wy-H.wy)*aa,T.wz=H.wz+(K.wz-H.wz)*aa}}var ca=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=ca,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(!(this.numVertices<4)){for(var a=-1/0,t=1/0,r=-1/0,i=1/0,o=null,_=null,s=null,h=null,v=1,e=1,l=-1,u=1,b=0,f=this.numVertices;b<f;){var n=b++,c=this.vertices[n],M=c.x*v+c.y*e,m=c.x*l+c.y*u;M>a&&(a=M,o=c),M<t&&(t=M,_=c),m>r&&(r=m,s=c),m<i&&(i=m,h=c)}var y=this.tmpVertices[this.numTmpVertices++];y.x=o.x,y.y=o.y,y.wx=o.wx,y.wy=o.wy,y.wz=o.wz;var V=this.tmpVertices[this.numTmpVertices++];V.x=s.x,V.y=s.y,V.wx=s.wx,V.wy=s.wy,V.wz=s.wz;var z=this.tmpVertices[this.numTmpVertices++];z.x=_.x,z.y=_.y,z.wx=_.wx,z.wy=_.wy,z.wz=_.wz;var I=this.tmpVertices[this.numTmpVertices++];I.x=h.x,I.y=h.y,I.wx=h.wx,I.wy=h.wy,I.wz=h.wz;var k=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=k,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};x.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};x.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};x.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,r,i,o,_){var s=t,h=r;a.incremental=!1;var v,e,l,u,b,f;v=i._rotation01,e=i._rotation11,l=i._rotation21,u=o._rotation01,b=o._rotation11,f=o._rotation21;var n=s._halfHeight,c=h._halfHeight,M=s._radius,m=h._radius,y,V,z,I,k,X,L,p,g,N,A,F;y=i._positionX+v*-n,V=i._positionY+e*-n,z=i._positionZ+l*-n,I=i._positionX+v*n,k=i._positionY+e*n,X=i._positionZ+l*n,L=o._positionX+u*-c,p=o._positionY+b*-c,g=o._positionZ+f*-c,N=o._positionX+u*c,A=o._positionY+b*c,F=o._positionZ+f*c;var S,Y,R;S=y-L,Y=V-p,R=z-g;var C,d,Z,$,j,E;C=I-y,d=k-V,Z=X-z,$=N-L,j=A-p,E=F-g;var G=-(S*C+Y*d+R*Z),B=S*$+Y*j+R*E,Q=n*n*4,U=C*$+d*j+Z*E,J=c*c*4,D,H;if(Q==0&&J==0)D=0,H=0;else if(Q==0)D=0,H=B,H<0?H=0:H>J?H=1:H/=J;else if(J==0)H=0,D=G,D<0?D=0:D>Q?D=1:D/=Q;else{var K=Q*J-U*U;K==0?D=0:(D=U*B+J*G,D<0?D=0:D>K?D=1:D/=K),H=D*U+B,H<0?(H=0,D=G,D<0?D=0:D>Q?D=1:D/=Q):H>J?(H=1,D=U+G,D<0?D=0:D>Q?D=1:D/=Q):H/=J}var ra,sa,W,q,na,oa;ra=y+C*D,sa=V+d*D,W=z+Z*D,q=L+$*H,na=p+j*H,oa=g+E*H;var aa,T,ca;aa=ra-q,T=sa-na,ca=W-oa;var _a=aa*aa+T*T+ca*ca;if(!(_a>=(M+m)*(M+m))){var w=Math.sqrt(_a),ta,ia,la;w>0?(ta=aa*(1/w),ia=T*(1/w),la=ca*(1/w)):(ta=1,ia=0,la=0),this.setNormal(a,ta,ia,la);var va,xa,Ma,za,Xa,Za;va=ra+ta*-M,xa=sa+ia*-M,Ma=W+la*-M,za=q+ta*m,Xa=na+ia*m,Za=oa+la*m,this.addPoint(a,va,xa,Ma,za,Xa,Za,M+m-w,0)}}};x.collision.narrowphase.detector.GjkEpaDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,r,i,o,_){var s=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance,h=t,v=r,e=s.computeClosestPointsImpl(h,v,i,o,x.common.Setting.enableGJKCaching?_:null,!0);if(a.incremental=!0,e!=x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+e);return}var l=h._gjkMargin,u=v._gjkMargin;if(!(s.distance>l+u)){var b,f,n,c,M,m,y=s.closestPoint1;b=y.x,f=y.y,n=y.z;var V=s.closestPoint2;c=V.x,M=V.y,m=V.z;var z,I,k;if(z=b-c,I=f-M,k=n-m,z*z+I*I+k*k!=0){s.distance<0&&(z=-z,I=-I,k=-k);var X=z*z+I*I+k*k;X>0&&(X=1/Math.sqrt(X)),z*=X,I*=X,k*=X,this.setNormal(a,z,I,k),b+=z*-h._gjkMargin,f+=I*-h._gjkMargin,n+=k*-h._gjkMargin,c+=z*v._gjkMargin,M+=I*v._gjkMargin,m+=k*v._gjkMargin,this.addPoint(a,b,f,n,c,M,m,h._gjkMargin+v._gjkMargin-s.distance,0)}}}};x.collision.narrowphase.detector.SphereBoxDetector=class extends x.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,r,i,o,_){var s=t,h=r;a.incremental=!1;var v,e,l,u,b,f;v=h._halfExtentsX,e=h._halfExtentsY,l=h._halfExtentsZ,u=-v,b=-e,f=-l;var n=s._radius,c,M,m;c=i._positionX-o._positionX,M=i._positionY-o._positionY,m=i._positionZ-o._positionZ;var y,V,z,I,k,X;I=o._rotation00*c+o._rotation10*M+o._rotation20*m,k=o._rotation01*c+o._rotation11*M+o._rotation21*m,X=o._rotation02*c+o._rotation12*M+o._rotation22*m,y=I,V=k,z=X;var L=u<y&&v>y&&b<V&&e>V&&f<z&&l>z;if(L){var p,g,N;p=y<0?-y:y,g=V<0?-V:V,N=z<0?-z:z,p=v-p,g=e-g,N=l-N;var A,F,S,Y=p,R=g,C=N,d,Z,$,j;Y<R?Y<C?(y>0?(A=1,F=0,S=0):(A=-1,F=0,S=0),Z=0,$=1,j=1,d=Y):(z>0?(A=0,F=0,S=1):(A=0,F=0,S=-1),Z=1,$=1,j=0,d=C):R<C?(V>0?(A=0,F=1,S=0):(A=0,F=-1,S=0),Z=1,$=0,j=1,d=R):(z>0?(A=0,F=0,S=1):(A=0,F=0,S=-1),Z=1,$=1,j=0,d=C);var E,G,B;E=Z*y,G=$*V,B=j*z;var Q,U,J;Q=A*v,U=F*e,J=S*l,Q+=E,U+=G,J+=B;var D,H,K,ra,sa,W,q,na,oa;q=o._rotation00*Q+o._rotation01*U+o._rotation02*J,na=o._rotation10*Q+o._rotation11*U+o._rotation12*J,oa=o._rotation20*Q+o._rotation21*U+o._rotation22*J,D=q,H=na,K=oa;var aa,T,ca;aa=o._rotation00*A+o._rotation01*F+o._rotation02*S,T=o._rotation10*A+o._rotation11*F+o._rotation12*S,ca=o._rotation20*A+o._rotation21*F+o._rotation22*S,ra=aa,sa=T,W=ca,this.setNormal(a,ra,sa,W);var _a,w,ta,ia,la,va;_a=i._positionX+ra*-n,w=i._positionY+sa*-n,ta=i._positionZ+W*-n,ia=o._positionX+D,la=o._positionY+H,va=o._positionZ+K,this.addPoint(a,_a,w,ta,ia,la,va,d,0);return}var xa,Ma,za,Xa=1e-9,Za,fa,ba;Za=Xa,fa=Xa,ba=Xa,v-=Za,e-=fa,l-=ba,u+=Za,b+=fa,f+=ba,xa=y<v?y:v,Ma=V<e?V:e,za=z<l?z:l,xa=xa>u?xa:u,Ma=Ma>b?Ma:b,za=za>f?za:f;var ea,ha,pa;ea=y-xa,ha=V-Ma,pa=z-za;var ya=ea*ea+ha*ha+pa*pa;if(!(ya>=n*n)){ya=Math.sqrt(ya);var da,ma,Ya,Qa,ga,ua,wa,ka,Pa;wa=o._rotation00*xa+o._rotation01*Ma+o._rotation02*za,ka=o._rotation10*xa+o._rotation11*Ma+o._rotation12*za,Pa=o._rotation20*xa+o._rotation21*Ma+o._rotation22*za,da=wa,ma=ka,Ya=Pa;var Mt,Ha,Ba;Mt=o._rotation00*ea+o._rotation01*ha+o._rotation02*pa,Ha=o._rotation10*ea+o._rotation11*ha+o._rotation12*pa,Ba=o._rotation20*ea+o._rotation21*ha+o._rotation22*pa,Qa=Mt,ga=Ha,ua=Ba;var nt,Ea,Fa,Aa=Qa*Qa+ga*ga+ua*ua;Aa>0&&(Aa=1/Math.sqrt(Aa)),nt=Qa*Aa,Ea=ga*Aa,Fa=ua*Aa,this.setNormal(a,nt,Ea,Fa);var ft,Ua,ja,bt,rt,$a;ft=i._positionX+nt*-n,Ua=i._positionY+Ea*-n,ja=i._positionZ+Fa*-n,bt=o._positionX+da,rt=o._positionY+ma,$a=o._positionZ+Ya,this.addPoint(a,ft,Ua,ja,bt,rt,$a,n-ya,0)}}};x.collision.narrowphase.detector.SphereCapsuleDetector=class extends x.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,r,i,o,_){var s=t,h=r;a.incremental=!1;var v=h._halfHeight,e=s._radius,l=h._radius,u,b,f;u=o._rotation01,b=o._rotation11,f=o._rotation21;var n,c,M;n=i._positionX,c=i._positionY,M=i._positionZ;var m,y,V,z,I,k;m=o._positionX+u*-v,y=o._positionY+b*-v,V=o._positionZ+f*-v,z=o._positionX+u*v,I=o._positionY+b*v,k=o._positionZ+f*v;var X,L,p;X=n-m,L=c-y,p=M-V;var g,N,A;g=z-m,N=I-y,A=k-V;var F=v*v*4,S=X*g+L*N+p*A;S<0?S=0:S>F?S=1:S/=F;var Y,R,C;Y=m+g*S,R=y+N*S,C=V+A*S;var d,Z,$;d=n-Y,Z=c-R,$=M-C;var j=d*d+Z*Z+$*$;if(!(j>=(e+l)*(e+l))){var E=Math.sqrt(j),G,B,Q;E>0?(G=d*(1/E),B=Z*(1/E),Q=$*(1/E)):(G=1,B=0,Q=0),this.setNormal(a,G,B,Q);var U,J,D,H,K,ra;U=n+G*-e,J=c+B*-e,D=M+Q*-e,H=Y+G*l,K=R+B*l,ra=C+Q*l,this.addPoint(a,U,J,D,H,K,ra,e+l-E,0)}}};x.collision.narrowphase.detector.SphereSphereDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,r,i,o,_){var s=t,h=r;a.incremental=!1;var v,e,l;v=i._positionX-o._positionX,e=i._positionY-o._positionY,l=i._positionZ-o._positionZ;var u=s._radius,b=h._radius,f=v*v+e*e+l*l;if(!(f>=(u+b)*(u+b))){var n=Math.sqrt(f),c,M,m;n>0?(c=v*(1/n),M=e*(1/n),m=l*(1/n)):(c=1,M=0,m=0),this.setNormal(a,c,M,m);var y,V,z,I,k,X;y=i._positionX+c*-u,V=i._positionY+M*-u,z=i._positionZ+m*-u,I=o._positionX+c*b,k=o._positionY+M*b,X=o._positionZ+m*b,this.addPoint(a,y,V,z,I,k,X,u+b-n,0)}}};x.collision.narrowphase.detector.gjkepa||(x.collision.narrowphase.detector.gjkepa={});x.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){var a=new Array(x.common.Setting.maxEPAVertices);this._vertices=a,this._center=new x.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(a){}validate(){for(var a=this._triangleList;a!=null;){var t=a._next;if(a._vertices[0]._tmpEdgeLoopOuterTriangle=null,a._vertices[0]._tmpEdgeLoopNext=null,a._adjacentPairIndex[0]==-1)return this._status=2,!1;if(a._adjacentTriangles[0]==null)return this._status=3,!1;if(a._vertices[1]._tmpEdgeLoopOuterTriangle=null,a._vertices[1]._tmpEdgeLoopNext=null,a._adjacentPairIndex[1]==-1)return this._status=2,!1;if(a._adjacentTriangles[1]==null)return this._status=3,!1;if(a._vertices[2]._tmpEdgeLoopOuterTriangle=null,a._vertices[2]._tmpEdgeLoopNext=null,a._adjacentPairIndex[2]==-1)return this._status=2,!1;if(a._adjacentTriangles[2]==null)return this._status=3,!1;a=t}return!0}findEdgeLoop(a,t,r){if(t._tmpDfsId!=a){t._tmpDfsId=a;var i=t.tmp;i.x=r.x,i.y=r.y,i.z=r.z;var o=i,_=t._vertices[0].v,s=o.x-_.x,h=o.y-_.y,v=o.z-_.z;o.x=s,o.y=h,o.z=v;var e=t.tmp,l=t._normal;if(t._tmpDfsVisible=e.x*l.x+e.y*l.y+e.z*l.z>0,!t._tmpDfsVisible){this._status=6;return}for(var u=0;u<3;){var b=u++,f=t._adjacentTriangles[b];if(f!=null){var n=f.tmp;n.x=r.x,n.y=r.y,n.z=r.z;var c=n,M=f._vertices[0].v,m=c.x-M.x,y=c.y-M.y,V=c.z-M.z;c.x=m,c.y=y,c.z=V;var z=f.tmp,I=f._normal;if(f._tmpDfsVisible=z.x*I.x+z.y*I.y+z.z*I.z>0,f._tmpDfsVisible)this.findEdgeLoop(a,f,r);else{var k=t._nextIndex[b],X=t._vertices[b],L=t._vertices[k];X._tmpEdgeLoopNext=L,X._tmpEdgeLoopOuterTriangle=f}}}var p=t._adjacentTriangles[0];if(p!=null){var g=t._adjacentPairIndex[0];p._adjacentTriangles[g]=null,p._adjacentPairIndex[g]=-1,t._adjacentTriangles[0]=null,t._adjacentPairIndex[0]=-1}var N=t._adjacentTriangles[1];if(N!=null){var A=t._adjacentPairIndex[1];N._adjacentTriangles[A]=null,N._adjacentPairIndex[A]=-1,t._adjacentTriangles[1]=null,t._adjacentPairIndex[1]=-1}var F=t._adjacentTriangles[2];if(F!=null){var S=t._adjacentPairIndex[2];F._adjacentTriangles[S]=null,F._adjacentPairIndex[S]=-1,t._adjacentTriangles[2]=null,t._adjacentPairIndex[2]=-1}this._numTriangles--;var Y=t._prev,R=t._next;Y!=null&&(Y._next=R),R!=null&&(R._prev=Y),t==this._triangleList&&(this._triangleList=this._triangleList._next),t==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=this._trianglePool,this._trianglePool=t}}_init(a,t,r,i){this._status=0,this._numVertices=4,this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=r,this._vertices[3]=i;var o=this._center,_=a.v;o.x=_.x,o.y=_.y,o.z=_.z;var s=o,h=t.v,v=s.x+h.x,e=s.y+h.y,l=s.z+h.z;s.x=v,s.y=e,s.z=l;var u=s,b=r.v,f=u.x+b.x,n=u.y+b.y,c=u.z+b.z;u.x=f,u.y=n,u.z=c;var M=u,m=i.v,y=M.x+m.x,V=M.y+m.y,z=M.z+m.z;M.x=y,M.y=V,M.z=z;var I=M,k=I.x*.25,X=I.y*.25,L=I.z*.25;I.x=k,I.y=X,I.z=L;var p=this._trianglePool;p!=null?(this._trianglePool=p._next,p._next=null):p=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var g=p,N=this._trianglePool;N!=null?(this._trianglePool=N._next,N._next=null):N=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var A=N,F=this._trianglePool;F!=null?(this._trianglePool=F._next,F._next=null):F=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var S=F,Y=this._trianglePool;Y!=null?(this._trianglePool=Y._next,Y._next=null):Y=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var R=Y,C=!0;g.init(a,t,r,this._center,C)||(this._status=1);var d=!0;A.init(a,t,i,this._center,d)||(this._status=1);var Z=!0;S.init(a,r,i,this._center,Z)||(this._status=1);var $=!0;return R.init(t,r,i,this._center,$)||(this._status=1),g.setAdjacentTriangle(A)||(this._status=1),g.setAdjacentTriangle(S)||(this._status=1),g.setAdjacentTriangle(R)||(this._status=1),A.setAdjacentTriangle(S)||(this._status=1),A.setAdjacentTriangle(R)||(this._status=1),S.setAdjacentTriangle(R)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=g,this._triangleListLast=g):(this._triangleListLast._next=g,g._prev=this._triangleListLast,this._triangleListLast=g),this._numTriangles++,this._triangleList==null?(this._triangleList=A,this._triangleListLast=A):(this._triangleListLast._next=A,A._prev=this._triangleListLast,this._triangleListLast=A),this._numTriangles++,this._triangleList==null?(this._triangleList=S,this._triangleListLast=S):(this._triangleListLast._next=S,S._prev=this._triangleListLast,this._triangleListLast=S),this._numTriangles++,this._triangleList==null?(this._triangleList=R,this._triangleListLast=R):(this._triangleListLast._next=R,R._prev=this._triangleListLast,this._triangleListLast=R),this._status==0}_addVertex(a,t){this._vertices[this._numVertices++]=a;var r=t._vertices[0];if(this.findEdgeLoop(this._numVertices,t,a.v),this._status!=0)return!1;for(var i=r,o=r,_=null,s=null;;){if(i._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(i._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;var h=this._trianglePool;h!=null?(this._trianglePool=h._next,h._next=null):h=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var v=h;if(s==null&&(s=v),v.init(i,i._tmpEdgeLoopNext,a,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=v,this._triangleListLast=v):(this._triangleListLast._next=v,v._prev=this._triangleListLast,this._triangleListLast=v),v.setAdjacentTriangle(i._tmpEdgeLoopOuterTriangle)||(this._status=1),_!=null&&(v.setAdjacentTriangle(_)||(this._status=1)),_=v,i=i._tmpEdgeLoopNext,i==o)break}return _.setAdjacentTriangle(s)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};x.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++x.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new x.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var a=new Array(3);this._vertices=a;var t=new Array(3);this._adjacentTriangles=t;var r=new Array(3);this._adjacentPairIndex=r,this.tmp=new x.common.Vec3;var i=new Array(3);this._nextIndex=i,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(a,t,r,i,o){o==null&&(o=!1);var _,s,h,v,e,l,u,b,f,n,c,M,m=a.v;_=m.x,s=m.y,h=m.z;var y=t.v;v=y.x,e=y.y,l=y.z;var V=r.v;u=V.x,b=V.y,f=V.z;var z=i;n=z.x,c=z.y,M=z.z;var I,k,X,L,p,g,N,A,F;I=v-_,k=e-s,X=l-h,L=u-_,p=b-s,g=f-h,N=_-n,A=s-c,F=h-M;var S,Y,R;S=k*g-X*p,Y=X*L-I*g,R=I*p-k*L;var C=!1,d=N*S+A*Y+F*R;if(d<0)if(o){var Z=t;t=r,r=Z,S*=-1,Y*=-1,R*=-1}else C=!0;this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=r;var $=this._normal;$.x=S,$.y=Y,$.z=R;var j=a.v,E=t.v,G=r.v,B=this.tmp,Q,U,J,D,H,K,ra,sa,W,q,na,oa,aa,T,ca,_a,w,ta,ia=j;Q=ia.x,U=ia.y,J=ia.z;var la=E;D=la.x,H=la.y,K=la.z;var va=G;ra=va.x,sa=va.y,W=va.z,q=D-Q,na=H-U,oa=K-J,aa=ra-D,T=sa-H,ca=W-K,_a=Q-ra,w=U-sa,ta=J-W;var xa,Ma,za;xa=na*ca-oa*T,Ma=oa*aa-q*ca,za=q*T-na*aa;var Xa,Za,fa,ba,ea,ha,pa,ya,da;Xa=na*za-oa*Ma,Za=oa*xa-q*za,fa=q*Ma-na*xa,ba=T*za-ca*Ma,ea=ca*xa-aa*za,ha=aa*Ma-T*xa,pa=w*za-ta*Ma,ya=ta*xa-_a*za,da=_a*Ma-w*xa;var ma=Q*Xa+U*Za+J*fa,Ya=D*ba+H*ea+K*ha,Qa=ra*pa+sa*ya+W*da,ga=-1,ua,wa,ka;if(ua=0,wa=0,ka=0,ma<0){var Pa,Mt,Ha,Ba,nt,Ea,Fa=j;Pa=Fa.x,Mt=Fa.y,Ha=Fa.z;var Aa=E;Ba=Aa.x,nt=Aa.y,Ea=Aa.z;var ft,Ua,ja;ft=Ba-Pa,Ua=nt-Mt,ja=Ea-Ha;var bt=ft*ft+Ua*Ua+ja*ja,rt=ft*Pa+Ua*Mt+ja*Ha;if(rt=-rt/bt,rt<0){var $a=B;$a.x=Pa,$a.y=Mt,$a.z=Ha}else if(rt>1){var _t=B;_t.x=Ba,_t.y=nt,_t.z=Ea}else{var gt,mt,Wa;gt=Pa+ft*rt,mt=Mt+Ua*rt,Wa=Ha+ja*rt;var it=B;it.x=gt,it.y=mt,it.z=Wa}var ut=B.x*B.x+B.y*B.y+B.z*B.z;ga=ut;var Da=B;ua=Da.x,wa=Da.y,ka=Da.z}if(Ya<0){var Ta,Na,Vt,Pt,et,Xt,Yt=E;Ta=Yt.x,Na=Yt.y,Vt=Yt.z;var zt=G;Pt=zt.x,et=zt.y,Xt=zt.z;var Ia,O,Va;Ia=Pt-Ta,O=et-Na,Va=Xt-Vt;var lt=Ia*Ia+O*O+Va*Va,P=Ia*Ta+O*Na+Va*Vt;if(P=-P/lt,P<0){var wt=B;wt.x=Ta,wt.y=Na,wt.z=Vt}else if(P>1){var Bt=B;Bt.x=Pt,Bt.y=et,Bt.z=Xt}else{var At,yt,kt;At=Ta+Ia*P,yt=Na+O*P,kt=Vt+Va*P;var pt=B;pt.x=At,pt.y=yt,pt.z=kt}var ht=B.x*B.x+B.y*B.y+B.z*B.z;if(ga<0||ht<ga){ga=ht;var xt=B;ua=xt.x,wa=xt.y,ka=xt.z}}if(Qa<0){var Ra,st,Ca,vt,qa,at,Oa=j;Ra=Oa.x,st=Oa.y,Ca=Oa.z;var tt=G;vt=tt.x,qa=tt.y,at=tt.z;var ct,Sa,Ga;ct=vt-Ra,Sa=qa-st,Ga=at-Ca;var Ka=ct*ct+Sa*Sa+Ga*Ga,La=ct*Ra+Sa*st+Ga*Ca;if(La=-La/Ka,La<0){var ot=B;ot.x=Ra,ot.y=st,ot.z=Ca}else if(La>1){var It=B;It.x=vt,It.y=qa,It.z=at}else{var or,gr,ar;or=Ra+ct*La,gr=st+Sa*La,ar=Ca+Ga*La;var Ct=B;Ct.x=or,Ct.y=gr,Ct.z=ar}var _r=B.x*B.x+B.y*B.y+B.z*B.z;if(ga<0||_r<ga){ga=_r;var Et=B;ua=Et.x,wa=Et.y,ka=Et.z}}if(ga>0){var St=B;St.x=ua,St.y=wa,St.z=ka}else{var Gt=xa*xa+Ma*Ma+za*za;Gt>0&&(Gt=1/Math.sqrt(Gt)),xa*=Gt,Ma*=Gt,za*=Gt;var jr=Q*xa+U*Ma+J*za,vr=xa*xa+Ma*Ma+za*za;vr=jr/vr,ua=xa*vr,wa=Ma*vr,ka=za*vr;var lr=B;lr.x=ua,lr.y=wa,lr.z=ka}var tr=this.tmp;return this._distanceSq=tr.x*tr.x+tr.y*tr.y+tr.z*tr.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!C}setAdjacentTriangle(a){var t=0,r=this._nextIndex[0],i=this._nextIndex[0];this._vertices[0]==a._vertices[i]&&this._vertices[r]==a._vertices[0]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=0,++t);var o=this._nextIndex[0],_=this._nextIndex[1];this._vertices[0]==a._vertices[_]&&this._vertices[o]==a._vertices[1]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=0,++t);var s=this._nextIndex[0],h=this._nextIndex[2];this._vertices[0]==a._vertices[h]&&this._vertices[s]==a._vertices[2]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=0,++t);var v=this._nextIndex[1],e=this._nextIndex[0];this._vertices[1]==a._vertices[e]&&this._vertices[v]==a._vertices[0]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=1,++t);var l=this._nextIndex[1],u=this._nextIndex[1];this._vertices[1]==a._vertices[u]&&this._vertices[l]==a._vertices[1]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=1,++t);var b=this._nextIndex[1],f=this._nextIndex[2];this._vertices[1]==a._vertices[f]&&this._vertices[b]==a._vertices[2]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=1,++t);var n=this._nextIndex[2],c=this._nextIndex[0];this._vertices[2]==a._vertices[c]&&this._vertices[n]==a._vertices[0]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=2,++t);var M=this._nextIndex[2],m=this._nextIndex[1];this._vertices[2]==a._vertices[m]&&this._vertices[M]==a._vertices[1]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=2,++t);var y=this._nextIndex[2],V=this._nextIndex[2];return this._vertices[2]==a._vertices[V]&&this._vertices[y]==a._vertices[2]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=2,++t),t==1}removeAdjacentTriangles(){var a=this._adjacentTriangles[0];if(a!=null){var t=this._adjacentPairIndex[0];a._adjacentTriangles[t]=null,a._adjacentPairIndex[t]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var r=this._adjacentTriangles[1];if(r!=null){var i=this._adjacentPairIndex[1];r._adjacentTriangles[i]=null,r._adjacentPairIndex[i]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var o=this._adjacentTriangles[2];if(o!=null){var _=this._adjacentPairIndex[2];o._adjacentTriangles[_]=null,o._adjacentPairIndex[_]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};x.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new x.common.Vec3,this.w1=new x.common.Vec3,this.w2=new x.common.Vec3}init(a,t,r){var i=this.v;i.x=a.x,i.y=a.y,i.z=a.z;var o=this.w1;o.x=t.x,o.y=t.y,o.z=t.z;var _=this.w2;return _.x=r.x,_.y=r.y,_.z=r.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};x.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new x.common.Vec3}clear(){this.prevClosestDir.zero()}};x.common||(x.common={});x.common.Vec3=class{constructor(a,t,r){r==null&&(r=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=r,x.common.Vec3.numCreations++}init(a,t,r){return this.x=a,this.y=t,this.z=r,this}zero(){var a=0,t=0,r=0;return this.x=a,this.y=t,this.z=r,this}add(a){return new x.common.Vec3(this.x+a.x,this.y+a.y,this.z+a.z)}add3(a,t,r){return new x.common.Vec3(this.x+a,this.y+t,this.z+r)}addScaled(a,t){return new x.common.Vec3(this.x+a.x*t,this.y+a.y*t,this.z+a.z*t)}sub(a){return new x.common.Vec3(this.x-a.x,this.y-a.y,this.z-a.z)}sub3(a,t,r){return new x.common.Vec3(this.x-a,this.y-t,this.z-r)}scale(a){return new x.common.Vec3(this.x*a,this.y*a,this.z*a)}scale3(a,t,r){return new x.common.Vec3(this.x*a,this.y*t,this.z*r)}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}cross(a){return new x.common.Vec3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)}addEq(a){var t=this.x+a.x,r=this.y+a.y,i=this.z+a.z;return this.x=t,this.y=r,this.z=i,this}add3Eq(a,t,r){var i=this.x+a,o=this.y+t,_=this.z+r;return this.x=i,this.y=o,this.z=_,this}addScaledEq(a,t){var r=this.x+a.x*t,i=this.y+a.y*t,o=this.z+a.z*t;return this.x=r,this.y=i,this.z=o,this}subEq(a){var t=this.x-a.x,r=this.y-a.y,i=this.z-a.z;return this.x=t,this.y=r,this.z=i,this}sub3Eq(a,t,r){var i=this.x-a,o=this.y-t,_=this.z-r;return this.x=i,this.y=o,this.z=_,this}scaleEq(a){var t=this.x*a,r=this.y*a,i=this.z*a;return this.x=t,this.y=r,this.z=i,this}scale3Eq(a,t,r){var i=this.x*a,o=this.y*t,_=this.z*r;return this.x=i,this.y=o,this.z=_,this}crossEq(a){var t=this.y*a.z-this.z*a.y,r=this.z*a.x-this.x*a.z,i=this.x*a.y-this.y*a.x;return this.x=t,this.y=r,this.z=i,this}mulMat3(a){return new x.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02,this.x*a.e10+this.y*a.e11+this.z*a.e12,this.x*a.e20+this.y*a.e21+this.z*a.e22)}mulMat4(a){return new x.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23)}mulTransform(a){var t,r,i,o=this;t=o.x,r=o.y,i=o.z;var _,s,h;_=a._rotation00*t+a._rotation01*r+a._rotation02*i,s=a._rotation10*t+a._rotation11*r+a._rotation12*i,h=a._rotation20*t+a._rotation21*r+a._rotation22*i,t=_,r=s,i=h,t+=a._positionX,r+=a._positionY,i+=a._positionZ;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}mulMat3Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02,r=this.x*a.e10+this.y*a.e11+this.z*a.e12,i=this.x*a.e20+this.y*a.e21+this.z*a.e22;return this.x=t,this.y=r,this.z=i,this}mulMat4Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,r=this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,i=this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23;return this.x=t,this.y=r,this.z=i,this}mulTransformEq(a){var t,r,i,o=this;t=o.x,r=o.y,i=o.z;var _,s,h;_=a._rotation00*t+a._rotation01*r+a._rotation02*i,s=a._rotation10*t+a._rotation11*r+a._rotation12*i,h=a._rotation20*t+a._rotation21*r+a._rotation22*i,t=_,r=s,i=h,t+=a._positionX,r+=a._positionY,i+=a._positionZ;var v=this;return v.x=t,v.y=r,v.z=i,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a>0&&(a=1/a),new x.common.Vec3(this.x*a,this.y*a,this.z*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0&&(a=1/a);var t=this.x*a,r=this.y*a,i=this.z*a;return this.x=t,this.y=r,this.z=i,this}negate(){return new x.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){var a=-this.x,t=-this.y,r=-this.z;return this.x=a,this.y=t,this.z=r,this}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}clone(){return new x.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};x.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){var a=new x.common.Vec3,t=a;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,a}getPositionTo(a){var t=a;t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(a){var t=a;return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._positionX+=t,this._positionY+=r,this._positionZ+=i}getRotation(){var a=new x.common.Mat3,t=a;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,a}getRotationTo(a){var t=a;t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(a){var t=a;return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var _=Math.sin(t),s=Math.sin(r),h=Math.sin(i),v=Math.cos(t),e=Math.cos(r),l=Math.cos(i);this._rotation00=e*l,this._rotation01=-e*h,this._rotation02=s,this._rotation10=v*h+l*_*s,this._rotation11=v*l-_*s*h,this._rotation12=-e*_,this._rotation20=_*h-v*l*s,this._rotation21=l*_+v*s*h,this._rotation22=v*e}rotate(a){var t,r,i,o,_,s,h,v,e,l=a;t=l.e00,r=l.e01,i=l.e02,o=l.e10,_=l.e11,s=l.e12,h=l.e20,v=l.e21,e=l.e22;var u,b,f,n,c,M,m,y,V;u=t*this._rotation00+r*this._rotation10+i*this._rotation20,b=t*this._rotation01+r*this._rotation11+i*this._rotation21,f=t*this._rotation02+r*this._rotation12+i*this._rotation22,n=o*this._rotation00+_*this._rotation10+s*this._rotation20,c=o*this._rotation01+_*this._rotation11+s*this._rotation21,M=o*this._rotation02+_*this._rotation12+s*this._rotation22,m=h*this._rotation00+v*this._rotation10+e*this._rotation20,y=h*this._rotation01+v*this._rotation11+e*this._rotation21,V=h*this._rotation02+v*this._rotation12+e*this._rotation22,this._rotation00=u,this._rotation01=b,this._rotation02=f,this._rotation10=n,this._rotation11=c,this._rotation12=M,this._rotation20=m,this._rotation21=y,this._rotation22=V}rotateXyz(a){var t,r,i,o,_,s,h,v,e,l,u,b,f=a;t=f.x,r=f.y,i=f.z;var n=Math.sin(t),c=Math.sin(r),M=Math.sin(i),m=Math.cos(t),y=Math.cos(r),V=Math.cos(i);o=y*V,_=-y*M,s=c,h=m*M+V*n*c,v=m*V-n*c*M,e=-y*n,l=n*M-m*V*c,u=V*n+m*c*M,b=m*y;var z,I,k,X,L,p,g,N,A;z=o*this._rotation00+_*this._rotation10+s*this._rotation20,I=o*this._rotation01+_*this._rotation11+s*this._rotation21,k=o*this._rotation02+_*this._rotation12+s*this._rotation22,X=h*this._rotation00+v*this._rotation10+e*this._rotation20,L=h*this._rotation01+v*this._rotation11+e*this._rotation21,p=h*this._rotation02+v*this._rotation12+e*this._rotation22,g=l*this._rotation00+u*this._rotation10+b*this._rotation20,N=l*this._rotation01+u*this._rotation11+b*this._rotation21,A=l*this._rotation02+u*this._rotation12+b*this._rotation22,this._rotation00=z,this._rotation01=I,this._rotation02=k,this._rotation10=X,this._rotation11=L,this._rotation12=p,this._rotation20=g,this._rotation21=N,this._rotation22=A}getOrientation(){var a=new x.common.Quat,t,r,i,o,_=this._rotation00,s=this._rotation11,h=this._rotation22,v=_+s+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._rotation21-this._rotation12)*e,r=(this._rotation02-this._rotation20)*e,i=(this._rotation10-this._rotation01)*e):_>s?_>h?(e=Math.sqrt(_-s-h+1),t=.5*e,e=.5/e,r=(this._rotation01+this._rotation10)*e,i=(this._rotation02+this._rotation20)*e,o=(this._rotation21-this._rotation12)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e):s>h?(e=Math.sqrt(s-h-_+1),r=.5*e,e=.5/e,t=(this._rotation01+this._rotation10)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation02-this._rotation20)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e);var l=a;return l.x=t,l.y=r,l.z=i,l.w=o,a}getOrientationTo(a){var t,r,i,o,_=this._rotation00,s=this._rotation11,h=this._rotation22,v=_+s+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._rotation21-this._rotation12)*e,r=(this._rotation02-this._rotation20)*e,i=(this._rotation10-this._rotation01)*e):_>s?_>h?(e=Math.sqrt(_-s-h+1),t=.5*e,e=.5/e,r=(this._rotation01+this._rotation10)*e,i=(this._rotation02+this._rotation20)*e,o=(this._rotation21-this._rotation12)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e):s>h?(e=Math.sqrt(s-h-_+1),r=.5*e,e=.5/e,t=(this._rotation01+this._rotation10)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation02-this._rotation20)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e);var l=a;l.x=t,l.y=r,l.z=i,l.w=o}setOrientation(a){var t,r,i,o,_=a;t=_.x,r=_.y,i=_.z,o=_.w;var s=t,h=r,v=i,e=o,l=2*s,u=2*h,b=2*v,f=s*l,n=h*u,c=v*b,M=s*u,m=h*b,y=s*b,V=e*l,z=e*u,I=e*b;return this._rotation00=1-n-c,this._rotation01=M-I,this._rotation02=y+z,this._rotation10=M+I,this._rotation11=1-f-c,this._rotation12=m-V,this._rotation20=y-z,this._rotation21=m+V,this._rotation22=1-f-n,this}clone(){var a=new x.common.Transform;return a._positionX=this._positionX,a._positionY=this._positionY,a._positionZ=this._positionZ,a._rotation00=this._rotation00,a._rotation01=this._rotation01,a._rotation02=this._rotation02,a._rotation10=this._rotation10,a._rotation11=this._rotation11,a._rotation12=this._rotation12,a._rotation20=this._rotation20,a._rotation21=this._rotation21,a._rotation22=this._rotation22,a}copyFrom(a){return this._positionX=a._positionX,this._positionY=a._positionY,this._positionZ=a._positionZ,this._rotation00=a._rotation00,this._rotation01=a._rotation01,this._rotation02=a._rotation02,this._rotation10=a._rotation10,this._rotation11=a._rotation11,this._rotation12=a._rotation12,this._rotation20=a._rotation20,this._rotation21=a._rotation21,this._rotation22=a._rotation22,this}};x.common.Setting=class{};x.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){var a=new Array(4);this.s=a;var t=new Array(4);this.w1=t;var r=new Array(4);this.w2=r;var i=new Array(3);this.baseDirs=i,this.baseDirs[0]=new x.common.Vec3(1,0,0),this.baseDirs[1]=new x.common.Vec3(0,1,0),this.baseDirs[2]=new x.common.Vec3(0,0,1),this.tl1=new x.common.Vec3,this.tl2=new x.common.Vec3,this.rayX=new x.common.Vec3,this.rayR=new x.common.Vec3,this.tempTransform=new x.common.Transform,this.s[0]=new x.common.Vec3,this.w1[0]=new x.common.Vec3,this.w2[0]=new x.common.Vec3,this.s[1]=new x.common.Vec3,this.w1[1]=new x.common.Vec3,this.w2[1]=new x.common.Vec3,this.s[2]=new x.common.Vec3,this.w1[2]=new x.common.Vec3,this.w2[2]=new x.common.Vec3,this.s[3]=new x.common.Vec3,this.w1[3]=new x.common.Vec3,this.w2[3]=new x.common.Vec3,this.dir=new x.common.Vec3,this.closest=new x.common.Vec3,this.closestPoint1=new x.common.Vec3,this.closestPoint2=new x.common.Vec3,this.polyhedron=new x.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(a,t,r,i,o,_){this.c1=a,this.c2=t,this.tf1=r,this.tf2=i;var s=this.s,h=this.w1,v=this.w2,e=this.closest,l=this.dir;if(o!=null?(o._gjkCache==null&&(o._gjkCache=new x.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(o._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var u,b,f;u=i._positionX-r._positionX,b=i._positionY-r._positionY,f=i._positionZ-r._positionZ;var n=l;n.x=u,n.y=b,n.z=f,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],M=this.w1[this.simplexSize];c.x=M.x,c.y=M.y,c.z=M.z;var m=c,y=this.w2[this.simplexSize],V=m.x-y.x,z=m.y-y.y,I=m.z-y.z;m.x=V,m.y=z,m.z=I,this.simplexSize=1;for(var k=0,X=40,L=1e-4,p=L*L;k<X;){var g=0;switch(this.simplexSize){case 1:var N=s[0];e.x=N.x,e.y=N.y,e.z=N.z,g=1;break;case 2:var A,F,S,Y,R,C,d=s[0];A=d.x,F=d.y,S=d.z;var Z=s[1];Y=Z.x,R=Z.y,C=Z.z;var $,j,E;$=Y-A,j=R-F,E=C-S;var G=$*$+j*j+E*E,B=$*A+j*F+E*S;if(B=-B/G,B<0){var Q=e;Q.x=A,Q.y=F,Q.z=S,g=1}else if(B>1){var U=e;U.x=Y,U.y=R,U.z=C,g=2}else{var J,D,H;J=A+$*B,D=F+j*B,H=S+E*B;var K=e;K.x=J,K.y=D,K.z=H,g=3}break;case 3:var ra=s[0],sa=s[1],W=s[2],q,na,oa,aa,T,ca,_a,w,ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba=ra;q=ba.x,na=ba.y,oa=ba.z;var ea=sa;aa=ea.x,T=ea.y,ca=ea.z;var ha=W;_a=ha.x,w=ha.y,ta=ha.z,ia=aa-q,la=T-na,va=ca-oa,xa=_a-aa,Ma=w-T,za=ta-ca,Xa=q-_a,Za=na-w,fa=oa-ta;var pa,ya,da;pa=la*za-va*Ma,ya=va*xa-ia*za,da=ia*Ma-la*xa;var ma,Ya,Qa,ga,ua,wa,ka,Pa,Mt;ma=la*da-va*ya,Ya=va*pa-ia*da,Qa=ia*ya-la*pa,ga=Ma*da-za*ya,ua=za*pa-xa*da,wa=xa*ya-Ma*pa,ka=Za*da-fa*ya,Pa=fa*pa-Xa*da,Mt=Xa*ya-Za*pa;var Ha=q*ma+na*Ya+oa*Qa,Ba=aa*ga+T*ua+ca*wa,nt=_a*ka+w*Pa+ta*Mt,Ea=-1,Fa,Aa,ft,Ua=0;if(Fa=0,Aa=0,ft=0,Ha<0){var ja,bt,rt,$a,_t,gt,mt=ra;ja=mt.x,bt=mt.y,rt=mt.z;var Wa=sa;$a=Wa.x,_t=Wa.y,gt=Wa.z;var it,ut,Da;it=$a-ja,ut=_t-bt,Da=gt-rt;var Ta=it*it+ut*ut+Da*Da,Na=it*ja+ut*bt+Da*rt;Na=-Na/Ta;var Vt;if(Na<0){var Pt=e;Pt.x=ja,Pt.y=bt,Pt.z=rt,Vt=1}else if(Na>1){var et=e;et.x=$a,et.y=_t,et.z=gt,Vt=2}else{var Xt,Yt,zt;Xt=ja+it*Na,Yt=bt+ut*Na,zt=rt+Da*Na;var Ia=e;Ia.x=Xt,Ia.y=Yt,Ia.z=zt,Vt=3}var O=e.x*e.x+e.y*e.y+e.z*e.z;Ua=Vt,Ea=O;var Va=e;Fa=Va.x,Aa=Va.y,ft=Va.z}if(Ba<0){var lt,P,wt,Bt,At,yt,kt=sa;lt=kt.x,P=kt.y,wt=kt.z;var pt=W;Bt=pt.x,At=pt.y,yt=pt.z;var ht,xt,Ra;ht=Bt-lt,xt=At-P,Ra=yt-wt;var st=ht*ht+xt*xt+Ra*Ra,Ca=ht*lt+xt*P+Ra*wt;Ca=-Ca/st;var vt;if(Ca<0){var qa=e;qa.x=lt,qa.y=P,qa.z=wt,vt=1}else if(Ca>1){var at=e;at.x=Bt,at.y=At,at.z=yt,vt=2}else{var Oa,tt,ct;Oa=lt+ht*Ca,tt=P+xt*Ca,ct=wt+Ra*Ca;var Sa=e;Sa.x=Oa,Sa.y=tt,Sa.z=ct,vt=3}var Ga=e.x*e.x+e.y*e.y+e.z*e.z;if(Ea<0||Ga<Ea){Ua=vt<<1,Ea=Ga;var Ka=e;Fa=Ka.x,Aa=Ka.y,ft=Ka.z}}if(nt<0){var La,ot,It,or,gr,ar,Ct=ra;La=Ct.x,ot=Ct.y,It=Ct.z;var _r=W;or=_r.x,gr=_r.y,ar=_r.z;var Et,St,Gt;Et=or-La,St=gr-ot,Gt=ar-It;var jr=Et*Et+St*St+Gt*Gt,vr=Et*La+St*ot+Gt*It;vr=-vr/jr;var lr;if(vr<0){var tr=e;tr.x=La,tr.y=ot,tr.z=It,lr=1}else if(vr>1){var Or=e;Or.x=or,Or.y=gr,Or.z=ar,lr=2}else{var Xr,Mr,Zt;Xr=La+Et*vr,Mr=ot+St*vr,Zt=It+Gt*vr;var ir=e;ir.x=Xr,ir.y=Mr,ir.z=Zt,lr=3}var Wt=e.x*e.x+e.y*e.y+e.z*e.z;if(Ea<0||Wt<Ea){Ua=lr&1|(lr&2)<<1,Ea=Wt;var nr=e;Fa=nr.x,Aa=nr.y,ft=nr.z}}if(Ea>0){var $r=e;$r.x=Fa,$r.y=Aa,$r.z=ft,g=Ua}else{var Ut=pa*pa+ya*ya+da*da;Ut>0&&(Ut=1/Math.sqrt(Ut)),pa*=Ut,ya*=Ut,da*=Ut;var Kr=q*pa+na*ya+oa*da,Ir=pa*pa+ya*ya+da*da;Ir=Kr/Ir,Fa=pa*Ir,Aa=ya*Ir,ft=da*Ir;var mi=e;mi.x=Fa,mi.y=Aa,mi.z=ft,g=7}break;case 4:var Wr=s[0],Lt=s[1],Kt=s[2],Tt=s[3],br,zr,vi,qt,fr,dt,ur,hr,ei,Xi,io,Jt,fi,pi,Dt,di,Sr,Di,Hn,oo,Bi,no,yn,Ao,Io,xr,qi,Ai=Wr;br=Ai.x,zr=Ai.y,vi=Ai.z;var yi=Lt;qt=yi.x,fr=yi.y,dt=yi.z;var So=Kt;ur=So.x,hr=So.y,ei=So.z;var Dr=Tt;Xi=Dr.x,io=Dr.y,Jt=Dr.z,fi=qt-br,pi=fr-zr,Dt=dt-vi,di=ur-br,Sr=hr-zr,Di=ei-vi,Hn=Xi-br,oo=io-zr,Bi=Jt-vi,no=ur-qt,yn=hr-fr,Ao=ei-dt,Io=Xi-qt,xr=io-fr,qi=Jt-dt;var Si,gi,Rt,Hr,Lr,Cn,zs,Ke,ms,Te,qe,D_;Si=pi*Di-Dt*Sr,gi=Dt*di-fi*Di,Rt=fi*Sr-pi*di,Hr=Sr*Bi-Di*oo,Lr=Di*Hn-di*Bi,Cn=di*oo-Sr*Hn,zs=oo*Dt-Bi*pi,Ke=Bi*fi-Hn*Dt,ms=Hn*pi-oo*fi,Te=xr*Ao-qi*yn,qe=qi*no-Io*Ao,D_=Io*yn-xr*no;var gn=fi*Te+pi*qe+Dt*D_>0?1:-1,Pr=br*Si+zr*gi+vi*Rt,No=br*Hr+zr*Lr+vi*Cn,Wi=br*zs+zr*Ke+vi*ms,ke=qt*Te+fr*qe+dt*D_,on=-1,Tn,jn,we,k_=0;if(Tn=0,jn=0,we=0,Pr*gn<0){var Re,Vr,Ii,ui,eo,Rn,ps,nn,Qn,cr,ho,Fi,En,as,Qe,Ee,De,he,rr=Wr;Re=rr.x,Vr=rr.y,Ii=rr.z;var ri=Lt;ui=ri.x,eo=ri.y,Rn=ri.z;var Qr=Kt;ps=Qr.x,nn=Qr.y,Qn=Qr.z,cr=ui-Re,ho=eo-Vr,Fi=Rn-Ii,En=ps-ui,as=nn-eo,Qe=Qn-Rn,Ee=Re-ps,De=Vr-nn,he=Ii-Qn;var Fr,fo,Po;Fr=ho*Qe-Fi*as,fo=Fi*En-cr*Qe,Po=cr*as-ho*En;var s_,Fe,ts,Dn,co,Ft,Nr,li,Vo;s_=ho*Po-Fi*fo,Fe=Fi*Fr-cr*Po,ts=cr*fo-ho*Fr,Dn=as*Po-Qe*fo,co=Qe*Fr-En*Po,Ft=En*fo-as*Fr,Nr=De*Po-he*fo,li=he*Fr-Ee*Po,Vo=Ee*fo-De*Fr;var ce=Re*s_+Vr*Fe+Ii*ts,Xe=ui*Dn+eo*co+Rn*Ft,Le=ps*Nr+nn*li+Qn*Vo,uo=-1,$t,Vi,si,Go=0;if($t=0,Vi=0,si=0,ce<0){var Ns,Co,ko,Ni,Pi,Ci,Li=Wr;Ns=Li.x,Co=Li.y,ko=Li.z;var Qt=Lt;Ni=Qt.x,Pi=Qt.y,Ci=Qt.z;var Gr,Yr,Rr;Gr=Ni-Ns,Yr=Pi-Co,Rr=Ci-ko;var Mi=Gr*Gr+Yr*Yr+Rr*Rr,qr=Gr*Ns+Yr*Co+Rr*ko;qr=-qr/Mi;var Gi;if(qr<0){var Ji=e;Ji.x=Ns,Ji.y=Co,Ji.z=ko,Gi=1}else if(qr>1){var ao=e;ao.x=Ni,ao.y=Pi,ao.z=Ci,Gi=2}else{var be,kr,en;be=Ns+Gr*qr,kr=Co+Yr*qr,en=ko+Rr*qr;var Yi=e;Yi.x=be,Yi.y=kr,Yi.z=en,Gi=3}var Jo=e.x*e.x+e.y*e.y+e.z*e.z;Go=Gi,uo=Jo;var ys=e;$t=ys.x,Vi=ys.y,si=ys.z}if(Xe<0){var In,gs,Vn,Cr,To,so,Fn=Lt;In=Fn.x,gs=Fn.y,Vn=Fn.z;var Ne=Kt;Cr=Ne.x,To=Ne.y,so=Ne.z;var Nn,Wo,kn;Nn=Cr-In,Wo=To-gs,kn=so-Vn;var Ye=Nn*Nn+Wo*Wo+kn*kn,Ot=Nn*In+Wo*gs+kn*Vn;Ot=-Ot/Ye;var Ro;if(Ot<0){var Ui=e;Ui.x=In,Ui.y=gs,Ui.z=Vn,Ro=1}else if(Ot>1){var wn=e;wn.x=Cr,wn.y=To,wn.z=so,Ro=2}else{var Gn,fe,Is;Gn=In+Nn*Ot,fe=gs+Wo*Ot,Is=Vn+kn*Ot;var Uo=e;Uo.x=Gn,Uo.y=fe,Uo.z=Is,Ro=3}var Vs=e.x*e.x+e.y*e.y+e.z*e.z;if(uo<0||Vs<uo){Go=Ro<<1,uo=Vs;var w_=e;$t=w_.x,Vi=w_.y,si=w_.z}}if(Le<0){var Gs,X_,Ge,F_,N_,Oi,wo=Wr;Gs=wo.x,X_=wo.y,Ge=wo.z;var Xo=Kt;F_=Xo.x,N_=Xo.y,Oi=Xo.z;var Jn,wr,Wn;Jn=F_-Gs,wr=N_-X_,Wn=Oi-Ge;var Qo=Jn*Jn+wr*wr+Wn*Wn,to=Jn*Gs+wr*X_+Wn*Ge;to=-to/Qo;var G_;if(to<0){var J_=e;J_.x=Gs,J_.y=X_,J_.z=Ge,G_=1}else if(to>1){var L_=e;L_.x=F_,L_.y=N_,L_.z=Oi,G_=2}else{var rs,__,v_;rs=Gs+Jn*to,__=X_+wr*to,v_=Ge+Wn*to;var is=e;is.x=rs,is.y=__,is.z=v_,G_=3}var mr=e.x*e.x+e.y*e.y+e.z*e.z;if(uo<0||mr<uo){Go=G_&1|(G_&2)<<1,uo=mr;var Oo=e;$t=Oo.x,Vi=Oo.y,si=Oo.z}}var ai;if(uo>0){var Ze=e;Ze.x=$t,Ze.y=Vi,Ze.z=si,ai=Go}else{var Js=Fr*Fr+fo*fo+Po*Po;Js>0&&(Js=1/Math.sqrt(Js)),Fr*=Js,fo*=Js,Po*=Js;var hv=Re*Fr+Vr*fo+Ii*Po,ue=Fr*Fr+fo*fo+Po*Po;ue=hv/ue,$t=Fr*ue,Vi=fo*ue,si=Po*ue;var Je=e;Je.x=$t,Je.y=Vi,Je.z=si,ai=7}var $n=e.x*e.x+e.y*e.y+e.z*e.z;k_=ai,on=$n;var Ws=e;Tn=Ws.x,jn=Ws.y,we=Ws.z}if(No*gn<0){var Tr,Lo,Ti,sn,ks,Y_,We,Kn,Xn,os,de,ns,Us,l_,Be,Ae,qn,pr,xo=Wr;Tr=xo.x,Lo=xo.y,Ti=xo.z;var Zi=Kt;sn=Zi.x,ks=Zi.y,Y_=Zi.z;var Ho=Tt;We=Ho.x,Kn=Ho.y,Xn=Ho.z,os=sn-Tr,de=ks-Lo,ns=Y_-Ti,Us=We-sn,l_=Kn-ks,Be=Xn-Y_,Ae=Tr-We,qn=Lo-Kn,pr=Ti-Xn;var Yo,Hi,Eo;Yo=de*Be-ns*l_,Hi=ns*Us-os*Be,Eo=os*l_-de*Us;var ws,ae,Os,W_,te,Nt,ji,Do,Xs;ws=de*Eo-ns*Hi,ae=ns*Yo-os*Eo,Os=os*Hi-de*Yo,W_=l_*Eo-Be*Hi,te=Be*Yo-Us*Eo,Nt=Us*Hi-l_*Yo,ji=qn*Eo-pr*Hi,Do=pr*Yo-Ae*Eo,Xs=Ae*Hi-qn*Yo;var kv=Tr*ws+Lo*ae+Ti*Os,r0=sn*W_+ks*te+Y_*Nt,U_=We*ji+Kn*Do+Xn*Xs,Ht=-1,Ln,Ri,Yn,Z_=0;if(Ln=0,Ri=0,Yn=0,kv<0){var Hs,h_,bo,es,ss,xe,Zr=Wr;Hs=Zr.x,h_=Zr.y,bo=Zr.z;var jo=Kt;es=jo.x,ss=jo.y,xe=jo.z;var ki,Zo,Ue;ki=es-Hs,Zo=ss-h_,Ue=xe-bo;var cv=ki*ki+Zo*Zo+Ue*Ue,Me=ki*Hs+Zo*h_+Ue*bo;Me=-Me/cv;var js;if(Me<0){var wv=e;wv.x=Hs,wv.y=h_,wv.z=bo,js=1}else if(Me>1){var Oe=e;Oe.x=es,Oe.y=ss,Oe.z=xe,js=2}else{var er,Zn,_n;er=Hs+ki*Me,Zn=h_+Zo*Me,_n=bo+Ue*Me;var vn=e;vn.x=er,vn.y=Zn,vn.z=_n,js=3}var d_=e.x*e.x+e.y*e.y+e.z*e.z;Z_=js,Ht=d_;var bv=e;Ln=bv.x,Ri=bv.y,Yn=bv.z}if(r0<0){var re,Se,c_,O_,fv,uv,b_=Kt;re=b_.x,Se=b_.y,c_=b_.z;var He=Tt;O_=He.x,fv=He.y,uv=He.z;var Mo,_s,vs;Mo=O_-re,_s=fv-Se,vs=uv-c_;var Ur=Mo*Mo+_s*_s+vs*vs,zo=Mo*re+_s*Se+vs*c_;zo=-zo/Ur;var _o;if(zo<0){var ls=e;ls.x=re,ls.y=Se,ls.z=c_,_o=1}else if(zo>1){var Ls=e;Ls.x=O_,Ls.y=fv,Ls.z=uv,_o=2}else{var Ys,Zs,B_;Ys=re+Mo*zo,Zs=Se+_s*zo,B_=c_+vs*zo;var ze=e;ze.x=Ys,ze.y=Zs,ze.z=B_,_o=3}var hs=e.x*e.x+e.y*e.y+e.z*e.z;if(Ht<0||hs<Ht){Z_=_o<<1,Ht=hs;var H_=e;Ln=H_.x,Ri=H_.y,Yn=H_.z}}if(U_<0){var $s,Un,me,Xv,A_,$o,ln=Wr;$s=ln.x,Un=ln.y,me=ln.z;var mo=Tt;Xv=mo.x,A_=mo.y,$o=mo.z;var jt,$i,vo;jt=Xv-$s,$i=A_-Un,vo=$o-me;var Ks=jt*jt+$i*$i+vo*vo,ds=jt*$s+$i*Un+vo*me;ds=-ds/Ks;var qs;if(ds<0){var S_=e;S_.x=$s,S_.y=Un,S_.z=me,qs=1}else if(ds>1){var Ko=e;Ko.x=Xv,Ko.y=A_,Ko.z=$o,qs=2}else{var ie,j_,xv;ie=$s+jt*ds,j_=Un+$i*ds,xv=me+vo*ds;var dr=e;dr.x=ie,dr.y=j_,dr.z=xv,qs=3}var po=e.x*e.x+e.y*e.y+e.z*e.z;if(Ht<0||po<Ht){Z_=qs&1|(qs&2)<<1,Ht=po;var Qi=e;Ln=Qi.x,Ri=Qi.y,Yn=Qi.z}}var ro;if(Ht>0){var $_=e;$_.x=Ln,$_.y=Ri,$_.z=Yn,ro=Z_}else{var K_=Yo*Yo+Hi*Hi+Eo*Eo;K_>0&&(K_=1/Math.sqrt(K_)),Yo*=K_,Hi*=K_,Eo*=K_;var Lv=Tr*Yo+Lo*Hi+Ti*Eo,a_=Yo*Yo+Hi*Hi+Eo*Eo;a_=Lv/a_,Ln=Yo*a_,Ri=Hi*a_,Yn=Eo*a_;var Yv=e;Yv.x=Ln,Yv.y=Ri,Yv.z=Yn,ro=7}var q_=e.x*e.x+e.y*e.y+e.z*e.z;if(on<0||q_<on){k_=ro&1|(ro&6)<<1,on=q_;var Br=e;Tn=Br.x,jn=Br.y,we=Br.z}}if(Wi*gn<0){var av,Bs,As,cs,bs,Ss,Zv,pe,Ki,t_,yo,r_,Fo,Ps,qo,ye,sr,an,_i=Wr;av=_i.x,Bs=_i.y,As=_i.z;var oe=Lt;cs=oe.x,bs=oe.y,Ss=oe.z;var ge=Tt;Zv=ge.x,pe=ge.y,Ki=ge.z,t_=cs-av,yo=bs-Bs,r_=Ss-As,Fo=Zv-cs,Ps=pe-bs,qo=Ki-Ss,ye=av-Zv,sr=Bs-pe,an=As-Ki;var Bo,Ei,dn;Bo=yo*qo-r_*Ps,Ei=r_*Fo-t_*qo,dn=t_*Ps-yo*Fo;var tv,i_,P_,rv,ne,Bn,Ie,E0,z0;tv=yo*dn-r_*Ei,i_=r_*Bo-t_*dn,P_=t_*Ei-yo*Bo,rv=Ps*dn-qo*Ei,ne=qo*Bo-Fo*dn,Bn=Fo*Ei-Ps*Bo,Ie=sr*dn-an*Ei,E0=an*Bo-ye*dn,z0=ye*Ei-sr*Bo;var hl=av*tv+Bs*i_+As*P_,D0=cs*rv+bs*ne+Ss*Bn,hi=Zv*Ie+pe*E0+Ki*z0,On=-1,go,fs,iv,Mv=0;if(go=0,fs=0,iv=0,hl<0){var o_,dv,Cs,f_,u_,Ar,Ts=Wr;o_=Ts.x,dv=Ts.y,Cs=Ts.z;var lo=Lt;f_=lo.x,u_=lo.y,Ar=lo.z;var Pe,zv,Rs;Pe=f_-o_,zv=u_-dv,Rs=Ar-Cs;var x_=Pe*Pe+zv*zv+Rs*Rs,ov=Pe*o_+zv*dv+Rs*Cs;ov=-ov/x_;var i0;if(ov<0){var o0=e;o0.x=o_,o0.y=dv,o0.z=Cs,i0=1}else if(ov>1){var nv=e;nv.x=f_,nv.y=u_,nv.z=Ar,i0=2}else{var ti,je,An;ti=o_+Pe*ov,je=dv+zv*ov,An=Cs+Rs*ov;var us=e;us.x=ti,us.y=je,us.z=An,i0=3}var F0=e.x*e.x+e.y*e.y+e.z*e.z;Mv=i0,On=F0;var Dv=e;go=Dv.x,fs=Dv.y,iv=Dv.z}if(D0<0){var C_,m0,Bv,n0,p0,N0,e0=Lt;C_=e0.x,m0=e0.y,Bv=e0.z;var s0=Tt;n0=s0.x,p0=s0.y,N0=s0.z;var y0,Fv,ci;y0=n0-C_,Fv=p0-m0,ci=N0-Bv;var mv=y0*y0+Fv*Fv+ci*ci,hn=y0*C_+Fv*m0+ci*Bv;hn=-hn/mv;var Nv;if(hn<0){var Hl=e;Hl.x=C_,Hl.y=m0,Hl.z=Bv,Nv=1}else if(hn>1){var g0=e;g0.x=n0,g0.y=p0,g0.z=N0,Nv=2}else{var I0,cl,dl;I0=C_+y0*hn,cl=m0+Fv*hn,dl=Bv+ci*hn;var Gv=e;Gv.x=I0,Gv.y=cl,Gv.z=dl,Nv=3}var jl=e.x*e.x+e.y*e.y+e.z*e.z;if(On<0||jl<On){Mv=Nv<<1,On=jl;var $l=e;go=$l.x,fs=$l.y,iv=$l.z}}if(hi<0){var bl,Bl,Al,Kl,fl,ql,ul=Wr;bl=ul.x,Bl=ul.y,Al=ul.z;var ii=Tt;Kl=ii.x,fl=ii.y,ql=ii.z;var xs,tn,pv;xs=Kl-bl,tn=fl-Bl,pv=ql-Al;var yh=xs*xs+tn*tn+pv*pv,Jv=xs*bl+tn*Bl+pv*Al;Jv=-Jv/yh;var G0;if(Jv<0){var xl=e;xl.x=bl,xl.y=Bl,xl.z=Al,G0=1}else if(Jv>1){var V0=e;V0.x=Kl,V0.y=fl,V0.z=ql,G0=2}else{var k0,J0,zi;k0=bl+xs*Jv,J0=Bl+tn*Jv,zi=Al+pv*Jv;var Ms=e;Ms.x=k0,Ms.y=J0,Ms.z=zi,G0=3}var ee=e.x*e.x+e.y*e.y+e.z*e.z;if(On<0||ee<On){Mv=G0&1|(G0&2)<<1,On=ee;var _0=e;go=_0.x,fs=_0.y,iv=_0.z}}var Sl;if(On>0){var lh=e;lh.x=go,lh.y=fs,lh.z=iv,Sl=Mv}else{var W0=Bo*Bo+Ei*Ei+dn*dn;W0>0&&(W0=1/Math.sqrt(W0)),Bo*=W0,Ei*=W0,dn*=W0;var hh=av*Bo+Bs*Ei+As*dn,U0=Bo*Bo+Ei*Ei+dn*dn;U0=hh/U0,go=Bo*U0,fs=Ei*U0,iv=dn*U0;var Pl=e;Pl.x=go,Pl.y=fs,Pl.z=iv,Sl=7}var Ml=e.x*e.x+e.y*e.y+e.z*e.z;if(on<0||Ml<on){k_=Sl&3|(Sl&4)<<1,on=Ml;var Ce=e;Tn=Ce.x,jn=Ce.y,we=Ce.z}}if(ke*gn<0){var w0,M_,Cl,O0,H0,Tl,zl,X0,v0,z_,Wv,Uv,ev,L0,Av,l0,se,h0,Y0=Lt;w0=Y0.x,M_=Y0.y,Cl=Y0.z;var Qs=Kt;O0=Qs.x,H0=Qs.y,Tl=Qs.z;var j0=Tt;zl=j0.x,X0=j0.y,v0=j0.z,z_=O0-w0,Wv=H0-M_,Uv=Tl-Cl,ev=zl-O0,L0=X0-H0,Av=v0-Tl,l0=w0-zl,se=M_-X0,h0=Cl-v0;var yr,cn,wi;yr=Wv*Av-Uv*L0,cn=Uv*ev-z_*Av,wi=z_*L0-Wv*ev;var Ov,c0,ch,ah,m_,$e,Es,th,bh;Ov=Wv*wi-Uv*cn,c0=Uv*yr-z_*wi,ch=z_*cn-Wv*yr,ah=L0*wi-Av*cn,m_=Av*yr-ev*wi,$e=ev*cn-L0*yr,Es=se*wi-h0*cn,th=h0*yr-l0*wi,bh=l0*cn-se*yr;var Rl=w0*Ov+M_*c0+Cl*ch,bi=O0*ah+H0*m_+Tl*$e,n_=zl*Es+X0*th+v0*bh,bn=-1,yv,$0,gv,ml=0;if(yv=0,$0=0,gv=0,Rl<0){var pl,yl,T_,Sv,Sn,Iv,Pv=Lt;pl=Pv.x,yl=Pv.y,T_=Pv.z;var R_=Kt;Sv=R_.x,Sn=R_.y,Iv=R_.z;var _e,Q_,Cv;_e=Sv-pl,Q_=Sn-yl,Cv=Iv-T_;var Hv=_e*_e+Q_*Q_+Cv*Cv,oi=_e*pl+Q_*yl+Cv*T_;oi=-oi/Hv;var p_;if(oi<0){var ve=e;ve.x=pl,ve.y=yl,ve.z=T_,p_=1}else if(oi>1){var Jr=e;Jr.x=Sv,Jr.y=Sn,Jr.z=Iv,p_=2}else{var y_,Pn,K0;y_=pl+_e*oi,Pn=yl+Q_*oi,K0=T_+Cv*oi;var b0=e;b0.x=y_,b0.y=Pn,b0.z=K0,p_=3}var fh=e.x*e.x+e.y*e.y+e.z*e.z;ml=p_,bn=fh;var q0=e;yv=q0.x,$0=q0.y,gv=q0.z}if(bi<0){var al,gl,Z0,uh,Il,gh,rh=Kt;al=rh.x,gl=rh.y,Z0=rh.z;var Vl=Tt;uh=Vl.x,Il=Vl.y,gh=Vl.z;var d0,B0,kl;d0=uh-al,B0=Il-gl,kl=gh-Z0;var ih=d0*d0+B0*B0+kl*kl,jv=d0*al+B0*gl+kl*Z0;jv=-jv/ih;var Ql;if(jv<0){var $v=e;$v.x=al,$v.y=gl,$v.z=Z0,Ql=1}else if(jv>1){var ni=e;ni.x=uh,ni.y=Il,ni.z=gh,Ql=2}else{var g_,rn,wl;g_=al+d0*jv,rn=gl+B0*jv,wl=Z0+kl*jv;var A0=e;A0.x=g_,A0.y=rn,A0.z=wl,Ql=3}var oh=e.x*e.x+e.y*e.y+e.z*e.z;if(bn<0||oh<bn){ml=Ql<<1,bn=oh;var El=e;yv=El.x,$0=El.y,gv=El.z}}if(n_<0){var tl,Dl,S0,nh,eh,Fl,Nl=Lt;tl=Nl.x,Dl=Nl.y,S0=Nl.z;var sv=Tt;nh=sv.x,eh=sv.y,Fl=sv.z;var Tv,Kv,Ds;Tv=nh-tl,Kv=eh-Dl,Ds=Fl-S0;var xh=Tv*Tv+Kv*Kv+Ds*Ds,f0=Tv*tl+Kv*Dl+Ds*S0;f0=-f0/xh;var Xl;if(f0<0){var Rv=e;Rv.x=tl,Rv.y=Dl,Rv.z=S0,Xl=1}else if(f0>1){var qv=e;qv.x=nh,qv.y=eh,qv.z=Fl,Xl=2}else{var Qv,u0,Zh;Qv=tl+Tv*f0,u0=Dl+Kv*f0,Zh=S0+Ds*f0;var P0=e;P0.x=Qv,P0.y=u0,P0.z=Zh,Xl=3}var a0=e.x*e.x+e.y*e.y+e.z*e.z;if(bn<0||a0<bn){ml=Xl&1|(Xl&2)<<1,bn=a0;var Gl=e;yv=Gl.x,$0=Gl.y,gv=Gl.z}}var Jl;if(bn>0){var Mh=e;Mh.x=yv,Mh.y=$0,Mh.z=gv,Jl=ml}else{var Ev=yr*yr+cn*cn+wi*wi;Ev>0&&(Ev=1/Math.sqrt(Ev)),yr*=Ev,cn*=Ev,wi*=Ev;var xi=w0*yr+M_*cn+Cl*wi,Ve=yr*yr+cn*cn+wi*wi;Ve=xi/Ve,yv=yr*Ve,$0=cn*Ve,gv=wi*Ve;var le=e;le.x=yv,le.y=$0,le.z=gv,Jl=7}var C0=e.x*e.x+e.y*e.y+e.z*e.z;if(on<0||C0<on){k_=Jl<<1,on=C0;var Wl=e;Tn=Wl.x,jn=Wl.y,we=Wl.z}}if(on>0){var Fs=e;Fs.x=Tn,Fs.y=jn,Fs.z=we,g=k_}else e.zero(),g=15;break}if(e.x*e.x+e.y*e.y+e.z*e.z<p){if(!_)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){var x0=this.computeDepth(a,t,r,i,s,h,v);return x0!=0?(this.distance=0,x0):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(g),l.x=e.x,l.y=e.y,l.z=e.z;var Ll=l,Ul=-Ll.x,Ol=-Ll.y,Ih=-Ll.z;Ll.x=Ul,Ll.y=Ol,Ll.z=Ih,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var _v=this.s[this.simplexSize],vv=this.w1[this.simplexSize];_v.x=vv.x,_v.y=vv.y,_v.z=vv.z;var T0=_v,I_=this.w2[this.simplexSize],Yl=T0.x-I_.x,Vh=T0.y-I_.y,dh=T0.z-I_.z;if(T0.x=Yl,T0.y=Vh,T0.z=dh,l.x*l.x+l.y*l.y+l.z*l.z<p)throw new Error("!?");var t0=e.x*l.x+e.y*l.y+e.z*l.z,lv=s[this.simplexSize],kh=lv.x*l.x+lv.y*l.y+lv.z*l.z;if(kh-t0<p)return this.interpolateClosestPoints(),this.distance=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),o!=null&&o._gjkCache!=null&&this.saveCache(o._gjkCache),0;this.simplexSize++,++k}return 2}convexCastImpl(a,t,r,i,o,_,s){this.c1=a,this.c2=t,this.tf1=r,this.tf2=i;var h=this.s;this.w1,this.w2;var v=this.closest,e=this.dir,l,u,b;l=i._positionX-r._positionX,u=i._positionY-r._positionY,b=i._positionZ-r._positionZ;var f=e;if(f.x=l,f.y=u,f.z=b,e.x*e.x+e.y*e.y+e.z*e.z<1e-6&&e.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{var n=this.w1[this.simplexSize];n.x=this.tf1._positionX,n.y=this.tf1._positionY,n.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var c=this.s[this.simplexSize],M=this.w1[this.simplexSize];c.x=M.x,c.y=M.y,c.z=M.z;var m=c,y=this.w2[this.simplexSize],V=m.x-y.x,z=m.y-y.y,I=m.z-y.z;m.x=V,m.y=z,m.z=I,this.simplexSize=1;var k=0,X=40,L=0,p=this.rayX,g=this.rayR;p.zero(),g.x=_.x,g.y=_.y,g.z=_.z;var N=g,A=N.x-o.x,F=N.y-o.y,S=N.z-o.z;N.x=A,N.y=F,N.z=S;for(var Y=1e-4,R=Y*Y;k<X;){var C=0;switch(this.simplexSize){case 1:var d=h[0];v.x=d.x,v.y=d.y,v.z=d.z,C=1;break;case 2:var Z,$,j,E,G,B,Q=h[0];Z=Q.x,$=Q.y,j=Q.z;var U=h[1];E=U.x,G=U.y,B=U.z;var J,D,H;J=E-Z,D=G-$,H=B-j;var K=J*J+D*D+H*H,ra=J*Z+D*$+H*j;if(ra=-ra/K,ra<0){var sa=v;sa.x=Z,sa.y=$,sa.z=j,C=1}else if(ra>1){var W=v;W.x=E,W.y=G,W.z=B,C=2}else{var q,na,oa;q=Z+J*ra,na=$+D*ra,oa=j+H*ra;var aa=v;aa.x=q,aa.y=na,aa.z=oa,C=3}break;case 3:var T=h[0],ca=h[1],_a=h[2],w,ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya=T;w=Ya.x,ta=Ya.y,ia=Ya.z;var Qa=ca;la=Qa.x,va=Qa.y,xa=Qa.z;var ga=_a;Ma=ga.x,za=ga.y,Xa=ga.z,Za=la-w,fa=va-ta,ba=xa-ia,ea=Ma-la,ha=za-va,pa=Xa-xa,ya=w-Ma,da=ta-za,ma=ia-Xa;var ua,wa,ka;ua=fa*pa-ba*ha,wa=ba*ea-Za*pa,ka=Za*ha-fa*ea;var Pa,Mt,Ha,Ba,nt,Ea,Fa,Aa,ft;Pa=fa*ka-ba*wa,Mt=ba*ua-Za*ka,Ha=Za*wa-fa*ua,Ba=ha*ka-pa*wa,nt=pa*ua-ea*ka,Ea=ea*wa-ha*ua,Fa=da*ka-ma*wa,Aa=ma*ua-ya*ka,ft=ya*wa-da*ua;var Ua=w*Pa+ta*Mt+ia*Ha,ja=la*Ba+va*nt+xa*Ea,bt=Ma*Fa+za*Aa+Xa*ft,rt=-1,$a,_t,gt,mt=0;if($a=0,_t=0,gt=0,Ua<0){var Wa,it,ut,Da,Ta,Na,Vt=T;Wa=Vt.x,it=Vt.y,ut=Vt.z;var Pt=ca;Da=Pt.x,Ta=Pt.y,Na=Pt.z;var et,Xt,Yt;et=Da-Wa,Xt=Ta-it,Yt=Na-ut;var zt=et*et+Xt*Xt+Yt*Yt,Ia=et*Wa+Xt*it+Yt*ut;Ia=-Ia/zt;var O;if(Ia<0){var Va=v;Va.x=Wa,Va.y=it,Va.z=ut,O=1}else if(Ia>1){var lt=v;lt.x=Da,lt.y=Ta,lt.z=Na,O=2}else{var P,wt,Bt;P=Wa+et*Ia,wt=it+Xt*Ia,Bt=ut+Yt*Ia;var At=v;At.x=P,At.y=wt,At.z=Bt,O=3}var yt=v.x*v.x+v.y*v.y+v.z*v.z;mt=O,rt=yt;var kt=v;$a=kt.x,_t=kt.y,gt=kt.z}if(ja<0){var pt,ht,xt,Ra,st,Ca,vt=ca;pt=vt.x,ht=vt.y,xt=vt.z;var qa=_a;Ra=qa.x,st=qa.y,Ca=qa.z;var at,Oa,tt;at=Ra-pt,Oa=st-ht,tt=Ca-xt;var ct=at*at+Oa*Oa+tt*tt,Sa=at*pt+Oa*ht+tt*xt;Sa=-Sa/ct;var Ga;if(Sa<0){var Ka=v;Ka.x=pt,Ka.y=ht,Ka.z=xt,Ga=1}else if(Sa>1){var La=v;La.x=Ra,La.y=st,La.z=Ca,Ga=2}else{var ot,It,or;ot=pt+at*Sa,It=ht+Oa*Sa,or=xt+tt*Sa;var gr=v;gr.x=ot,gr.y=It,gr.z=or,Ga=3}var ar=v.x*v.x+v.y*v.y+v.z*v.z;if(rt<0||ar<rt){mt=Ga<<1,rt=ar;var Ct=v;$a=Ct.x,_t=Ct.y,gt=Ct.z}}if(bt<0){var _r,Et,St,Gt,jr,vr,lr=T;_r=lr.x,Et=lr.y,St=lr.z;var tr=_a;Gt=tr.x,jr=tr.y,vr=tr.z;var Or,Xr,Mr;Or=Gt-_r,Xr=jr-Et,Mr=vr-St;var Zt=Or*Or+Xr*Xr+Mr*Mr,ir=Or*_r+Xr*Et+Mr*St;ir=-ir/Zt;var Wt;if(ir<0){var nr=v;nr.x=_r,nr.y=Et,nr.z=St,Wt=1}else if(ir>1){var $r=v;$r.x=Gt,$r.y=jr,$r.z=vr,Wt=2}else{var Ut,Kr,Ir;Ut=_r+Or*ir,Kr=Et+Xr*ir,Ir=St+Mr*ir;var mi=v;mi.x=Ut,mi.y=Kr,mi.z=Ir,Wt=3}var Wr=v.x*v.x+v.y*v.y+v.z*v.z;if(rt<0||Wr<rt){mt=Wt&1|(Wt&2)<<1,rt=Wr;var Lt=v;$a=Lt.x,_t=Lt.y,gt=Lt.z}}if(rt>0){var Kt=v;Kt.x=$a,Kt.y=_t,Kt.z=gt,C=mt}else{var Tt=ua*ua+wa*wa+ka*ka;Tt>0&&(Tt=1/Math.sqrt(Tt)),ua*=Tt,wa*=Tt,ka*=Tt;var br=w*ua+ta*wa+ia*ka,zr=ua*ua+wa*wa+ka*ka;zr=br/zr,$a=ua*zr,_t=wa*zr,gt=ka*zr;var vi=v;vi.x=$a,vi.y=_t,vi.z=gt,C=7}break;case 4:var qt=h[0],fr=h[1],dt=h[2],ur=h[3],hr,ei,Xi,io,Jt,fi,pi,Dt,di,Sr,Di,Hn,oo,Bi,no,yn,Ao,Io,xr,qi,Ai,yi,So,Dr,Si,gi,Rt,Hr=qt;hr=Hr.x,ei=Hr.y,Xi=Hr.z;var Lr=fr;io=Lr.x,Jt=Lr.y,fi=Lr.z;var Cn=dt;pi=Cn.x,Dt=Cn.y,di=Cn.z;var zs=ur;Sr=zs.x,Di=zs.y,Hn=zs.z,oo=io-hr,Bi=Jt-ei,no=fi-Xi,yn=pi-hr,Ao=Dt-ei,Io=di-Xi,xr=Sr-hr,qi=Di-ei,Ai=Hn-Xi,yi=pi-io,So=Dt-Jt,Dr=di-fi,Si=Sr-io,gi=Di-Jt,Rt=Hn-fi;var Ke,ms,Te,qe,D_,gn,Pr,No,Wi,ke,on,Tn;Ke=Bi*Io-no*Ao,ms=no*yn-oo*Io,Te=oo*Ao-Bi*yn,qe=Ao*Ai-Io*qi,D_=Io*xr-yn*Ai,gn=yn*qi-Ao*xr,Pr=qi*no-Ai*Bi,No=Ai*oo-xr*no,Wi=xr*Bi-qi*oo,ke=gi*Dr-Rt*So,on=Rt*yi-Si*Dr,Tn=Si*So-gi*yi;var jn=oo*ke+Bi*on+no*Tn>0?1:-1,we=hr*Ke+ei*ms+Xi*Te,k_=hr*qe+ei*D_+Xi*gn,Re=hr*Pr+ei*No+Xi*Wi,Vr=io*ke+Jt*on+fi*Tn,Ii=-1,ui,eo,Rn,ps=0;if(ui=0,eo=0,Rn=0,we*jn<0){var nn,Qn,cr,ho,Fi,En,as,Qe,Ee,De,he,rr,ri,Qr,Fr,fo,Po,s_,Fe=qt;nn=Fe.x,Qn=Fe.y,cr=Fe.z;var ts=fr;ho=ts.x,Fi=ts.y,En=ts.z;var Dn=dt;as=Dn.x,Qe=Dn.y,Ee=Dn.z,De=ho-nn,he=Fi-Qn,rr=En-cr,ri=as-ho,Qr=Qe-Fi,Fr=Ee-En,fo=nn-as,Po=Qn-Qe,s_=cr-Ee;var co,Ft,Nr;co=he*Fr-rr*Qr,Ft=rr*ri-De*Fr,Nr=De*Qr-he*ri;var li,Vo,ce,Xe,Le,uo,$t,Vi,si;li=he*Nr-rr*Ft,Vo=rr*co-De*Nr,ce=De*Ft-he*co,Xe=Qr*Nr-Fr*Ft,Le=Fr*co-ri*Nr,uo=ri*Ft-Qr*co,$t=Po*Nr-s_*Ft,Vi=s_*co-fo*Nr,si=fo*Ft-Po*co;var Go=nn*li+Qn*Vo+cr*ce,Ns=ho*Xe+Fi*Le+En*uo,Co=as*$t+Qe*Vi+Ee*si,ko=-1,Ni,Pi,Ci,Li=0;if(Ni=0,Pi=0,Ci=0,Go<0){var Qt,Gr,Yr,Rr,Mi,qr,Gi=qt;Qt=Gi.x,Gr=Gi.y,Yr=Gi.z;var Ji=fr;Rr=Ji.x,Mi=Ji.y,qr=Ji.z;var ao,be,kr;ao=Rr-Qt,be=Mi-Gr,kr=qr-Yr;var en=ao*ao+be*be+kr*kr,Yi=ao*Qt+be*Gr+kr*Yr;Yi=-Yi/en;var Jo;if(Yi<0){var ys=v;ys.x=Qt,ys.y=Gr,ys.z=Yr,Jo=1}else if(Yi>1){var In=v;In.x=Rr,In.y=Mi,In.z=qr,Jo=2}else{var gs,Vn,Cr;gs=Qt+ao*Yi,Vn=Gr+be*Yi,Cr=Yr+kr*Yi;var To=v;To.x=gs,To.y=Vn,To.z=Cr,Jo=3}var so=v.x*v.x+v.y*v.y+v.z*v.z;Li=Jo,ko=so;var Fn=v;Ni=Fn.x,Pi=Fn.y,Ci=Fn.z}if(Ns<0){var Ne,Nn,Wo,kn,Ye,Ot,Ro=fr;Ne=Ro.x,Nn=Ro.y,Wo=Ro.z;var Ui=dt;kn=Ui.x,Ye=Ui.y,Ot=Ui.z;var wn,Gn,fe;wn=kn-Ne,Gn=Ye-Nn,fe=Ot-Wo;var Is=wn*wn+Gn*Gn+fe*fe,Uo=wn*Ne+Gn*Nn+fe*Wo;Uo=-Uo/Is;var Vs;if(Uo<0){var w_=v;w_.x=Ne,w_.y=Nn,w_.z=Wo,Vs=1}else if(Uo>1){var Gs=v;Gs.x=kn,Gs.y=Ye,Gs.z=Ot,Vs=2}else{var X_,Ge,F_;X_=Ne+wn*Uo,Ge=Nn+Gn*Uo,F_=Wo+fe*Uo;var N_=v;N_.x=X_,N_.y=Ge,N_.z=F_,Vs=3}var Oi=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Oi<ko){Li=Vs<<1,ko=Oi;var wo=v;Ni=wo.x,Pi=wo.y,Ci=wo.z}}if(Co<0){var Xo,Jn,wr,Wn,Qo,to,G_=qt;Xo=G_.x,Jn=G_.y,wr=G_.z;var J_=dt;Wn=J_.x,Qo=J_.y,to=J_.z;var L_,rs,__;L_=Wn-Xo,rs=Qo-Jn,__=to-wr;var v_=L_*L_+rs*rs+__*__,is=L_*Xo+rs*Jn+__*wr;is=-is/v_;var mr;if(is<0){var Oo=v;Oo.x=Xo,Oo.y=Jn,Oo.z=wr,mr=1}else if(is>1){var ai=v;ai.x=Wn,ai.y=Qo,ai.z=to,mr=2}else{var Ze,Js,hv;Ze=Xo+L_*is,Js=Jn+rs*is,hv=wr+__*is;var ue=v;ue.x=Ze,ue.y=Js,ue.z=hv,mr=3}var Je=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Je<ko){Li=mr&1|(mr&2)<<1,ko=Je;var $n=v;Ni=$n.x,Pi=$n.y,Ci=$n.z}}var Ws;if(ko>0){var Tr=v;Tr.x=Ni,Tr.y=Pi,Tr.z=Ci,Ws=Li}else{var Lo=co*co+Ft*Ft+Nr*Nr;Lo>0&&(Lo=1/Math.sqrt(Lo)),co*=Lo,Ft*=Lo,Nr*=Lo;var Ti=nn*co+Qn*Ft+cr*Nr,sn=co*co+Ft*Ft+Nr*Nr;sn=Ti/sn,Ni=co*sn,Pi=Ft*sn,Ci=Nr*sn;var ks=v;ks.x=Ni,ks.y=Pi,ks.z=Ci,Ws=7}var Y_=v.x*v.x+v.y*v.y+v.z*v.z;ps=Ws,Ii=Y_;var We=v;ui=We.x,eo=We.y,Rn=We.z}if(k_*jn<0){var Kn,Xn,os,de,ns,Us,l_,Be,Ae,qn,pr,xo,Zi,Ho,Yo,Hi,Eo,ws,ae=qt;Kn=ae.x,Xn=ae.y,os=ae.z;var Os=dt;de=Os.x,ns=Os.y,Us=Os.z;var W_=ur;l_=W_.x,Be=W_.y,Ae=W_.z,qn=de-Kn,pr=ns-Xn,xo=Us-os,Zi=l_-de,Ho=Be-ns,Yo=Ae-Us,Hi=Kn-l_,Eo=Xn-Be,ws=os-Ae;var te,Nt,ji;te=pr*Yo-xo*Ho,Nt=xo*Zi-qn*Yo,ji=qn*Ho-pr*Zi;var Do,Xs,kv,r0,U_,Ht,Ln,Ri,Yn;Do=pr*ji-xo*Nt,Xs=xo*te-qn*ji,kv=qn*Nt-pr*te,r0=Ho*ji-Yo*Nt,U_=Yo*te-Zi*ji,Ht=Zi*Nt-Ho*te,Ln=Eo*ji-ws*Nt,Ri=ws*te-Hi*ji,Yn=Hi*Nt-Eo*te;var Z_=Kn*Do+Xn*Xs+os*kv,Hs=de*r0+ns*U_+Us*Ht,h_=l_*Ln+Be*Ri+Ae*Yn,bo=-1,es,ss,xe,Zr=0;if(es=0,ss=0,xe=0,Z_<0){var jo,ki,Zo,Ue,cv,Me,js=qt;jo=js.x,ki=js.y,Zo=js.z;var wv=dt;Ue=wv.x,cv=wv.y,Me=wv.z;var Oe,er,Zn;Oe=Ue-jo,er=cv-ki,Zn=Me-Zo;var _n=Oe*Oe+er*er+Zn*Zn,vn=Oe*jo+er*ki+Zn*Zo;vn=-vn/_n;var d_;if(vn<0){var bv=v;bv.x=jo,bv.y=ki,bv.z=Zo,d_=1}else if(vn>1){var re=v;re.x=Ue,re.y=cv,re.z=Me,d_=2}else{var Se,c_,O_;Se=jo+Oe*vn,c_=ki+er*vn,O_=Zo+Zn*vn;var fv=v;fv.x=Se,fv.y=c_,fv.z=O_,d_=3}var uv=v.x*v.x+v.y*v.y+v.z*v.z;Zr=d_,bo=uv;var b_=v;es=b_.x,ss=b_.y,xe=b_.z}if(Hs<0){var He,Mo,_s,vs,Ur,zo,_o=dt;He=_o.x,Mo=_o.y,_s=_o.z;var ls=ur;vs=ls.x,Ur=ls.y,zo=ls.z;var Ls,Ys,Zs;Ls=vs-He,Ys=Ur-Mo,Zs=zo-_s;var B_=Ls*Ls+Ys*Ys+Zs*Zs,ze=Ls*He+Ys*Mo+Zs*_s;ze=-ze/B_;var hs;if(ze<0){var H_=v;H_.x=He,H_.y=Mo,H_.z=_s,hs=1}else if(ze>1){var $s=v;$s.x=vs,$s.y=Ur,$s.z=zo,hs=2}else{var Un,me,Xv;Un=He+Ls*ze,me=Mo+Ys*ze,Xv=_s+Zs*ze;var A_=v;A_.x=Un,A_.y=me,A_.z=Xv,hs=3}var $o=v.x*v.x+v.y*v.y+v.z*v.z;if(bo<0||$o<bo){Zr=hs<<1,bo=$o;var ln=v;es=ln.x,ss=ln.y,xe=ln.z}}if(h_<0){var mo,jt,$i,vo,Ks,ds,qs=qt;mo=qs.x,jt=qs.y,$i=qs.z;var S_=ur;vo=S_.x,Ks=S_.y,ds=S_.z;var Ko,ie,j_;Ko=vo-mo,ie=Ks-jt,j_=ds-$i;var xv=Ko*Ko+ie*ie+j_*j_,dr=Ko*mo+ie*jt+j_*$i;dr=-dr/xv;var po;if(dr<0){var Qi=v;Qi.x=mo,Qi.y=jt,Qi.z=$i,po=1}else if(dr>1){var ro=v;ro.x=vo,ro.y=Ks,ro.z=ds,po=2}else{var $_,K_,Lv;$_=mo+Ko*dr,K_=jt+ie*dr,Lv=$i+j_*dr;var a_=v;a_.x=$_,a_.y=K_,a_.z=Lv,po=3}var Yv=v.x*v.x+v.y*v.y+v.z*v.z;if(bo<0||Yv<bo){Zr=po&1|(po&2)<<1,bo=Yv;var q_=v;es=q_.x,ss=q_.y,xe=q_.z}}var Br;if(bo>0){var av=v;av.x=es,av.y=ss,av.z=xe,Br=Zr}else{var Bs=te*te+Nt*Nt+ji*ji;Bs>0&&(Bs=1/Math.sqrt(Bs)),te*=Bs,Nt*=Bs,ji*=Bs;var As=Kn*te+Xn*Nt+os*ji,cs=te*te+Nt*Nt+ji*ji;cs=As/cs,es=te*cs,ss=Nt*cs,xe=ji*cs;var bs=v;bs.x=es,bs.y=ss,bs.z=xe,Br=7}var Ss=v.x*v.x+v.y*v.y+v.z*v.z;if(Ii<0||Ss<Ii){ps=Br&1|(Br&6)<<1,Ii=Ss;var Zv=v;ui=Zv.x,eo=Zv.y,Rn=Zv.z}}if(Re*jn<0){var pe,Ki,t_,yo,r_,Fo,Ps,qo,ye,sr,an,_i,oe,ge,Bo,Ei,dn,tv,i_=qt;pe=i_.x,Ki=i_.y,t_=i_.z;var P_=fr;yo=P_.x,r_=P_.y,Fo=P_.z;var rv=ur;Ps=rv.x,qo=rv.y,ye=rv.z,sr=yo-pe,an=r_-Ki,_i=Fo-t_,oe=Ps-yo,ge=qo-r_,Bo=ye-Fo,Ei=pe-Ps,dn=Ki-qo,tv=t_-ye;var ne,Bn,Ie;ne=an*Bo-_i*ge,Bn=_i*oe-sr*Bo,Ie=sr*ge-an*oe;var E0,z0,hl,D0,hi,On,go,fs,iv;E0=an*Ie-_i*Bn,z0=_i*ne-sr*Ie,hl=sr*Bn-an*ne,D0=ge*Ie-Bo*Bn,hi=Bo*ne-oe*Ie,On=oe*Bn-ge*ne,go=dn*Ie-tv*Bn,fs=tv*ne-Ei*Ie,iv=Ei*Bn-dn*ne;var Mv=pe*E0+Ki*z0+t_*hl,o_=yo*D0+r_*hi+Fo*On,dv=Ps*go+qo*fs+ye*iv,Cs=-1,f_,u_,Ar,Ts=0;if(f_=0,u_=0,Ar=0,Mv<0){var lo,Pe,zv,Rs,x_,ov,i0=qt;lo=i0.x,Pe=i0.y,zv=i0.z;var o0=fr;Rs=o0.x,x_=o0.y,ov=o0.z;var nv,ti,je;nv=Rs-lo,ti=x_-Pe,je=ov-zv;var An=nv*nv+ti*ti+je*je,us=nv*lo+ti*Pe+je*zv;us=-us/An;var F0;if(us<0){var Dv=v;Dv.x=lo,Dv.y=Pe,Dv.z=zv,F0=1}else if(us>1){var C_=v;C_.x=Rs,C_.y=x_,C_.z=ov,F0=2}else{var m0,Bv,n0;m0=lo+nv*us,Bv=Pe+ti*us,n0=zv+je*us;var p0=v;p0.x=m0,p0.y=Bv,p0.z=n0,F0=3}var N0=v.x*v.x+v.y*v.y+v.z*v.z;Ts=F0,Cs=N0;var e0=v;f_=e0.x,u_=e0.y,Ar=e0.z}if(o_<0){var s0,y0,Fv,ci,mv,hn,Nv=fr;s0=Nv.x,y0=Nv.y,Fv=Nv.z;var Hl=ur;ci=Hl.x,mv=Hl.y,hn=Hl.z;var g0,I0,cl;g0=ci-s0,I0=mv-y0,cl=hn-Fv;var dl=g0*g0+I0*I0+cl*cl,Gv=g0*s0+I0*y0+cl*Fv;Gv=-Gv/dl;var jl;if(Gv<0){var $l=v;$l.x=s0,$l.y=y0,$l.z=Fv,jl=1}else if(Gv>1){var bl=v;bl.x=ci,bl.y=mv,bl.z=hn,jl=2}else{var Bl,Al,Kl;Bl=s0+g0*Gv,Al=y0+I0*Gv,Kl=Fv+cl*Gv;var fl=v;fl.x=Bl,fl.y=Al,fl.z=Kl,jl=3}var ql=v.x*v.x+v.y*v.y+v.z*v.z;if(Cs<0||ql<Cs){Ts=jl<<1,Cs=ql;var ul=v;f_=ul.x,u_=ul.y,Ar=ul.z}}if(dv<0){var ii,xs,tn,pv,yh,Jv,G0=qt;ii=G0.x,xs=G0.y,tn=G0.z;var xl=ur;pv=xl.x,yh=xl.y,Jv=xl.z;var V0,k0,J0;V0=pv-ii,k0=yh-xs,J0=Jv-tn;var zi=V0*V0+k0*k0+J0*J0,Ms=V0*ii+k0*xs+J0*tn;Ms=-Ms/zi;var ee;if(Ms<0){var _0=v;_0.x=ii,_0.y=xs,_0.z=tn,ee=1}else if(Ms>1){var Sl=v;Sl.x=pv,Sl.y=yh,Sl.z=Jv,ee=2}else{var lh,W0,hh;lh=ii+V0*Ms,W0=xs+k0*Ms,hh=tn+J0*Ms;var U0=v;U0.x=lh,U0.y=W0,U0.z=hh,ee=3}var Pl=v.x*v.x+v.y*v.y+v.z*v.z;if(Cs<0||Pl<Cs){Ts=ee&1|(ee&2)<<1,Cs=Pl;var Ml=v;f_=Ml.x,u_=Ml.y,Ar=Ml.z}}var Ce;if(Cs>0){var w0=v;w0.x=f_,w0.y=u_,w0.z=Ar,Ce=Ts}else{var M_=ne*ne+Bn*Bn+Ie*Ie;M_>0&&(M_=1/Math.sqrt(M_)),ne*=M_,Bn*=M_,Ie*=M_;var Cl=pe*ne+Ki*Bn+t_*Ie,O0=ne*ne+Bn*Bn+Ie*Ie;O0=Cl/O0,f_=ne*O0,u_=Bn*O0,Ar=Ie*O0;var H0=v;H0.x=f_,H0.y=u_,H0.z=Ar,Ce=7}var Tl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ii<0||Tl<Ii){ps=Ce&3|(Ce&4)<<1,Ii=Tl;var zl=v;ui=zl.x,eo=zl.y,Rn=zl.z}}if(Vr*jn<0){var X0,v0,z_,Wv,Uv,ev,L0,Av,l0,se,h0,Y0,Qs,j0,yr,cn,wi,Ov,c0=fr;X0=c0.x,v0=c0.y,z_=c0.z;var ch=dt;Wv=ch.x,Uv=ch.y,ev=ch.z;var ah=ur;L0=ah.x,Av=ah.y,l0=ah.z,se=Wv-X0,h0=Uv-v0,Y0=ev-z_,Qs=L0-Wv,j0=Av-Uv,yr=l0-ev,cn=X0-L0,wi=v0-Av,Ov=z_-l0;var m_,$e,Es;m_=h0*yr-Y0*j0,$e=Y0*Qs-se*yr,Es=se*j0-h0*Qs;var th,bh,Rl,bi,n_,bn,yv,$0,gv;th=h0*Es-Y0*$e,bh=Y0*m_-se*Es,Rl=se*$e-h0*m_,bi=j0*Es-yr*$e,n_=yr*m_-Qs*Es,bn=Qs*$e-j0*m_,yv=wi*Es-Ov*$e,$0=Ov*m_-cn*Es,gv=cn*$e-wi*m_;var ml=X0*th+v0*bh+z_*Rl,pl=Wv*bi+Uv*n_+ev*bn,yl=L0*yv+Av*$0+l0*gv,T_=-1,Sv,Sn,Iv,Pv=0;if(Sv=0,Sn=0,Iv=0,ml<0){var R_,_e,Q_,Cv,Hv,oi,p_=fr;R_=p_.x,_e=p_.y,Q_=p_.z;var ve=dt;Cv=ve.x,Hv=ve.y,oi=ve.z;var Jr,y_,Pn;Jr=Cv-R_,y_=Hv-_e,Pn=oi-Q_;var K0=Jr*Jr+y_*y_+Pn*Pn,b0=Jr*R_+y_*_e+Pn*Q_;b0=-b0/K0;var fh;if(b0<0){var q0=v;q0.x=R_,q0.y=_e,q0.z=Q_,fh=1}else if(b0>1){var al=v;al.x=Cv,al.y=Hv,al.z=oi,fh=2}else{var gl,Z0,uh;gl=R_+Jr*b0,Z0=_e+y_*b0,uh=Q_+Pn*b0;var Il=v;Il.x=gl,Il.y=Z0,Il.z=uh,fh=3}var gh=v.x*v.x+v.y*v.y+v.z*v.z;Pv=fh,T_=gh;var rh=v;Sv=rh.x,Sn=rh.y,Iv=rh.z}if(pl<0){var Vl,d0,B0,kl,ih,jv,Ql=dt;Vl=Ql.x,d0=Ql.y,B0=Ql.z;var $v=ur;kl=$v.x,ih=$v.y,jv=$v.z;var ni,g_,rn;ni=kl-Vl,g_=ih-d0,rn=jv-B0;var wl=ni*ni+g_*g_+rn*rn,A0=ni*Vl+g_*d0+rn*B0;A0=-A0/wl;var oh;if(A0<0){var El=v;El.x=Vl,El.y=d0,El.z=B0,oh=1}else if(A0>1){var tl=v;tl.x=kl,tl.y=ih,tl.z=jv,oh=2}else{var Dl,S0,nh;Dl=Vl+ni*A0,S0=d0+g_*A0,nh=B0+rn*A0;var eh=v;eh.x=Dl,eh.y=S0,eh.z=nh,oh=3}var Fl=v.x*v.x+v.y*v.y+v.z*v.z;if(T_<0||Fl<T_){Pv=oh<<1,T_=Fl;var Nl=v;Sv=Nl.x,Sn=Nl.y,Iv=Nl.z}}if(yl<0){var sv,Tv,Kv,Ds,xh,f0,Xl=fr;sv=Xl.x,Tv=Xl.y,Kv=Xl.z;var Rv=ur;Ds=Rv.x,xh=Rv.y,f0=Rv.z;var qv,Qv,u0;qv=Ds-sv,Qv=xh-Tv,u0=f0-Kv;var Zh=qv*qv+Qv*Qv+u0*u0,P0=qv*sv+Qv*Tv+u0*Kv;P0=-P0/Zh;var a0;if(P0<0){var Gl=v;Gl.x=sv,Gl.y=Tv,Gl.z=Kv,a0=1}else if(P0>1){var Jl=v;Jl.x=Ds,Jl.y=xh,Jl.z=f0,a0=2}else{var Mh,Ev,xi;Mh=sv+qv*P0,Ev=Tv+Qv*P0,xi=Kv+u0*P0;var Ve=v;Ve.x=Mh,Ve.y=Ev,Ve.z=xi,a0=3}var le=v.x*v.x+v.y*v.y+v.z*v.z;if(T_<0||le<T_){Pv=a0&1|(a0&2)<<1,T_=le;var C0=v;Sv=C0.x,Sn=C0.y,Iv=C0.z}}var Wl;if(T_>0){var Fs=v;Fs.x=Sv,Fs.y=Sn,Fs.z=Iv,Wl=Pv}else{var x0=m_*m_+$e*$e+Es*Es;x0>0&&(x0=1/Math.sqrt(x0)),m_*=x0,$e*=x0,Es*=x0;var Ll=X0*m_+v0*$e+z_*Es,Ul=m_*m_+$e*$e+Es*Es;Ul=Ll/Ul,Sv=m_*Ul,Sn=$e*Ul,Iv=Es*Ul;var Ol=v;Ol.x=Sv,Ol.y=Sn,Ol.z=Iv,Wl=7}var Ih=v.x*v.x+v.y*v.y+v.z*v.z;if(Ii<0||Ih<Ii){ps=Wl<<1,Ii=Ih;var _v=v;ui=_v.x,eo=_v.y,Rn=_v.z}}if(Ii>0){var vv=v;vv.x=ui,vv.y=eo,vv.z=Rn,C=ps}else v.zero(),C=15;break}if(this.shrinkSimplex(C),v.x*v.x+v.y*v.y+v.z*v.z<R){if(L==0||this.simplexSize==4)return s.fraction=L,!1;this.interpolateClosestPoints(),s.fraction=L;var T0=s.normal;T0.x=e.x,T0.y=e.y,T0.z=e.z;var I_=T0,Yl=Math.sqrt(I_.x*I_.x+I_.y*I_.y+I_.z*I_.z);Yl>0&&(Yl=1/Yl);var Vh=I_.x*Yl,dh=I_.y*Yl,t0=I_.z*Yl;I_.x=Vh,I_.y=dh,I_.z=t0;var lv=s.position,kh=this.closestPoint1;lv.x=kh.x,lv.y=kh.y,lv.z=kh.z;var Zl=lv,wh=Zl.x+o.x*L,jh=Zl.y+o.y*L,sh=Zl.z+o.z*L;return Zl.x=wh,Zl.y=jh,Zl.z=sh,!0}e.x=v.x,e.y=v.y,e.z=v.z;var Er=e,e_=-Er.x,V_=-Er.y,_h=-Er.z;if(Er.x=e_,Er.y=V_,Er.z=_h,this.c1!=null)this.computeWitnessPoint1(!0);else{var Bh=this.w1[this.simplexSize];Bh.x=this.tf1._positionX,Bh.y=this.tf1._positionY,Bh.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var Ah=this.s[this.simplexSize],zh=this.w1[this.simplexSize];Ah.x=zh.x,Ah.y=zh.y,Ah.z=zh.z;var Vv=Ah,Rh=this.w2[this.simplexSize],Qh=Vv.x-Rh.x,$h=Vv.y-Rh.y,Kh=Vv.z-Rh.z;Vv.x=Qh,Vv.y=$h,Vv.z=Kh;var mh=h[this.simplexSize],Sh=mh.x-p.x,rl=mh.y-p.y,rc=mh.z-p.z;if(mh.x=Sh,mh.y=rl,mh.z=rc,e.x*e.x+e.y*e.y+e.z*e.z<R)throw new Error("!?");var Xh=h[this.simplexSize],E_=e,Eh=Xh.x*E_.x+Xh.y*E_.y+Xh.z*E_.z;if(Eh<0){if(g.x*E_.x+g.y*E_.y+g.z*E_.z>=0)return!1;var ph=Eh/(g.x*E_.x+g.y*E_.y+g.z*E_.z);if(L+=ph,L>=1)return!1;var qh=p.x+g.x*ph,Lh=p.y+g.y*ph,ac=p.z+g.z*ph;p.x=qh,p.y=Lh,p.z=ac;for(var Ph=0,R0=this.simplexSize+1;Ph<R0;){var ic=Ph++,vh=h[ic],Yh=-ph,Dh=vh.x+g.x*Yh,Ch=vh.y+g.y*Yh,Q0=vh.z+g.z*Yh;vh.x=Dh,vh.y=Ch,vh.z=Q0}}for(var M0=!1,nc=0,ec=this.simplexSize;nc<ec;){var Fh=nc++,oc=h[Fh].x-h[this.simplexSize].x,tc=h[Fh].y-h[this.simplexSize].y,il=h[Fh].z-h[this.simplexSize].z;if(oc*oc+tc*tc+il*il<R){M0=!0;break}}M0||this.simplexSize++,++k}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:var a=this.closestPoint1,t=this.w1[0];a.x=t.x,a.y=t.y,a.z=t.z;var r=this.closestPoint2,i=this.w2[0];r.x=i.x,r.y=i.y,r.z=i.z;break;case 2:var o,_,s,h=this.closest;o=h.x,_=h.y,s=h.z;var v,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g=this.s[0];v=g.x,e=g.y,l=g.z;var N=this.w1[0];u=N.x,b=N.y,f=N.z;var A=this.w2[0];n=A.x,c=A.y,M=A.z;var F=this.s[1];m=F.x,y=F.y,V=F.z;var S=this.w1[1];z=S.x,I=S.y,k=S.z;var Y=this.w2[1];X=Y.x,L=Y.y,p=Y.z;var R=this.s[2];R.x,R.y,R.z;var C=this.w1[2];C.x,C.y,C.z;var d=this.w2[2];d.x,d.y,d.z;var Z,$,j;Z=m-v,$=y-e,j=V-l;var E=Z*Z+$*$+j*j;E!=0&&(E=1/E);var G,B,Q;G=o-v,B=_-e,Q=s-l;var U=(G*Z+B*$+Q*j)*E,J,D,H,K,ra,sa,W,q,na;J=z-u,D=I-b,H=k-f,K=u+J*U,ra=b+D*U,sa=f+H*U,J=X-n,D=L-c,H=p-M,W=n+J*U,q=c+D*U,na=M+H*U;var oa=this.closestPoint1;oa.x=K,oa.y=ra,oa.z=sa;var aa=this.closestPoint2;aa.x=W,aa.y=q,aa.z=na;break;case 3:var T,ca,_a,w=this.closest;T=w.x,ca=w.y,_a=w.z;var ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya,Qa,ga,ua,wa,ka,Pa,Mt,Ha,Ba,nt=this.s[0];ta=nt.x,ia=nt.y,la=nt.z;var Ea=this.w1[0];va=Ea.x,xa=Ea.y,Ma=Ea.z;var Fa=this.w2[0];za=Fa.x,Xa=Fa.y,Za=Fa.z;var Aa=this.s[1];fa=Aa.x,ba=Aa.y,ea=Aa.z;var ft=this.w1[1];ha=ft.x,pa=ft.y,ya=ft.z;var Ua=this.w2[1];da=Ua.x,ma=Ua.y,Ya=Ua.z;var ja=this.s[2];Qa=ja.x,ga=ja.y,ua=ja.z;var bt=this.w1[2];wa=bt.x,ka=bt.y,Pa=bt.z;var rt=this.w2[2];Mt=rt.x,Ha=rt.y,Ba=rt.z;var $a,_t,gt,mt,Wa,it,ut,Da,Ta;$a=fa-ta,_t=ba-ia,gt=ea-la,mt=Qa-ta,Wa=ga-ia,it=ua-la,ut=T-ta,Da=ca-ia,Ta=_a-la;var Na=$a*$a+_t*_t+gt*gt,Vt=$a*mt+_t*Wa+gt*it,Pt=mt*mt+Wa*Wa+it*it,et=$a*ut+_t*Da+gt*Ta,Xt=mt*ut+Wa*Da+it*Ta,Yt=Na*Pt-Vt*Vt;Yt!=0&&(Yt=1/Yt);var zt=(et*Pt-Xt*Vt)*Yt,Ia=(-et*Vt+Xt*Na)*Yt,O,Va,lt,P,wt,Bt,At,yt,kt;O=ha-va,Va=pa-xa,lt=ya-Ma,P=va+O*zt,wt=xa+Va*zt,Bt=Ma+lt*zt,O=wa-va,Va=ka-xa,lt=Pa-Ma,P+=O*Ia,wt+=Va*Ia,Bt+=lt*Ia,O=da-za,Va=ma-Xa,lt=Ya-Za,At=za+O*zt,yt=Xa+Va*zt,kt=Za+lt*zt,O=Mt-za,Va=Ha-Xa,lt=Ba-Za,At+=O*Ia,yt+=Va*Ia,kt+=lt*Ia;var pt=this.closestPoint1;pt.x=P,pt.y=wt,pt.z=Bt;var ht=this.closestPoint2;ht.x=At,ht.y=yt,ht.z=kt;break;default:throw new Error("!?")}}loadCache(a){var t=this.dir,r=a.prevClosestDir;t.x=r.x,t.y=r.y,t.z=r.z}saveCache(a){var t=a.prevClosestDir,r=this.closest;t.x=r.x,t.y=r.y,t.z=r.z;var i=t,o=-i.x,_=-i.y,s=-i.z;i.x=o,i.y=_,i.z=s}shrinkSimplex(a){switch(this.simplexSize=a,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),a){case 2:var t=this.s[0],r=this.s[1];t.x=r.x,t.y=r.y,t.z=r.z;var i=this.w1[0],o=this.w1[1];i.x=o.x,i.y=o.y,i.z=o.z;var _=this.w2[0],s=this.w2[1];_.x=s.x,_.y=s.y,_.z=s.z;break;case 4:var h=this.s[0],v=this.s[2];h.x=v.x,h.y=v.y,h.z=v.z;var e=this.w1[0],l=this.w1[2];e.x=l.x,e.y=l.y,e.z=l.z;var u=this.w2[0],b=this.w2[2];u.x=b.x,u.y=b.y,u.z=b.z;break;case 5:var f=this.s[1],n=this.s[2];f.x=n.x,f.y=n.y,f.z=n.z;var c=this.w1[1],M=this.w1[2];c.x=M.x,c.y=M.y,c.z=M.z;var m=this.w2[1],y=this.w2[2];m.x=y.x,m.y=y.y,m.z=y.z;break;case 6:var V=this.s[0],z=this.s[2];V.x=z.x,V.y=z.y,V.z=z.z;var I=this.w1[0],k=this.w1[2];I.x=k.x,I.y=k.y,I.z=k.z;var X=this.w2[0],L=this.w2[2];X.x=L.x,X.y=L.y,X.z=L.z;break;case 8:var p=this.s[0],g=this.s[3];p.x=g.x,p.y=g.y,p.z=g.z;var N=this.w1[0],A=this.w1[3];N.x=A.x,N.y=A.y,N.z=A.z;var F=this.w2[0],S=this.w2[3];F.x=S.x,F.y=S.y,F.z=S.z;break;case 9:var Y=this.s[1],R=this.s[3];Y.x=R.x,Y.y=R.y,Y.z=R.z;var C=this.w1[1],d=this.w1[3];C.x=d.x,C.y=d.y,C.z=d.z;var Z=this.w2[1],$=this.w2[3];Z.x=$.x,Z.y=$.y,Z.z=$.z;break;case 10:var j=this.s[0],E=this.s[3];j.x=E.x,j.y=E.y,j.z=E.z;var G=this.w1[0],B=this.w1[3];G.x=B.x,G.y=B.y,G.z=B.z;var Q=this.w2[0],U=this.w2[3];Q.x=U.x,Q.y=U.y,Q.z=U.z;break;case 11:var J=this.s[2],D=this.s[3];J.x=D.x,J.y=D.y,J.z=D.z;var H=this.w1[2],K=this.w1[3];H.x=K.x,H.y=K.y,H.z=K.z;var ra=this.w2[2],sa=this.w2[3];ra.x=sa.x,ra.y=sa.y,ra.z=sa.z;break;case 12:var W=this.s[0],q=this.s[2];W.x=q.x,W.y=q.y,W.z=q.z;var na=this.w1[0],oa=this.w1[2];na.x=oa.x,na.y=oa.y,na.z=oa.z;var aa=this.w2[0],T=this.w2[2];aa.x=T.x,aa.y=T.y,aa.z=T.z;var ca=this.s[1],_a=this.s[3];ca.x=_a.x,ca.y=_a.y,ca.z=_a.z;var w=this.w1[1],ta=this.w1[3];w.x=ta.x,w.y=ta.y,w.z=ta.z;var ia=this.w2[1],la=this.w2[3];ia.x=la.x,ia.y=la.y,ia.z=la.z;break;case 13:var va=this.s[1],xa=this.s[3];va.x=xa.x,va.y=xa.y,va.z=xa.z;var Ma=this.w1[1],za=this.w1[3];Ma.x=za.x,Ma.y=za.y,Ma.z=za.z;var Xa=this.w2[1],Za=this.w2[3];Xa.x=Za.x,Xa.y=Za.y,Xa.z=Za.z;break;case 14:var fa=this.s[0],ba=this.s[3];fa.x=ba.x,fa.y=ba.y,fa.z=ba.z;var ea=this.w1[0],ha=this.w1[3];ea.x=ha.x,ea.y=ha.y,ea.z=ha.z;var pa=this.w2[0],ya=this.w2[3];pa.x=ya.x,pa.y=ya.y,pa.z=ya.z;break}}computeWitnessPoint1(a){var t,r,i,o,_,s,h=this.dir;o=h.x,_=h.y,s=h.z;var v,e,l,u,b,f;u=this.tf1._rotation00*o+this.tf1._rotation10*_+this.tf1._rotation20*s,b=this.tf1._rotation01*o+this.tf1._rotation11*_+this.tf1._rotation21*s,f=this.tf1._rotation02*o+this.tf1._rotation12*_+this.tf1._rotation22*s,v=u,e=b,l=f;var n,c,M,m=this.dir;if(m.x=v,m.y=e,m.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var z=y.x*V,I=y.y*V,k=y.z*V;y.x=z,y.y=I,y.z=k;var X=this.w1[this.simplexSize],L=this.dir,p=this.c1._gjkMargin,g=X.x+L.x*p,N=X.y+L.y*p,A=X.z+L.z*p;X.x=g,X.y=N,X.z=A}var F=this.w1[this.simplexSize];t=F.x,r=F.y,i=F.z;var S,Y,R;S=this.tf1._rotation00*t+this.tf1._rotation01*r+this.tf1._rotation02*i,Y=this.tf1._rotation10*t+this.tf1._rotation11*r+this.tf1._rotation12*i,R=this.tf1._rotation20*t+this.tf1._rotation21*r+this.tf1._rotation22*i,n=S,c=Y,M=R,n+=this.tf1._positionX,c+=this.tf1._positionY,M+=this.tf1._positionZ;var C=this.w1[this.simplexSize];C.x=n,C.y=c,C.z=M;var d=this.dir;d.x=o,d.y=_,d.z=s}computeWitnessPoint2(a){var t,r,i,o,_,s,h=this.dir;o=h.x,_=h.y,s=h.z;var v,e,l,u,b,f;u=this.tf2._rotation00*o+this.tf2._rotation10*_+this.tf2._rotation20*s,b=this.tf2._rotation01*o+this.tf2._rotation11*_+this.tf2._rotation21*s,f=this.tf2._rotation02*o+this.tf2._rotation12*_+this.tf2._rotation22*s,v=u,e=b,l=f,v=-v,e=-e,l=-l;var n,c,M,m=this.dir;if(m.x=v,m.y=e,m.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var z=y.x*V,I=y.y*V,k=y.z*V;y.x=z,y.y=I,y.z=k;var X=this.w2[this.simplexSize],L=this.dir,p=this.c2._gjkMargin,g=X.x+L.x*p,N=X.y+L.y*p,A=X.z+L.z*p;X.x=g,X.y=N,X.z=A}var F=this.w2[this.simplexSize];t=F.x,r=F.y,i=F.z;var S,Y,R;S=this.tf2._rotation00*t+this.tf2._rotation01*r+this.tf2._rotation02*i,Y=this.tf2._rotation10*t+this.tf2._rotation11*r+this.tf2._rotation12*i,R=this.tf2._rotation20*t+this.tf2._rotation21*r+this.tf2._rotation22*i,n=S,c=Y,M=R,n+=this.tf2._positionX,c+=this.tf2._positionY,M+=this.tf2._positionZ;var C=this.w2[this.simplexSize];C.x=n,C.y=c,C.z=M;var d=this.dir;d.x=o,d.y=_,d.z=s}pointToTetrahedron(){for(var a=0;a<3;){var t=a++,r=this.dir,i=this.baseDirs[t];r.x=i.x,r.y=i.y,r.z=i.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var o=this.s[this.simplexSize],_=this.w1[this.simplexSize];o.x=_.x,o.y=_.y,o.z=_.z;var s=o,h=this.w2[this.simplexSize],v=s.x-h.x,e=s.y-h.y,l=s.z-h.z;if(s.x=v,s.y=e,s.z=l,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var u=this.dir,b=-u.x,f=-u.y,n=-u.z;u.x=b,u.y=f,u.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],M=this.w1[this.simplexSize];c.x=M.x,c.y=M.y,c.z=M.z;var m=c,y=this.w2[this.simplexSize],V=m.x-y.x,z=m.y-y.y,I=m.z-y.z;if(m.x=V,m.y=z,m.z=I,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){var a,t,r,i=this.dir;a=i.x,t=i.y,r=i.z;var o,_,s,h,v,e,l,u,b,f=this.s[0];o=f.x,_=f.y,s=f.z;var n=this.s[1];h=n.x,v=n.y,e=n.z,l=o-h,u=_-v,b=s-e;for(var c=0;c<3;){var M=c++,m,y,V,z=this.baseDirs[M];m=z.x,y=z.y,V=z.z;var I,k,X;I=u*V-b*y,k=b*m-l*V,X=l*y-u*m;var L=this.dir;L.x=I,L.y=k,L.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var p=this.s[this.simplexSize],g=this.w1[this.simplexSize];p.x=g.x,p.y=g.y,p.z=g.z;var N=p,A=this.w2[this.simplexSize],F=N.x-A.x,S=N.y-A.y,Y=N.z-A.z;if(N.x=F,N.y=S,N.z=Y,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var R=this.dir,C=-R.x,d=-R.y,Z=-R.z;R.x=C,R.y=d,R.z=Z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var $=this.s[this.simplexSize],j=this.w1[this.simplexSize];$.x=j.x,$.y=j.y,$.z=j.z;var E=$,G=this.w2[this.simplexSize],B=E.x-G.x,Q=E.y-G.y,U=E.z-G.z;if(E.x=B,E.y=Q,E.z=U,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}var J=this.dir;J.x=a,J.y=t,J.z=r}triangleToTetrahedron(){var a,t,r,i=this.dir;for(a=i.x,t=i.y,r=i.z;;){var o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V=this.s[0];o=V.x,_=V.y,s=V.z;var z=this.s[1];h=z.x,v=z.y,e=z.z;var I=this.s[2];l=I.x,u=I.y,b=I.z,f=h-o,n=v-_,c=e-s,M=l-o,m=u-_,y=b-s;var k,X,L;k=n*y-c*m,X=c*M-f*y,L=f*m-n*M;var p=this.dir;p.x=k,p.y=X,p.z=L,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var g=this.s[this.simplexSize],N=this.w1[this.simplexSize];g.x=N.x,g.y=N.y,g.z=N.z;var A=g,F=this.w2[this.simplexSize],S=A.x-F.x,Y=A.y-F.y,R=A.z-F.z;if(A.x=S,A.y=Y,A.z=R,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var C=this.dir,d=-C.x,Z=-C.y,$=-C.z;C.x=d,C.y=Z,C.z=$,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var j=this.s[this.simplexSize],E=this.w1[this.simplexSize];j.x=E.x,j.y=E.y,j.z=E.z;var G=j,B=this.w2[this.simplexSize],Q=G.x-B.x,U=G.y-B.y,J=G.z-B.z;if(G.x=Q,G.y=U,G.z=J,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var D=this.dir;D.x=a,D.y=t,D.z=r}isValidTetrahedron(){var a=this.s[1].x-this.s[0].x,t=this.s[1].y-this.s[0].y,r=this.s[1].z-this.s[0].z,i=this.s[2].x-this.s[0].x,o=this.s[2].y-this.s[0].y,_=this.s[2].z-this.s[0].z,s=this.s[3].x-this.s[0].x,h=this.s[3].y-this.s[0].y,v=this.s[3].z-this.s[0].z,e=a*(o*v-_*h)-t*(i*v-_*s)+r*(i*h-o*s);return e>1e-12?!0:e<-1e-12}computeDepth(a,t,r,i,o,_,s){for(var h=this.polyhedron;h._numTriangles>0;){var v=h._triangleList;h._numTriangles--;var e=v._prev,l=v._next;e!=null&&(e._next=l),l!=null&&(l._prev=e),v==h._triangleList&&(h._triangleList=h._triangleList._next),v==h._triangleListLast&&(h._triangleListLast=h._triangleListLast._prev),v._next=null,v._prev=null,v.removeReferences(),v._next=h._trianglePool,h._trianglePool=v}for(;h._numVertices>0;){var u=h._vertices[--h._numVertices];u.removeReferences(),u._next=h._vertexPool,h._vertexPool=u}var b=this.polyhedron,f=this.polyhedron,n=f._vertexPool;n!=null?(f._vertexPool=n._next,n._next=null):n=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var c=n.init(o[0],_[0],s[0]),M=this.polyhedron,m=M._vertexPool;m!=null?(M._vertexPool=m._next,m._next=null):m=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var y=m.init(o[1],_[1],s[1]),V=this.polyhedron,z=V._vertexPool;z!=null?(V._vertexPool=z._next,z._next=null):z=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var I=z.init(o[2],_[2],s[2]),k=this.polyhedron,X=k._vertexPool;if(X!=null?(k._vertexPool=X._next,X._next=null):X=new x.collision.narrowphase.detector.gjkepa.EpaVertex,!b._init(c,y,I,X.init(o[3],_[3],s[3])))return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var L=this.s[0],p=this.w1[0],g=this.w2[0],N=0,A=40;N<A;){for(var F=this.polyhedron._triangleList,S=1/0,Y=null;F!=null;){var R=F._next;F._distanceSq<S&&(S=F._distanceSq,Y=F),F=R}var C=Y,d=this.dir,Z=C._normal;d.x=Z.x,d.y=Z.y,d.z=Z.z;var $=d,j=Math.sqrt($.x*$.x+$.y*$.y+$.z*$.z);j>0&&(j=1/j);var E=$.x*j,G=$.y*j,B=$.z*j;$.x=E,$.y=G,$.z=B,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Q=this.s[this.simplexSize],U=this.w1[this.simplexSize];Q.x=U.x,Q.y=U.y,Q.z=U.z;var J=Q,D=this.w2[this.simplexSize],H=J.x-D.x,K=J.y-D.y,ra=J.z-D.z;J.x=H,J.y=K,J.z=ra;var sa=C._vertices[0],W=C._vertices[1],q=C._vertices[2],na=sa.v,oa=this.dir,aa=na.x*oa.x+na.y*oa.y+na.z*oa.z,T=this.dir,ca=L.x*T.x+L.y*T.y+L.z*T.z;if(ca-aa<1e-6||N==A-1){var _a=this.closest,w=this.dir;_a.x=w.x,_a.y=w.y,_a.z=w.z;var ta=_a,ia=this.dir,la=sa.v,va=this.dir,xa=(ia.x*la.x+ia.y*la.y+ia.z*la.z)/(va.x*va.x+va.y*va.y+va.z*va.z),Ma=ta.x*xa,za=ta.y*xa,Xa=ta.z*xa;ta.x=Ma,ta.y=za,ta.z=Xa;var Za,fa,ba,ea=this.closest;Za=ea.x,fa=ea.y,ba=ea.z;var ha,pa,ya,da,ma,Ya,Qa,ga,ua,wa,ka,Pa,Mt,Ha,Ba,nt,Ea,Fa,Aa,ft,Ua,ja,bt,rt,$a,_t,gt,mt=sa.v;ha=mt.x,pa=mt.y,ya=mt.z;var Wa=sa.w1;da=Wa.x,ma=Wa.y,Ya=Wa.z;var it=sa.w2;Qa=it.x,ga=it.y,ua=it.z;var ut=W.v;wa=ut.x,ka=ut.y,Pa=ut.z;var Da=W.w1;Mt=Da.x,Ha=Da.y,Ba=Da.z;var Ta=W.w2;nt=Ta.x,Ea=Ta.y,Fa=Ta.z;var Na=q.v;Aa=Na.x,ft=Na.y,Ua=Na.z;var Vt=q.w1;ja=Vt.x,bt=Vt.y,rt=Vt.z;var Pt=q.w2;$a=Pt.x,_t=Pt.y,gt=Pt.z;var et,Xt,Yt,zt,Ia,O,Va,lt,P;et=wa-ha,Xt=ka-pa,Yt=Pa-ya,zt=Aa-ha,Ia=ft-pa,O=Ua-ya,Va=Za-ha,lt=fa-pa,P=ba-ya;var wt=et*et+Xt*Xt+Yt*Yt,Bt=et*zt+Xt*Ia+Yt*O,At=zt*zt+Ia*Ia+O*O,yt=et*Va+Xt*lt+Yt*P,kt=zt*Va+Ia*lt+O*P,pt=wt*At-Bt*Bt;pt!=0&&(pt=1/pt);var ht=(yt*At-kt*Bt)*pt,xt=(-yt*Bt+kt*wt)*pt,Ra,st,Ca,vt,qa,at,Oa,tt,ct;Ra=Mt-da,st=Ha-ma,Ca=Ba-Ya,vt=da+Ra*ht,qa=ma+st*ht,at=Ya+Ca*ht,Ra=ja-da,st=bt-ma,Ca=rt-Ya,vt+=Ra*xt,qa+=st*xt,at+=Ca*xt,Ra=nt-Qa,st=Ea-ga,Ca=Fa-ua,Oa=Qa+Ra*ht,tt=ga+st*ht,ct=ua+Ca*ht,Ra=$a-Qa,st=_t-ga,Ca=gt-ua,Oa+=Ra*xt,tt+=st*xt,ct+=Ca*xt;var Sa=this.closestPoint1;Sa.x=vt,Sa.y=qa,Sa.z=at;var Ga=this.closestPoint2;Ga.x=Oa,Ga.y=tt,Ga.z=ct;var Ka=this.closest;return this.depth=Math.sqrt(Ka.x*Ka.x+Ka.y*Ka.y+Ka.z*Ka.z),x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var La=this.polyhedron,ot=La._vertexPool;ot!=null?(La._vertexPool=ot._next,ot._next=null):ot=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var It=ot.init(L,p,g);if(!this.polyhedron._addVertex(It,C))return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++N}return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(a,t,r,i,o){return this.computeClosestPointsImpl(a,t,r,i,o,!0)}computeDistance(a,t,r,i,o){return this.computeClosestPointsImpl(a,t,r,i,o,!1)}convexCast(a,t,r,i,o,_,s){return this.convexCastImpl(a,t,r,i,o,_,s)}rayCast(a,t,r,i,o){var _=this.tempTransform,s=t,h=r;_._positionX=h.x,_._positionY=h.y,_._positionZ=h.z;var v=this.tl1,e=this.tl2;v.x=i.x,v.y=i.y,v.z=i.z;var l=v,u=l.x-r.x,b=l.y-r.y,f=l.z-r.z;return l.x=u,l.y=b,l.z=f,e.zero(),this.convexCastImpl(null,a,_,s,v,e,o)}static getInstance(){return x.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};x.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};x.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};x.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(a,t,r){var i,o,_,s,h,v,e=a;i=e.x,o=e.y,_=e.z;var l=t;s=l.x,h=l.y,v=l.z;var u,b,f;u=s-i,b=h-o,f=v-_;var n=u*u+b*b+f*f,c=u*i+b*o+f*_;if(c=-c/n,c<0){var M=r;return M.x=i,M.y=o,M.z=_,1}if(c>1){var m=r;return m.x=s,m.y=h,m.z=v,2}var y,V,z;y=i+u*c,V=o+b*c,z=_+f*c;var I=r;return I.x=y,I.y=V,I.z=z,3}static projectOrigin3(a,t,r,i){var o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k=a;o=k.x,_=k.y,s=k.z;var X=t;h=X.x,v=X.y,e=X.z;var L=r;l=L.x,u=L.y,b=L.z,f=h-o,n=v-_,c=e-s,M=l-h,m=u-v,y=b-e,V=o-l,z=_-u,I=s-b;var p,g,N;p=n*y-c*m,g=c*M-f*y,N=f*m-n*M;var A,F,S,Y,R,C,d,Z,$;A=n*N-c*g,F=c*p-f*N,S=f*g-n*p,Y=m*N-y*g,R=y*p-M*N,C=M*g-m*p,d=z*N-I*g,Z=I*p-V*N,$=V*g-z*p;var j=o*A+_*F+s*S,E=h*Y+v*R+e*C,G=l*d+u*Z+b*$,B=-1,Q,U,J,D=0;if(Q=0,U=0,J=0,j<0){var H,K,ra,sa,W,q,na=a;H=na.x,K=na.y,ra=na.z;var oa=t;sa=oa.x,W=oa.y,q=oa.z;var aa,T,ca;aa=sa-H,T=W-K,ca=q-ra;var _a=aa*aa+T*T+ca*ca,w=aa*H+T*K+ca*ra;w=-w/_a;var ta;if(w<0){var ia=i;ia.x=H,ia.y=K,ia.z=ra,ta=1}else if(w>1){var la=i;la.x=sa,la.y=W,la.z=q,ta=2}else{var va,xa,Ma;va=H+aa*w,xa=K+T*w,Ma=ra+ca*w;var za=i;za.x=va,za.y=xa,za.z=Ma,ta=3}var Xa=i.x*i.x+i.y*i.y+i.z*i.z;D=ta,B=Xa;var Za=i;Q=Za.x,U=Za.y,J=Za.z}if(E<0){var fa,ba,ea,ha,pa,ya,da=t;fa=da.x,ba=da.y,ea=da.z;var ma=r;ha=ma.x,pa=ma.y,ya=ma.z;var Ya,Qa,ga;Ya=ha-fa,Qa=pa-ba,ga=ya-ea;var ua=Ya*Ya+Qa*Qa+ga*ga,wa=Ya*fa+Qa*ba+ga*ea;wa=-wa/ua;var ka;if(wa<0){var Pa=i;Pa.x=fa,Pa.y=ba,Pa.z=ea,ka=1}else if(wa>1){var Mt=i;Mt.x=ha,Mt.y=pa,Mt.z=ya,ka=2}else{var Ha,Ba,nt;Ha=fa+Ya*wa,Ba=ba+Qa*wa,nt=ea+ga*wa;var Ea=i;Ea.x=Ha,Ea.y=Ba,Ea.z=nt,ka=3}var Fa=i.x*i.x+i.y*i.y+i.z*i.z;if(B<0||Fa<B){D=ka<<1,B=Fa;var Aa=i;Q=Aa.x,U=Aa.y,J=Aa.z}}if(G<0){var ft,Ua,ja,bt,rt,$a,_t=a;ft=_t.x,Ua=_t.y,ja=_t.z;var gt=r;bt=gt.x,rt=gt.y,$a=gt.z;var mt,Wa,it;mt=bt-ft,Wa=rt-Ua,it=$a-ja;var ut=mt*mt+Wa*Wa+it*it,Da=mt*ft+Wa*Ua+it*ja;Da=-Da/ut;var Ta;if(Da<0){var Na=i;Na.x=ft,Na.y=Ua,Na.z=ja,Ta=1}else if(Da>1){var Vt=i;Vt.x=bt,Vt.y=rt,Vt.z=$a,Ta=2}else{var Pt,et,Xt;Pt=ft+mt*Da,et=Ua+Wa*Da,Xt=ja+it*Da;var Yt=i;Yt.x=Pt,Yt.y=et,Yt.z=Xt,Ta=3}var zt=i.x*i.x+i.y*i.y+i.z*i.z;if(B<0||zt<B){D=Ta&1|(Ta&2)<<1,B=zt;var Ia=i;Q=Ia.x,U=Ia.y,J=Ia.z}}if(B>0){var O=i;return O.x=Q,O.y=U,O.z=J,D}var Va=p*p+g*g+N*N;Va>0&&(Va=1/Math.sqrt(Va)),p*=Va,g*=Va,N*=Va;var lt=o*p+_*g+s*N,P=p*p+g*g+N*N;P=lt/P,Q=p*P,U=g*P,J=N*P;var wt=i;return wt.x=Q,wt.y=U,wt.z=J,7}static projectOrigin4(a,t,r,i,o){var _,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y,R=a;_=R.x,s=R.y,h=R.z;var C=t;v=C.x,e=C.y,l=C.z;var d=r;u=d.x,b=d.y,f=d.z;var Z=i;n=Z.x,c=Z.y,M=Z.z,m=v-_,y=e-s,V=l-h,z=u-_,I=b-s,k=f-h,X=n-_,L=c-s,p=M-h,g=u-v,N=b-e,A=f-l,F=n-v,S=c-e,Y=M-l;var $,j,E,G,B,Q,U,J,D,H,K,ra;$=y*k-V*I,j=V*z-m*k,E=m*I-y*z,G=I*p-k*L,B=k*X-z*p,Q=z*L-I*X,U=L*V-p*y,J=p*m-X*V,D=X*y-L*m,H=S*A-Y*N,K=Y*g-F*A,ra=F*N-S*g;var sa=m*H+y*K+V*ra>0?1:-1,W=_*$+s*j+h*E,q=_*G+s*B+h*Q,na=_*U+s*J+h*D,oa=v*H+e*K+l*ra,aa=-1,T,ca,_a,w=0;if(T=0,ca=0,_a=0,W*sa<0){var ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya,Qa=a;ta=Qa.x,ia=Qa.y,la=Qa.z;var ga=t;va=ga.x,xa=ga.y,Ma=ga.z;var ua=r;za=ua.x,Xa=ua.y,Za=ua.z,fa=va-ta,ba=xa-ia,ea=Ma-la,ha=za-va,pa=Xa-xa,ya=Za-Ma,da=ta-za,ma=ia-Xa,Ya=la-Za;var wa,ka,Pa;wa=ba*ya-ea*pa,ka=ea*ha-fa*ya,Pa=fa*pa-ba*ha;var Mt,Ha,Ba,nt,Ea,Fa,Aa,ft,Ua;Mt=ba*Pa-ea*ka,Ha=ea*wa-fa*Pa,Ba=fa*ka-ba*wa,nt=pa*Pa-ya*ka,Ea=ya*wa-ha*Pa,Fa=ha*ka-pa*wa,Aa=ma*Pa-Ya*ka,ft=Ya*wa-da*Pa,Ua=da*ka-ma*wa;var ja=ta*Mt+ia*Ha+la*Ba,bt=va*nt+xa*Ea+Ma*Fa,rt=za*Aa+Xa*ft+Za*Ua,$a=-1,_t,gt,mt,Wa=0;if(_t=0,gt=0,mt=0,ja<0){var it,ut,Da,Ta,Na,Vt,Pt=a;it=Pt.x,ut=Pt.y,Da=Pt.z;var et=t;Ta=et.x,Na=et.y,Vt=et.z;var Xt,Yt,zt;Xt=Ta-it,Yt=Na-ut,zt=Vt-Da;var Ia=Xt*Xt+Yt*Yt+zt*zt,O=Xt*it+Yt*ut+zt*Da;O=-O/Ia;var Va;if(O<0){var lt=o;lt.x=it,lt.y=ut,lt.z=Da,Va=1}else if(O>1){var P=o;P.x=Ta,P.y=Na,P.z=Vt,Va=2}else{var wt,Bt,At;wt=it+Xt*O,Bt=ut+Yt*O,At=Da+zt*O;var yt=o;yt.x=wt,yt.y=Bt,yt.z=At,Va=3}var kt=o.x*o.x+o.y*o.y+o.z*o.z;Wa=Va,$a=kt;var pt=o;_t=pt.x,gt=pt.y,mt=pt.z}if(bt<0){var ht,xt,Ra,st,Ca,vt,qa=t;ht=qa.x,xt=qa.y,Ra=qa.z;var at=r;st=at.x,Ca=at.y,vt=at.z;var Oa,tt,ct;Oa=st-ht,tt=Ca-xt,ct=vt-Ra;var Sa=Oa*Oa+tt*tt+ct*ct,Ga=Oa*ht+tt*xt+ct*Ra;Ga=-Ga/Sa;var Ka;if(Ga<0){var La=o;La.x=ht,La.y=xt,La.z=Ra,Ka=1}else if(Ga>1){var ot=o;ot.x=st,ot.y=Ca,ot.z=vt,Ka=2}else{var It,or,gr;It=ht+Oa*Ga,or=xt+tt*Ga,gr=Ra+ct*Ga;var ar=o;ar.x=It,ar.y=or,ar.z=gr,Ka=3}var Ct=o.x*o.x+o.y*o.y+o.z*o.z;if($a<0||Ct<$a){Wa=Ka<<1,$a=Ct;var _r=o;_t=_r.x,gt=_r.y,mt=_r.z}}if(rt<0){var Et,St,Gt,jr,vr,lr,tr=a;Et=tr.x,St=tr.y,Gt=tr.z;var Or=r;jr=Or.x,vr=Or.y,lr=Or.z;var Xr,Mr,Zt;Xr=jr-Et,Mr=vr-St,Zt=lr-Gt;var ir=Xr*Xr+Mr*Mr+Zt*Zt,Wt=Xr*Et+Mr*St+Zt*Gt;Wt=-Wt/ir;var nr;if(Wt<0){var $r=o;$r.x=Et,$r.y=St,$r.z=Gt,nr=1}else if(Wt>1){var Ut=o;Ut.x=jr,Ut.y=vr,Ut.z=lr,nr=2}else{var Kr,Ir,mi;Kr=Et+Xr*Wt,Ir=St+Mr*Wt,mi=Gt+Zt*Wt;var Wr=o;Wr.x=Kr,Wr.y=Ir,Wr.z=mi,nr=3}var Lt=o.x*o.x+o.y*o.y+o.z*o.z;if($a<0||Lt<$a){Wa=nr&1|(nr&2)<<1,$a=Lt;var Kt=o;_t=Kt.x,gt=Kt.y,mt=Kt.z}}var Tt;if($a>0){var br=o;br.x=_t,br.y=gt,br.z=mt,Tt=Wa}else{var zr=wa*wa+ka*ka+Pa*Pa;zr>0&&(zr=1/Math.sqrt(zr)),wa*=zr,ka*=zr,Pa*=zr;var vi=ta*wa+ia*ka+la*Pa,qt=wa*wa+ka*ka+Pa*Pa;qt=vi/qt,_t=wa*qt,gt=ka*qt,mt=Pa*qt;var fr=o;fr.x=_t,fr.y=gt,fr.z=mt,Tt=7}var dt=o.x*o.x+o.y*o.y+o.z*o.z;w=Tt,aa=dt;var ur=o;T=ur.x,ca=ur.y,_a=ur.z}if(q*sa<0){var hr,ei,Xi,io,Jt,fi,pi,Dt,di,Sr,Di,Hn,oo,Bi,no,yn,Ao,Io,xr=a;hr=xr.x,ei=xr.y,Xi=xr.z;var qi=r;io=qi.x,Jt=qi.y,fi=qi.z;var Ai=i;pi=Ai.x,Dt=Ai.y,di=Ai.z,Sr=io-hr,Di=Jt-ei,Hn=fi-Xi,oo=pi-io,Bi=Dt-Jt,no=di-fi,yn=hr-pi,Ao=ei-Dt,Io=Xi-di;var yi,So,Dr;yi=Di*no-Hn*Bi,So=Hn*oo-Sr*no,Dr=Sr*Bi-Di*oo;var Si,gi,Rt,Hr,Lr,Cn,zs,Ke,ms;Si=Di*Dr-Hn*So,gi=Hn*yi-Sr*Dr,Rt=Sr*So-Di*yi,Hr=Bi*Dr-no*So,Lr=no*yi-oo*Dr,Cn=oo*So-Bi*yi,zs=Ao*Dr-Io*So,Ke=Io*yi-yn*Dr,ms=yn*So-Ao*yi;var Te=hr*Si+ei*gi+Xi*Rt,qe=io*Hr+Jt*Lr+fi*Cn,D_=pi*zs+Dt*Ke+di*ms,gn=-1,Pr,No,Wi,ke=0;if(Pr=0,No=0,Wi=0,Te<0){var on,Tn,jn,we,k_,Re,Vr=a;on=Vr.x,Tn=Vr.y,jn=Vr.z;var Ii=r;we=Ii.x,k_=Ii.y,Re=Ii.z;var ui,eo,Rn;ui=we-on,eo=k_-Tn,Rn=Re-jn;var ps=ui*ui+eo*eo+Rn*Rn,nn=ui*on+eo*Tn+Rn*jn;nn=-nn/ps;var Qn;if(nn<0){var cr=o;cr.x=on,cr.y=Tn,cr.z=jn,Qn=1}else if(nn>1){var ho=o;ho.x=we,ho.y=k_,ho.z=Re,Qn=2}else{var Fi,En,as;Fi=on+ui*nn,En=Tn+eo*nn,as=jn+Rn*nn;var Qe=o;Qe.x=Fi,Qe.y=En,Qe.z=as,Qn=3}var Ee=o.x*o.x+o.y*o.y+o.z*o.z;ke=Qn,gn=Ee;var De=o;Pr=De.x,No=De.y,Wi=De.z}if(qe<0){var he,rr,ri,Qr,Fr,fo,Po=r;he=Po.x,rr=Po.y,ri=Po.z;var s_=i;Qr=s_.x,Fr=s_.y,fo=s_.z;var Fe,ts,Dn;Fe=Qr-he,ts=Fr-rr,Dn=fo-ri;var co=Fe*Fe+ts*ts+Dn*Dn,Ft=Fe*he+ts*rr+Dn*ri;Ft=-Ft/co;var Nr;if(Ft<0){var li=o;li.x=he,li.y=rr,li.z=ri,Nr=1}else if(Ft>1){var Vo=o;Vo.x=Qr,Vo.y=Fr,Vo.z=fo,Nr=2}else{var ce,Xe,Le;ce=he+Fe*Ft,Xe=rr+ts*Ft,Le=ri+Dn*Ft;var uo=o;uo.x=ce,uo.y=Xe,uo.z=Le,Nr=3}var $t=o.x*o.x+o.y*o.y+o.z*o.z;if(gn<0||$t<gn){ke=Nr<<1,gn=$t;var Vi=o;Pr=Vi.x,No=Vi.y,Wi=Vi.z}}if(D_<0){var si,Go,Ns,Co,ko,Ni,Pi=a;si=Pi.x,Go=Pi.y,Ns=Pi.z;var Ci=i;Co=Ci.x,ko=Ci.y,Ni=Ci.z;var Li,Qt,Gr;Li=Co-si,Qt=ko-Go,Gr=Ni-Ns;var Yr=Li*Li+Qt*Qt+Gr*Gr,Rr=Li*si+Qt*Go+Gr*Ns;Rr=-Rr/Yr;var Mi;if(Rr<0){var qr=o;qr.x=si,qr.y=Go,qr.z=Ns,Mi=1}else if(Rr>1){var Gi=o;Gi.x=Co,Gi.y=ko,Gi.z=Ni,Mi=2}else{var Ji,ao,be;Ji=si+Li*Rr,ao=Go+Qt*Rr,be=Ns+Gr*Rr;var kr=o;kr.x=Ji,kr.y=ao,kr.z=be,Mi=3}var en=o.x*o.x+o.y*o.y+o.z*o.z;if(gn<0||en<gn){ke=Mi&1|(Mi&2)<<1,gn=en;var Yi=o;Pr=Yi.x,No=Yi.y,Wi=Yi.z}}var Jo;if(gn>0){var ys=o;ys.x=Pr,ys.y=No,ys.z=Wi,Jo=ke}else{var In=yi*yi+So*So+Dr*Dr;In>0&&(In=1/Math.sqrt(In)),yi*=In,So*=In,Dr*=In;var gs=hr*yi+ei*So+Xi*Dr,Vn=yi*yi+So*So+Dr*Dr;Vn=gs/Vn,Pr=yi*Vn,No=So*Vn,Wi=Dr*Vn;var Cr=o;Cr.x=Pr,Cr.y=No,Cr.z=Wi,Jo=7}var To=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||To<aa){w=Jo&1|(Jo&6)<<1,aa=To;var so=o;T=so.x,ca=so.y,_a=so.z}}if(na*sa<0){var Fn,Ne,Nn,Wo,kn,Ye,Ot,Ro,Ui,wn,Gn,fe,Is,Uo,Vs,w_,Gs,X_,Ge=a;Fn=Ge.x,Ne=Ge.y,Nn=Ge.z;var F_=t;Wo=F_.x,kn=F_.y,Ye=F_.z;var N_=i;Ot=N_.x,Ro=N_.y,Ui=N_.z,wn=Wo-Fn,Gn=kn-Ne,fe=Ye-Nn,Is=Ot-Wo,Uo=Ro-kn,Vs=Ui-Ye,w_=Fn-Ot,Gs=Ne-Ro,X_=Nn-Ui;var Oi,wo,Xo;Oi=Gn*Vs-fe*Uo,wo=fe*Is-wn*Vs,Xo=wn*Uo-Gn*Is;var Jn,wr,Wn,Qo,to,G_,J_,L_,rs;Jn=Gn*Xo-fe*wo,wr=fe*Oi-wn*Xo,Wn=wn*wo-Gn*Oi,Qo=Uo*Xo-Vs*wo,to=Vs*Oi-Is*Xo,G_=Is*wo-Uo*Oi,J_=Gs*Xo-X_*wo,L_=X_*Oi-w_*Xo,rs=w_*wo-Gs*Oi;var __=Fn*Jn+Ne*wr+Nn*Wn,v_=Wo*Qo+kn*to+Ye*G_,is=Ot*J_+Ro*L_+Ui*rs,mr=-1,Oo,ai,Ze,Js=0;if(Oo=0,ai=0,Ze=0,__<0){var hv,ue,Je,$n,Ws,Tr,Lo=a;hv=Lo.x,ue=Lo.y,Je=Lo.z;var Ti=t;$n=Ti.x,Ws=Ti.y,Tr=Ti.z;var sn,ks,Y_;sn=$n-hv,ks=Ws-ue,Y_=Tr-Je;var We=sn*sn+ks*ks+Y_*Y_,Kn=sn*hv+ks*ue+Y_*Je;Kn=-Kn/We;var Xn;if(Kn<0){var os=o;os.x=hv,os.y=ue,os.z=Je,Xn=1}else if(Kn>1){var de=o;de.x=$n,de.y=Ws,de.z=Tr,Xn=2}else{var ns,Us,l_;ns=hv+sn*Kn,Us=ue+ks*Kn,l_=Je+Y_*Kn;var Be=o;Be.x=ns,Be.y=Us,Be.z=l_,Xn=3}var Ae=o.x*o.x+o.y*o.y+o.z*o.z;Js=Xn,mr=Ae;var qn=o;Oo=qn.x,ai=qn.y,Ze=qn.z}if(v_<0){var pr,xo,Zi,Ho,Yo,Hi,Eo=t;pr=Eo.x,xo=Eo.y,Zi=Eo.z;var ws=i;Ho=ws.x,Yo=ws.y,Hi=ws.z;var ae,Os,W_;ae=Ho-pr,Os=Yo-xo,W_=Hi-Zi;var te=ae*ae+Os*Os+W_*W_,Nt=ae*pr+Os*xo+W_*Zi;Nt=-Nt/te;var ji;if(Nt<0){var Do=o;Do.x=pr,Do.y=xo,Do.z=Zi,ji=1}else if(Nt>1){var Xs=o;Xs.x=Ho,Xs.y=Yo,Xs.z=Hi,ji=2}else{var kv,r0,U_;kv=pr+ae*Nt,r0=xo+Os*Nt,U_=Zi+W_*Nt;var Ht=o;Ht.x=kv,Ht.y=r0,Ht.z=U_,ji=3}var Ln=o.x*o.x+o.y*o.y+o.z*o.z;if(mr<0||Ln<mr){Js=ji<<1,mr=Ln;var Ri=o;Oo=Ri.x,ai=Ri.y,Ze=Ri.z}}if(is<0){var Yn,Z_,Hs,h_,bo,es,ss=a;Yn=ss.x,Z_=ss.y,Hs=ss.z;var xe=i;h_=xe.x,bo=xe.y,es=xe.z;var Zr,jo,ki;Zr=h_-Yn,jo=bo-Z_,ki=es-Hs;var Zo=Zr*Zr+jo*jo+ki*ki,Ue=Zr*Yn+jo*Z_+ki*Hs;Ue=-Ue/Zo;var cv;if(Ue<0){var Me=o;Me.x=Yn,Me.y=Z_,Me.z=Hs,cv=1}else if(Ue>1){var js=o;js.x=h_,js.y=bo,js.z=es,cv=2}else{var wv,Oe,er;wv=Yn+Zr*Ue,Oe=Z_+jo*Ue,er=Hs+ki*Ue;var Zn=o;Zn.x=wv,Zn.y=Oe,Zn.z=er,cv=3}var _n=o.x*o.x+o.y*o.y+o.z*o.z;if(mr<0||_n<mr){Js=cv&1|(cv&2)<<1,mr=_n;var vn=o;Oo=vn.x,ai=vn.y,Ze=vn.z}}var d_;if(mr>0){var bv=o;bv.x=Oo,bv.y=ai,bv.z=Ze,d_=Js}else{var re=Oi*Oi+wo*wo+Xo*Xo;re>0&&(re=1/Math.sqrt(re)),Oi*=re,wo*=re,Xo*=re;var Se=Fn*Oi+Ne*wo+Nn*Xo,c_=Oi*Oi+wo*wo+Xo*Xo;c_=Se/c_,Oo=Oi*c_,ai=wo*c_,Ze=Xo*c_;var O_=o;O_.x=Oo,O_.y=ai,O_.z=Ze,d_=7}var fv=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||fv<aa){w=d_&3|(d_&4)<<1,aa=fv;var uv=o;T=uv.x,ca=uv.y,_a=uv.z}}if(oa*sa<0){var b_,He,Mo,_s,vs,Ur,zo,_o,ls,Ls,Ys,Zs,B_,ze,hs,H_,$s,Un,me=t;b_=me.x,He=me.y,Mo=me.z;var Xv=r;_s=Xv.x,vs=Xv.y,Ur=Xv.z;var A_=i;zo=A_.x,_o=A_.y,ls=A_.z,Ls=_s-b_,Ys=vs-He,Zs=Ur-Mo,B_=zo-_s,ze=_o-vs,hs=ls-Ur,H_=b_-zo,$s=He-_o,Un=Mo-ls;var $o,ln,mo;$o=Ys*hs-Zs*ze,ln=Zs*B_-Ls*hs,mo=Ls*ze-Ys*B_;var jt,$i,vo,Ks,ds,qs,S_,Ko,ie;jt=Ys*mo-Zs*ln,$i=Zs*$o-Ls*mo,vo=Ls*ln-Ys*$o,Ks=ze*mo-hs*ln,ds=hs*$o-B_*mo,qs=B_*ln-ze*$o,S_=$s*mo-Un*ln,Ko=Un*$o-H_*mo,ie=H_*ln-$s*$o;var j_=b_*jt+He*$i+Mo*vo,xv=_s*Ks+vs*ds+Ur*qs,dr=zo*S_+_o*Ko+ls*ie,po=-1,Qi,ro,$_,K_=0;if(Qi=0,ro=0,$_=0,j_<0){var Lv,a_,Yv,q_,Br,av,Bs=t;Lv=Bs.x,a_=Bs.y,Yv=Bs.z;var As=r;q_=As.x,Br=As.y,av=As.z;var cs,bs,Ss;cs=q_-Lv,bs=Br-a_,Ss=av-Yv;var Zv=cs*cs+bs*bs+Ss*Ss,pe=cs*Lv+bs*a_+Ss*Yv;pe=-pe/Zv;var Ki;if(pe<0){var t_=o;t_.x=Lv,t_.y=a_,t_.z=Yv,Ki=1}else if(pe>1){var yo=o;yo.x=q_,yo.y=Br,yo.z=av,Ki=2}else{var r_,Fo,Ps;r_=Lv+cs*pe,Fo=a_+bs*pe,Ps=Yv+Ss*pe;var qo=o;qo.x=r_,qo.y=Fo,qo.z=Ps,Ki=3}var ye=o.x*o.x+o.y*o.y+o.z*o.z;K_=Ki,po=ye;var sr=o;Qi=sr.x,ro=sr.y,$_=sr.z}if(xv<0){var an,_i,oe,ge,Bo,Ei,dn=r;an=dn.x,_i=dn.y,oe=dn.z;var tv=i;ge=tv.x,Bo=tv.y,Ei=tv.z;var i_,P_,rv;i_=ge-an,P_=Bo-_i,rv=Ei-oe;var ne=i_*i_+P_*P_+rv*rv,Bn=i_*an+P_*_i+rv*oe;Bn=-Bn/ne;var Ie;if(Bn<0){var E0=o;E0.x=an,E0.y=_i,E0.z=oe,Ie=1}else if(Bn>1){var z0=o;z0.x=ge,z0.y=Bo,z0.z=Ei,Ie=2}else{var hl,D0,hi;hl=an+i_*Bn,D0=_i+P_*Bn,hi=oe+rv*Bn;var On=o;On.x=hl,On.y=D0,On.z=hi,Ie=3}var go=o.x*o.x+o.y*o.y+o.z*o.z;if(po<0||go<po){K_=Ie<<1,po=go;var fs=o;Qi=fs.x,ro=fs.y,$_=fs.z}}if(dr<0){var iv,Mv,o_,dv,Cs,f_,u_=t;iv=u_.x,Mv=u_.y,o_=u_.z;var Ar=i;dv=Ar.x,Cs=Ar.y,f_=Ar.z;var Ts,lo,Pe;Ts=dv-iv,lo=Cs-Mv,Pe=f_-o_;var zv=Ts*Ts+lo*lo+Pe*Pe,Rs=Ts*iv+lo*Mv+Pe*o_;Rs=-Rs/zv;var x_;if(Rs<0){var ov=o;ov.x=iv,ov.y=Mv,ov.z=o_,x_=1}else if(Rs>1){var i0=o;i0.x=dv,i0.y=Cs,i0.z=f_,x_=2}else{var o0,nv,ti;o0=iv+Ts*Rs,nv=Mv+lo*Rs,ti=o_+Pe*Rs;var je=o;je.x=o0,je.y=nv,je.z=ti,x_=3}var An=o.x*o.x+o.y*o.y+o.z*o.z;if(po<0||An<po){K_=x_&1|(x_&2)<<1,po=An;var us=o;Qi=us.x,ro=us.y,$_=us.z}}var F0;if(po>0){var Dv=o;Dv.x=Qi,Dv.y=ro,Dv.z=$_,F0=K_}else{var C_=$o*$o+ln*ln+mo*mo;C_>0&&(C_=1/Math.sqrt(C_)),$o*=C_,ln*=C_,mo*=C_;var m0=b_*$o+He*ln+Mo*mo,Bv=$o*$o+ln*ln+mo*mo;Bv=m0/Bv,Qi=$o*Bv,ro=ln*Bv,$_=mo*Bv;var n0=o;n0.x=Qi,n0.y=ro,n0.z=$_,F0=7}var p0=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||p0<aa){w=F0<<1,aa=p0;var N0=o;T=N0.x,ca=N0.y,_a=N0.z}}if(aa>0){var e0=o;return e0.x=T,e0.y=ca,e0.z=_a,w}return o.zero(),15}};x.common.Mat3=class{constructor(a,t,r,i,o,_,s,h,v){v==null&&(v=1),h==null&&(h=0),s==null&&(s=0),_==null&&(_=0),o==null&&(o=1),i==null&&(i=0),r==null&&(r=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=_,this.e20=s,this.e21=h,this.e22=v,x.common.Mat3.numCreations++}init(a,t,r,i,o,_,s,h,v){return this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=_,this.e20=s,this.e21=h,this.e22=v,this}identity(){var a=1,t=0,r=0,i=0,o=1,_=0,s=0,h=0,v=1;return this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=_,this.e20=s,this.e21=h,this.e22=v,this}add(a){return new x.common.Mat3(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22)}sub(a){return new x.common.Mat3(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22)}scale(a){return new x.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*a,this.e11*a,this.e12*a,this.e20*a,this.e21*a,this.e22*a)}mul(a){return new x.common.Mat3(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22)}addEq(a){var t=this.e00+a.e00,r=this.e01+a.e01,i=this.e02+a.e02,o=this.e10+a.e10,_=this.e11+a.e11,s=this.e12+a.e12,h=this.e20+a.e20,v=this.e21+a.e21,e=this.e22+a.e22;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=_,this.e12=s,this.e20=h,this.e21=v,this.e22=e,this}subEq(a){var t=this.e00-a.e00,r=this.e01-a.e01,i=this.e02-a.e02,o=this.e10-a.e10,_=this.e11-a.e11,s=this.e12-a.e12,h=this.e20-a.e20,v=this.e21-a.e21,e=this.e22-a.e22;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=_,this.e12=s,this.e20=h,this.e21=v,this.e22=e,this}scaleEq(a){var t=this.e00*a,r=this.e01*a,i=this.e02*a,o=this.e10*a,_=this.e11*a,s=this.e12*a,h=this.e20*a,v=this.e21*a,e=this.e22*a;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=_,this.e12=s,this.e20=h,this.e21=v,this.e22=e,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,r=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,i=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,o=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,_=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,s=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,h=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,v=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,e=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=_,this.e12=s,this.e20=h,this.e21=v,this.e22=e,this}prependScale(a,t,r){return new x.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*t,this.e11*t,this.e12*t,this.e20*r,this.e21*r,this.e22*r)}appendScale(a,t,r){return new x.common.Mat3(this.e00*a,this.e01*t,this.e02*r,this.e10*a,this.e11*t,this.e12*r,this.e20*a,this.e21*t,this.e22*r)}prependRotation(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_;return new x.common.Mat3(h*this.e00+v*this.e10+e*this.e20,h*this.e01+v*this.e11+e*this.e21,h*this.e02+v*this.e12+e*this.e22,l*this.e00+u*this.e10+b*this.e20,l*this.e01+u*this.e11+b*this.e21,l*this.e02+u*this.e12+b*this.e22,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22)}appendRotation(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_;return new x.common.Mat3(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*u+this.e02*n,this.e00*e+this.e01*b+this.e02*c,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*u+this.e12*n,this.e10*e+this.e11*b+this.e12*c,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*u+this.e22*n,this.e20*e+this.e21*b+this.e22*c)}prependScaleEq(a,t,r){var i=this.e00*a,o=this.e01*a,_=this.e02*a,s=this.e10*t,h=this.e11*t,v=this.e12*t,e=this.e20*r,l=this.e21*r,u=this.e22*r;return this.e00=i,this.e01=o,this.e02=_,this.e10=s,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}appendScaleEq(a,t,r){var i=this.e00*a,o=this.e01*t,_=this.e02*r,s=this.e10*a,h=this.e11*t,v=this.e12*r,e=this.e20*a,l=this.e21*t,u=this.e22*r;return this.e00=i,this.e01=o,this.e02=_,this.e10=s,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}prependRotationEq(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_,M=h*this.e00+v*this.e10+e*this.e20,m=h*this.e01+v*this.e11+e*this.e21,y=h*this.e02+v*this.e12+e*this.e22,V=l*this.e00+u*this.e10+b*this.e20,z=l*this.e01+u*this.e11+b*this.e21,I=l*this.e02+u*this.e12+b*this.e22,k=f*this.e00+n*this.e10+c*this.e20,X=f*this.e01+n*this.e11+c*this.e21,L=f*this.e02+n*this.e12+c*this.e22;return this.e00=M,this.e01=m,this.e02=y,this.e10=V,this.e11=z,this.e12=I,this.e20=k,this.e21=X,this.e22=L,this}appendRotationEq(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_,M=this.e00*h+this.e01*l+this.e02*f,m=this.e00*v+this.e01*u+this.e02*n,y=this.e00*e+this.e01*b+this.e02*c,V=this.e10*h+this.e11*l+this.e12*f,z=this.e10*v+this.e11*u+this.e12*n,I=this.e10*e+this.e11*b+this.e12*c,k=this.e20*h+this.e21*l+this.e22*f,X=this.e20*v+this.e21*u+this.e22*n,L=this.e20*e+this.e21*b+this.e22*c;return this.e00=M,this.e01=m,this.e02=y,this.e10=V,this.e11=z,this.e12=I,this.e20=k,this.e21=X,this.e22=L,this}transpose(){return new x.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){var a=this.e00,t=this.e10,r=this.e20,i=this.e01,o=this.e11,_=this.e21,s=this.e02,h=this.e12,v=this.e22;return this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=_,this.e20=s,this.e21=h,this.e22=v,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,r=this.e10*this.e21-this.e11*this.e20,i=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,_=this.e00*this.e21-this.e01*this.e20,s=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,e=this.e00*a-this.e01*t+this.e02*r;return e!=0&&(e=1/e),new x.common.Mat3(a*e,-i*e,s*e,-t*e,o*e,-h*e,r*e,-_*e,v*e)}inverseEq(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,r=this.e10*this.e21-this.e11*this.e20,i=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,_=this.e00*this.e21-this.e01*this.e20,s=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,e=this.e00*a-this.e01*t+this.e02*r;e!=0&&(e=1/e);var l=a*e,u=-i*e,b=s*e,f=-t*e,n=o*e,c=-h*e,M=r*e,m=-_*e,y=v*e;return this.e00=l,this.e01=u,this.e02=b,this.e10=f,this.e11=n,this.e12=c,this.e20=M,this.e21=m,this.e22=y,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this}clone(){return new x.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(a){var t=a.x,r=a.y,i=a.z,o=a.w,_=2*t,s=2*r,h=2*i,v=t*_,e=r*s,l=i*h,u=t*s,b=r*h,f=t*h,n=o*_,c=o*s,M=o*h;return this.e00=1-e-l,this.e01=u-M,this.e02=f+c,this.e10=u+M,this.e11=1-v-l,this.e12=b-n,this.e20=f-c,this.e21=b+n,this.e22=1-v-e,this}toQuat(){var a=new x.common.Quat,t=this.e00,r=this.e11,i=this.e22,o=t+r+i,_;return o>0?(_=Math.sqrt(o+1),a.w=.5*_,_=.5/_,a.x=(this.e21-this.e12)*_,a.y=(this.e02-this.e20)*_,a.z=(this.e10-this.e01)*_):t>r?t>i?(_=Math.sqrt(t-r-i+1),a.x=.5*_,_=.5/_,a.y=(this.e01+this.e10)*_,a.z=(this.e02+this.e20)*_,a.w=(this.e21-this.e12)*_):(_=Math.sqrt(i-t-r+1),a.z=.5*_,_=.5/_,a.x=(this.e02+this.e20)*_,a.y=(this.e12+this.e21)*_,a.w=(this.e10-this.e01)*_):r>i?(_=Math.sqrt(r-i-t+1),a.y=.5*_,_=.5/_,a.x=(this.e01+this.e10)*_,a.z=(this.e12+this.e21)*_,a.w=(this.e02-this.e20)*_):(_=Math.sqrt(i-t-r+1),a.z=.5*_,_=.5/_,a.x=(this.e02+this.e20)*_,a.y=(this.e12+this.e21)*_,a.w=(this.e10-this.e01)*_),a}fromEulerXyz(a){var t=Math.sin(a.x),r=Math.sin(a.y),i=Math.sin(a.z),o=Math.cos(a.x),_=Math.cos(a.y),s=Math.cos(a.z),h=_*s,v=-_*i,e=r,l=o*i+s*t*r,u=o*s-t*r*i,b=-_*t,f=t*i-o*s*r,n=s*t+o*r*i,c=o*_;return this.e00=h,this.e01=v,this.e02=e,this.e10=l,this.e11=u,this.e12=b,this.e20=f,this.e21=n,this.e22=c,this}toEulerXyz(){var a=this.e02;if(a<=-1){var t=Math.atan2(this.e21,this.e11);return new x.common.Vec3(t*.5,-1.570796326794895,-t*.5)}if(a>=1){var r=Math.atan2(this.e21,this.e11);return new x.common.Vec3(r*.5,1.570796326794895,r*.5)}var i=Math.asin(a),o=Math.atan2(-this.e12,this.e22),_=Math.atan2(-this.e01,this.e00);return new x.common.Vec3(o,i,_)}getRow(a){return a==0?new x.common.Vec3(this.e00,this.e01,this.e02):a==1?new x.common.Vec3(this.e10,this.e11,this.e12):a==2?new x.common.Vec3(this.e20,this.e21,this.e22):null}getCol(a){return a==0?new x.common.Vec3(this.e00,this.e10,this.e20):a==1?new x.common.Vec3(this.e01,this.e11,this.e21):a==2?new x.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(a,t){a==0?t.init(this.e00,this.e01,this.e02):a==1?t.init(this.e10,this.e11,this.e12):a==2?t.init(this.e20,this.e21,this.e22):t.zero()}getColTo(a,t){a==0?t.init(this.e00,this.e10,this.e20):a==1?t.init(this.e01,this.e11,this.e21):a==2?t.init(this.e02,this.e12,this.e22):t.zero()}fromRows(a,t,r){var i=a.x,o=a.y,_=a.z,s=t.x,h=t.y,v=t.z,e=r.x,l=r.y,u=r.z;return this.e00=i,this.e01=o,this.e02=_,this.e10=s,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}fromCols(a,t,r){var i=a.x,o=t.x,_=r.x,s=a.y,h=t.y,v=r.y,e=a.z,l=t.z,u=r.z;return this.e00=i,this.e01=o,this.e02=_,this.e10=s,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+",\n     "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+",\n     "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};x.common.Mat4=class{constructor(a,t,r,i,o,_,s,h,v,e,l,u,b,f,n,c){c==null&&(c=1),n==null&&(n=0),f==null&&(f=0),b==null&&(b=0),u==null&&(u=0),l==null&&(l=1),e==null&&(e=0),v==null&&(v=0),h==null&&(h=0),s==null&&(s=0),_==null&&(_=1),o==null&&(o=0),i==null&&(i=0),r==null&&(r=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=_,this.e12=s,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,x.common.Mat4.numCreations++}init(a,t,r,i,o,_,s,h,v,e,l,u,b,f,n,c){return this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=_,this.e12=s,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}identity(){var a=1,t=0,r=0,i=0,o=0,_=1,s=0,h=0,v=0,e=0,l=1,u=0,b=0,f=0,n=0,c=1;return this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=_,this.e12=s,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}add(a){return new x.common.Mat4(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e03+a.e03,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e13+a.e13,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22,this.e23+a.e23,this.e30+a.e30,this.e31+a.e31,this.e32+a.e32,this.e33+a.e33)}sub(a){return new x.common.Mat4(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e03-a.e03,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e13-a.e13,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22,this.e23-a.e23,this.e30-a.e30,this.e31-a.e31,this.e32-a.e32,this.e33-a.e33)}scale(a){return new x.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*a,this.e11*a,this.e12*a,this.e13*a,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30*a,this.e31*a,this.e32*a,this.e33*a)}mul(a){return new x.common.Mat4(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33)}addEq(a){var t=this.e00+a.e00,r=this.e01+a.e01,i=this.e02+a.e02,o=this.e03+a.e03,_=this.e10+a.e10,s=this.e11+a.e11,h=this.e12+a.e12,v=this.e13+a.e13,e=this.e20+a.e20,l=this.e21+a.e21,u=this.e22+a.e22,b=this.e23+a.e23,f=this.e30+a.e30,n=this.e31+a.e31,c=this.e32+a.e32,M=this.e33+a.e33;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=_,this.e11=s,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}subEq(a){var t=this.e00-a.e00,r=this.e01-a.e01,i=this.e02-a.e02,o=this.e03-a.e03,_=this.e10-a.e10,s=this.e11-a.e11,h=this.e12-a.e12,v=this.e13-a.e13,e=this.e20-a.e20,l=this.e21-a.e21,u=this.e22-a.e22,b=this.e23-a.e23,f=this.e30-a.e30,n=this.e31-a.e31,c=this.e32-a.e32,M=this.e33-a.e33;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=_,this.e11=s,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}scaleEq(a){var t=this.e00*a,r=this.e01*a,i=this.e02*a,o=this.e03*a,_=this.e10*a,s=this.e11*a,h=this.e12*a,v=this.e13*a,e=this.e20*a,l=this.e21*a,u=this.e22*a,b=this.e23*a,f=this.e30*a,n=this.e31*a,c=this.e32*a,M=this.e33*a;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=_,this.e11=s,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,r=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,i=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,o=this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,_=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,s=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,h=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,v=this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,e=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,l=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,u=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,b=this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,f=this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,n=this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,c=this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,M=this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=_,this.e11=s,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}prependScale(a,t,r){return new x.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*r,this.e21*r,this.e22*r,this.e23*r,this.e30,this.e31,this.e32,this.e33)}appendScale(a,t,r){return new x.common.Mat4(this.e00*a,this.e01*t,this.e02*r,this.e03,this.e10*a,this.e11*t,this.e12*r,this.e13,this.e20*a,this.e21*t,this.e22*r,this.e23,this.e30*a,this.e31*t,this.e32*r,this.e33)}prependRotation(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_;return new x.common.Mat4(h*this.e00+v*this.e10+e*this.e20,h*this.e01+v*this.e11+e*this.e21,h*this.e02+v*this.e12+e*this.e22,h*this.e03+v*this.e13+e*this.e23,l*this.e00+u*this.e10+b*this.e20,l*this.e01+u*this.e11+b*this.e21,l*this.e02+u*this.e12+b*this.e22,l*this.e03+u*this.e13+b*this.e23,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22,f*this.e03+n*this.e13+c*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_;return new x.common.Mat4(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*u+this.e02*n,this.e00*e+this.e01*b+this.e02*c,this.e03,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*u+this.e12*n,this.e10*e+this.e11*b+this.e12*c,this.e13,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*u+this.e22*n,this.e20*e+this.e21*b+this.e22*c,this.e23,this.e30*h+this.e31*l+this.e32*f,this.e30*v+this.e31*u+this.e32*n,this.e30*e+this.e31*b+this.e32*c,this.e33)}prependTranslation(a,t,r){return new x.common.Mat4(this.e00+a*this.e30,this.e01+a*this.e31,this.e02+a*this.e32,this.e03+a*this.e33,this.e10+t*this.e30,this.e11+t*this.e31,this.e12+t*this.e32,this.e13+t*this.e33,this.e20+r*this.e30,this.e21+r*this.e31,this.e22+r*this.e32,this.e23+r*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(a,t,r){return new x.common.Mat4(this.e00,this.e01,this.e02,this.e00*a+this.e01*t+this.e02*r+this.e03,this.e10,this.e11,this.e12,this.e10*a+this.e11*t+this.e12*r+this.e13,this.e20,this.e21,this.e22,this.e20*a+this.e21*t+this.e22*r+this.e23,this.e30,this.e31,this.e32,this.e30*a+this.e31*t+this.e32*r+this.e33)}prependScaleEq(a,t,r){var i=this.e00*a,o=this.e01*a,_=this.e02*a,s=this.e03*a,h=this.e10*t,v=this.e11*t,e=this.e12*t,l=this.e13*t,u=this.e20*r,b=this.e21*r,f=this.e22*r,n=this.e23*r,c=this.e30,M=this.e31,m=this.e32,y=this.e33;return this.e00=i,this.e01=o,this.e02=_,this.e03=s,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}appendScaleEq(a,t,r){var i=this.e00*a,o=this.e01*t,_=this.e02*r,s=this.e03,h=this.e10*a,v=this.e11*t,e=this.e12*r,l=this.e13,u=this.e20*a,b=this.e21*t,f=this.e22*r,n=this.e23,c=this.e30*a,M=this.e31*t,m=this.e32*r,y=this.e33;return this.e00=i,this.e01=o,this.e02=_,this.e03=s,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}prependRotationEq(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_,M=h*this.e00+v*this.e10+e*this.e20,m=h*this.e01+v*this.e11+e*this.e21,y=h*this.e02+v*this.e12+e*this.e22,V=h*this.e03+v*this.e13+e*this.e23,z=l*this.e00+u*this.e10+b*this.e20,I=l*this.e01+u*this.e11+b*this.e21,k=l*this.e02+u*this.e12+b*this.e22,X=l*this.e03+u*this.e13+b*this.e23,L=f*this.e00+n*this.e10+c*this.e20,p=f*this.e01+n*this.e11+c*this.e21,g=f*this.e02+n*this.e12+c*this.e22,N=f*this.e03+n*this.e13+c*this.e23,A=this.e30,F=this.e31,S=this.e32,Y=this.e33;return this.e00=M,this.e01=m,this.e02=y,this.e03=V,this.e10=z,this.e11=I,this.e12=k,this.e13=X,this.e20=L,this.e21=p,this.e22=g,this.e23=N,this.e30=A,this.e31=F,this.e32=S,this.e33=Y,this}appendRotationEq(a,t,r,i){var o=Math.sin(a),_=Math.cos(a),s=1-_,h=t*t*s+_,v=t*r*s-i*o,e=t*i*s+r*o,l=r*t*s+i*o,u=r*r*s+_,b=r*i*s-t*o,f=i*t*s-r*o,n=i*r*s+t*o,c=i*i*s+_,M=this.e00*h+this.e01*l+this.e02*f,m=this.e00*v+this.e01*u+this.e02*n,y=this.e00*e+this.e01*b+this.e02*c,V=this.e03,z=this.e10*h+this.e11*l+this.e12*f,I=this.e10*v+this.e11*u+this.e12*n,k=this.e10*e+this.e11*b+this.e12*c,X=this.e13,L=this.e20*h+this.e21*l+this.e22*f,p=this.e20*v+this.e21*u+this.e22*n,g=this.e20*e+this.e21*b+this.e22*c,N=this.e23,A=this.e30*h+this.e31*l+this.e32*f,F=this.e30*v+this.e31*u+this.e32*n,S=this.e30*e+this.e31*b+this.e32*c,Y=this.e33;return this.e00=M,this.e01=m,this.e02=y,this.e03=V,this.e10=z,this.e11=I,this.e12=k,this.e13=X,this.e20=L,this.e21=p,this.e22=g,this.e23=N,this.e30=A,this.e31=F,this.e32=S,this.e33=Y,this}prependTranslationEq(a,t,r){var i=this.e00+a*this.e30,o=this.e01+a*this.e31,_=this.e02+a*this.e32,s=this.e03+a*this.e33,h=this.e10+t*this.e30,v=this.e11+t*this.e31,e=this.e12+t*this.e32,l=this.e13+t*this.e33,u=this.e20+r*this.e30,b=this.e21+r*this.e31,f=this.e22+r*this.e32,n=this.e23+r*this.e33,c=this.e30,M=this.e31,m=this.e32,y=this.e33;return this.e00=i,this.e01=o,this.e02=_,this.e03=s,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}appendTranslationEq(a,t,r){var i=this.e00,o=this.e01,_=this.e02,s=this.e00*a+this.e01*t+this.e02*r+this.e03,h=this.e10,v=this.e11,e=this.e12,l=this.e10*a+this.e11*t+this.e12*r+this.e13,u=this.e20,b=this.e21,f=this.e22,n=this.e20*a+this.e21*t+this.e22*r+this.e23,c=this.e30,M=this.e31,m=this.e32,y=this.e30*a+this.e31*t+this.e32*r+this.e33;return this.e00=i,this.e01=o,this.e02=_,this.e03=s,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}transpose(){return new x.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){var a=this.e00,t=this.e10,r=this.e20,i=this.e30,o=this.e01,_=this.e11,s=this.e21,h=this.e31,v=this.e02,e=this.e12,l=this.e22,u=this.e32,b=this.e03,f=this.e13,n=this.e23,c=this.e33;return this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=_,this.e12=s,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}determinant(){var a=this.e20*this.e31-this.e21*this.e30,t=this.e20*this.e32-this.e22*this.e30,r=this.e20*this.e33-this.e23*this.e30,i=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,_=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*_-this.e12*o+this.e13*i)-this.e01*(this.e10*_-this.e12*r+this.e13*t)+this.e02*(this.e10*o-this.e11*r+this.e13*a)-this.e03*(this.e10*i-this.e11*t+this.e12*a)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,r=this.e00*this.e13-this.e03*this.e10,i=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,_=this.e02*this.e13-this.e03*this.e12,s=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,b=this.e11*u-this.e12*l+this.e13*e,f=this.e10*u-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*s,c=this.e10*e-this.e11*h+this.e12*s,M=this.e01*u-this.e02*l+this.e03*e,m=this.e00*u-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*s,V=this.e00*e-this.e01*h+this.e02*s,z=this.e31*_-this.e32*o+this.e33*i,I=this.e30*_-this.e32*r+this.e33*t,k=this.e30*o-this.e31*r+this.e33*a,X=this.e30*i-this.e31*t+this.e32*a,L=this.e21*_-this.e22*o+this.e23*i,p=this.e20*_-this.e22*r+this.e23*t,g=this.e20*o-this.e21*r+this.e23*a,N=this.e20*i-this.e21*t+this.e22*a,A=this.e00*b-this.e01*f+this.e02*n-this.e03*c;return A!=0&&(A=1/A),new x.common.Mat4(b*A,-M*A,z*A,-L*A,-f*A,m*A,-I*A,p*A,n*A,-y*A,k*A,-g*A,-c*A,V*A,-X*A,N*A)}inverseEq(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,r=this.e00*this.e13-this.e03*this.e10,i=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,_=this.e02*this.e13-this.e03*this.e12,s=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,b=this.e11*u-this.e12*l+this.e13*e,f=this.e10*u-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*s,c=this.e10*e-this.e11*h+this.e12*s,M=this.e01*u-this.e02*l+this.e03*e,m=this.e00*u-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*s,V=this.e00*e-this.e01*h+this.e02*s,z=this.e31*_-this.e32*o+this.e33*i,I=this.e30*_-this.e32*r+this.e33*t,k=this.e30*o-this.e31*r+this.e33*a,X=this.e30*i-this.e31*t+this.e32*a,L=this.e21*_-this.e22*o+this.e23*i,p=this.e20*_-this.e22*r+this.e23*t,g=this.e20*o-this.e21*r+this.e23*a,N=this.e20*i-this.e21*t+this.e22*a,A=this.e00*b-this.e01*f+this.e02*n-this.e03*c;A!=0&&(A=1/A);var F=b*A,S=-M*A,Y=z*A,R=-L*A,C=-f*A,d=m*A,Z=-I*A,$=p*A,j=n*A,E=-y*A,G=k*A,B=-g*A,Q=-c*A,U=V*A,J=-X*A,D=N*A;return this.e00=F,this.e01=S,this.e02=Y,this.e03=R,this.e10=C,this.e11=d,this.e12=Z,this.e13=$,this.e20=j,this.e21=E,this.e22=G,this.e23=B,this.e30=Q,this.e31=U,this.e32=J,this.e33=D,this}lookAt(a,t,r,i,o,_,s,h,v){var e=a-i,l=t-o,u=r-_,b=1/Math.sqrt(e*e+l*l+u*u);e*=b,l*=b,u*=b;var f=h*u-v*l,n=v*e-s*u,c=s*l-h*e;b=1/Math.sqrt(f*f+n*n+c*c),f*=b,n*=b,c*=b;var M=l*c-u*n,m=u*f-e*c,y=e*n-l*f;return this.e00=f,this.e01=n,this.e02=c,this.e03=-(f*a+n*t+c*r),this.e10=M,this.e11=m,this.e12=y,this.e13=-(M*a+m*t+y*r),this.e20=e,this.e21=l,this.e22=u,this.e23=-(e*a+l*t+u*r),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(a,t,r,i){var o=1/Math.tan(a*.5),_=i/(r-i);return this.e00=o/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=_,this.e23=r*_,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(a,t,r,i){var o=1/(r-i);return this.e00=2/a,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/t,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=r*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e03=a.e03,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e13=a.e13,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this.e23=a.e23,this.e30=a.e30,this.e31=a.e31,this.e32=a.e32,this.e33=a.e33,this}fromMat3(a){var t=a.e00,r=a.e01,i=a.e02,o=0,_=a.e10,s=a.e11,h=a.e12,v=0,e=a.e20,l=a.e21,u=a.e22,b=0,f=0,n=0,c=0,M=1;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=_,this.e11=s,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}fromTransform(a){var t=this;return t.e00=a._rotation00,t.e01=a._rotation01,t.e02=a._rotation02,t.e10=a._rotation10,t.e11=a._rotation11,t.e12=a._rotation12,t.e20=a._rotation20,t.e21=a._rotation21,t.e22=a._rotation22,t.e03=a._positionX,t.e13=a._positionY,t.e23=a._positionZ,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this}clone(){return new x.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+",\n    "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+",\n    "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+",\n    "+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};x.common.MathUtil=class{static abs(a){return a>0?a:-a}static sin(a){return Math.sin(a)}static cos(a){return Math.cos(a)}static tan(a){return Math.tan(a)}static asin(a){return Math.asin(a)}static acos(a){return Math.acos(a)}static atan(a){return Math.atan(a)}static safeAsin(a){return a<=-1?-1.570796326794895:a>=1?1.570796326794895:Math.asin(a)}static safeAcos(a){return a<=-1?3.14159265358979:a>=1?0:Math.acos(a)}static atan2(a,t){return Math.atan2(a,t)}static sqrt(a){return Math.sqrt(a)}static clamp(a,t,r){return a<t?t:a>r?r:a}static rand(){return Math.random()}static randIn(a,t){return a+Math.random()*(t-a)}static randVec3In(a,t){return new x.common.Vec3(a+Math.random()*(t-a),a+Math.random()*(t-a),a+Math.random()*(t-a))}static randVec3(){return new x.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};x.common.Pool=class{constructor(){var a=new Array(256);this.stackVec3=a,this.sizeVec3=0;var t=new Array(256);this.stackMat3=t,this.sizeMat3=0;var r=new Array(256);this.stackMat4=r,this.sizeMat4=0;var i=new Array(256);this.stackQuat=i,this.sizeQuat=0}vec3(){return this.sizeVec3==0?new x.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new x.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new x.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new x.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(a,t,r,i){if(a!=null){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var o=this.sizeVec3<<1,_=new Array(o),s=_,h=0,v=this.sizeVec3;h<v;){var e=h++;s[e]=this.stackVec3[e],this.stackVec3[e]=null}this.stackVec3=s}this.stackVec3[this.sizeVec3++]=a}if(t!=null){var l=1,u=0,b=0,f=0,n=1,c=0,M=0,m=0,y=1;if(t.e00=l,t.e01=u,t.e02=b,t.e10=f,t.e11=n,t.e12=c,t.e20=M,t.e21=m,t.e22=y,this.sizeMat3==this.stackMat3.length){for(var V=this.sizeMat3<<1,z=new Array(V),I=z,k=0,X=this.sizeMat3;k<X;){var L=k++;I[L]=this.stackMat3[L],this.stackMat3[L]=null}this.stackMat3=I}this.stackMat3[this.sizeMat3++]=t}if(r!=null){var p=1,g=0,N=0,A=0,F=0,S=1,Y=0,R=0,C=0,d=0,Z=1,$=0,j=0,E=0,G=0,B=1;if(r.e00=p,r.e01=g,r.e02=N,r.e03=A,r.e10=F,r.e11=S,r.e12=Y,r.e13=R,r.e20=C,r.e21=d,r.e22=Z,r.e23=$,r.e30=j,r.e31=E,r.e32=G,r.e33=B,this.sizeMat4==this.stackMat4.length){for(var Q=this.sizeMat4<<1,U=new Array(Q),J=U,D=0,H=this.sizeMat4;D<H;){var K=D++;J[K]=this.stackMat4[K],this.stackMat4[K]=null}this.stackMat4=J}this.stackMat4[this.sizeMat4++]=r}if(i!=null){var ra=0,sa=0,W=0,q=1;if(i.x=ra,i.y=sa,i.z=W,i.w=q,this.sizeQuat==this.stackQuat.length){for(var na=this.sizeQuat<<1,oa=new Array(na),aa=oa,T=0,ca=this.sizeQuat;T<ca;){var _a=T++;aa[_a]=this.stackQuat[_a],this.stackQuat[_a]=null}this.stackQuat=aa}this.stackQuat[this.sizeQuat++]=i}}disposeVec3(a){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var t=this.sizeVec3<<1,r=new Array(t),i=r,o=0,_=this.sizeVec3;o<_;){var s=o++;i[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=i}this.stackVec3[this.sizeVec3++]=a}disposeMat3(a){var t=1,r=0,i=0,o=0,_=1,s=0,h=0,v=0,e=1;if(a.e00=t,a.e01=r,a.e02=i,a.e10=o,a.e11=_,a.e12=s,a.e20=h,a.e21=v,a.e22=e,this.sizeMat3==this.stackMat3.length){for(var l=this.sizeMat3<<1,u=new Array(l),b=u,f=0,n=this.sizeMat3;f<n;){var c=f++;b[c]=this.stackMat3[c],this.stackMat3[c]=null}this.stackMat3=b}this.stackMat3[this.sizeMat3++]=a}disposeMat4(a){var t=1,r=0,i=0,o=0,_=0,s=1,h=0,v=0,e=0,l=0,u=1,b=0,f=0,n=0,c=0,M=1;if(a.e00=t,a.e01=r,a.e02=i,a.e03=o,a.e10=_,a.e11=s,a.e12=h,a.e13=v,a.e20=e,a.e21=l,a.e22=u,a.e23=b,a.e30=f,a.e31=n,a.e32=c,a.e33=M,this.sizeMat4==this.stackMat4.length){for(var m=this.sizeMat4<<1,y=new Array(m),V=y,z=0,I=this.sizeMat4;z<I;){var k=z++;V[k]=this.stackMat4[k],this.stackMat4[k]=null}this.stackMat4=V}this.stackMat4[this.sizeMat4++]=a}disposeQuat(a){var t=0,r=0,i=0,o=1;if(a.x=t,a.y=r,a.z=i,a.w=o,this.sizeQuat==this.stackQuat.length){for(var _=this.sizeQuat<<1,s=new Array(_),h=s,v=0,e=this.sizeQuat;v<e;){var l=v++;h[l]=this.stackQuat[l],this.stackQuat[l]=null}this.stackQuat=h}this.stackQuat[this.sizeQuat++]=a}};x.common.Quat=class{constructor(a,t,r,i){i==null&&(i=1),r==null&&(r=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=r,this.w=i,x.common.Quat.numCreations++}identity(){var a=0,t=0,r=0,i=1;return this.x=a,this.y=t,this.z=r,this.w=i,this}init(a,t,r,i){return this.x=a,this.y=t,this.z=r,this.w=i,this}add(a){return new x.common.Quat(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)}sub(a){return new x.common.Quat(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)}scale(a){return new x.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}addEq(a){var t=this.x+a.x,r=this.y+a.y,i=this.z+a.z,o=this.w+a.w;return this.x=t,this.y=r,this.z=i,this.w=o,this}subEq(a){var t=this.x-a.x,r=this.y-a.y,i=this.z-a.z,o=this.w-a.w;return this.x=t,this.y=r,this.z=i,this.w=o,this}scaleEq(a){var t=this.x*a,r=this.y*a,i=this.z*a,o=this.w*a;return this.x=t,this.y=r,this.z=i,this.w=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return a>0&&(a=1/a),new x.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a>0&&(a=1/a);var t=this.x*a,r=this.y*a,i=this.z*a,o=this.w*a;return this.x=t,this.y=r,this.z=i,this.w=o,this}setArc(a,t){var r=a.x,i=a.y,o=a.z,_=t.x,s=t.y,h=t.z,v=r*_+i*s+o*h;if(this.w=Math.sqrt((1+v)*.5),this.w==0)return _=r*r,s=i*i,h=o*o,_<s?_<h?(v=1/Math.sqrt(s+h),this.x=0,this.y=o*v,this.z=-i*v):(v=1/Math.sqrt(_+s),this.z=0,this.x=i*v,this.y=-r*v):s<h?(v=1/Math.sqrt(h+_),this.y=0,this.z=r*v,this.x=-o*v):(v=1/Math.sqrt(_+s),this.z=0,this.x=i*v,this.y=-r*v),this;v=.5/this.w;var e=i*h-o*s,l=o*_-r*h,u=r*s-i*_;return this.x=e*v,this.y=l*v,this.z=u*v,this}slerp(a,t){var r,i,o,_,s=this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w;if(s<0?(s=-s,r=-a.x,i=-a.y,o=-a.z,_=-a.w):(r=a.x,i=a.y,o=a.z,_=a.w),s>.999999){var h=new x.common.Quat(this.x+(r-this.x)*t,this.y+(i-this.y)*t,this.z+(o-this.z)*t,this.w+(_-this.w)*t),v=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z+h.w*h.w);v>0&&(v=1/v);var e=h.x*v,l=h.y*v,u=h.z*v,b=h.w*v;return h.x=e,h.y=l,h.z=u,h.w=b,h}var f=t*Math.acos(s);r-=this.x*s,i-=this.y*s,o-=this.z*s,_-=this.w*s;var n=1/Math.sqrt(r*r+i*i+o*o+_*_);r*=n,i*=n,o*=n,_*=n;var c=Math.sin(f),M=Math.cos(f);return new x.common.Quat(this.x*M+r*c,this.y*M+i*c,this.z*M+o*c,this.w*M+_*c)}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}clone(){return new x.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(a){var t=a.e00,r=a.e11,i=a.e22,o=t+r+i,_;return o>0?(_=Math.sqrt(o+1),this.w=.5*_,_=.5/_,this.x=(a.e21-a.e12)*_,this.y=(a.e02-a.e20)*_,this.z=(a.e10-a.e01)*_):t>r?t>i?(_=Math.sqrt(t-r-i+1),this.x=.5*_,_=.5/_,this.y=(a.e01+a.e10)*_,this.z=(a.e02+a.e20)*_,this.w=(a.e21-a.e12)*_):(_=Math.sqrt(i-t-r+1),this.z=.5*_,_=.5/_,this.x=(a.e02+a.e20)*_,this.y=(a.e12+a.e21)*_,this.w=(a.e10-a.e01)*_):r>i?(_=Math.sqrt(r-i-t+1),this.y=.5*_,_=.5/_,this.x=(a.e01+a.e10)*_,this.z=(a.e12+a.e21)*_,this.w=(a.e02-a.e20)*_):(_=Math.sqrt(i-t-r+1),this.z=.5*_,_=.5/_,this.x=(a.e02+a.e20)*_,this.y=(a.e12+a.e21)*_,this.w=(a.e10-a.e01)*_),this}toMat3(){var a=new x.common.Mat3,t=this.x,r=this.y,i=this.z,o=this.w,_=2*t,s=2*r,h=2*i,v=t*_,e=r*s,l=i*h,u=t*s,b=r*h,f=t*h,n=o*_,c=o*s,M=o*h;return a.e00=1-e-l,a.e01=u-M,a.e02=f+c,a.e10=u+M,a.e11=1-v-l,a.e12=b-n,a.e20=f-c,a.e21=b+n,a.e22=1-v-e,a}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+" i,\n    "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+" j,\n    "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+" k,\n    "+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};x.dynamics||(x.dynamics={});x.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new x.dynamics.ContactLink,this._link2=new x.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new x.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new x.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new x.dynamics.constraint.contact.Manifold,this._updater=new x.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new x.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector!=null){var a=this._touching,t=this._detectorResult;this._detector.detect(t,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var r=t.numPoints;if(this._touching=r>0,this._touching?(this._manifold._buildBasis(t.normal),t.getMaxDepth()>x.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=x.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=x.common.Setting.defaultContactPositionCorrectionAlgorithm,t.incremental?this._updater.incrementalUpdate(t,this._b1._transform,this._b2._transform):this._updater.totalUpdate(t,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!a){var i=this._s1._contactCallback,o=this._s2._contactCallback;i==o&&(o=null),i!=null&&i.beginContact(this),o!=null&&o.beginContact(this)}if(!this._touching&&a){var _=this._s1._contactCallback,s=this._s2._contactCallback;_==s&&(s=null),_!=null&&_.endContact(this),s!=null&&s.endContact(this)}if(this._touching){var h=this._s1._contactCallback,v=this._s2._contactCallback;h==v&&(v=null),h!=null&&h.preSolve(this),v!=null&&v.preSolve(this)}}}_postSolve(){var a=this._s1._contactCallback,t=this._s2._contactCallback;a==t&&(t=null),a!=null&&a.postSolve(this),t!=null&&t.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.ContactManager=class{constructor(a){this._broadPhase=a,this._collisionMatrix=new x.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){for(var a=this._broadPhase._proxyPairList;a!=null;){for(var t=a._next;;){var r,i;if(a._p1._id<a._p2._id?(r=a._p1.userData,i=a._p2.userData):(r=a._p2.userData,i=a._p1.userData),!this.shouldCollide(r,i))break;var o=r._rigidBody,_=i._rigidBody,s=o._numContactLinks,h=_._numContactLinks,v;s<h?v=o._contactLinkList:v=_._contactLinkList;for(var e=r._id,l=i._id,u=!1;v!=null;){var b=v._next,f=v._contact;if(f._s1._id==e&&f._s2._id==l){f._latest=!0,u=!0;break}v=b}if(!u){var n=this._contactPool;n!=null?(this._contactPool=n._next,n._next=null):n=new x.dynamics.Contact;var c=n;this._contactList==null?(this._contactList=c,this._contactListLast=c):(this._contactListLast._next=c,c._prev=this._contactListLast,this._contactListLast=c),c._latest=!0;var M=this._collisionMatrix.detectors[r._geom._type][i._geom._type];c._s1=r,c._s2=i,c._b1=r._rigidBody,c._b2=i._rigidBody,c._touching=!1,c._b1._contactLinkList==null?(c._b1._contactLinkList=c._link1,c._b1._contactLinkListLast=c._link1):(c._b1._contactLinkListLast._next=c._link1,c._link1._prev=c._b1._contactLinkListLast,c._b1._contactLinkListLast=c._link1),c._b2._contactLinkList==null?(c._b2._contactLinkList=c._link2,c._b2._contactLinkListLast=c._link2):(c._b2._contactLinkListLast._next=c._link2,c._link2._prev=c._b2._contactLinkListLast,c._b2._contactLinkListLast=c._link2),c._b1._numContactLinks++,c._b2._numContactLinks++,c._link1._other=c._b2,c._link2._other=c._b1,c._link1._contact=c,c._link2._contact=c,c._detector=M;var m=c._contactConstraint;m._s1=r,m._s2=i,m._b1=m._s1._rigidBody,m._b2=m._s2._rigidBody,m._tf1=m._b1._transform,m._tf2=m._b2._transform,this._numContacts++}break}a=t}}destroyOutdatedContacts(){for(var a=this._broadPhase._incremental,t=this._contactList;t!=null;){for(var r=t._next;;){if(t._latest){t._latest=!1,t._shouldBeSkipped=!1;break}if(!a){var i=t._prev,o=t._next;if(i!=null&&(i._next=o),o!=null&&(o._prev=i),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var _=t._s1._contactCallback,s=t._s2._contactCallback;_==s&&(s=null),_!=null&&_.endContact(t),s!=null&&s.endContact(t)}var h=t._link1._prev,v=t._link1._next;h!=null&&(h._next=v),v!=null&&(v._prev=h),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var e=t._link2._prev,l=t._link2._next;e!=null&&(e._next=l),l!=null&&(l._prev=e),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var u=t._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var b=t._s1,f=t._s2,n=b._rigidBody,c=f._rigidBody,M=!n._sleeping&&n._type!=1,m=!c._sleeping&&c._type!=1;if(!M&&!m){t._shouldBeSkipped=!0;break}var y=b._aabb,V=f._aabb,z=b._proxy,I=f._proxy;if(!(z._aabbMinX<I._aabbMaxX&&z._aabbMaxX>I._aabbMinX&&z._aabbMinY<I._aabbMaxY&&z._aabbMaxY>I._aabbMinY&&z._aabbMinZ<I._aabbMaxZ&&z._aabbMaxZ>I._aabbMinZ)||!this.shouldCollide(b,f)){var k=t._prev,X=t._next;if(k!=null&&(k._next=X),X!=null&&(X._prev=k),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var L=t._s1._contactCallback,p=t._s2._contactCallback;L==p&&(p=null),L!=null&&L.endContact(t),p!=null&&p.endContact(t)}var g=t._link1._prev,N=t._link1._next;g!=null&&(g._next=N),N!=null&&(N._prev=g),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var A=t._link2._prev,F=t._link2._next;A!=null&&(A._next=F),F!=null&&(F._prev=A),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var S=t._contactConstraint;S._s1=null,S._s2=null,S._b1=null,S._b2=null,S._tf1=null,S._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var Y=y._minX<V._maxX&&y._maxX>V._minX&&y._minY<V._maxY&&y._maxY>V._minY&&y._minZ<V._maxZ&&y._maxZ>V._minZ;t._shouldBeSkipped=!Y;break}t=r}}shouldCollide(a,t){var r=a._rigidBody,i=t._rigidBody;if(r==i||r._type!=0&&i._type!=0||!(a._collisionGroup&t._collisionMask)||!(t._collisionGroup&a._collisionMask))return!1;var o,_;for(r._numJointLinks<i._numJointLinks?(o=r._jointLinkList,_=i):(o=i._jointLinkList,_=r);o!=null;){var s=o._next;if(o._other==_&&!o._joint._allowCollision)return!1;o=s}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){for(var a=this._contactList;a!=null;){var t=a._next;a._touching&&a._postSolve(),a=t}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};x.dynamics.Island=class{constructor(){var a=new Array(x.common.Setting.islandInitialRigidBodyArraySize);this.rigidBodies=a;var t=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solvers=t;var r=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solversSi=r;var i=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solversNgs=i,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(a){if(this.numRigidBodies==this.rigidBodies.length){for(var t=this.numRigidBodies<<1,r=new Array(t),i=r,o=0,_=this.numRigidBodies;o<_;){var s=o++;i[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=i}a._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=a}_addConstraintSolver(a,t){if(this.numSolvers==this.solvers.length){for(var r=this.numSolvers<<1,i=new Array(r),o=i,_=0,s=this.numSolvers;_<s;){var h=_++;o[h]=this.solvers[h],this.solvers[h]=null}this.solvers=o}if(a._addedToIsland=!0,this.solvers[this.numSolvers++]=a,t==x.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var v=this.numSolversSi<<1,e=new Array(v),l=e,u=0,b=this.numSolversSi;u<b;){var f=u++;l[f]=this.solversSi[f],this.solversSi[f]=null}this.solversSi=l}this.solversSi[this.numSolversSi++]=a}if(t==x.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var n=this.numSolversNgs<<1,c=new Array(n),M=c,m=0,y=this.numSolversNgs;m<y;){var V=m++;M[V]=this.solversNgs[V],this.solversNgs[V]=null}this.solversNgs=M}this.solversNgs[this.numSolversNgs++]=a}}_stepSingleRigidBody(a,t){var r=a.dt,i=t._ptransform,o=t._transform;if(i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<x.common.Setting.sleepingVelocityThreshold*x.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<x.common.Setting.sleepingAngularVelocityThreshold*x.common.Setting.sleepingAngularVelocityThreshold?(t._sleepTime+=r,t._sleepTime>x.common.Setting.sleepingTimeThreshold&&(t._sleeping=!0,t._sleepTime=0)):t._sleepTime=0,!t._sleeping){if(t._type==0){var _=r*t._linearDamping,s=_*_,h=1/(1+_+s*(.5+_*.16666666666666666+s*.041666666666666664)),v=r*t._angularDamping,e=v*v,l=1/(1+v+e*(.5+v*.16666666666666666+e*.041666666666666664)),u,b,f,n,c,M;u=this.gravityX*t._gravityScale,b=this.gravityY*t._gravityScale,f=this.gravityZ*t._gravityScale,u+=t._forceX*t._invMass,b+=t._forceY*t._invMass,f+=t._forceZ*t._invMass;var m,y,V;m=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,y=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,V=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=m,c=y,M=V,t._velX+=u*r,t._velY+=b*r,t._velZ+=f*r,t._velX*=h,t._velY*=h,t._velZ*=h,t._angVelX+=n*r,t._angVelY+=c*r,t._angVelZ+=M*r,t._angVelX*=l,t._angVelY*=l,t._angVelZ*=l}t._integrate(r);for(var z=t._shapeList;z!=null;){var I=z._next,k=z._ptransform,X=z._localTransform,L=t._ptransform,p,g,N,A,F,S,Y,R,C;p=L._rotation00*X._rotation00+L._rotation01*X._rotation10+L._rotation02*X._rotation20,g=L._rotation00*X._rotation01+L._rotation01*X._rotation11+L._rotation02*X._rotation21,N=L._rotation00*X._rotation02+L._rotation01*X._rotation12+L._rotation02*X._rotation22,A=L._rotation10*X._rotation00+L._rotation11*X._rotation10+L._rotation12*X._rotation20,F=L._rotation10*X._rotation01+L._rotation11*X._rotation11+L._rotation12*X._rotation21,S=L._rotation10*X._rotation02+L._rotation11*X._rotation12+L._rotation12*X._rotation22,Y=L._rotation20*X._rotation00+L._rotation21*X._rotation10+L._rotation22*X._rotation20,R=L._rotation20*X._rotation01+L._rotation21*X._rotation11+L._rotation22*X._rotation21,C=L._rotation20*X._rotation02+L._rotation21*X._rotation12+L._rotation22*X._rotation22,k._rotation00=p,k._rotation01=g,k._rotation02=N,k._rotation10=A,k._rotation11=F,k._rotation12=S,k._rotation20=Y,k._rotation21=R,k._rotation22=C;var d,Z,$;d=L._rotation00*X._positionX+L._rotation01*X._positionY+L._rotation02*X._positionZ,Z=L._rotation10*X._positionX+L._rotation11*X._positionY+L._rotation12*X._positionZ,$=L._rotation20*X._positionX+L._rotation21*X._positionY+L._rotation22*X._positionZ,k._positionX=d,k._positionY=Z,k._positionZ=$,k._positionX+=L._positionX,k._positionY+=L._positionY,k._positionZ+=L._positionZ;var j=z._transform,E=z._localTransform,G=t._transform,B,Q,U,J,D,H,K,ra,sa;B=G._rotation00*E._rotation00+G._rotation01*E._rotation10+G._rotation02*E._rotation20,Q=G._rotation00*E._rotation01+G._rotation01*E._rotation11+G._rotation02*E._rotation21,U=G._rotation00*E._rotation02+G._rotation01*E._rotation12+G._rotation02*E._rotation22,J=G._rotation10*E._rotation00+G._rotation11*E._rotation10+G._rotation12*E._rotation20,D=G._rotation10*E._rotation01+G._rotation11*E._rotation11+G._rotation12*E._rotation21,H=G._rotation10*E._rotation02+G._rotation11*E._rotation12+G._rotation12*E._rotation22,K=G._rotation20*E._rotation00+G._rotation21*E._rotation10+G._rotation22*E._rotation20,ra=G._rotation20*E._rotation01+G._rotation21*E._rotation11+G._rotation22*E._rotation21,sa=G._rotation20*E._rotation02+G._rotation21*E._rotation12+G._rotation22*E._rotation22,j._rotation00=B,j._rotation01=Q,j._rotation02=U,j._rotation10=J,j._rotation11=D,j._rotation12=H,j._rotation20=K,j._rotation21=ra,j._rotation22=sa;var W,q,na;W=G._rotation00*E._positionX+G._rotation01*E._positionY+G._rotation02*E._positionZ,q=G._rotation10*E._positionX+G._rotation11*E._positionY+G._rotation12*E._positionZ,na=G._rotation20*E._positionX+G._rotation21*E._positionY+G._rotation22*E._positionZ,j._positionX=W,j._positionY=q,j._positionZ=na,j._positionX+=G._positionX,j._positionY+=G._positionY,j._positionZ+=G._positionZ;var oa,aa,T,ca,_a,w;if(z._geom._computeAabb(z._aabb,z._ptransform),oa=z._aabb._minX,aa=z._aabb._minY,T=z._aabb._minZ,ca=z._aabb._maxX,_a=z._aabb._maxY,w=z._aabb._maxZ,z._geom._computeAabb(z._aabb,z._transform),z._aabb._minX=oa<z._aabb._minX?oa:z._aabb._minX,z._aabb._minY=aa<z._aabb._minY?aa:z._aabb._minY,z._aabb._minZ=T<z._aabb._minZ?T:z._aabb._minZ,z._aabb._maxX=ca>z._aabb._maxX?ca:z._aabb._maxX,z._aabb._maxY=_a>z._aabb._maxY?_a:z._aabb._maxY,z._aabb._maxZ=w>z._aabb._maxZ?w:z._aabb._maxZ,z._proxy!=null){var ta,ia,la;ta=z._transform._positionX-z._ptransform._positionX,ia=z._transform._positionY-z._ptransform._positionY,la=z._transform._positionZ-z._ptransform._positionZ;var va=z.displacement;va.x=ta,va.y=ia,va.z=la,z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=I}}}_step(a,t,r){for(var i=a.dt,o=!0,_=0,s=this.numRigidBodies;_<s;){var h=_++,v=this.rigidBodies[h],e=v._ptransform,l=v._transform;if(e._positionX=l._positionX,e._positionY=l._positionY,e._positionZ=l._positionZ,e._rotation00=l._rotation00,e._rotation01=l._rotation01,e._rotation02=l._rotation02,e._rotation10=l._rotation10,e._rotation11=l._rotation11,e._rotation12=l._rotation12,e._rotation20=l._rotation20,e._rotation21=l._rotation21,e._rotation22=l._rotation22,v._linearContactImpulseX=0,v._linearContactImpulseY=0,v._linearContactImpulseZ=0,v._angularContactImpulseX=0,v._angularContactImpulseY=0,v._angularContactImpulseZ=0,v._sleeping=!1,v._autoSleep&&v._velX*v._velX+v._velY*v._velY+v._velZ*v._velZ<x.common.Setting.sleepingVelocityThreshold*x.common.Setting.sleepingVelocityThreshold&&v._angVelX*v._angVelX+v._angVelY*v._angVelY+v._angVelZ*v._angVelZ<x.common.Setting.sleepingAngularVelocityThreshold*x.common.Setting.sleepingAngularVelocityThreshold?v._sleepTime+=i:v._sleepTime=0,v._sleepTime<x.common.Setting.sleepingTimeThreshold&&(o=!1),v._type==0){var u=i*v._linearDamping,b=u*u,f=1/(1+u+b*(.5+u*.16666666666666666+b*.041666666666666664)),n=i*v._angularDamping,c=n*n,M=1/(1+n+c*(.5+n*.16666666666666666+c*.041666666666666664)),m,y,V,z,I,k;m=this.gravityX*v._gravityScale,y=this.gravityY*v._gravityScale,V=this.gravityZ*v._gravityScale,m+=v._forceX*v._invMass,y+=v._forceY*v._invMass,V+=v._forceZ*v._invMass;var X,L,p;X=v._invInertia00*v._torqueX+v._invInertia01*v._torqueY+v._invInertia02*v._torqueZ,L=v._invInertia10*v._torqueX+v._invInertia11*v._torqueY+v._invInertia12*v._torqueZ,p=v._invInertia20*v._torqueX+v._invInertia21*v._torqueY+v._invInertia22*v._torqueZ,z=X,I=L,k=p,v._velX+=m*i,v._velY+=y*i,v._velZ+=V*i,v._velX*=f,v._velY*=f,v._velZ*=f,v._angVelX+=z*i,v._angVelY+=I*i,v._angVelZ+=k*i,v._angVelX*=M,v._angVelY*=M,v._angVelZ*=M}}if(o){for(var g=0,N=this.numRigidBodies;g<N;){var A=g++,F=this.rigidBodies[A];F._sleeping=!0,F._sleepTime=0}return}for(var S=0,Y=this.numSolvers;S<Y;){var R=S++,C=this.solvers[R];C.preSolveVelocity(a)}for(var d=0,Z=this.numSolvers;d<Z;){var $=d++,j=this.solvers[$];j.warmStart(a)}for(var E=0,G=t;E<G;){E++;for(var B=0,Q=this.numSolvers;B<Q;){var U=B++,J=this.solvers[U];J.solveVelocity()}}for(var D=0,H=this.numSolvers;D<H;){var K=D++,ra=this.solvers[K];ra.postSolveVelocity(a)}for(var sa=0,W=this.numRigidBodies;sa<W;){var q=sa++,na=this.rigidBodies[q];na._integrate(i)}for(var oa=0,aa=this.numSolversSi;oa<aa;){var T=oa++,ca=this.solversSi[T];ca.preSolvePosition(a)}for(var _a=0,w=r;_a<w;){_a++;for(var ta=0,ia=this.numSolversSi;ta<ia;){var la=ta++,va=this.solversSi[la];va.solvePositionSplitImpulse()}}for(var xa=0,Ma=this.numRigidBodies;xa<Ma;){var za=xa++,Xa=this.rigidBodies[za];Xa._integratePseudoVelocity()}for(var Za=0,fa=this.numSolversNgs;Za<fa;){var ba=Za++,ea=this.solversNgs[ba];ea.preSolvePosition(a)}for(var ha=0,pa=r;ha<pa;){ha++;for(var ya=0,da=this.numSolversNgs;ya<da;){var ma=ya++,Ya=this.solversNgs[ma];Ya.solvePositionNgs(a)}}for(var Qa=0,ga=this.numSolvers;Qa<ga;){var ua=Qa++,wa=this.solvers[ua];wa.postSolve()}for(var ka=0,Pa=this.numRigidBodies;ka<Pa;)for(var Mt=ka++,Ha=this.rigidBodies[Mt],Ba=Ha._shapeList;Ba!=null;){var nt=Ba._next,Ea=Ba._ptransform,Fa=Ba._localTransform,Aa=Ha._ptransform,ft,Ua,ja,bt,rt,$a,_t,gt,mt;ft=Aa._rotation00*Fa._rotation00+Aa._rotation01*Fa._rotation10+Aa._rotation02*Fa._rotation20,Ua=Aa._rotation00*Fa._rotation01+Aa._rotation01*Fa._rotation11+Aa._rotation02*Fa._rotation21,ja=Aa._rotation00*Fa._rotation02+Aa._rotation01*Fa._rotation12+Aa._rotation02*Fa._rotation22,bt=Aa._rotation10*Fa._rotation00+Aa._rotation11*Fa._rotation10+Aa._rotation12*Fa._rotation20,rt=Aa._rotation10*Fa._rotation01+Aa._rotation11*Fa._rotation11+Aa._rotation12*Fa._rotation21,$a=Aa._rotation10*Fa._rotation02+Aa._rotation11*Fa._rotation12+Aa._rotation12*Fa._rotation22,_t=Aa._rotation20*Fa._rotation00+Aa._rotation21*Fa._rotation10+Aa._rotation22*Fa._rotation20,gt=Aa._rotation20*Fa._rotation01+Aa._rotation21*Fa._rotation11+Aa._rotation22*Fa._rotation21,mt=Aa._rotation20*Fa._rotation02+Aa._rotation21*Fa._rotation12+Aa._rotation22*Fa._rotation22,Ea._rotation00=ft,Ea._rotation01=Ua,Ea._rotation02=ja,Ea._rotation10=bt,Ea._rotation11=rt,Ea._rotation12=$a,Ea._rotation20=_t,Ea._rotation21=gt,Ea._rotation22=mt;var Wa,it,ut;Wa=Aa._rotation00*Fa._positionX+Aa._rotation01*Fa._positionY+Aa._rotation02*Fa._positionZ,it=Aa._rotation10*Fa._positionX+Aa._rotation11*Fa._positionY+Aa._rotation12*Fa._positionZ,ut=Aa._rotation20*Fa._positionX+Aa._rotation21*Fa._positionY+Aa._rotation22*Fa._positionZ,Ea._positionX=Wa,Ea._positionY=it,Ea._positionZ=ut,Ea._positionX+=Aa._positionX,Ea._positionY+=Aa._positionY,Ea._positionZ+=Aa._positionZ;var Da=Ba._transform,Ta=Ba._localTransform,Na=Ha._transform,Vt,Pt,et,Xt,Yt,zt,Ia,O,Va;Vt=Na._rotation00*Ta._rotation00+Na._rotation01*Ta._rotation10+Na._rotation02*Ta._rotation20,Pt=Na._rotation00*Ta._rotation01+Na._rotation01*Ta._rotation11+Na._rotation02*Ta._rotation21,et=Na._rotation00*Ta._rotation02+Na._rotation01*Ta._rotation12+Na._rotation02*Ta._rotation22,Xt=Na._rotation10*Ta._rotation00+Na._rotation11*Ta._rotation10+Na._rotation12*Ta._rotation20,Yt=Na._rotation10*Ta._rotation01+Na._rotation11*Ta._rotation11+Na._rotation12*Ta._rotation21,zt=Na._rotation10*Ta._rotation02+Na._rotation11*Ta._rotation12+Na._rotation12*Ta._rotation22,Ia=Na._rotation20*Ta._rotation00+Na._rotation21*Ta._rotation10+Na._rotation22*Ta._rotation20,O=Na._rotation20*Ta._rotation01+Na._rotation21*Ta._rotation11+Na._rotation22*Ta._rotation21,Va=Na._rotation20*Ta._rotation02+Na._rotation21*Ta._rotation12+Na._rotation22*Ta._rotation22,Da._rotation00=Vt,Da._rotation01=Pt,Da._rotation02=et,Da._rotation10=Xt,Da._rotation11=Yt,Da._rotation12=zt,Da._rotation20=Ia,Da._rotation21=O,Da._rotation22=Va;var lt,P,wt;lt=Na._rotation00*Ta._positionX+Na._rotation01*Ta._positionY+Na._rotation02*Ta._positionZ,P=Na._rotation10*Ta._positionX+Na._rotation11*Ta._positionY+Na._rotation12*Ta._positionZ,wt=Na._rotation20*Ta._positionX+Na._rotation21*Ta._positionY+Na._rotation22*Ta._positionZ,Da._positionX=lt,Da._positionY=P,Da._positionZ=wt,Da._positionX+=Na._positionX,Da._positionY+=Na._positionY,Da._positionZ+=Na._positionZ;var Bt,At,yt,kt,pt,ht;if(Ba._geom._computeAabb(Ba._aabb,Ba._ptransform),Bt=Ba._aabb._minX,At=Ba._aabb._minY,yt=Ba._aabb._minZ,kt=Ba._aabb._maxX,pt=Ba._aabb._maxY,ht=Ba._aabb._maxZ,Ba._geom._computeAabb(Ba._aabb,Ba._transform),Ba._aabb._minX=Bt<Ba._aabb._minX?Bt:Ba._aabb._minX,Ba._aabb._minY=At<Ba._aabb._minY?At:Ba._aabb._minY,Ba._aabb._minZ=yt<Ba._aabb._minZ?yt:Ba._aabb._minZ,Ba._aabb._maxX=kt>Ba._aabb._maxX?kt:Ba._aabb._maxX,Ba._aabb._maxY=pt>Ba._aabb._maxY?pt:Ba._aabb._maxY,Ba._aabb._maxZ=ht>Ba._aabb._maxZ?ht:Ba._aabb._maxZ,Ba._proxy!=null){var xt,Ra,st;xt=Ba._transform._positionX-Ba._ptransform._positionX,Ra=Ba._transform._positionY-Ba._ptransform._positionY,st=Ba._transform._positionZ-Ba._ptransform._positionZ;var Ca=Ba.displacement;Ca.x=xt,Ca.y=Ra,Ca.z=st,Ba._rigidBody._world._broadPhase.moveProxy(Ba._proxy,Ba._aabb,Ba.displacement)}Ba=nt}}};x.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};x.dynamics.World=class{constructor(a,t){switch(a==null&&(a=2),a){case 1:this._broadPhase=new x.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new x.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new x.dynamics.ContactManager(this._broadPhase),t==null&&(t=new x.common.Vec3(0,-9.80665,0)),this._gravity=new x.common.Vec3(t.x,t.y,t.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new x.dynamics._World.RayCastWrapper,this._convexCastWrapper=new x.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new x.dynamics._World.AabbTestWrapper,this._island=new x.dynamics.Island;var r=new Array(x.common.Setting.islandInitialConstraintArraySize);this._solversInIslands=r;var i=new Array(x.common.Setting.islandInitialRigidBodyArraySize);this._rigidBodyStack=i,this._timeStep=new x.dynamics.TimeStep,this._pool=new x.common.Pool,this._shapeIdCount=0}_updateContacts(){var a=Date.now()/1e3;this._contactManager._updateContacts();var t=Date.now()/1e3;x.dynamics.common.Performance.broadPhaseCollisionTime=(t-a)*1e3;for(var r=Date.now()/1e3,i=this._contactManager._contactList;i!=null;){var o=i._next;i._shouldBeSkipped||i._updateManifold(),i=o}var _=Date.now()/1e3;x.dynamics.common.Performance.narrowPhaseCollisionTime=(_-r)*1e3}_solveIslands(){var a=Date.now()/1e3;if(x.common.Setting.disableSleeping)for(var t=this._rigidBodyList;t!=null;){var r=t._next;t._sleeping=!1,t._sleepTime=0,t=r}if(this._rigidBodyStack.length<this._numRigidBodies){for(var i=this._rigidBodyStack.length<<1;i<this._numRigidBodies;)i<<=1;var o=new Array(i);this._rigidBodyStack=o}this._numIslands=0;var _=this._island,s=this._gravity;_.gravityX=s.x,_.gravityY=s.y,_.gravityZ=s.z;var h=this._rigidBodyList;for(this._numSolversInIslands=0;h!=null;){for(var v=h._next;!(h._addedToIsland||h._sleeping||h._type==1);){if(h._numContactLinks==0&&h._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,h),this._numIslands++;break}this.buildIsland(h),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}h=v}for(this._contactManager._postSolve(),h=this._rigidBodyList;h!=null;){var e=h._next;h._addedToIsland=!1,h=e}for(h=this._rigidBodyList;h!=null;){var l=h._next;h._forceX=0,h._forceY=0,h._forceZ=0,h._torqueX=0,h._torqueY=0,h._torqueZ=0,h=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var u=Date.now()/1e3;x.dynamics.common.Performance.dynamicsTime=(u-a)*1e3}buildIsland(a){var t=1;for(this._island._addRigidBody(a),this._rigidBodyStack[0]=a;t>0;){var r=this._rigidBodyStack[--t];if(this._rigidBodyStack[t]=null,r._type!=1){for(var i=r._contactLinkList;i!=null;){var o=i._next,_=i._contact._contactConstraint,s=i._contact._contactConstraint._solver;if(_.isTouching()&&!s._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var h=this._numSolversInIslands<<1,v=new Array(h),e=v,l=0,u=this._numSolversInIslands;l<u;){var b=l++;e[b]=this._solversInIslands[b],this._solversInIslands[b]=null}this._solversInIslands=e}this._solversInIslands[this._numSolversInIslands++]=s,this._island._addConstraintSolver(s,_._positionCorrectionAlgorithm);var f=i._other;f._addedToIsland||(this._island._addRigidBody(f),this._rigidBodyStack[t++]=f)}i=o}for(var n=r._jointLinkList;n!=null;){var c=n._next,M=n._joint,m=M._solver;if(!m._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var y=this._numSolversInIslands<<1,V=new Array(y),z=V,I=0,k=this._numSolversInIslands;I<k;){var X=I++;z[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=z}this._solversInIslands[this._numSolversInIslands++]=m,this._island._addConstraintSolver(m,M._positionCorrectionAlgorithm);var L=n._other;L._addedToIsland||(this._island._addRigidBody(L),this._rigidBodyStack[t++]=L)}n=c}}}}_drawBvh(a,t){a.drawBvh&&this._drawBvhNode(a,t._root,0,a.style.bvhNodeColor)}_drawBvhNode(a,t,r,i){if(t!=null){if(r>=a.drawBvhMinLevel&&r<=a.drawBvhMaxLevel){var o=this._pool,_=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],s=this._pool,h=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],v=_;v.x=t._aabbMinX,v.y=t._aabbMinY,v.z=t._aabbMinZ;var e=h;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,a.aabb(_,h,i);var l=this._pool,u=null,b=null,f=null;if(_!=null){if(_.zero(),l.sizeVec3==l.stackVec3.length){for(var n=l.sizeVec3<<1,c=new Array(n),M=c,m=0,y=l.sizeVec3;m<y;){var V=m++;M[V]=l.stackVec3[V],l.stackVec3[V]=null}l.stackVec3=M}l.stackVec3[l.sizeVec3++]=_}if(u!=null){var z=1,I=0,k=0,X=0,L=1,p=0,g=0,N=0,A=1;if(u.e00=z,u.e01=I,u.e02=k,u.e10=X,u.e11=L,u.e12=p,u.e20=g,u.e21=N,u.e22=A,l.sizeMat3==l.stackMat3.length){for(var F=l.sizeMat3<<1,S=new Array(F),Y=S,R=0,C=l.sizeMat3;R<C;){var d=R++;Y[d]=l.stackMat3[d],l.stackMat3[d]=null}l.stackMat3=Y}l.stackMat3[l.sizeMat3++]=u}if(b!=null){var Z=1,$=0,j=0,E=0,G=0,B=1,Q=0,U=0,J=0,D=0,H=1,K=0,ra=0,sa=0,W=0,q=1;if(b.e00=Z,b.e01=$,b.e02=j,b.e03=E,b.e10=G,b.e11=B,b.e12=Q,b.e13=U,b.e20=J,b.e21=D,b.e22=H,b.e23=K,b.e30=ra,b.e31=sa,b.e32=W,b.e33=q,l.sizeMat4==l.stackMat4.length){for(var na=l.sizeMat4<<1,oa=new Array(na),aa=oa,T=0,ca=l.sizeMat4;T<ca;){var _a=T++;aa[_a]=l.stackMat4[_a],l.stackMat4[_a]=null}l.stackMat4=aa}l.stackMat4[l.sizeMat4++]=b}if(f!=null){var w=0,ta=0,ia=0,la=1;if(f.x=w,f.y=ta,f.z=ia,f.w=la,l.sizeQuat==l.stackQuat.length){for(var va=l.sizeQuat<<1,xa=new Array(va),Ma=xa,za=0,Xa=l.sizeQuat;za<Xa;){var Za=za++;Ma[Za]=l.stackQuat[Za],l.stackQuat[Za]=null}l.stackQuat=Ma}l.stackQuat[l.sizeQuat++]=f}var fa=this._pool,ba=null,ea=null,ha=null;if(h!=null){if(h.zero(),fa.sizeVec3==fa.stackVec3.length){for(var pa=fa.sizeVec3<<1,ya=new Array(pa),da=ya,ma=0,Ya=fa.sizeVec3;ma<Ya;){var Qa=ma++;da[Qa]=fa.stackVec3[Qa],fa.stackVec3[Qa]=null}fa.stackVec3=da}fa.stackVec3[fa.sizeVec3++]=h}if(ba!=null){var ga=1,ua=0,wa=0,ka=0,Pa=1,Mt=0,Ha=0,Ba=0,nt=1;if(ba.e00=ga,ba.e01=ua,ba.e02=wa,ba.e10=ka,ba.e11=Pa,ba.e12=Mt,ba.e20=Ha,ba.e21=Ba,ba.e22=nt,fa.sizeMat3==fa.stackMat3.length){for(var Ea=fa.sizeMat3<<1,Fa=new Array(Ea),Aa=Fa,ft=0,Ua=fa.sizeMat3;ft<Ua;){var ja=ft++;Aa[ja]=fa.stackMat3[ja],fa.stackMat3[ja]=null}fa.stackMat3=Aa}fa.stackMat3[fa.sizeMat3++]=ba}if(ea!=null){var bt=1,rt=0,$a=0,_t=0,gt=0,mt=1,Wa=0,it=0,ut=0,Da=0,Ta=1,Na=0,Vt=0,Pt=0,et=0,Xt=1;if(ea.e00=bt,ea.e01=rt,ea.e02=$a,ea.e03=_t,ea.e10=gt,ea.e11=mt,ea.e12=Wa,ea.e13=it,ea.e20=ut,ea.e21=Da,ea.e22=Ta,ea.e23=Na,ea.e30=Vt,ea.e31=Pt,ea.e32=et,ea.e33=Xt,fa.sizeMat4==fa.stackMat4.length){for(var Yt=fa.sizeMat4<<1,zt=new Array(Yt),Ia=zt,O=0,Va=fa.sizeMat4;O<Va;){var lt=O++;Ia[lt]=fa.stackMat4[lt],fa.stackMat4[lt]=null}fa.stackMat4=Ia}fa.stackMat4[fa.sizeMat4++]=ea}if(ha!=null){var P=0,wt=0,Bt=0,At=1;if(ha.x=P,ha.y=wt,ha.z=Bt,ha.w=At,fa.sizeQuat==fa.stackQuat.length){for(var yt=fa.sizeQuat<<1,kt=new Array(yt),pt=kt,ht=0,xt=fa.sizeQuat;ht<xt;){var Ra=ht++;pt[Ra]=fa.stackQuat[Ra],fa.stackQuat[Ra]=null}fa.stackQuat=pt}fa.stackQuat[fa.sizeQuat++]=ha}}this._drawBvhNode(a,t._children[0],r+1,i),this._drawBvhNode(a,t._children[1],r+1,i)}}_drawRigidBodies(a){for(var t=a.style,r=this._rigidBodyList;r!=null;){var i=r._next;if(a.drawBases){var o=a.style;a.basis(r._transform,o.basisLength,o.basisColorX,o.basisColorY,o.basisColorZ)}var _=null,s=r._type==0;s||(_=r._type==2?t.kinematicShapeColor:t.staticShapeColor);for(var h=r._shapeList;h!=null;){var v=h._next;if(s&&(h._id&1?_=r._sleeping?t.sleepingShapeColor2:r._sleepTime>x.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor2:t.shapeColor2:_=r._sleeping?t.sleepingShapeColor1:r._sleepTime>x.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor1:t.shapeColor1),a.drawShapes){var e=h._geom,l=h._transform;switch(e._type){case 0:a.sphere(l,e._radius,_);break;case 1:var u=e,b=this._pool,f=b.sizeVec3==0?new x.common.Vec3:b.stackVec3[--b.sizeVec3],n=f;n.x=u._halfExtentsX,n.y=u._halfExtentsY,n.z=u._halfExtentsZ,a.box(l,f,_);var c=this._pool,M=null,m=null,y=null;if(f!=null){if(f.zero(),c.sizeVec3==c.stackVec3.length){for(var V=c.sizeVec3<<1,z=new Array(V),I=z,k=0,X=c.sizeVec3;k<X;){var L=k++;I[L]=c.stackVec3[L],c.stackVec3[L]=null}c.stackVec3=I}c.stackVec3[c.sizeVec3++]=f}if(M!=null){var p=1,g=0,N=0,A=0,F=1,S=0,Y=0,R=0,C=1;if(M.e00=p,M.e01=g,M.e02=N,M.e10=A,M.e11=F,M.e12=S,M.e20=Y,M.e21=R,M.e22=C,c.sizeMat3==c.stackMat3.length){for(var d=c.sizeMat3<<1,Z=new Array(d),$=Z,j=0,E=c.sizeMat3;j<E;){var G=j++;$[G]=c.stackMat3[G],c.stackMat3[G]=null}c.stackMat3=$}c.stackMat3[c.sizeMat3++]=M}if(m!=null){var B=1,Q=0,U=0,J=0,D=0,H=1,K=0,ra=0,sa=0,W=0,q=1,na=0,oa=0,aa=0,T=0,ca=1;if(m.e00=B,m.e01=Q,m.e02=U,m.e03=J,m.e10=D,m.e11=H,m.e12=K,m.e13=ra,m.e20=sa,m.e21=W,m.e22=q,m.e23=na,m.e30=oa,m.e31=aa,m.e32=T,m.e33=ca,c.sizeMat4==c.stackMat4.length){for(var _a=c.sizeMat4<<1,w=new Array(_a),ta=w,ia=0,la=c.sizeMat4;ia<la;){var va=ia++;ta[va]=c.stackMat4[va],c.stackMat4[va]=null}c.stackMat4=ta}c.stackMat4[c.sizeMat4++]=m}if(y!=null){var xa=0,Ma=0,za=0,Xa=1;if(y.x=xa,y.y=Ma,y.z=za,y.w=Xa,c.sizeQuat==c.stackQuat.length){for(var Za=c.sizeQuat<<1,fa=new Array(Za),ba=fa,ea=0,ha=c.sizeQuat;ea<ha;){var pa=ea++;ba[pa]=c.stackQuat[pa],c.stackQuat[pa]=null}c.stackQuat=ba}c.stackQuat[c.sizeQuat++]=y}break;case 2:var ya=e;a.cylinder(l,ya._radius,ya._halfHeight,_);break;case 3:var da=e;a.cone(l,da._radius,da._halfHeight,_);break;case 4:var ma=e;a.capsule(l,ma._radius,ma._halfHeight,_);break;case 5:var Ya=e,Qa=Ya._numVertices,ga=this._pool,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3],wa=this._pool,ka=wa.sizeVec3==0?new x.common.Vec3:wa.stackVec3[--wa.sizeVec3],Pa=this._pool,Mt=Pa.sizeVec3==0?new x.common.Vec3:Pa.stackVec3[--Pa.sizeVec3],Ha=this._pool,Ba=Ha.sizeVec3==0?new x.common.Vec3:Ha.stackVec3[--Ha.sizeVec3],nt=this._pool,Ea=nt.sizeVec3==0?new x.common.Vec3:nt.stackVec3[--nt.sizeVec3],Fa=this._pool,Aa=Fa.sizeVec3==0?new x.common.Vec3:Fa.stackVec3[--Fa.sizeVec3],ft=this._pool,Ua=ft.sizeMat3==0?new x.common.Mat3:ft.stackMat3[--ft.sizeMat3],ja=this._pool,bt=ja.sizeVec3==0?new x.common.Vec3:ja.stackVec3[--ja.sizeVec3],rt=Ua;rt.e00=l._rotation00,rt.e01=l._rotation01,rt.e02=l._rotation02,rt.e10=l._rotation10,rt.e11=l._rotation11,rt.e12=l._rotation12,rt.e20=l._rotation20,rt.e21=l._rotation21,rt.e22=l._rotation22;var $a=bt;$a.x=l._positionX,$a.y=l._positionY,$a.z=l._positionZ;for(var _t=0,gt=Qa;_t<gt;){var mt=_t++,Wa=Ya._tmpVertices[mt],it=Ya._vertices[mt];Wa.x=it.x,Wa.y=it.y,Wa.z=it.z;var ut=Wa,Da=ut.x*Ua.e00+ut.y*Ua.e01+ut.z*Ua.e02,Ta=ut.x*Ua.e10+ut.y*Ua.e11+ut.z*Ua.e12,Na=ut.x*Ua.e20+ut.y*Ua.e21+ut.z*Ua.e22;ut.x=Da,ut.y=Ta,ut.z=Na;var Vt=ut,Pt=Vt.x+bt.x,et=Vt.y+bt.y,Xt=Vt.z+bt.z;Vt.x=Pt,Vt.y=et,Vt.z=Xt}if(Qa>30)for(var Yt=0,zt=Qa;Yt<zt;){var Ia=Yt++,O=Ya._tmpVertices[Ia];ua.x=O.x,ua.y=O.y,ua.z=O.z;var Va=Ya._tmpVertices[(Ia+1)%Qa];ka.x=Va.x,ka.y=Va.y,ka.z=Va.z,a.line(ua,ka,_)}else if(this._debugDraw.wireframe||Qa>10)for(var lt=0,P=Qa;lt<P;){var wt=lt++,Bt=Ya._tmpVertices[wt];ua.x=Bt.x,ua.y=Bt.y,ua.z=Bt.z;for(var At=0,yt=wt;At<yt;){var kt=At++,pt=Ya._tmpVertices[kt];ka.x=pt.x,ka.y=pt.y,ka.z=pt.z,a.line(ua,ka,_)}}else for(var ht=0,xt=Qa;ht<xt;){var Ra=ht++,st=Ya._tmpVertices[Ra];ua.x=st.x,ua.y=st.y,ua.z=st.z;for(var Ca=0,vt=Ra;Ca<vt;){var qa=Ca++,at=Ya._tmpVertices[qa];ka.x=at.x,ka.y=at.y,ka.z=at.z;for(var Oa=0,tt=qa;Oa<tt;){var ct=Oa++,Sa=Ya._tmpVertices[ct];Mt.x=Sa.x,Mt.y=Sa.y,Mt.z=Sa.z,Ba.x=ka.x,Ba.y=ka.y,Ba.z=ka.z;var Ga=Ba,Ka=Ga.x-ua.x,La=Ga.y-ua.y,ot=Ga.z-ua.z;Ga.x=Ka,Ga.y=La,Ga.z=ot,Ea.x=Mt.x,Ea.y=Mt.y,Ea.z=Mt.z;var It=Ea,or=It.x-ua.x,gr=It.y-ua.y,ar=It.z-ua.z;It.x=or,It.y=gr,It.z=ar,Aa.x=Ba.x,Aa.y=Ba.y,Aa.z=Ba.z;var Ct=Aa,_r=Ct.y*Ea.z-Ct.z*Ea.y,Et=Ct.z*Ea.x-Ct.x*Ea.z,St=Ct.x*Ea.y-Ct.y*Ea.x;Ct.x=_r,Ct.y=Et,Ct.z=St;var Gt=Ct,jr=Math.sqrt(Gt.x*Gt.x+Gt.y*Gt.y+Gt.z*Gt.z);jr>0&&(jr=1/jr);var vr=Gt.x*jr,lr=Gt.y*jr,tr=Gt.z*jr;Gt.x=vr,Gt.y=lr,Gt.z=tr,a.triangle(ua,ka,Mt,Aa,Aa,Aa,_);var Or=-Aa.x,Xr=-Aa.y,Mr=-Aa.z;Aa.x=Or,Aa.y=Xr,Aa.z=Mr,a.triangle(ua,Mt,ka,Aa,Aa,Aa,_)}}}var Zt=this._pool,ir=null,Wt=null,nr=null;if(ua!=null){if(ua.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var $r=Zt.sizeVec3<<1,Ut=new Array($r),Kr=Ut,Ir=0,mi=Zt.sizeVec3;Ir<mi;){var Wr=Ir++;Kr[Wr]=Zt.stackVec3[Wr],Zt.stackVec3[Wr]=null}Zt.stackVec3=Kr}Zt.stackVec3[Zt.sizeVec3++]=ua}if(ir!=null){var Lt=1,Kt=0,Tt=0,br=0,zr=1,vi=0,qt=0,fr=0,dt=1;if(ir.e00=Lt,ir.e01=Kt,ir.e02=Tt,ir.e10=br,ir.e11=zr,ir.e12=vi,ir.e20=qt,ir.e21=fr,ir.e22=dt,Zt.sizeMat3==Zt.stackMat3.length){for(var ur=Zt.sizeMat3<<1,hr=new Array(ur),ei=hr,Xi=0,io=Zt.sizeMat3;Xi<io;){var Jt=Xi++;ei[Jt]=Zt.stackMat3[Jt],Zt.stackMat3[Jt]=null}Zt.stackMat3=ei}Zt.stackMat3[Zt.sizeMat3++]=ir}if(Wt!=null){var fi=1,pi=0,Dt=0,di=0,Sr=0,Di=1,Hn=0,oo=0,Bi=0,no=0,yn=1,Ao=0,Io=0,xr=0,qi=0,Ai=1;if(Wt.e00=fi,Wt.e01=pi,Wt.e02=Dt,Wt.e03=di,Wt.e10=Sr,Wt.e11=Di,Wt.e12=Hn,Wt.e13=oo,Wt.e20=Bi,Wt.e21=no,Wt.e22=yn,Wt.e23=Ao,Wt.e30=Io,Wt.e31=xr,Wt.e32=qi,Wt.e33=Ai,Zt.sizeMat4==Zt.stackMat4.length){for(var yi=Zt.sizeMat4<<1,So=new Array(yi),Dr=So,Si=0,gi=Zt.sizeMat4;Si<gi;){var Rt=Si++;Dr[Rt]=Zt.stackMat4[Rt],Zt.stackMat4[Rt]=null}Zt.stackMat4=Dr}Zt.stackMat4[Zt.sizeMat4++]=Wt}if(nr!=null){var Hr=0,Lr=0,Cn=0,zs=1;if(nr.x=Hr,nr.y=Lr,nr.z=Cn,nr.w=zs,Zt.sizeQuat==Zt.stackQuat.length){for(var Ke=Zt.sizeQuat<<1,ms=new Array(Ke),Te=ms,qe=0,D_=Zt.sizeQuat;qe<D_;){var gn=qe++;Te[gn]=Zt.stackQuat[gn],Zt.stackQuat[gn]=null}Zt.stackQuat=Te}Zt.stackQuat[Zt.sizeQuat++]=nr}var Pr=this._pool,No=null,Wi=null,ke=null;if(ka!=null){if(ka.zero(),Pr.sizeVec3==Pr.stackVec3.length){for(var on=Pr.sizeVec3<<1,Tn=new Array(on),jn=Tn,we=0,k_=Pr.sizeVec3;we<k_;){var Re=we++;jn[Re]=Pr.stackVec3[Re],Pr.stackVec3[Re]=null}Pr.stackVec3=jn}Pr.stackVec3[Pr.sizeVec3++]=ka}if(No!=null){var Vr=1,Ii=0,ui=0,eo=0,Rn=1,ps=0,nn=0,Qn=0,cr=1;if(No.e00=Vr,No.e01=Ii,No.e02=ui,No.e10=eo,No.e11=Rn,No.e12=ps,No.e20=nn,No.e21=Qn,No.e22=cr,Pr.sizeMat3==Pr.stackMat3.length){for(var ho=Pr.sizeMat3<<1,Fi=new Array(ho),En=Fi,as=0,Qe=Pr.sizeMat3;as<Qe;){var Ee=as++;En[Ee]=Pr.stackMat3[Ee],Pr.stackMat3[Ee]=null}Pr.stackMat3=En}Pr.stackMat3[Pr.sizeMat3++]=No}if(Wi!=null){var De=1,he=0,rr=0,ri=0,Qr=0,Fr=1,fo=0,Po=0,s_=0,Fe=0,ts=1,Dn=0,co=0,Ft=0,Nr=0,li=1;if(Wi.e00=De,Wi.e01=he,Wi.e02=rr,Wi.e03=ri,Wi.e10=Qr,Wi.e11=Fr,Wi.e12=fo,Wi.e13=Po,Wi.e20=s_,Wi.e21=Fe,Wi.e22=ts,Wi.e23=Dn,Wi.e30=co,Wi.e31=Ft,Wi.e32=Nr,Wi.e33=li,Pr.sizeMat4==Pr.stackMat4.length){for(var Vo=Pr.sizeMat4<<1,ce=new Array(Vo),Xe=ce,Le=0,uo=Pr.sizeMat4;Le<uo;){var $t=Le++;Xe[$t]=Pr.stackMat4[$t],Pr.stackMat4[$t]=null}Pr.stackMat4=Xe}Pr.stackMat4[Pr.sizeMat4++]=Wi}if(ke!=null){var Vi=0,si=0,Go=0,Ns=1;if(ke.x=Vi,ke.y=si,ke.z=Go,ke.w=Ns,Pr.sizeQuat==Pr.stackQuat.length){for(var Co=Pr.sizeQuat<<1,ko=new Array(Co),Ni=ko,Pi=0,Ci=Pr.sizeQuat;Pi<Ci;){var Li=Pi++;Ni[Li]=Pr.stackQuat[Li],Pr.stackQuat[Li]=null}Pr.stackQuat=Ni}Pr.stackQuat[Pr.sizeQuat++]=ke}var Qt=this._pool,Gr=null,Yr=null,Rr=null;if(Mt!=null){if(Mt.zero(),Qt.sizeVec3==Qt.stackVec3.length){for(var Mi=Qt.sizeVec3<<1,qr=new Array(Mi),Gi=qr,Ji=0,ao=Qt.sizeVec3;Ji<ao;){var be=Ji++;Gi[be]=Qt.stackVec3[be],Qt.stackVec3[be]=null}Qt.stackVec3=Gi}Qt.stackVec3[Qt.sizeVec3++]=Mt}if(Gr!=null){var kr=1,en=0,Yi=0,Jo=0,ys=1,In=0,gs=0,Vn=0,Cr=1;if(Gr.e00=kr,Gr.e01=en,Gr.e02=Yi,Gr.e10=Jo,Gr.e11=ys,Gr.e12=In,Gr.e20=gs,Gr.e21=Vn,Gr.e22=Cr,Qt.sizeMat3==Qt.stackMat3.length){for(var To=Qt.sizeMat3<<1,so=new Array(To),Fn=so,Ne=0,Nn=Qt.sizeMat3;Ne<Nn;){var Wo=Ne++;Fn[Wo]=Qt.stackMat3[Wo],Qt.stackMat3[Wo]=null}Qt.stackMat3=Fn}Qt.stackMat3[Qt.sizeMat3++]=Gr}if(Yr!=null){var kn=1,Ye=0,Ot=0,Ro=0,Ui=0,wn=1,Gn=0,fe=0,Is=0,Uo=0,Vs=1,w_=0,Gs=0,X_=0,Ge=0,F_=1;if(Yr.e00=kn,Yr.e01=Ye,Yr.e02=Ot,Yr.e03=Ro,Yr.e10=Ui,Yr.e11=wn,Yr.e12=Gn,Yr.e13=fe,Yr.e20=Is,Yr.e21=Uo,Yr.e22=Vs,Yr.e23=w_,Yr.e30=Gs,Yr.e31=X_,Yr.e32=Ge,Yr.e33=F_,Qt.sizeMat4==Qt.stackMat4.length){for(var N_=Qt.sizeMat4<<1,Oi=new Array(N_),wo=Oi,Xo=0,Jn=Qt.sizeMat4;Xo<Jn;){var wr=Xo++;wo[wr]=Qt.stackMat4[wr],Qt.stackMat4[wr]=null}Qt.stackMat4=wo}Qt.stackMat4[Qt.sizeMat4++]=Yr}if(Rr!=null){var Wn=0,Qo=0,to=0,G_=1;if(Rr.x=Wn,Rr.y=Qo,Rr.z=to,Rr.w=G_,Qt.sizeQuat==Qt.stackQuat.length){for(var J_=Qt.sizeQuat<<1,L_=new Array(J_),rs=L_,__=0,v_=Qt.sizeQuat;__<v_;){var is=__++;rs[is]=Qt.stackQuat[is],Qt.stackQuat[is]=null}Qt.stackQuat=rs}Qt.stackQuat[Qt.sizeQuat++]=Rr}var mr=this._pool,Oo=null,ai=null,Ze=null;if(Ba!=null){if(Ba.zero(),mr.sizeVec3==mr.stackVec3.length){for(var Js=mr.sizeVec3<<1,hv=new Array(Js),ue=hv,Je=0,$n=mr.sizeVec3;Je<$n;){var Ws=Je++;ue[Ws]=mr.stackVec3[Ws],mr.stackVec3[Ws]=null}mr.stackVec3=ue}mr.stackVec3[mr.sizeVec3++]=Ba}if(Oo!=null){var Tr=1,Lo=0,Ti=0,sn=0,ks=1,Y_=0,We=0,Kn=0,Xn=1;if(Oo.e00=Tr,Oo.e01=Lo,Oo.e02=Ti,Oo.e10=sn,Oo.e11=ks,Oo.e12=Y_,Oo.e20=We,Oo.e21=Kn,Oo.e22=Xn,mr.sizeMat3==mr.stackMat3.length){for(var os=mr.sizeMat3<<1,de=new Array(os),ns=de,Us=0,l_=mr.sizeMat3;Us<l_;){var Be=Us++;ns[Be]=mr.stackMat3[Be],mr.stackMat3[Be]=null}mr.stackMat3=ns}mr.stackMat3[mr.sizeMat3++]=Oo}if(ai!=null){var Ae=1,qn=0,pr=0,xo=0,Zi=0,Ho=1,Yo=0,Hi=0,Eo=0,ws=0,ae=1,Os=0,W_=0,te=0,Nt=0,ji=1;if(ai.e00=Ae,ai.e01=qn,ai.e02=pr,ai.e03=xo,ai.e10=Zi,ai.e11=Ho,ai.e12=Yo,ai.e13=Hi,ai.e20=Eo,ai.e21=ws,ai.e22=ae,ai.e23=Os,ai.e30=W_,ai.e31=te,ai.e32=Nt,ai.e33=ji,mr.sizeMat4==mr.stackMat4.length){for(var Do=mr.sizeMat4<<1,Xs=new Array(Do),kv=Xs,r0=0,U_=mr.sizeMat4;r0<U_;){var Ht=r0++;kv[Ht]=mr.stackMat4[Ht],mr.stackMat4[Ht]=null}mr.stackMat4=kv}mr.stackMat4[mr.sizeMat4++]=ai}if(Ze!=null){var Ln=0,Ri=0,Yn=0,Z_=1;if(Ze.x=Ln,Ze.y=Ri,Ze.z=Yn,Ze.w=Z_,mr.sizeQuat==mr.stackQuat.length){for(var Hs=mr.sizeQuat<<1,h_=new Array(Hs),bo=h_,es=0,ss=mr.sizeQuat;es<ss;){var xe=es++;bo[xe]=mr.stackQuat[xe],mr.stackQuat[xe]=null}mr.stackQuat=bo}mr.stackQuat[mr.sizeQuat++]=Ze}var Zr=this._pool,jo=null,ki=null,Zo=null;if(Ea!=null){if(Ea.zero(),Zr.sizeVec3==Zr.stackVec3.length){for(var Ue=Zr.sizeVec3<<1,cv=new Array(Ue),Me=cv,js=0,wv=Zr.sizeVec3;js<wv;){var Oe=js++;Me[Oe]=Zr.stackVec3[Oe],Zr.stackVec3[Oe]=null}Zr.stackVec3=Me}Zr.stackVec3[Zr.sizeVec3++]=Ea}if(jo!=null){var er=1,Zn=0,_n=0,vn=0,d_=1,bv=0,re=0,Se=0,c_=1;if(jo.e00=er,jo.e01=Zn,jo.e02=_n,jo.e10=vn,jo.e11=d_,jo.e12=bv,jo.e20=re,jo.e21=Se,jo.e22=c_,Zr.sizeMat3==Zr.stackMat3.length){for(var O_=Zr.sizeMat3<<1,fv=new Array(O_),uv=fv,b_=0,He=Zr.sizeMat3;b_<He;){var Mo=b_++;uv[Mo]=Zr.stackMat3[Mo],Zr.stackMat3[Mo]=null}Zr.stackMat3=uv}Zr.stackMat3[Zr.sizeMat3++]=jo}if(ki!=null){var _s=1,vs=0,Ur=0,zo=0,_o=0,ls=1,Ls=0,Ys=0,Zs=0,B_=0,ze=1,hs=0,H_=0,$s=0,Un=0,me=1;if(ki.e00=_s,ki.e01=vs,ki.e02=Ur,ki.e03=zo,ki.e10=_o,ki.e11=ls,ki.e12=Ls,ki.e13=Ys,ki.e20=Zs,ki.e21=B_,ki.e22=ze,ki.e23=hs,ki.e30=H_,ki.e31=$s,ki.e32=Un,ki.e33=me,Zr.sizeMat4==Zr.stackMat4.length){for(var Xv=Zr.sizeMat4<<1,A_=new Array(Xv),$o=A_,ln=0,mo=Zr.sizeMat4;ln<mo;){var jt=ln++;$o[jt]=Zr.stackMat4[jt],Zr.stackMat4[jt]=null}Zr.stackMat4=$o}Zr.stackMat4[Zr.sizeMat4++]=ki}if(Zo!=null){var $i=0,vo=0,Ks=0,ds=1;if(Zo.x=$i,Zo.y=vo,Zo.z=Ks,Zo.w=ds,Zr.sizeQuat==Zr.stackQuat.length){for(var qs=Zr.sizeQuat<<1,S_=new Array(qs),Ko=S_,ie=0,j_=Zr.sizeQuat;ie<j_;){var xv=ie++;Ko[xv]=Zr.stackQuat[xv],Zr.stackQuat[xv]=null}Zr.stackQuat=Ko}Zr.stackQuat[Zr.sizeQuat++]=Zo}var dr=this._pool,po=null,Qi=null,ro=null;if(Aa!=null){if(Aa.zero(),dr.sizeVec3==dr.stackVec3.length){for(var $_=dr.sizeVec3<<1,K_=new Array($_),Lv=K_,a_=0,Yv=dr.sizeVec3;a_<Yv;){var q_=a_++;Lv[q_]=dr.stackVec3[q_],dr.stackVec3[q_]=null}dr.stackVec3=Lv}dr.stackVec3[dr.sizeVec3++]=Aa}if(po!=null){var Br=1,av=0,Bs=0,As=0,cs=1,bs=0,Ss=0,Zv=0,pe=1;if(po.e00=Br,po.e01=av,po.e02=Bs,po.e10=As,po.e11=cs,po.e12=bs,po.e20=Ss,po.e21=Zv,po.e22=pe,dr.sizeMat3==dr.stackMat3.length){for(var Ki=dr.sizeMat3<<1,t_=new Array(Ki),yo=t_,r_=0,Fo=dr.sizeMat3;r_<Fo;){var Ps=r_++;yo[Ps]=dr.stackMat3[Ps],dr.stackMat3[Ps]=null}dr.stackMat3=yo}dr.stackMat3[dr.sizeMat3++]=po}if(Qi!=null){var qo=1,ye=0,sr=0,an=0,_i=0,oe=1,ge=0,Bo=0,Ei=0,dn=0,tv=1,i_=0,P_=0,rv=0,ne=0,Bn=1;if(Qi.e00=qo,Qi.e01=ye,Qi.e02=sr,Qi.e03=an,Qi.e10=_i,Qi.e11=oe,Qi.e12=ge,Qi.e13=Bo,Qi.e20=Ei,Qi.e21=dn,Qi.e22=tv,Qi.e23=i_,Qi.e30=P_,Qi.e31=rv,Qi.e32=ne,Qi.e33=Bn,dr.sizeMat4==dr.stackMat4.length){for(var Ie=dr.sizeMat4<<1,E0=new Array(Ie),z0=E0,hl=0,D0=dr.sizeMat4;hl<D0;){var hi=hl++;z0[hi]=dr.stackMat4[hi],dr.stackMat4[hi]=null}dr.stackMat4=z0}dr.stackMat4[dr.sizeMat4++]=Qi}if(ro!=null){var On=0,go=0,fs=0,iv=1;if(ro.x=On,ro.y=go,ro.z=fs,ro.w=iv,dr.sizeQuat==dr.stackQuat.length){for(var Mv=dr.sizeQuat<<1,o_=new Array(Mv),dv=o_,Cs=0,f_=dr.sizeQuat;Cs<f_;){var u_=Cs++;dv[u_]=dr.stackQuat[u_],dr.stackQuat[u_]=null}dr.stackQuat=dv}dr.stackQuat[dr.sizeQuat++]=ro}var Ar=this._pool,Ts=null,lo=null,Pe=null;if(Ts!=null){if(Ts.zero(),Ar.sizeVec3==Ar.stackVec3.length){for(var zv=Ar.sizeVec3<<1,Rs=new Array(zv),x_=Rs,ov=0,i0=Ar.sizeVec3;ov<i0;){var o0=ov++;x_[o0]=Ar.stackVec3[o0],Ar.stackVec3[o0]=null}Ar.stackVec3=x_}Ar.stackVec3[Ar.sizeVec3++]=Ts}if(Ua!=null){var nv=1,ti=0,je=0,An=0,us=1,F0=0,Dv=0,C_=0,m0=1;if(Ua.e00=nv,Ua.e01=ti,Ua.e02=je,Ua.e10=An,Ua.e11=us,Ua.e12=F0,Ua.e20=Dv,Ua.e21=C_,Ua.e22=m0,Ar.sizeMat3==Ar.stackMat3.length){for(var Bv=Ar.sizeMat3<<1,n0=new Array(Bv),p0=n0,N0=0,e0=Ar.sizeMat3;N0<e0;){var s0=N0++;p0[s0]=Ar.stackMat3[s0],Ar.stackMat3[s0]=null}Ar.stackMat3=p0}Ar.stackMat3[Ar.sizeMat3++]=Ua}if(lo!=null){var y0=1,Fv=0,ci=0,mv=0,hn=0,Nv=1,Hl=0,g0=0,I0=0,cl=0,dl=1,Gv=0,jl=0,$l=0,bl=0,Bl=1;if(lo.e00=y0,lo.e01=Fv,lo.e02=ci,lo.e03=mv,lo.e10=hn,lo.e11=Nv,lo.e12=Hl,lo.e13=g0,lo.e20=I0,lo.e21=cl,lo.e22=dl,lo.e23=Gv,lo.e30=jl,lo.e31=$l,lo.e32=bl,lo.e33=Bl,Ar.sizeMat4==Ar.stackMat4.length){for(var Al=Ar.sizeMat4<<1,Kl=new Array(Al),fl=Kl,ql=0,ul=Ar.sizeMat4;ql<ul;){var ii=ql++;fl[ii]=Ar.stackMat4[ii],Ar.stackMat4[ii]=null}Ar.stackMat4=fl}Ar.stackMat4[Ar.sizeMat4++]=lo}if(Pe!=null){var xs=0,tn=0,pv=0,yh=1;if(Pe.x=xs,Pe.y=tn,Pe.z=pv,Pe.w=yh,Ar.sizeQuat==Ar.stackQuat.length){for(var Jv=Ar.sizeQuat<<1,G0=new Array(Jv),xl=G0,V0=0,k0=Ar.sizeQuat;V0<k0;){var J0=V0++;xl[J0]=Ar.stackQuat[J0],Ar.stackQuat[J0]=null}Ar.stackQuat=xl}Ar.stackQuat[Ar.sizeQuat++]=Pe}var zi=this._pool,Ms=null,ee=null,_0=null;if(bt!=null){if(bt.zero(),zi.sizeVec3==zi.stackVec3.length){for(var Sl=zi.sizeVec3<<1,lh=new Array(Sl),W0=lh,hh=0,U0=zi.sizeVec3;hh<U0;){var Pl=hh++;W0[Pl]=zi.stackVec3[Pl],zi.stackVec3[Pl]=null}zi.stackVec3=W0}zi.stackVec3[zi.sizeVec3++]=bt}if(Ms!=null){var Ml=1,Ce=0,w0=0,M_=0,Cl=1,O0=0,H0=0,Tl=0,zl=1;if(Ms.e00=Ml,Ms.e01=Ce,Ms.e02=w0,Ms.e10=M_,Ms.e11=Cl,Ms.e12=O0,Ms.e20=H0,Ms.e21=Tl,Ms.e22=zl,zi.sizeMat3==zi.stackMat3.length){for(var X0=zi.sizeMat3<<1,v0=new Array(X0),z_=v0,Wv=0,Uv=zi.sizeMat3;Wv<Uv;){var ev=Wv++;z_[ev]=zi.stackMat3[ev],zi.stackMat3[ev]=null}zi.stackMat3=z_}zi.stackMat3[zi.sizeMat3++]=Ms}if(ee!=null){var L0=1,Av=0,l0=0,se=0,h0=0,Y0=1,Qs=0,j0=0,yr=0,cn=0,wi=1,Ov=0,c0=0,ch=0,ah=0,m_=1;if(ee.e00=L0,ee.e01=Av,ee.e02=l0,ee.e03=se,ee.e10=h0,ee.e11=Y0,ee.e12=Qs,ee.e13=j0,ee.e20=yr,ee.e21=cn,ee.e22=wi,ee.e23=Ov,ee.e30=c0,ee.e31=ch,ee.e32=ah,ee.e33=m_,zi.sizeMat4==zi.stackMat4.length){for(var $e=zi.sizeMat4<<1,Es=new Array($e),th=Es,bh=0,Rl=zi.sizeMat4;bh<Rl;){var bi=bh++;th[bi]=zi.stackMat4[bi],zi.stackMat4[bi]=null}zi.stackMat4=th}zi.stackMat4[zi.sizeMat4++]=ee}if(_0!=null){var n_=0,bn=0,yv=0,$0=1;if(_0.x=n_,_0.y=bn,_0.z=yv,_0.w=$0,zi.sizeQuat==zi.stackQuat.length){for(var gv=zi.sizeQuat<<1,ml=new Array(gv),pl=ml,yl=0,T_=zi.sizeQuat;yl<T_;){var Sv=yl++;pl[Sv]=zi.stackQuat[Sv],zi.stackQuat[Sv]=null}zi.stackQuat=pl}zi.stackQuat[zi.sizeQuat++]=_0}break}}if(a.drawAabbs){var Sn=h._aabb,Iv=t.aabbColor,Pv=this._pool,R_=Pv.sizeVec3==0?new x.common.Vec3:Pv.stackVec3[--Pv.sizeVec3],_e=this._pool,Q_=_e.sizeVec3==0?new x.common.Vec3:_e.stackVec3[--_e.sizeVec3],Cv=R_;Cv.x=Sn._minX,Cv.y=Sn._minY,Cv.z=Sn._minZ;var Hv=Q_;Hv.x=Sn._maxX,Hv.y=Sn._maxY,Hv.z=Sn._maxZ,a.aabb(R_,Q_,Iv);var oi=this._pool,p_=null,ve=null,Jr=null;if(R_!=null){if(R_.zero(),oi.sizeVec3==oi.stackVec3.length){for(var y_=oi.sizeVec3<<1,Pn=new Array(y_),K0=Pn,b0=0,fh=oi.sizeVec3;b0<fh;){var q0=b0++;K0[q0]=oi.stackVec3[q0],oi.stackVec3[q0]=null}oi.stackVec3=K0}oi.stackVec3[oi.sizeVec3++]=R_}if(p_!=null){var al=1,gl=0,Z0=0,uh=0,Il=1,gh=0,rh=0,Vl=0,d0=1;if(p_.e00=al,p_.e01=gl,p_.e02=Z0,p_.e10=uh,p_.e11=Il,p_.e12=gh,p_.e20=rh,p_.e21=Vl,p_.e22=d0,oi.sizeMat3==oi.stackMat3.length){for(var B0=oi.sizeMat3<<1,kl=new Array(B0),ih=kl,jv=0,Ql=oi.sizeMat3;jv<Ql;){var $v=jv++;ih[$v]=oi.stackMat3[$v],oi.stackMat3[$v]=null}oi.stackMat3=ih}oi.stackMat3[oi.sizeMat3++]=p_}if(ve!=null){var ni=1,g_=0,rn=0,wl=0,A0=0,oh=1,El=0,tl=0,Dl=0,S0=0,nh=1,eh=0,Fl=0,Nl=0,sv=0,Tv=1;if(ve.e00=ni,ve.e01=g_,ve.e02=rn,ve.e03=wl,ve.e10=A0,ve.e11=oh,ve.e12=El,ve.e13=tl,ve.e20=Dl,ve.e21=S0,ve.e22=nh,ve.e23=eh,ve.e30=Fl,ve.e31=Nl,ve.e32=sv,ve.e33=Tv,oi.sizeMat4==oi.stackMat4.length){for(var Kv=oi.sizeMat4<<1,Ds=new Array(Kv),xh=Ds,f0=0,Xl=oi.sizeMat4;f0<Xl;){var Rv=f0++;xh[Rv]=oi.stackMat4[Rv],oi.stackMat4[Rv]=null}oi.stackMat4=xh}oi.stackMat4[oi.sizeMat4++]=ve}if(Jr!=null){var qv=0,Qv=0,u0=0,Zh=1;if(Jr.x=qv,Jr.y=Qv,Jr.z=u0,Jr.w=Zh,oi.sizeQuat==oi.stackQuat.length){for(var P0=oi.sizeQuat<<1,a0=new Array(P0),Gl=a0,Jl=0,Mh=oi.sizeQuat;Jl<Mh;){var Ev=Jl++;Gl[Ev]=oi.stackQuat[Ev],oi.stackQuat[Ev]=null}oi.stackQuat=Gl}oi.stackQuat[oi.sizeQuat++]=Jr}var xi=this._pool,Ve=null,le=null,C0=null;if(Q_!=null){if(Q_.zero(),xi.sizeVec3==xi.stackVec3.length){for(var Wl=xi.sizeVec3<<1,Fs=new Array(Wl),x0=Fs,Ll=0,Ul=xi.sizeVec3;Ll<Ul;){var Ol=Ll++;x0[Ol]=xi.stackVec3[Ol],xi.stackVec3[Ol]=null}xi.stackVec3=x0}xi.stackVec3[xi.sizeVec3++]=Q_}if(Ve!=null){var Ih=1,_v=0,vv=0,T0=0,I_=1,Yl=0,Vh=0,dh=0,t0=1;if(Ve.e00=Ih,Ve.e01=_v,Ve.e02=vv,Ve.e10=T0,Ve.e11=I_,Ve.e12=Yl,Ve.e20=Vh,Ve.e21=dh,Ve.e22=t0,xi.sizeMat3==xi.stackMat3.length){for(var lv=xi.sizeMat3<<1,kh=new Array(lv),Zl=kh,wh=0,jh=xi.sizeMat3;wh<jh;){var sh=wh++;Zl[sh]=xi.stackMat3[sh],xi.stackMat3[sh]=null}xi.stackMat3=Zl}xi.stackMat3[xi.sizeMat3++]=Ve}if(le!=null){var Er=1,e_=0,V_=0,_h=0,Bh=0,Ah=1,zh=0,Vv=0,Rh=0,Qh=0,$h=1,Kh=0,mh=0,Sh=0,rl=0,rc=1;if(le.e00=Er,le.e01=e_,le.e02=V_,le.e03=_h,le.e10=Bh,le.e11=Ah,le.e12=zh,le.e13=Vv,le.e20=Rh,le.e21=Qh,le.e22=$h,le.e23=Kh,le.e30=mh,le.e31=Sh,le.e32=rl,le.e33=rc,xi.sizeMat4==xi.stackMat4.length){for(var Xh=xi.sizeMat4<<1,E_=new Array(Xh),Eh=E_,ph=0,qh=xi.sizeMat4;ph<qh;){var Lh=ph++;Eh[Lh]=xi.stackMat4[Lh],xi.stackMat4[Lh]=null}xi.stackMat4=Eh}xi.stackMat4[xi.sizeMat4++]=le}if(C0!=null){var ac=0,Ph=0,R0=0,ic=1;if(C0.x=ac,C0.y=Ph,C0.z=R0,C0.w=ic,xi.sizeQuat==xi.stackQuat.length){for(var vh=xi.sizeQuat<<1,Yh=new Array(vh),Dh=Yh,Ch=0,Q0=xi.sizeQuat;Ch<Q0;){var M0=Ch++;Dh[M0]=xi.stackQuat[M0],xi.stackQuat[M0]=null}xi.stackQuat=Dh}xi.stackQuat[xi.sizeQuat++]=C0}}h=v}r=i}}_drawConstraints(a){var t=a.style;if(a.drawPairs||a.drawContacts)for(var r=this._contactManager._contactList;r!=null;){var i=r._next;if(a.drawPairs){var o=t.pairColor,_=this._pool,s=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],h=this._pool,v=h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3],e=s;e.x=r._s1._transform._positionX,e.y=r._s1._transform._positionY,e.z=r._s1._transform._positionZ;var l=v;l.x=r._s2._transform._positionX,l.y=r._s2._transform._positionY,l.z=r._s2._transform._positionZ,a.line(s,v,o);var u=this._pool,b=null,f=null,n=null;if(s!=null){if(s.zero(),u.sizeVec3==u.stackVec3.length){for(var c=u.sizeVec3<<1,M=new Array(c),m=M,y=0,V=u.sizeVec3;y<V;){var z=y++;m[z]=u.stackVec3[z],u.stackVec3[z]=null}u.stackVec3=m}u.stackVec3[u.sizeVec3++]=s}if(b!=null){var I=1,k=0,X=0,L=0,p=1,g=0,N=0,A=0,F=1;if(b.e00=I,b.e01=k,b.e02=X,b.e10=L,b.e11=p,b.e12=g,b.e20=N,b.e21=A,b.e22=F,u.sizeMat3==u.stackMat3.length){for(var S=u.sizeMat3<<1,Y=new Array(S),R=Y,C=0,d=u.sizeMat3;C<d;){var Z=C++;R[Z]=u.stackMat3[Z],u.stackMat3[Z]=null}u.stackMat3=R}u.stackMat3[u.sizeMat3++]=b}if(f!=null){var $=1,j=0,E=0,G=0,B=0,Q=1,U=0,J=0,D=0,H=0,K=1,ra=0,sa=0,W=0,q=0,na=1;if(f.e00=$,f.e01=j,f.e02=E,f.e03=G,f.e10=B,f.e11=Q,f.e12=U,f.e13=J,f.e20=D,f.e21=H,f.e22=K,f.e23=ra,f.e30=sa,f.e31=W,f.e32=q,f.e33=na,u.sizeMat4==u.stackMat4.length){for(var oa=u.sizeMat4<<1,aa=new Array(oa),T=aa,ca=0,_a=u.sizeMat4;ca<_a;){var w=ca++;T[w]=u.stackMat4[w],u.stackMat4[w]=null}u.stackMat4=T}u.stackMat4[u.sizeMat4++]=f}if(n!=null){var ta=0,ia=0,la=0,va=1;if(n.x=ta,n.y=ia,n.z=la,n.w=va,u.sizeQuat==u.stackQuat.length){for(var xa=u.sizeQuat<<1,Ma=new Array(xa),za=Ma,Xa=0,Za=u.sizeQuat;Xa<Za;){var fa=Xa++;za[fa]=u.stackQuat[fa],u.stackQuat[fa]=null}u.stackQuat=za}u.stackQuat[u.sizeQuat++]=n}var ba=this._pool,ea=null,ha=null,pa=null;if(v!=null){if(v.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ya=ba.sizeVec3<<1,da=new Array(ya),ma=da,Ya=0,Qa=ba.sizeVec3;Ya<Qa;){var ga=Ya++;ma[ga]=ba.stackVec3[ga],ba.stackVec3[ga]=null}ba.stackVec3=ma}ba.stackVec3[ba.sizeVec3++]=v}if(ea!=null){var ua=1,wa=0,ka=0,Pa=0,Mt=1,Ha=0,Ba=0,nt=0,Ea=1;if(ea.e00=ua,ea.e01=wa,ea.e02=ka,ea.e10=Pa,ea.e11=Mt,ea.e12=Ha,ea.e20=Ba,ea.e21=nt,ea.e22=Ea,ba.sizeMat3==ba.stackMat3.length){for(var Fa=ba.sizeMat3<<1,Aa=new Array(Fa),ft=Aa,Ua=0,ja=ba.sizeMat3;Ua<ja;){var bt=Ua++;ft[bt]=ba.stackMat3[bt],ba.stackMat3[bt]=null}ba.stackMat3=ft}ba.stackMat3[ba.sizeMat3++]=ea}if(ha!=null){var rt=1,$a=0,_t=0,gt=0,mt=0,Wa=1,it=0,ut=0,Da=0,Ta=0,Na=1,Vt=0,Pt=0,et=0,Xt=0,Yt=1;if(ha.e00=rt,ha.e01=$a,ha.e02=_t,ha.e03=gt,ha.e10=mt,ha.e11=Wa,ha.e12=it,ha.e13=ut,ha.e20=Da,ha.e21=Ta,ha.e22=Na,ha.e23=Vt,ha.e30=Pt,ha.e31=et,ha.e32=Xt,ha.e33=Yt,ba.sizeMat4==ba.stackMat4.length){for(var zt=ba.sizeMat4<<1,Ia=new Array(zt),O=Ia,Va=0,lt=ba.sizeMat4;Va<lt;){var P=Va++;O[P]=ba.stackMat4[P],ba.stackMat4[P]=null}ba.stackMat4=O}ba.stackMat4[ba.sizeMat4++]=ha}if(pa!=null){var wt=0,Bt=0,At=0,yt=1;if(pa.x=wt,pa.y=Bt,pa.z=At,pa.w=yt,ba.sizeQuat==ba.stackQuat.length){for(var kt=ba.sizeQuat<<1,pt=new Array(kt),ht=pt,xt=0,Ra=ba.sizeQuat;xt<Ra;){var st=xt++;ht[st]=ba.stackQuat[st],ba.stackQuat[st]=null}ba.stackQuat=ht}ba.stackQuat[ba.sizeQuat++]=pa}}if(a.drawContacts)for(var Ca=r._contactConstraint,vt=r._contactConstraint._manifold._points,qa=0,at=r._contactConstraint._manifold._numPoints;qa<at;){var Oa=qa++,tt=vt[Oa],ct=a.style;Ca._s1._transform,Ca._s2._transform;var Sa=this._pool,Ga=Sa.sizeVec3==0?new x.common.Vec3:Sa.stackVec3[--Sa.sizeVec3],Ka=this._pool,La=Ka.sizeVec3==0?new x.common.Vec3:Ka.stackVec3[--Ka.sizeVec3],ot=this._pool,It=ot.sizeVec3==0?new x.common.Vec3:ot.stackVec3[--ot.sizeVec3],or=this._pool,gr=or.sizeVec3==0?new x.common.Vec3:or.stackVec3[--or.sizeVec3],ar=this._pool,Ct=ar.sizeVec3==0?new x.common.Vec3:ar.stackVec3[--ar.sizeVec3],_r=Ga;_r.x=tt._pos1X,_r.y=tt._pos1Y,_r.z=tt._pos1Z;var Et=La;Et.x=tt._pos2X,Et.y=tt._pos2Y,Et.z=tt._pos2Z;var St=It;St.x=Ca._manifold._normalX,St.y=Ca._manifold._normalY,St.z=Ca._manifold._normalZ;var Gt=gr;Gt.x=Ca._manifold._tangentX,Gt.y=Ca._manifold._tangentY,Gt.z=Ca._manifold._tangentZ;var jr=Ct;if(jr.x=Ca._manifold._binormalX,jr.y=Ca._manifold._binormalY,jr.z=Ca._manifold._binormalZ,tt._disabled)a.point(Ga,ct.disabledContactColor),a.point(La,ct.disabledContactColor),a.line(Ga,La,ct.disabledContactColor);else if(tt._warmStarted){var vr;switch(tt._id&3){case 0:vr=ct.contactColor;break;case 1:vr=ct.contactColor2;break;case 2:vr=ct.contactColor3;break;default:vr=ct.contactColor4}a.point(Ga,vr),a.point(La,vr),a.line(Ga,La,ct.contactColor)}else a.point(Ga,ct.newContactColor),a.point(La,ct.newContactColor),a.line(Ga,La,ct.newContactColor);La.x=Ga.x,La.y=Ga.y,La.z=Ga.z;var lr=La,tr=ct.contactNormalLength,Or=lr.x+It.x*tr,Xr=lr.y+It.y*tr,Mr=lr.z+It.z*tr;if(lr.x=Or,lr.y=Xr,lr.z=Mr,a.line(Ga,La,ct.contactNormalColor),a.drawContactBases){La.x=Ga.x,La.y=Ga.y,La.z=Ga.z;var Zt=La,ir=ct.contactTangentLength,Wt=Zt.x+gr.x*ir,nr=Zt.y+gr.y*ir,$r=Zt.z+gr.z*ir;Zt.x=Wt,Zt.y=nr,Zt.z=$r,a.line(Ga,La,ct.contactTangentColor),La.x=Ga.x,La.y=Ga.y,La.z=Ga.z;var Ut=La,Kr=ct.contactBinormalLength,Ir=Ut.x+Ct.x*Kr,mi=Ut.y+Ct.y*Kr,Wr=Ut.z+Ct.z*Kr;Ut.x=Ir,Ut.y=mi,Ut.z=Wr,a.line(Ga,La,ct.contactBinormalColor)}var Lt=this._pool,Kt=null,Tt=null,br=null;if(Ga!=null){if(Ga.zero(),Lt.sizeVec3==Lt.stackVec3.length){for(var zr=Lt.sizeVec3<<1,vi=new Array(zr),qt=vi,fr=0,dt=Lt.sizeVec3;fr<dt;){var ur=fr++;qt[ur]=Lt.stackVec3[ur],Lt.stackVec3[ur]=null}Lt.stackVec3=qt}Lt.stackVec3[Lt.sizeVec3++]=Ga}if(Kt!=null){var hr=1,ei=0,Xi=0,io=0,Jt=1,fi=0,pi=0,Dt=0,di=1;if(Kt.e00=hr,Kt.e01=ei,Kt.e02=Xi,Kt.e10=io,Kt.e11=Jt,Kt.e12=fi,Kt.e20=pi,Kt.e21=Dt,Kt.e22=di,Lt.sizeMat3==Lt.stackMat3.length){for(var Sr=Lt.sizeMat3<<1,Di=new Array(Sr),Hn=Di,oo=0,Bi=Lt.sizeMat3;oo<Bi;){var no=oo++;Hn[no]=Lt.stackMat3[no],Lt.stackMat3[no]=null}Lt.stackMat3=Hn}Lt.stackMat3[Lt.sizeMat3++]=Kt}if(Tt!=null){var yn=1,Ao=0,Io=0,xr=0,qi=0,Ai=1,yi=0,So=0,Dr=0,Si=0,gi=1,Rt=0,Hr=0,Lr=0,Cn=0,zs=1;if(Tt.e00=yn,Tt.e01=Ao,Tt.e02=Io,Tt.e03=xr,Tt.e10=qi,Tt.e11=Ai,Tt.e12=yi,Tt.e13=So,Tt.e20=Dr,Tt.e21=Si,Tt.e22=gi,Tt.e23=Rt,Tt.e30=Hr,Tt.e31=Lr,Tt.e32=Cn,Tt.e33=zs,Lt.sizeMat4==Lt.stackMat4.length){for(var Ke=Lt.sizeMat4<<1,ms=new Array(Ke),Te=ms,qe=0,D_=Lt.sizeMat4;qe<D_;){var gn=qe++;Te[gn]=Lt.stackMat4[gn],Lt.stackMat4[gn]=null}Lt.stackMat4=Te}Lt.stackMat4[Lt.sizeMat4++]=Tt}if(br!=null){var Pr=0,No=0,Wi=0,ke=1;if(br.x=Pr,br.y=No,br.z=Wi,br.w=ke,Lt.sizeQuat==Lt.stackQuat.length){for(var on=Lt.sizeQuat<<1,Tn=new Array(on),jn=Tn,we=0,k_=Lt.sizeQuat;we<k_;){var Re=we++;jn[Re]=Lt.stackQuat[Re],Lt.stackQuat[Re]=null}Lt.stackQuat=jn}Lt.stackQuat[Lt.sizeQuat++]=br}var Vr=this._pool,Ii=null,ui=null,eo=null;if(La!=null){if(La.zero(),Vr.sizeVec3==Vr.stackVec3.length){for(var Rn=Vr.sizeVec3<<1,ps=new Array(Rn),nn=ps,Qn=0,cr=Vr.sizeVec3;Qn<cr;){var ho=Qn++;nn[ho]=Vr.stackVec3[ho],Vr.stackVec3[ho]=null}Vr.stackVec3=nn}Vr.stackVec3[Vr.sizeVec3++]=La}if(Ii!=null){var Fi=1,En=0,as=0,Qe=0,Ee=1,De=0,he=0,rr=0,ri=1;if(Ii.e00=Fi,Ii.e01=En,Ii.e02=as,Ii.e10=Qe,Ii.e11=Ee,Ii.e12=De,Ii.e20=he,Ii.e21=rr,Ii.e22=ri,Vr.sizeMat3==Vr.stackMat3.length){for(var Qr=Vr.sizeMat3<<1,Fr=new Array(Qr),fo=Fr,Po=0,s_=Vr.sizeMat3;Po<s_;){var Fe=Po++;fo[Fe]=Vr.stackMat3[Fe],Vr.stackMat3[Fe]=null}Vr.stackMat3=fo}Vr.stackMat3[Vr.sizeMat3++]=Ii}if(ui!=null){var ts=1,Dn=0,co=0,Ft=0,Nr=0,li=1,Vo=0,ce=0,Xe=0,Le=0,uo=1,$t=0,Vi=0,si=0,Go=0,Ns=1;if(ui.e00=ts,ui.e01=Dn,ui.e02=co,ui.e03=Ft,ui.e10=Nr,ui.e11=li,ui.e12=Vo,ui.e13=ce,ui.e20=Xe,ui.e21=Le,ui.e22=uo,ui.e23=$t,ui.e30=Vi,ui.e31=si,ui.e32=Go,ui.e33=Ns,Vr.sizeMat4==Vr.stackMat4.length){for(var Co=Vr.sizeMat4<<1,ko=new Array(Co),Ni=ko,Pi=0,Ci=Vr.sizeMat4;Pi<Ci;){var Li=Pi++;Ni[Li]=Vr.stackMat4[Li],Vr.stackMat4[Li]=null}Vr.stackMat4=Ni}Vr.stackMat4[Vr.sizeMat4++]=ui}if(eo!=null){var Qt=0,Gr=0,Yr=0,Rr=1;if(eo.x=Qt,eo.y=Gr,eo.z=Yr,eo.w=Rr,Vr.sizeQuat==Vr.stackQuat.length){for(var Mi=Vr.sizeQuat<<1,qr=new Array(Mi),Gi=qr,Ji=0,ao=Vr.sizeQuat;Ji<ao;){var be=Ji++;Gi[be]=Vr.stackQuat[be],Vr.stackQuat[be]=null}Vr.stackQuat=Gi}Vr.stackQuat[Vr.sizeQuat++]=eo}var kr=this._pool,en=null,Yi=null,Jo=null;if(It!=null){if(It.zero(),kr.sizeVec3==kr.stackVec3.length){for(var ys=kr.sizeVec3<<1,In=new Array(ys),gs=In,Vn=0,Cr=kr.sizeVec3;Vn<Cr;){var To=Vn++;gs[To]=kr.stackVec3[To],kr.stackVec3[To]=null}kr.stackVec3=gs}kr.stackVec3[kr.sizeVec3++]=It}if(en!=null){var so=1,Fn=0,Ne=0,Nn=0,Wo=1,kn=0,Ye=0,Ot=0,Ro=1;if(en.e00=so,en.e01=Fn,en.e02=Ne,en.e10=Nn,en.e11=Wo,en.e12=kn,en.e20=Ye,en.e21=Ot,en.e22=Ro,kr.sizeMat3==kr.stackMat3.length){for(var Ui=kr.sizeMat3<<1,wn=new Array(Ui),Gn=wn,fe=0,Is=kr.sizeMat3;fe<Is;){var Uo=fe++;Gn[Uo]=kr.stackMat3[Uo],kr.stackMat3[Uo]=null}kr.stackMat3=Gn}kr.stackMat3[kr.sizeMat3++]=en}if(Yi!=null){var Vs=1,w_=0,Gs=0,X_=0,Ge=0,F_=1,N_=0,Oi=0,wo=0,Xo=0,Jn=1,wr=0,Wn=0,Qo=0,to=0,G_=1;if(Yi.e00=Vs,Yi.e01=w_,Yi.e02=Gs,Yi.e03=X_,Yi.e10=Ge,Yi.e11=F_,Yi.e12=N_,Yi.e13=Oi,Yi.e20=wo,Yi.e21=Xo,Yi.e22=Jn,Yi.e23=wr,Yi.e30=Wn,Yi.e31=Qo,Yi.e32=to,Yi.e33=G_,kr.sizeMat4==kr.stackMat4.length){for(var J_=kr.sizeMat4<<1,L_=new Array(J_),rs=L_,__=0,v_=kr.sizeMat4;__<v_;){var is=__++;rs[is]=kr.stackMat4[is],kr.stackMat4[is]=null}kr.stackMat4=rs}kr.stackMat4[kr.sizeMat4++]=Yi}if(Jo!=null){var mr=0,Oo=0,ai=0,Ze=1;if(Jo.x=mr,Jo.y=Oo,Jo.z=ai,Jo.w=Ze,kr.sizeQuat==kr.stackQuat.length){for(var Js=kr.sizeQuat<<1,hv=new Array(Js),ue=hv,Je=0,$n=kr.sizeQuat;Je<$n;){var Ws=Je++;ue[Ws]=kr.stackQuat[Ws],kr.stackQuat[Ws]=null}kr.stackQuat=ue}kr.stackQuat[kr.sizeQuat++]=Jo}var Tr=this._pool,Lo=null,Ti=null,sn=null;if(gr!=null){if(gr.zero(),Tr.sizeVec3==Tr.stackVec3.length){for(var ks=Tr.sizeVec3<<1,Y_=new Array(ks),We=Y_,Kn=0,Xn=Tr.sizeVec3;Kn<Xn;){var os=Kn++;We[os]=Tr.stackVec3[os],Tr.stackVec3[os]=null}Tr.stackVec3=We}Tr.stackVec3[Tr.sizeVec3++]=gr}if(Lo!=null){var de=1,ns=0,Us=0,l_=0,Be=1,Ae=0,qn=0,pr=0,xo=1;if(Lo.e00=de,Lo.e01=ns,Lo.e02=Us,Lo.e10=l_,Lo.e11=Be,Lo.e12=Ae,Lo.e20=qn,Lo.e21=pr,Lo.e22=xo,Tr.sizeMat3==Tr.stackMat3.length){for(var Zi=Tr.sizeMat3<<1,Ho=new Array(Zi),Yo=Ho,Hi=0,Eo=Tr.sizeMat3;Hi<Eo;){var ws=Hi++;Yo[ws]=Tr.stackMat3[ws],Tr.stackMat3[ws]=null}Tr.stackMat3=Yo}Tr.stackMat3[Tr.sizeMat3++]=Lo}if(Ti!=null){var ae=1,Os=0,W_=0,te=0,Nt=0,ji=1,Do=0,Xs=0,kv=0,r0=0,U_=1,Ht=0,Ln=0,Ri=0,Yn=0,Z_=1;if(Ti.e00=ae,Ti.e01=Os,Ti.e02=W_,Ti.e03=te,Ti.e10=Nt,Ti.e11=ji,Ti.e12=Do,Ti.e13=Xs,Ti.e20=kv,Ti.e21=r0,Ti.e22=U_,Ti.e23=Ht,Ti.e30=Ln,Ti.e31=Ri,Ti.e32=Yn,Ti.e33=Z_,Tr.sizeMat4==Tr.stackMat4.length){for(var Hs=Tr.sizeMat4<<1,h_=new Array(Hs),bo=h_,es=0,ss=Tr.sizeMat4;es<ss;){var xe=es++;bo[xe]=Tr.stackMat4[xe],Tr.stackMat4[xe]=null}Tr.stackMat4=bo}Tr.stackMat4[Tr.sizeMat4++]=Ti}if(sn!=null){var Zr=0,jo=0,ki=0,Zo=1;if(sn.x=Zr,sn.y=jo,sn.z=ki,sn.w=Zo,Tr.sizeQuat==Tr.stackQuat.length){for(var Ue=Tr.sizeQuat<<1,cv=new Array(Ue),Me=cv,js=0,wv=Tr.sizeQuat;js<wv;){var Oe=js++;Me[Oe]=Tr.stackQuat[Oe],Tr.stackQuat[Oe]=null}Tr.stackQuat=Me}Tr.stackQuat[Tr.sizeQuat++]=sn}var er=this._pool,Zn=null,_n=null,vn=null;if(Ct!=null){if(Ct.zero(),er.sizeVec3==er.stackVec3.length){for(var d_=er.sizeVec3<<1,bv=new Array(d_),re=bv,Se=0,c_=er.sizeVec3;Se<c_;){var O_=Se++;re[O_]=er.stackVec3[O_],er.stackVec3[O_]=null}er.stackVec3=re}er.stackVec3[er.sizeVec3++]=Ct}if(Zn!=null){var fv=1,uv=0,b_=0,He=0,Mo=1,_s=0,vs=0,Ur=0,zo=1;if(Zn.e00=fv,Zn.e01=uv,Zn.e02=b_,Zn.e10=He,Zn.e11=Mo,Zn.e12=_s,Zn.e20=vs,Zn.e21=Ur,Zn.e22=zo,er.sizeMat3==er.stackMat3.length){for(var _o=er.sizeMat3<<1,ls=new Array(_o),Ls=ls,Ys=0,Zs=er.sizeMat3;Ys<Zs;){var B_=Ys++;Ls[B_]=er.stackMat3[B_],er.stackMat3[B_]=null}er.stackMat3=Ls}er.stackMat3[er.sizeMat3++]=Zn}if(_n!=null){var ze=1,hs=0,H_=0,$s=0,Un=0,me=1,Xv=0,A_=0,$o=0,ln=0,mo=1,jt=0,$i=0,vo=0,Ks=0,ds=1;if(_n.e00=ze,_n.e01=hs,_n.e02=H_,_n.e03=$s,_n.e10=Un,_n.e11=me,_n.e12=Xv,_n.e13=A_,_n.e20=$o,_n.e21=ln,_n.e22=mo,_n.e23=jt,_n.e30=$i,_n.e31=vo,_n.e32=Ks,_n.e33=ds,er.sizeMat4==er.stackMat4.length){for(var qs=er.sizeMat4<<1,S_=new Array(qs),Ko=S_,ie=0,j_=er.sizeMat4;ie<j_;){var xv=ie++;Ko[xv]=er.stackMat4[xv],er.stackMat4[xv]=null}er.stackMat4=Ko}er.stackMat4[er.sizeMat4++]=_n}if(vn!=null){var dr=0,po=0,Qi=0,ro=1;if(vn.x=dr,vn.y=po,vn.z=Qi,vn.w=ro,er.sizeQuat==er.stackQuat.length){for(var $_=er.sizeQuat<<1,K_=new Array($_),Lv=K_,a_=0,Yv=er.sizeQuat;a_<Yv;){var q_=a_++;Lv[q_]=er.stackQuat[q_],er.stackQuat[q_]=null}er.stackQuat=Lv}er.stackQuat[er.sizeQuat++]=vn}}r=i}if(a.drawJoints)for(var Br=this._jointList;Br!=null;){var av=Br._next,Bs=this._pool,As=Bs.sizeVec3==0?new x.common.Vec3:Bs.stackVec3[--Bs.sizeVec3],cs=this._pool,bs=cs.sizeVec3==0?new x.common.Vec3:cs.stackVec3[--cs.sizeVec3],Ss=As;Ss.x=Br._b1._transform._positionX,Ss.y=Br._b1._transform._positionY,Ss.z=Br._b1._transform._positionZ;var Zv=bs;Zv.x=Br._b2._transform._positionX,Zv.y=Br._b2._transform._positionY,Zv.z=Br._b2._transform._positionZ;var pe=this._pool,Ki=pe.sizeVec3==0?new x.common.Vec3:pe.stackVec3[--pe.sizeVec3],t_=this._pool,yo=t_.sizeVec3==0?new x.common.Vec3:t_.stackVec3[--t_.sizeVec3],r_=this._pool,Fo=r_.sizeVec3==0?new x.common.Vec3:r_.stackVec3[--r_.sizeVec3],Ps=this._pool,qo=Ps.sizeVec3==0?new x.common.Vec3:Ps.stackVec3[--Ps.sizeVec3],ye=this._pool,sr=ye.sizeVec3==0?new x.common.Vec3:ye.stackVec3[--ye.sizeVec3],an=this._pool,_i=an.sizeVec3==0?new x.common.Vec3:an.stackVec3[--an.sizeVec3],oe=this._pool,ge=oe.sizeVec3==0?new x.common.Vec3:oe.stackVec3[--oe.sizeVec3],Bo=this._pool,Ei=Bo.sizeVec3==0?new x.common.Vec3:Bo.stackVec3[--Bo.sizeVec3],dn=Ki;dn.x=Br._anchor1X,dn.y=Br._anchor1Y,dn.z=Br._anchor1Z;var tv=yo;tv.x=Br._anchor2X,tv.y=Br._anchor2Y,tv.z=Br._anchor2Z;var i_=Fo;i_.x=Br._basisX1X,i_.y=Br._basisX1Y,i_.z=Br._basisX1Z;var P_=qo;P_.x=Br._basisY1X,P_.y=Br._basisY1Y,P_.z=Br._basisY1Z;var rv=sr;rv.x=Br._basisZ1X,rv.y=Br._basisZ1Y,rv.z=Br._basisZ1Z;var ne=_i;ne.x=Br._basisX2X,ne.y=Br._basisX2Y,ne.z=Br._basisX2Z;var Bn=ge;Bn.x=Br._basisY2X,Bn.y=Br._basisY2Y,Bn.z=Br._basisY2Z;var Ie=Ei;if(Ie.x=Br._basisZ2X,Ie.y=Br._basisZ2Y,Ie.z=Br._basisZ2Z,a.line(As,Ki,a.style.jointLineColor),a.line(bs,yo,a.style.jointLineColor),a.drawJointLimits)switch(Br._type){case 0:break;case 1:var E0=a.style.jointRotationalConstraintRadius,z0=a.style.jointLineColor,hl=Br._lm;this._drawRotationalLimit(a,Ki,qo,sr,ge,E0,hl.lowerLimit,hl.upperLimit,z0);break;case 2:var D0=Br,hi=a.style.jointRotationalConstraintRadius,On=a.style.jointLineColor,go=D0._rotLm,fs=D0._translLm;this._drawRotationalLimit(a,yo,qo,sr,ge,hi,go.lowerLimit,go.upperLimit,On),this._drawTranslationalLimit(a,Ki,Fo,fs.lowerLimit,fs.upperLimit,On);break;case 3:a.style.jointRotationalConstraintRadius;var iv=a.style.jointLineColor,Mv=Br._lm;this._drawTranslationalLimit(a,Ki,Fo,Mv.lowerLimit,Mv.upperLimit,iv);break;case 4:var o_=Br,dv=a.style.jointRotationalConstraintRadius,Cs=a.style.jointLineColor,f_=o_._lm1,u_=o_._lm2;this._drawRotationalLimit(a,Ki,qo,sr,qo,dv,o_._angleX-f_.upperLimit,o_._angleX-f_.lowerLimit,Cs),this._drawRotationalLimit(a,yo,_i,ge,_i,dv,u_.lowerLimit-o_._angleZ,u_.upperLimit-o_._angleZ,Cs);break;case 5:var Ar=Br,Ts=a.style.jointRotationalConstraintRadius,lo=a.style.jointLineColor,Pe=Ar._twistLm;this._drawRotationalLimit(a,yo,ge,Ei,ge,Ts,Pe.lowerLimit-Ar._twistAngle,Pe.upperLimit-Ar._twistAngle,lo),this._drawEllipseOnSphere(a,Ki,Fo,qo,sr,Ar._maxSwingAngle1,Ar._maxSwingAngle2,Ts,lo);var zv=this._pool,Rs=zv.sizeVec3==0?new x.common.Vec3:zv.stackVec3[--zv.sizeVec3];Rs.x=yo.x,Rs.y=yo.y,Rs.z=yo.z;var x_=Rs,ov=x_.x+_i.x*Ts,i0=x_.y+_i.y*Ts,o0=x_.z+_i.z*Ts;x_.x=ov,x_.y=i0,x_.z=o0;var nv=x_;a.line(yo,nv,lo);var ti=this._pool,je=null,An=null,us=null;if(nv!=null){if(nv.zero(),ti.sizeVec3==ti.stackVec3.length){for(var F0=ti.sizeVec3<<1,Dv=new Array(F0),C_=Dv,m0=0,Bv=ti.sizeVec3;m0<Bv;){var n0=m0++;C_[n0]=ti.stackVec3[n0],ti.stackVec3[n0]=null}ti.stackVec3=C_}ti.stackVec3[ti.sizeVec3++]=nv}if(je!=null){var p0=1,N0=0,e0=0,s0=0,y0=1,Fv=0,ci=0,mv=0,hn=1;if(je.e00=p0,je.e01=N0,je.e02=e0,je.e10=s0,je.e11=y0,je.e12=Fv,je.e20=ci,je.e21=mv,je.e22=hn,ti.sizeMat3==ti.stackMat3.length){for(var Nv=ti.sizeMat3<<1,Hl=new Array(Nv),g0=Hl,I0=0,cl=ti.sizeMat3;I0<cl;){var dl=I0++;g0[dl]=ti.stackMat3[dl],ti.stackMat3[dl]=null}ti.stackMat3=g0}ti.stackMat3[ti.sizeMat3++]=je}if(An!=null){var Gv=1,jl=0,$l=0,bl=0,Bl=0,Al=1,Kl=0,fl=0,ql=0,ul=0,ii=1,xs=0,tn=0,pv=0,yh=0,Jv=1;if(An.e00=Gv,An.e01=jl,An.e02=$l,An.e03=bl,An.e10=Bl,An.e11=Al,An.e12=Kl,An.e13=fl,An.e20=ql,An.e21=ul,An.e22=ii,An.e23=xs,An.e30=tn,An.e31=pv,An.e32=yh,An.e33=Jv,ti.sizeMat4==ti.stackMat4.length){for(var G0=ti.sizeMat4<<1,xl=new Array(G0),V0=xl,k0=0,J0=ti.sizeMat4;k0<J0;){var zi=k0++;V0[zi]=ti.stackMat4[zi],ti.stackMat4[zi]=null}ti.stackMat4=V0}ti.stackMat4[ti.sizeMat4++]=An}if(us!=null){var Ms=0,ee=0,_0=0,Sl=1;if(us.x=Ms,us.y=ee,us.z=_0,us.w=Sl,ti.sizeQuat==ti.stackQuat.length){for(var lh=ti.sizeQuat<<1,W0=new Array(lh),hh=W0,U0=0,Pl=ti.sizeQuat;U0<Pl;){var Ml=U0++;hh[Ml]=ti.stackQuat[Ml],ti.stackQuat[Ml]=null}ti.stackQuat=hh}ti.stackQuat[ti.sizeQuat++]=us}break;case 6:var Ce=Br,w0=a.style.jointRotationalConstraintRadius,M_=a.style.jointLineColor,Cl=Ce._translLms[0],O0=Ce._translLms[1],H0=Ce._translLms[2],Tl=Ce._rotLms[0],zl=Ce._rotLms[1],X0=Ce._rotLms[2];this._drawTranslationalLimit3D(a,Ki,Fo,qo,sr,Cl,O0,H0,M_);var v0=this._pool,z_=v0.sizeVec3==0?new x.common.Vec3:v0.stackVec3[--v0.sizeVec3],Wv=z_;Wv.x=Ce._axisYX,Wv.y=Ce._axisYY,Wv.z=Ce._axisYZ;var Uv=this._pool,ev=Uv.sizeVec3==0?new x.common.Vec3:Uv.stackVec3[--Uv.sizeVec3];ev.x=Fo.x,ev.y=Fo.y,ev.z=Fo.z;var L0=ev,Av=this._pool,l0=Av.sizeVec3==0?new x.common.Vec3:Av.stackVec3[--Av.sizeVec3];l0.x=Fo.x,l0.y=Fo.y,l0.z=Fo.z;var se=l0,h0=se.y*z_.z-se.z*z_.y,Y0=se.z*z_.x-se.x*z_.z,Qs=se.x*z_.y-se.y*z_.x;se.x=h0,se.y=Y0,se.z=Qs;var j0=se;this._drawRotationalLimit(a,yo,qo,sr,qo,w0,Ce._angleX-Tl.upperLimit,Ce._angleX-Tl.lowerLimit,M_),this._drawRotationalLimit(a,yo,L0,j0,L0,w0,zl.lowerLimit-Ce._angleY,zl.upperLimit-Ce._angleY,M_),this._drawRotationalLimit(a,yo,_i,ge,_i,w0,X0.lowerLimit-Ce._angleZ,X0.upperLimit-Ce._angleZ,M_);break}a.line(Ki,yo,a.style.jointErrorColor);var yr=this._pool,cn=null,wi=null,Ov=null;if(As!=null){if(As.zero(),yr.sizeVec3==yr.stackVec3.length){for(var c0=yr.sizeVec3<<1,ch=new Array(c0),ah=ch,m_=0,$e=yr.sizeVec3;m_<$e;){var Es=m_++;ah[Es]=yr.stackVec3[Es],yr.stackVec3[Es]=null}yr.stackVec3=ah}yr.stackVec3[yr.sizeVec3++]=As}if(cn!=null){var th=1,bh=0,Rl=0,bi=0,n_=1,bn=0,yv=0,$0=0,gv=1;if(cn.e00=th,cn.e01=bh,cn.e02=Rl,cn.e10=bi,cn.e11=n_,cn.e12=bn,cn.e20=yv,cn.e21=$0,cn.e22=gv,yr.sizeMat3==yr.stackMat3.length){for(var ml=yr.sizeMat3<<1,pl=new Array(ml),yl=pl,T_=0,Sv=yr.sizeMat3;T_<Sv;){var Sn=T_++;yl[Sn]=yr.stackMat3[Sn],yr.stackMat3[Sn]=null}yr.stackMat3=yl}yr.stackMat3[yr.sizeMat3++]=cn}if(wi!=null){var Iv=1,Pv=0,R_=0,_e=0,Q_=0,Cv=1,Hv=0,oi=0,p_=0,ve=0,Jr=1,y_=0,Pn=0,K0=0,b0=0,fh=1;if(wi.e00=Iv,wi.e01=Pv,wi.e02=R_,wi.e03=_e,wi.e10=Q_,wi.e11=Cv,wi.e12=Hv,wi.e13=oi,wi.e20=p_,wi.e21=ve,wi.e22=Jr,wi.e23=y_,wi.e30=Pn,wi.e31=K0,wi.e32=b0,wi.e33=fh,yr.sizeMat4==yr.stackMat4.length){for(var q0=yr.sizeMat4<<1,al=new Array(q0),gl=al,Z0=0,uh=yr.sizeMat4;Z0<uh;){var Il=Z0++;gl[Il]=yr.stackMat4[Il],yr.stackMat4[Il]=null}yr.stackMat4=gl}yr.stackMat4[yr.sizeMat4++]=wi}if(Ov!=null){var gh=0,rh=0,Vl=0,d0=1;if(Ov.x=gh,Ov.y=rh,Ov.z=Vl,Ov.w=d0,yr.sizeQuat==yr.stackQuat.length){for(var B0=yr.sizeQuat<<1,kl=new Array(B0),ih=kl,jv=0,Ql=yr.sizeQuat;jv<Ql;){var $v=jv++;ih[$v]=yr.stackQuat[$v],yr.stackQuat[$v]=null}yr.stackQuat=ih}yr.stackQuat[yr.sizeQuat++]=Ov}var ni=this._pool,g_=null,rn=null,wl=null;if(bs!=null){if(bs.zero(),ni.sizeVec3==ni.stackVec3.length){for(var A0=ni.sizeVec3<<1,oh=new Array(A0),El=oh,tl=0,Dl=ni.sizeVec3;tl<Dl;){var S0=tl++;El[S0]=ni.stackVec3[S0],ni.stackVec3[S0]=null}ni.stackVec3=El}ni.stackVec3[ni.sizeVec3++]=bs}if(g_!=null){var nh=1,eh=0,Fl=0,Nl=0,sv=1,Tv=0,Kv=0,Ds=0,xh=1;if(g_.e00=nh,g_.e01=eh,g_.e02=Fl,g_.e10=Nl,g_.e11=sv,g_.e12=Tv,g_.e20=Kv,g_.e21=Ds,g_.e22=xh,ni.sizeMat3==ni.stackMat3.length){for(var f0=ni.sizeMat3<<1,Xl=new Array(f0),Rv=Xl,qv=0,Qv=ni.sizeMat3;qv<Qv;){var u0=qv++;Rv[u0]=ni.stackMat3[u0],ni.stackMat3[u0]=null}ni.stackMat3=Rv}ni.stackMat3[ni.sizeMat3++]=g_}if(rn!=null){var Zh=1,P0=0,a0=0,Gl=0,Jl=0,Mh=1,Ev=0,xi=0,Ve=0,le=0,C0=1,Wl=0,Fs=0,x0=0,Ll=0,Ul=1;if(rn.e00=Zh,rn.e01=P0,rn.e02=a0,rn.e03=Gl,rn.e10=Jl,rn.e11=Mh,rn.e12=Ev,rn.e13=xi,rn.e20=Ve,rn.e21=le,rn.e22=C0,rn.e23=Wl,rn.e30=Fs,rn.e31=x0,rn.e32=Ll,rn.e33=Ul,ni.sizeMat4==ni.stackMat4.length){for(var Ol=ni.sizeMat4<<1,Ih=new Array(Ol),_v=Ih,vv=0,T0=ni.sizeMat4;vv<T0;){var I_=vv++;_v[I_]=ni.stackMat4[I_],ni.stackMat4[I_]=null}ni.stackMat4=_v}ni.stackMat4[ni.sizeMat4++]=rn}if(wl!=null){var Yl=0,Vh=0,dh=0,t0=1;if(wl.x=Yl,wl.y=Vh,wl.z=dh,wl.w=t0,ni.sizeQuat==ni.stackQuat.length){for(var lv=ni.sizeQuat<<1,kh=new Array(lv),Zl=kh,wh=0,jh=ni.sizeQuat;wh<jh;){var sh=wh++;Zl[sh]=ni.stackQuat[sh],ni.stackQuat[sh]=null}ni.stackQuat=Zl}ni.stackQuat[ni.sizeQuat++]=wl}var Er=this._pool,e_=null,V_=null,_h=null;if(Ki!=null){if(Ki.zero(),Er.sizeVec3==Er.stackVec3.length){for(var Bh=Er.sizeVec3<<1,Ah=new Array(Bh),zh=Ah,Vv=0,Rh=Er.sizeVec3;Vv<Rh;){var Qh=Vv++;zh[Qh]=Er.stackVec3[Qh],Er.stackVec3[Qh]=null}Er.stackVec3=zh}Er.stackVec3[Er.sizeVec3++]=Ki}if(e_!=null){var $h=1,Kh=0,mh=0,Sh=0,rl=1,rc=0,Xh=0,E_=0,Eh=1;if(e_.e00=$h,e_.e01=Kh,e_.e02=mh,e_.e10=Sh,e_.e11=rl,e_.e12=rc,e_.e20=Xh,e_.e21=E_,e_.e22=Eh,Er.sizeMat3==Er.stackMat3.length){for(var ph=Er.sizeMat3<<1,qh=new Array(ph),Lh=qh,ac=0,Ph=Er.sizeMat3;ac<Ph;){var R0=ac++;Lh[R0]=Er.stackMat3[R0],Er.stackMat3[R0]=null}Er.stackMat3=Lh}Er.stackMat3[Er.sizeMat3++]=e_}if(V_!=null){var ic=1,vh=0,Yh=0,Dh=0,Ch=0,Q0=1,M0=0,nc=0,ec=0,Fh=0,oc=1,tc=0,il=0,Xc=0,Lc=0,yc=1;if(V_.e00=ic,V_.e01=vh,V_.e02=Yh,V_.e03=Dh,V_.e10=Ch,V_.e11=Q0,V_.e12=M0,V_.e13=nc,V_.e20=ec,V_.e21=Fh,V_.e22=oc,V_.e23=tc,V_.e30=il,V_.e31=Xc,V_.e32=Lc,V_.e33=yc,Er.sizeMat4==Er.stackMat4.length){for(var gc=Er.sizeMat4<<1,Yc=new Array(gc),_c=Yc,Th=0,Zc=Er.sizeMat4;Th<Zc;){var Mc=Th++;_c[Mc]=Er.stackMat4[Mc],Er.stackMat4[Mc]=null}Er.stackMat4=_c}Er.stackMat4[Er.sizeMat4++]=V_}if(_h!=null){var Ic=0,Vc=0,dc=0,zc=1;if(_h.x=Ic,_h.y=Vc,_h.z=dc,_h.w=zc,Er.sizeQuat==Er.stackQuat.length){for(var Vf=Er.sizeQuat<<1,kf=new Array(Vf),lb=kf,hb=0,wf=Er.sizeQuat;hb<wf;){var Bc=hb++;lb[Bc]=Er.stackQuat[Bc],Er.stackQuat[Bc]=null}Er.stackQuat=lb}Er.stackQuat[Er.sizeQuat++]=_h}var fn=this._pool,Nh=null,ol=null,vc=null;if(yo!=null){if(yo.zero(),fn.sizeVec3==fn.stackVec3.length){for(var Xf=fn.sizeVec3<<1,Lf=new Array(Xf),cb=Lf,bb=0,Yf=fn.sizeVec3;bb<Yf;){var Ac=bb++;cb[Ac]=fn.stackVec3[Ac],fn.stackVec3[Ac]=null}fn.stackVec3=cb}fn.stackVec3[fn.sizeVec3++]=yo}if(Nh!=null){var Zf=1,df=0,Bf=0,Af=0,Sf=1,Pf=0,Cf=0,Tf=0,Rf=1;if(Nh.e00=Zf,Nh.e01=df,Nh.e02=Bf,Nh.e10=Af,Nh.e11=Sf,Nh.e12=Pf,Nh.e20=Cf,Nh.e21=Tf,Nh.e22=Rf,fn.sizeMat3==fn.stackMat3.length){for(var Qf=fn.sizeMat3<<1,Ef=new Array(Qf),fb=Ef,ub=0,Df=fn.sizeMat3;ub<Df;){var Sc=ub++;fb[Sc]=fn.stackMat3[Sc],fn.stackMat3[Sc]=null}fn.stackMat3=fb}fn.stackMat3[fn.sizeMat3++]=Nh}if(ol!=null){var Ff=1,Nf=0,Gf=0,Jf=0,Wf=0,Uf=1,Of=0,Hf=0,jf=0,$f=0,Kf=1,qf=0,au=0,tu=0,ru=0,iu=1;if(ol.e00=Ff,ol.e01=Nf,ol.e02=Gf,ol.e03=Jf,ol.e10=Wf,ol.e11=Uf,ol.e12=Of,ol.e13=Hf,ol.e20=jf,ol.e21=$f,ol.e22=Kf,ol.e23=qf,ol.e30=au,ol.e31=tu,ol.e32=ru,ol.e33=iu,fn.sizeMat4==fn.stackMat4.length){for(var ou=fn.sizeMat4<<1,nu=new Array(ou),xb=nu,Mb=0,eu=fn.sizeMat4;Mb<eu;){var Pc=Mb++;xb[Pc]=fn.stackMat4[Pc],fn.stackMat4[Pc]=null}fn.stackMat4=xb}fn.stackMat4[fn.sizeMat4++]=ol}if(vc!=null){var su=0,_u=0,vu=0,lu=1;if(vc.x=su,vc.y=_u,vc.z=vu,vc.w=lu,fn.sizeQuat==fn.stackQuat.length){for(var hu=fn.sizeQuat<<1,cu=new Array(hu),zb=cu,mb=0,bu=fn.sizeQuat;mb<bu;){var Cc=mb++;zb[Cc]=fn.stackQuat[Cc],fn.stackQuat[Cc]=null}fn.stackQuat=zb}fn.stackQuat[fn.sizeQuat++]=vc}var un=this._pool,Gh=null,nl=null,lc=null;if(Fo!=null){if(Fo.zero(),un.sizeVec3==un.stackVec3.length){for(var fu=un.sizeVec3<<1,uu=new Array(fu),pb=uu,yb=0,xu=un.sizeVec3;yb<xu;){var Tc=yb++;pb[Tc]=un.stackVec3[Tc],un.stackVec3[Tc]=null}un.stackVec3=pb}un.stackVec3[un.sizeVec3++]=Fo}if(Gh!=null){var Mu=1,zu=0,mu=0,pu=0,yu=1,gu=0,Iu=0,Vu=0,ku=1;if(Gh.e00=Mu,Gh.e01=zu,Gh.e02=mu,Gh.e10=pu,Gh.e11=yu,Gh.e12=gu,Gh.e20=Iu,Gh.e21=Vu,Gh.e22=ku,un.sizeMat3==un.stackMat3.length){for(var wu=un.sizeMat3<<1,Xu=new Array(wu),gb=Xu,Ib=0,Lu=un.sizeMat3;Ib<Lu;){var Rc=Ib++;gb[Rc]=un.stackMat3[Rc],un.stackMat3[Rc]=null}un.stackMat3=gb}un.stackMat3[un.sizeMat3++]=Gh}if(nl!=null){var Yu=1,Zu=0,du=0,Bu=0,Au=0,Su=1,Pu=0,Cu=0,Tu=0,Ru=0,Qu=1,Eu=0,Du=0,Fu=0,Nu=0,Gu=1;if(nl.e00=Yu,nl.e01=Zu,nl.e02=du,nl.e03=Bu,nl.e10=Au,nl.e11=Su,nl.e12=Pu,nl.e13=Cu,nl.e20=Tu,nl.e21=Ru,nl.e22=Qu,nl.e23=Eu,nl.e30=Du,nl.e31=Fu,nl.e32=Nu,nl.e33=Gu,un.sizeMat4==un.stackMat4.length){for(var Ju=un.sizeMat4<<1,Wu=new Array(Ju),Vb=Wu,kb=0,Uu=un.sizeMat4;kb<Uu;){var Qc=kb++;Vb[Qc]=un.stackMat4[Qc],un.stackMat4[Qc]=null}un.stackMat4=Vb}un.stackMat4[un.sizeMat4++]=nl}if(lc!=null){var Ou=0,Hu=0,ju=0,$u=1;if(lc.x=Ou,lc.y=Hu,lc.z=ju,lc.w=$u,un.sizeQuat==un.stackQuat.length){for(var Ku=un.sizeQuat<<1,qu=new Array(Ku),wb=qu,Xb=0,ax=un.sizeQuat;Xb<ax;){var Ec=Xb++;wb[Ec]=un.stackQuat[Ec],un.stackQuat[Ec]=null}un.stackQuat=wb}un.stackQuat[un.sizeQuat++]=lc}var xn=this._pool,Jh=null,el=null,hc=null;if(qo!=null){if(qo.zero(),xn.sizeVec3==xn.stackVec3.length){for(var tx=xn.sizeVec3<<1,rx=new Array(tx),Lb=rx,Yb=0,ix=xn.sizeVec3;Yb<ix;){var Dc=Yb++;Lb[Dc]=xn.stackVec3[Dc],xn.stackVec3[Dc]=null}xn.stackVec3=Lb}xn.stackVec3[xn.sizeVec3++]=qo}if(Jh!=null){var ox=1,nx=0,ex=0,sx=0,_x=1,vx=0,lx=0,hx=0,cx=1;if(Jh.e00=ox,Jh.e01=nx,Jh.e02=ex,Jh.e10=sx,Jh.e11=_x,Jh.e12=vx,Jh.e20=lx,Jh.e21=hx,Jh.e22=cx,xn.sizeMat3==xn.stackMat3.length){for(var bx=xn.sizeMat3<<1,fx=new Array(bx),Zb=fx,db=0,ux=xn.sizeMat3;db<ux;){var Fc=db++;Zb[Fc]=xn.stackMat3[Fc],xn.stackMat3[Fc]=null}xn.stackMat3=Zb}xn.stackMat3[xn.sizeMat3++]=Jh}if(el!=null){var xx=1,Mx=0,zx=0,mx=0,px=0,yx=1,gx=0,Ix=0,Vx=0,kx=0,wx=1,Xx=0,Lx=0,Yx=0,Zx=0,dx=1;if(el.e00=xx,el.e01=Mx,el.e02=zx,el.e03=mx,el.e10=px,el.e11=yx,el.e12=gx,el.e13=Ix,el.e20=Vx,el.e21=kx,el.e22=wx,el.e23=Xx,el.e30=Lx,el.e31=Yx,el.e32=Zx,el.e33=dx,xn.sizeMat4==xn.stackMat4.length){for(var Bx=xn.sizeMat4<<1,Ax=new Array(Bx),Bb=Ax,Ab=0,Sx=xn.sizeMat4;Ab<Sx;){var Nc=Ab++;Bb[Nc]=xn.stackMat4[Nc],xn.stackMat4[Nc]=null}xn.stackMat4=Bb}xn.stackMat4[xn.sizeMat4++]=el}if(hc!=null){var Px=0,Cx=0,Tx=0,Rx=1;if(hc.x=Px,hc.y=Cx,hc.z=Tx,hc.w=Rx,xn.sizeQuat==xn.stackQuat.length){for(var Qx=xn.sizeQuat<<1,Ex=new Array(Qx),Sb=Ex,Pb=0,Dx=xn.sizeQuat;Pb<Dx;){var Gc=Pb++;Sb[Gc]=xn.stackQuat[Gc],xn.stackQuat[Gc]=null}xn.stackQuat=Sb}xn.stackQuat[xn.sizeQuat++]=hc}var Mn=this._pool,Wh=null,sl=null,cc=null;if(sr!=null){if(sr.zero(),Mn.sizeVec3==Mn.stackVec3.length){for(var Fx=Mn.sizeVec3<<1,Nx=new Array(Fx),Cb=Nx,Tb=0,Gx=Mn.sizeVec3;Tb<Gx;){var Jc=Tb++;Cb[Jc]=Mn.stackVec3[Jc],Mn.stackVec3[Jc]=null}Mn.stackVec3=Cb}Mn.stackVec3[Mn.sizeVec3++]=sr}if(Wh!=null){var Jx=1,Wx=0,Ux=0,Ox=0,Hx=1,jx=0,$x=0,Kx=0,qx=1;if(Wh.e00=Jx,Wh.e01=Wx,Wh.e02=Ux,Wh.e10=Ox,Wh.e11=Hx,Wh.e12=jx,Wh.e20=$x,Wh.e21=Kx,Wh.e22=qx,Mn.sizeMat3==Mn.stackMat3.length){for(var a2=Mn.sizeMat3<<1,t2=new Array(a2),Rb=t2,Qb=0,r2=Mn.sizeMat3;Qb<r2;){var Wc=Qb++;Rb[Wc]=Mn.stackMat3[Wc],Mn.stackMat3[Wc]=null}Mn.stackMat3=Rb}Mn.stackMat3[Mn.sizeMat3++]=Wh}if(sl!=null){var i2=1,o2=0,n2=0,e2=0,s2=0,_2=1,v2=0,l2=0,h2=0,c2=0,b2=1,f2=0,u2=0,x2=0,M2=0,z2=1;if(sl.e00=i2,sl.e01=o2,sl.e02=n2,sl.e03=e2,sl.e10=s2,sl.e11=_2,sl.e12=v2,sl.e13=l2,sl.e20=h2,sl.e21=c2,sl.e22=b2,sl.e23=f2,sl.e30=u2,sl.e31=x2,sl.e32=M2,sl.e33=z2,Mn.sizeMat4==Mn.stackMat4.length){for(var m2=Mn.sizeMat4<<1,p2=new Array(m2),Eb=p2,Db=0,y2=Mn.sizeMat4;Db<y2;){var Uc=Db++;Eb[Uc]=Mn.stackMat4[Uc],Mn.stackMat4[Uc]=null}Mn.stackMat4=Eb}Mn.stackMat4[Mn.sizeMat4++]=sl}if(cc!=null){var g2=0,I2=0,V2=0,k2=1;if(cc.x=g2,cc.y=I2,cc.z=V2,cc.w=k2,Mn.sizeQuat==Mn.stackQuat.length){for(var w2=Mn.sizeQuat<<1,X2=new Array(w2),Fb=X2,Nb=0,L2=Mn.sizeQuat;Nb<L2;){var Oc=Nb++;Fb[Oc]=Mn.stackQuat[Oc],Mn.stackQuat[Oc]=null}Mn.stackQuat=Fb}Mn.stackQuat[Mn.sizeQuat++]=cc}var zn=this._pool,Uh=null,_l=null,bc=null;if(_i!=null){if(_i.zero(),zn.sizeVec3==zn.stackVec3.length){for(var Y2=zn.sizeVec3<<1,Z2=new Array(Y2),Gb=Z2,Jb=0,d2=zn.sizeVec3;Jb<d2;){var Hc=Jb++;Gb[Hc]=zn.stackVec3[Hc],zn.stackVec3[Hc]=null}zn.stackVec3=Gb}zn.stackVec3[zn.sizeVec3++]=_i}if(Uh!=null){var B2=1,A2=0,S2=0,P2=0,C2=1,T2=0,R2=0,Q2=0,E2=1;if(Uh.e00=B2,Uh.e01=A2,Uh.e02=S2,Uh.e10=P2,Uh.e11=C2,Uh.e12=T2,Uh.e20=R2,Uh.e21=Q2,Uh.e22=E2,zn.sizeMat3==zn.stackMat3.length){for(var D2=zn.sizeMat3<<1,F2=new Array(D2),Wb=F2,Ub=0,N2=zn.sizeMat3;Ub<N2;){var jc=Ub++;Wb[jc]=zn.stackMat3[jc],zn.stackMat3[jc]=null}zn.stackMat3=Wb}zn.stackMat3[zn.sizeMat3++]=Uh}if(_l!=null){var G2=1,J2=0,W2=0,U2=0,O2=0,H2=1,j2=0,$2=0,K2=0,q2=0,aM=1,tM=0,rM=0,iM=0,oM=0,nM=1;if(_l.e00=G2,_l.e01=J2,_l.e02=W2,_l.e03=U2,_l.e10=O2,_l.e11=H2,_l.e12=j2,_l.e13=$2,_l.e20=K2,_l.e21=q2,_l.e22=aM,_l.e23=tM,_l.e30=rM,_l.e31=iM,_l.e32=oM,_l.e33=nM,zn.sizeMat4==zn.stackMat4.length){for(var eM=zn.sizeMat4<<1,sM=new Array(eM),Ob=sM,Hb=0,_M=zn.sizeMat4;Hb<_M;){var $c=Hb++;Ob[$c]=zn.stackMat4[$c],zn.stackMat4[$c]=null}zn.stackMat4=Ob}zn.stackMat4[zn.sizeMat4++]=_l}if(bc!=null){var vM=0,lM=0,hM=0,cM=1;if(bc.x=vM,bc.y=lM,bc.z=hM,bc.w=cM,zn.sizeQuat==zn.stackQuat.length){for(var bM=zn.sizeQuat<<1,fM=new Array(bM),jb=fM,$b=0,uM=zn.sizeQuat;$b<uM;){var Kc=$b++;jb[Kc]=zn.stackQuat[Kc],zn.stackQuat[Kc]=null}zn.stackQuat=jb}zn.stackQuat[zn.sizeQuat++]=bc}var mn=this._pool,Oh=null,vl=null,fc=null;if(ge!=null){if(ge.zero(),mn.sizeVec3==mn.stackVec3.length){for(var xM=mn.sizeVec3<<1,MM=new Array(xM),Kb=MM,qb=0,zM=mn.sizeVec3;qb<zM;){var qc=qb++;Kb[qc]=mn.stackVec3[qc],mn.stackVec3[qc]=null}mn.stackVec3=Kb}mn.stackVec3[mn.sizeVec3++]=ge}if(Oh!=null){var mM=1,pM=0,yM=0,gM=0,IM=1,VM=0,kM=0,wM=0,XM=1;if(Oh.e00=mM,Oh.e01=pM,Oh.e02=yM,Oh.e10=gM,Oh.e11=IM,Oh.e12=VM,Oh.e20=kM,Oh.e21=wM,Oh.e22=XM,mn.sizeMat3==mn.stackMat3.length){for(var LM=mn.sizeMat3<<1,YM=new Array(LM),af=YM,tf=0,ZM=mn.sizeMat3;tf<ZM;){var ab=tf++;af[ab]=mn.stackMat3[ab],mn.stackMat3[ab]=null}mn.stackMat3=af}mn.stackMat3[mn.sizeMat3++]=Oh}if(vl!=null){var dM=1,BM=0,AM=0,SM=0,PM=0,CM=1,TM=0,RM=0,QM=0,EM=0,DM=1,FM=0,NM=0,GM=0,JM=0,WM=1;if(vl.e00=dM,vl.e01=BM,vl.e02=AM,vl.e03=SM,vl.e10=PM,vl.e11=CM,vl.e12=TM,vl.e13=RM,vl.e20=QM,vl.e21=EM,vl.e22=DM,vl.e23=FM,vl.e30=NM,vl.e31=GM,vl.e32=JM,vl.e33=WM,mn.sizeMat4==mn.stackMat4.length){for(var UM=mn.sizeMat4<<1,OM=new Array(UM),rf=OM,of=0,HM=mn.sizeMat4;of<HM;){var tb=of++;rf[tb]=mn.stackMat4[tb],mn.stackMat4[tb]=null}mn.stackMat4=rf}mn.stackMat4[mn.sizeMat4++]=vl}if(fc!=null){var jM=0,$M=0,KM=0,qM=1;if(fc.x=jM,fc.y=$M,fc.z=KM,fc.w=qM,mn.sizeQuat==mn.stackQuat.length){for(var az=mn.sizeQuat<<1,tz=new Array(az),nf=tz,ef=0,rz=mn.sizeQuat;ef<rz;){var rb=ef++;nf[rb]=mn.stackQuat[rb],mn.stackQuat[rb]=null}mn.stackQuat=nf}mn.stackQuat[mn.sizeQuat++]=fc}var pn=this._pool,Hh=null,ll=null,uc=null;if(Ei!=null){if(Ei.zero(),pn.sizeVec3==pn.stackVec3.length){for(var iz=pn.sizeVec3<<1,oz=new Array(iz),sf=oz,_f=0,nz=pn.sizeVec3;_f<nz;){var ib=_f++;sf[ib]=pn.stackVec3[ib],pn.stackVec3[ib]=null}pn.stackVec3=sf}pn.stackVec3[pn.sizeVec3++]=Ei}if(Hh!=null){var ez=1,sz=0,_z=0,vz=0,lz=1,hz=0,cz=0,bz=0,fz=1;if(Hh.e00=ez,Hh.e01=sz,Hh.e02=_z,Hh.e10=vz,Hh.e11=lz,Hh.e12=hz,Hh.e20=cz,Hh.e21=bz,Hh.e22=fz,pn.sizeMat3==pn.stackMat3.length){for(var uz=pn.sizeMat3<<1,xz=new Array(uz),vf=xz,lf=0,Mz=pn.sizeMat3;lf<Mz;){var ob=lf++;vf[ob]=pn.stackMat3[ob],pn.stackMat3[ob]=null}pn.stackMat3=vf}pn.stackMat3[pn.sizeMat3++]=Hh}if(ll!=null){var zz=1,mz=0,pz=0,yz=0,gz=0,Iz=1,Vz=0,kz=0,wz=0,Xz=0,Lz=1,Yz=0,Zz=0,dz=0,Bz=0,Az=1;if(ll.e00=zz,ll.e01=mz,ll.e02=pz,ll.e03=yz,ll.e10=gz,ll.e11=Iz,ll.e12=Vz,ll.e13=kz,ll.e20=wz,ll.e21=Xz,ll.e22=Lz,ll.e23=Yz,ll.e30=Zz,ll.e31=dz,ll.e32=Bz,ll.e33=Az,pn.sizeMat4==pn.stackMat4.length){for(var Sz=pn.sizeMat4<<1,Pz=new Array(Sz),hf=Pz,cf=0,Cz=pn.sizeMat4;cf<Cz;){var nb=cf++;hf[nb]=pn.stackMat4[nb],pn.stackMat4[nb]=null}pn.stackMat4=hf}pn.stackMat4[pn.sizeMat4++]=ll}if(uc!=null){var Tz=0,Rz=0,Qz=0,Ez=1;if(uc.x=Tz,uc.y=Rz,uc.z=Qz,uc.w=Ez,pn.sizeQuat==pn.stackQuat.length){for(var Dz=pn.sizeQuat<<1,Fz=new Array(Dz),bf=Fz,ff=0,Nz=pn.sizeQuat;ff<Nz;){var eb=ff++;bf[eb]=pn.stackQuat[eb],pn.stackQuat[eb]=null}pn.stackQuat=bf}pn.stackQuat[pn.sizeQuat++]=uc}Br=av}}_drawRotationalLimit(a,t,r,i,o,_,s,h,v){if(s!=h){var e=this._pool,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var u=l,b=u.x+o.x*_,f=u.y+o.y*_,n=u.z+o.z*_;u.x=b,u.y=f,u.z=n;var c=u;a.line(t,c,v);var M=this._pool,m=null,y=null,V=null;if(c!=null){if(c.zero(),M.sizeVec3==M.stackVec3.length){for(var z=M.sizeVec3<<1,I=new Array(z),k=I,X=0,L=M.sizeVec3;X<L;){var p=X++;k[p]=M.stackVec3[p],M.stackVec3[p]=null}M.stackVec3=k}M.stackVec3[M.sizeVec3++]=c}if(m!=null){var g=1,N=0,A=0,F=0,S=1,Y=0,R=0,C=0,d=1;if(m.e00=g,m.e01=N,m.e02=A,m.e10=F,m.e11=S,m.e12=Y,m.e20=R,m.e21=C,m.e22=d,M.sizeMat3==M.stackMat3.length){for(var Z=M.sizeMat3<<1,$=new Array(Z),j=$,E=0,G=M.sizeMat3;E<G;){var B=E++;j[B]=M.stackMat3[B],M.stackMat3[B]=null}M.stackMat3=j}M.stackMat3[M.sizeMat3++]=m}if(y!=null){var Q=1,U=0,J=0,D=0,H=0,K=1,ra=0,sa=0,W=0,q=0,na=1,oa=0,aa=0,T=0,ca=0,_a=1;if(y.e00=Q,y.e01=U,y.e02=J,y.e03=D,y.e10=H,y.e11=K,y.e12=ra,y.e13=sa,y.e20=W,y.e21=q,y.e22=na,y.e23=oa,y.e30=aa,y.e31=T,y.e32=ca,y.e33=_a,M.sizeMat4==M.stackMat4.length){for(var w=M.sizeMat4<<1,ta=new Array(w),ia=ta,la=0,va=M.sizeMat4;la<va;){var xa=la++;ia[xa]=M.stackMat4[xa],M.stackMat4[xa]=null}M.stackMat4=ia}M.stackMat4[M.sizeMat4++]=y}if(V!=null){var Ma=0,za=0,Xa=0,Za=1;if(V.x=Ma,V.y=za,V.z=Xa,V.w=Za,M.sizeQuat==M.stackQuat.length){for(var fa=M.sizeQuat<<1,ba=new Array(fa),ea=ba,ha=0,pa=M.sizeQuat;ha<pa;){var ya=ha++;ea[ya]=M.stackQuat[ya],M.stackQuat[ya]=null}M.stackQuat=ea}M.stackQuat[M.sizeQuat++]=V}s>h?a.ellipse(t,r,i,_,_,v):a.arc(t,r,i,_,_,s,h,!0,v)}}_drawTranslationalLimit(a,t,r,i,o,_){if(i<o){var s=this._pool,h=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3];h.x=t.x,h.y=t.y,h.z=t.z;var v=h,e=v.x+r.x*i,l=v.y+r.y*i,u=v.z+r.z*i;v.x=e,v.y=l,v.z=u;var b=v,f=this._pool,n=f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3];n.x=t.x,n.y=t.y,n.z=t.z;var c=n,M=c.x+r.x*o,m=c.y+r.y*o,y=c.z+r.z*o;c.x=M,c.y=m,c.z=y;var V=c;a.line(b,V,_);var z=this._pool,I=null,k=null,X=null;if(b!=null){if(b.zero(),z.sizeVec3==z.stackVec3.length){for(var L=z.sizeVec3<<1,p=new Array(L),g=p,N=0,A=z.sizeVec3;N<A;){var F=N++;g[F]=z.stackVec3[F],z.stackVec3[F]=null}z.stackVec3=g}z.stackVec3[z.sizeVec3++]=b}if(I!=null){var S=1,Y=0,R=0,C=0,d=1,Z=0,$=0,j=0,E=1;if(I.e00=S,I.e01=Y,I.e02=R,I.e10=C,I.e11=d,I.e12=Z,I.e20=$,I.e21=j,I.e22=E,z.sizeMat3==z.stackMat3.length){for(var G=z.sizeMat3<<1,B=new Array(G),Q=B,U=0,J=z.sizeMat3;U<J;){var D=U++;Q[D]=z.stackMat3[D],z.stackMat3[D]=null}z.stackMat3=Q}z.stackMat3[z.sizeMat3++]=I}if(k!=null){var H=1,K=0,ra=0,sa=0,W=0,q=1,na=0,oa=0,aa=0,T=0,ca=1,_a=0,w=0,ta=0,ia=0,la=1;if(k.e00=H,k.e01=K,k.e02=ra,k.e03=sa,k.e10=W,k.e11=q,k.e12=na,k.e13=oa,k.e20=aa,k.e21=T,k.e22=ca,k.e23=_a,k.e30=w,k.e31=ta,k.e32=ia,k.e33=la,z.sizeMat4==z.stackMat4.length){for(var va=z.sizeMat4<<1,xa=new Array(va),Ma=xa,za=0,Xa=z.sizeMat4;za<Xa;){var Za=za++;Ma[Za]=z.stackMat4[Za],z.stackMat4[Za]=null}z.stackMat4=Ma}z.stackMat4[z.sizeMat4++]=k}if(X!=null){var fa=0,ba=0,ea=0,ha=1;if(X.x=fa,X.y=ba,X.z=ea,X.w=ha,z.sizeQuat==z.stackQuat.length){for(var pa=z.sizeQuat<<1,ya=new Array(pa),da=ya,ma=0,Ya=z.sizeQuat;ma<Ya;){var Qa=ma++;da[Qa]=z.stackQuat[Qa],z.stackQuat[Qa]=null}z.stackQuat=da}z.stackQuat[z.sizeQuat++]=X}var ga=this._pool,ua=null,wa=null,ka=null;if(V!=null){if(V.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Pa=ga.sizeVec3<<1,Mt=new Array(Pa),Ha=Mt,Ba=0,nt=ga.sizeVec3;Ba<nt;){var Ea=Ba++;Ha[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Ha}ga.stackVec3[ga.sizeVec3++]=V}if(ua!=null){var Fa=1,Aa=0,ft=0,Ua=0,ja=1,bt=0,rt=0,$a=0,_t=1;if(ua.e00=Fa,ua.e01=Aa,ua.e02=ft,ua.e10=Ua,ua.e11=ja,ua.e12=bt,ua.e20=rt,ua.e21=$a,ua.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,mt=new Array(gt),Wa=mt,it=0,ut=ga.sizeMat3;it<ut;){var Da=it++;Wa[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Wa}ga.stackMat3[ga.sizeMat3++]=ua}if(wa!=null){var Ta=1,Na=0,Vt=0,Pt=0,et=0,Xt=1,Yt=0,zt=0,Ia=0,O=0,Va=1,lt=0,P=0,wt=0,Bt=0,At=1;if(wa.e00=Ta,wa.e01=Na,wa.e02=Vt,wa.e03=Pt,wa.e10=et,wa.e11=Xt,wa.e12=Yt,wa.e13=zt,wa.e20=Ia,wa.e21=O,wa.e22=Va,wa.e23=lt,wa.e30=P,wa.e31=wt,wa.e32=Bt,wa.e33=At,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,kt=new Array(yt),pt=kt,ht=0,xt=ga.sizeMat4;ht<xt;){var Ra=ht++;pt[Ra]=ga.stackMat4[Ra],ga.stackMat4[Ra]=null}ga.stackMat4=pt}ga.stackMat4[ga.sizeMat4++]=wa}if(ka!=null){var st=0,Ca=0,vt=0,qa=1;if(ka.x=st,ka.y=Ca,ka.z=vt,ka.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Oa=new Array(at),tt=Oa,ct=0,Sa=ga.sizeQuat;ct<Sa;){var Ga=ct++;tt[Ga]=ga.stackQuat[Ga],ga.stackQuat[Ga]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=ka}}}_drawTranslationalLimit3D(a,t,r,i,o,_,s,h,v){var e=_.lowerLimit,l=_.upperLimit,u=s.lowerLimit,b=s.upperLimit,f=h.lowerLimit,n=h.upperLimit,c=this._pool;c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3];var M=this._pool;M.sizeVec3==0?new x.common.Vec3:M.stackVec3[--M.sizeVec3];var m=this._pool,y=m.sizeVec3==0?new x.common.Vec3:m.stackVec3[--m.sizeVec3];y.x=t.x,y.y=t.y,y.z=t.z;var V=y,z=V.x+r.x*e,I=V.y+r.y*e,k=V.z+r.z*e;V.x=z,V.y=I,V.z=k;var X=V,L=X.x+i.x*u,p=X.y+i.y*u,g=X.z+i.z*u;X.x=L,X.y=p,X.z=g;var N=X,A=N.x+o.x*f,F=N.y+o.y*f,S=N.z+o.z*f;N.x=A,N.y=F,N.z=S;var Y=N,R=this._pool,C=R.sizeVec3==0?new x.common.Vec3:R.stackVec3[--R.sizeVec3];C.x=t.x,C.y=t.y,C.z=t.z;var d=C,Z=d.x+r.x*e,$=d.y+r.y*e,j=d.z+r.z*e;d.x=Z,d.y=$,d.z=j;var E=d,G=E.x+i.x*u,B=E.y+i.y*u,Q=E.z+i.z*u;E.x=G,E.y=B,E.z=Q;var U=E,J=U.x+o.x*n,D=U.y+o.y*n,H=U.z+o.z*n;U.x=J,U.y=D,U.z=H;var K=U,ra=this._pool,sa=ra.sizeVec3==0?new x.common.Vec3:ra.stackVec3[--ra.sizeVec3];sa.x=t.x,sa.y=t.y,sa.z=t.z;var W=sa,q=W.x+r.x*e,na=W.y+r.y*e,oa=W.z+r.z*e;W.x=q,W.y=na,W.z=oa;var aa=W,T=aa.x+i.x*b,ca=aa.y+i.y*b,_a=aa.z+i.z*b;aa.x=T,aa.y=ca,aa.z=_a;var w=aa,ta=w.x+o.x*f,ia=w.y+o.y*f,la=w.z+o.z*f;w.x=ta,w.y=ia,w.z=la;var va=w,xa=this._pool,Ma=xa.sizeVec3==0?new x.common.Vec3:xa.stackVec3[--xa.sizeVec3];Ma.x=t.x,Ma.y=t.y,Ma.z=t.z;var za=Ma,Xa=za.x+r.x*e,Za=za.y+r.y*e,fa=za.z+r.z*e;za.x=Xa,za.y=Za,za.z=fa;var ba=za,ea=ba.x+i.x*b,ha=ba.y+i.y*b,pa=ba.z+i.z*b;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+o.x*n,ma=ya.y+o.y*n,Ya=ya.z+o.z*n;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya,ga=this._pool,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3];ua.x=t.x,ua.y=t.y,ua.z=t.z;var wa=ua,ka=wa.x+r.x*l,Pa=wa.y+r.y*l,Mt=wa.z+r.z*l;wa.x=ka,wa.y=Pa,wa.z=Mt;var Ha=wa,Ba=Ha.x+i.x*u,nt=Ha.y+i.y*u,Ea=Ha.z+i.z*u;Ha.x=Ba,Ha.y=nt,Ha.z=Ea;var Fa=Ha,Aa=Fa.x+o.x*f,ft=Fa.y+o.y*f,Ua=Fa.z+o.z*f;Fa.x=Aa,Fa.y=ft,Fa.z=Ua;var ja=Fa,bt=this._pool,rt=bt.sizeVec3==0?new x.common.Vec3:bt.stackVec3[--bt.sizeVec3];rt.x=t.x,rt.y=t.y,rt.z=t.z;var $a=rt,_t=$a.x+r.x*l,gt=$a.y+r.y*l,mt=$a.z+r.z*l;$a.x=_t,$a.y=gt,$a.z=mt;var Wa=$a,it=Wa.x+i.x*u,ut=Wa.y+i.y*u,Da=Wa.z+i.z*u;Wa.x=it,Wa.y=ut,Wa.z=Da;var Ta=Wa,Na=Ta.x+o.x*n,Vt=Ta.y+o.y*n,Pt=Ta.z+o.z*n;Ta.x=Na,Ta.y=Vt,Ta.z=Pt;var et=Ta,Xt=this._pool,Yt=Xt.sizeVec3==0?new x.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=t.x,Yt.y=t.y,Yt.z=t.z;var zt=Yt,Ia=zt.x+r.x*l,O=zt.y+r.y*l,Va=zt.z+r.z*l;zt.x=Ia,zt.y=O,zt.z=Va;var lt=zt,P=lt.x+i.x*b,wt=lt.y+i.y*b,Bt=lt.z+i.z*b;lt.x=P,lt.y=wt,lt.z=Bt;var At=lt,yt=At.x+o.x*f,kt=At.y+o.y*f,pt=At.z+o.z*f;At.x=yt,At.y=kt,At.z=pt;var ht=At,xt=this._pool,Ra=xt.sizeVec3==0?new x.common.Vec3:xt.stackVec3[--xt.sizeVec3];Ra.x=t.x,Ra.y=t.y,Ra.z=t.z;var st=Ra,Ca=st.x+r.x*l,vt=st.y+r.y*l,qa=st.z+r.z*l;st.x=Ca,st.y=vt,st.z=qa;var at=st,Oa=at.x+i.x*b,tt=at.y+i.y*b,ct=at.z+i.z*b;at.x=Oa,at.y=tt,at.z=ct;var Sa=at,Ga=Sa.x+o.x*n,Ka=Sa.y+o.y*n,La=Sa.z+o.z*n;Sa.x=Ga,Sa.y=Ka,Sa.z=La;var ot=Sa;a.line(Y,ja,v),a.line(va,ht,v),a.line(K,et,v),a.line(Qa,ot,v),a.line(Y,va,v),a.line(ja,ht,v),a.line(K,Qa,v),a.line(et,ot,v),a.line(Y,K,v),a.line(ja,et,v),a.line(va,Qa,v),a.line(ht,ot,v);var It=this._pool;if(Y!=null){if(Y.zero(),It.sizeVec3==It.stackVec3.length){for(var or=It.sizeVec3<<1,gr=new Array(or),ar=gr,Ct=0,_r=It.sizeVec3;Ct<_r;){var Et=Ct++;ar[Et]=It.stackVec3[Et],It.stackVec3[Et]=null}It.stackVec3=ar}It.stackVec3[It.sizeVec3++]=Y}var St=this._pool;if(K!=null){if(K.zero(),St.sizeVec3==St.stackVec3.length){for(var Gt=St.sizeVec3<<1,jr=new Array(Gt),vr=jr,lr=0,tr=St.sizeVec3;lr<tr;){var Or=lr++;vr[Or]=St.stackVec3[Or],St.stackVec3[Or]=null}St.stackVec3=vr}St.stackVec3[St.sizeVec3++]=K}var Xr=this._pool;if(va!=null){if(va.zero(),Xr.sizeVec3==Xr.stackVec3.length){for(var Mr=Xr.sizeVec3<<1,Zt=new Array(Mr),ir=Zt,Wt=0,nr=Xr.sizeVec3;Wt<nr;){var $r=Wt++;ir[$r]=Xr.stackVec3[$r],Xr.stackVec3[$r]=null}Xr.stackVec3=ir}Xr.stackVec3[Xr.sizeVec3++]=va}var Ut=this._pool;if(Qa!=null){if(Qa.zero(),Ut.sizeVec3==Ut.stackVec3.length){for(var Kr=Ut.sizeVec3<<1,Ir=new Array(Kr),mi=Ir,Wr=0,Lt=Ut.sizeVec3;Wr<Lt;){var Kt=Wr++;mi[Kt]=Ut.stackVec3[Kt],Ut.stackVec3[Kt]=null}Ut.stackVec3=mi}Ut.stackVec3[Ut.sizeVec3++]=Qa}var Tt=this._pool;if(ja!=null){if(ja.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var br=Tt.sizeVec3<<1,zr=new Array(br),vi=zr,qt=0,fr=Tt.sizeVec3;qt<fr;){var dt=qt++;vi[dt]=Tt.stackVec3[dt],Tt.stackVec3[dt]=null}Tt.stackVec3=vi}Tt.stackVec3[Tt.sizeVec3++]=ja}var ur=this._pool;if(et!=null){if(et.zero(),ur.sizeVec3==ur.stackVec3.length){for(var hr=ur.sizeVec3<<1,ei=new Array(hr),Xi=ei,io=0,Jt=ur.sizeVec3;io<Jt;){var fi=io++;Xi[fi]=ur.stackVec3[fi],ur.stackVec3[fi]=null}ur.stackVec3=Xi}ur.stackVec3[ur.sizeVec3++]=et}var pi=this._pool;if(ht!=null){if(ht.zero(),pi.sizeVec3==pi.stackVec3.length){for(var Dt=pi.sizeVec3<<1,di=new Array(Dt),Sr=di,Di=0,Hn=pi.sizeVec3;Di<Hn;){var oo=Di++;Sr[oo]=pi.stackVec3[oo],pi.stackVec3[oo]=null}pi.stackVec3=Sr}pi.stackVec3[pi.sizeVec3++]=ht}var Bi=this._pool;if(ot!=null){if(ot.zero(),Bi.sizeVec3==Bi.stackVec3.length){for(var no=Bi.sizeVec3<<1,yn=new Array(no),Ao=yn,Io=0,xr=Bi.sizeVec3;Io<xr;){var qi=Io++;Ao[qi]=Bi.stackVec3[qi],Bi.stackVec3[qi]=null}Bi.stackVec3=Ao}Bi.stackVec3[Bi.sizeVec3++]=ot}}_drawEllipseOnSphere(a,t,r,i,o,_,s,h,v){for(var e=16,l=0,u=6.28318530717958/e,b=this._pool,f=b.sizeVec3==0?new x.common.Vec3:b.stackVec3[--b.sizeVec3],n=this._pool,c=n.sizeQuat==0?new x.common.Quat:n.stackQuat[--n.sizeQuat],M=this._pool,m=M.sizeMat3==0?new x.common.Mat3:M.stackMat3[--M.sizeMat3],y=this._pool,V=y.sizeVec3==0?new x.common.Vec3:y.stackVec3[--y.sizeVec3],z=0,I=e+1;z<I;){var k=z++,X=Math.cos(l)*_,L=Math.sin(l)*s,p=Math.sqrt(X*X+L*L),g=Math.sin(p*.5),N=Math.cos(p*.5),A=f.zero(),F=A.x+i.x*X,S=A.y+i.y*X,Y=A.z+i.z*X;A.x=F,A.y=S,A.z=Y;var R=A,C=R.x+o.x*L,d=R.y+o.y*L,Z=R.z+o.z*L;R.x=C,R.y=d,R.z=Z;var $=1/p*g,j=f.x*$,E=f.y*$,G=f.z*$;f.x=j,f.y=E,f.z=G,c.x=f.x,c.y=f.y,c.z=f.z,c.w=N;var B=c.x,Q=c.y,U=c.z,J=c.w,D=2*B,H=2*Q,K=2*U,ra=B*D,sa=Q*H,W=U*K,q=B*H,na=Q*K,oa=B*K,aa=J*D,T=J*H,ca=J*K;m.e00=1-sa-W,m.e01=q-ca,m.e02=oa+T,m.e10=q+ca,m.e11=1-ra-W,m.e12=na-aa,m.e20=oa-T,m.e21=na+aa,m.e22=1-ra-sa;var _a=this._pool,w=_a.sizeVec3==0?new x.common.Vec3:_a.stackVec3[--_a.sizeVec3],ta=w.x+r.x*h,ia=w.y+r.y*h,la=w.z+r.z*h;w.x=ta,w.y=ia,w.z=la;var va=w,xa=va.x*m.e00+va.y*m.e01+va.z*m.e02,Ma=va.x*m.e10+va.y*m.e11+va.z*m.e12,za=va.x*m.e20+va.y*m.e21+va.z*m.e22;va.x=xa,va.y=Ma,va.z=za;var Xa=va,Za=Xa.x+t.x,fa=Xa.y+t.y,ba=Xa.z+t.z;Xa.x=Za,Xa.y=fa,Xa.z=ba,k>=1&&a.line(V,va,v);var ea=this._pool,ha=null,pa=null,ya=null;if(V!=null){if(V.zero(),ea.sizeVec3==ea.stackVec3.length){for(var da=ea.sizeVec3<<1,ma=new Array(da),Ya=ma,Qa=0,ga=ea.sizeVec3;Qa<ga;){var ua=Qa++;Ya[ua]=ea.stackVec3[ua],ea.stackVec3[ua]=null}ea.stackVec3=Ya}ea.stackVec3[ea.sizeVec3++]=V}if(ha!=null){var wa=1,ka=0,Pa=0,Mt=0,Ha=1,Ba=0,nt=0,Ea=0,Fa=1;if(ha.e00=wa,ha.e01=ka,ha.e02=Pa,ha.e10=Mt,ha.e11=Ha,ha.e12=Ba,ha.e20=nt,ha.e21=Ea,ha.e22=Fa,ea.sizeMat3==ea.stackMat3.length){for(var Aa=ea.sizeMat3<<1,ft=new Array(Aa),Ua=ft,ja=0,bt=ea.sizeMat3;ja<bt;){var rt=ja++;Ua[rt]=ea.stackMat3[rt],ea.stackMat3[rt]=null}ea.stackMat3=Ua}ea.stackMat3[ea.sizeMat3++]=ha}if(pa!=null){var $a=1,_t=0,gt=0,mt=0,Wa=0,it=1,ut=0,Da=0,Ta=0,Na=0,Vt=1,Pt=0,et=0,Xt=0,Yt=0,zt=1;if(pa.e00=$a,pa.e01=_t,pa.e02=gt,pa.e03=mt,pa.e10=Wa,pa.e11=it,pa.e12=ut,pa.e13=Da,pa.e20=Ta,pa.e21=Na,pa.e22=Vt,pa.e23=Pt,pa.e30=et,pa.e31=Xt,pa.e32=Yt,pa.e33=zt,ea.sizeMat4==ea.stackMat4.length){for(var Ia=ea.sizeMat4<<1,O=new Array(Ia),Va=O,lt=0,P=ea.sizeMat4;lt<P;){var wt=lt++;Va[wt]=ea.stackMat4[wt],ea.stackMat4[wt]=null}ea.stackMat4=Va}ea.stackMat4[ea.sizeMat4++]=pa}if(ya!=null){var Bt=0,At=0,yt=0,kt=1;if(ya.x=Bt,ya.y=At,ya.z=yt,ya.w=kt,ea.sizeQuat==ea.stackQuat.length){for(var pt=ea.sizeQuat<<1,ht=new Array(pt),xt=ht,Ra=0,st=ea.sizeQuat;Ra<st;){var Ca=Ra++;xt[Ca]=ea.stackQuat[Ca],ea.stackQuat[Ca]=null}ea.stackQuat=xt}ea.stackQuat[ea.sizeQuat++]=ya}V=va,l+=u}var vt=this._pool;if(f!=null){if(f.zero(),vt.sizeVec3==vt.stackVec3.length){for(var qa=vt.sizeVec3<<1,at=new Array(qa),Oa=at,tt=0,ct=vt.sizeVec3;tt<ct;){var Sa=tt++;Oa[Sa]=vt.stackVec3[Sa],vt.stackVec3[Sa]=null}vt.stackVec3=Oa}vt.stackVec3[vt.sizeVec3++]=f}var Ga=this._pool;if(c!=null){var Ka=0,La=0,ot=0,It=1;if(c.x=Ka,c.y=La,c.z=ot,c.w=It,Ga.sizeQuat==Ga.stackQuat.length){for(var or=Ga.sizeQuat<<1,gr=new Array(or),ar=gr,Ct=0,_r=Ga.sizeQuat;Ct<_r;){var Et=Ct++;ar[Et]=Ga.stackQuat[Et],Ga.stackQuat[Et]=null}Ga.stackQuat=ar}Ga.stackQuat[Ga.sizeQuat++]=c}var St=this._pool;if(m!=null){var Gt=1,jr=0,vr=0,lr=0,tr=1,Or=0,Xr=0,Mr=0,Zt=1;if(m.e00=Gt,m.e01=jr,m.e02=vr,m.e10=lr,m.e11=tr,m.e12=Or,m.e20=Xr,m.e21=Mr,m.e22=Zt,St.sizeMat3==St.stackMat3.length){for(var ir=St.sizeMat3<<1,Wt=new Array(ir),nr=Wt,$r=0,Ut=St.sizeMat3;$r<Ut;){var Kr=$r++;nr[Kr]=St.stackMat3[Kr],St.stackMat3[Kr]=null}St.stackMat3=nr}St.stackMat3[St.sizeMat3++]=m}var Ir=this._pool;if(V!=null){if(V.zero(),Ir.sizeVec3==Ir.stackVec3.length){for(var mi=Ir.sizeVec3<<1,Wr=new Array(mi),Lt=Wr,Kt=0,Tt=Ir.sizeVec3;Kt<Tt;){var br=Kt++;Lt[br]=Ir.stackVec3[br],Ir.stackVec3[br]=null}Ir.stackVec3=Lt}Ir.stackVec3[Ir.sizeVec3++]=V}}step(a){this._timeStep.dt>0&&(this._timeStep.dtRatio=a/this._timeStep.dt),this._timeStep.dt=a,this._timeStep.invDt=1/a;var t=Date.now()/1e3;this._updateContacts(),this._solveIslands();var r=Date.now()/1e3;x.dynamics.common.Performance.totalTime=(r-t)*1e3}addRigidBody(a){if(a._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=a,this._rigidBodyListLast=a):(this._rigidBodyListLast._next=a,a._prev=this._rigidBodyListLast,this._rigidBodyListLast=a),a._world=this;for(var t=a._shapeList;t!=null;){var r=t._next;t._proxy=this._broadPhase.createProxy(t,t._aabb),t._id=this._shapeIdCount++,this._numShapes++,t=r}this._numRigidBodies++}removeRigidBody(a){if(a._world!=this)throw new Error("The rigid body doesn't belong to the world.");var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),a==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),a._next=null,a._prev=null,a._world=null;for(var i=a._shapeList;i!=null;){var o=i._next;this._broadPhase.destroyProxy(i._proxy),i._proxy=null,i._id=-1;for(var _=i._rigidBody._contactLinkList;_!=null;){var s=_._next,h=_._contact;if(h._s1==i||h._s2==i){var v=_._other;v._sleeping=!1,v._sleepTime=0;var e=this._contactManager,l=h._prev,u=h._next;if(l!=null&&(l._next=u),u!=null&&(u._prev=l),h==e._contactList&&(e._contactList=e._contactList._next),h==e._contactListLast&&(e._contactListLast=e._contactListLast._prev),h._next=null,h._prev=null,h._touching){var b=h._s1._contactCallback,f=h._s2._contactCallback;b==f&&(f=null),b!=null&&b.endContact(h),f!=null&&f.endContact(h)}var n=h._link1._prev,c=h._link1._next;n!=null&&(n._next=c),c!=null&&(c._prev=n),h._link1==h._b1._contactLinkList&&(h._b1._contactLinkList=h._b1._contactLinkList._next),h._link1==h._b1._contactLinkListLast&&(h._b1._contactLinkListLast=h._b1._contactLinkListLast._prev),h._link1._next=null,h._link1._prev=null;var M=h._link2._prev,m=h._link2._next;M!=null&&(M._next=m),m!=null&&(m._prev=M),h._link2==h._b2._contactLinkList&&(h._b2._contactLinkList=h._b2._contactLinkList._next),h._link2==h._b2._contactLinkListLast&&(h._b2._contactLinkListLast=h._b2._contactLinkListLast._prev),h._link2._next=null,h._link2._prev=null,h._b1._numContactLinks--,h._b2._numContactLinks--,h._link1._other=null,h._link2._other=null,h._link1._contact=null,h._link2._contact=null,h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._touching=!1,h._cachedDetectorData._clear(),h._manifold._clear(),h._detector=null;var y=h._contactConstraint;y._s1=null,y._s2=null,y._b1=null,y._b2=null,y._tf1=null,y._tf2=null,h._next=e._contactPool,e._contactPool=h,e._numContacts--}_=s}this._numShapes--,i=o}this._numRigidBodies--}addJoint(a){if(a._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=a,this._jointListLast=a):(this._jointListLast._next=a,a._prev=this._jointListLast,this._jointListLast=a),a._world=this,a._link1._other=a._b2,a._link2._other=a._b1,a._b1._jointLinkList==null?(a._b1._jointLinkList=a._link1,a._b1._jointLinkListLast=a._link1):(a._b1._jointLinkListLast._next=a._link1,a._link1._prev=a._b1._jointLinkListLast,a._b1._jointLinkListLast=a._link1),a._b2._jointLinkList==null?(a._b2._jointLinkList=a._link2,a._b2._jointLinkListLast=a._link2):(a._b2._jointLinkListLast._next=a._link2,a._link2._prev=a._b2._jointLinkListLast,a._b2._jointLinkListLast=a._link2),a._b1._numJointLinks++,a._b2._numJointLinks++;var t=a._b1;t._sleeping=!1,t._sleepTime=0;var r=a._b2;r._sleeping=!1,r._sleepTime=0,a._syncAnchors(),this._numJoints++}removeJoint(a){if(a._world!=this)throw new Error("The joint doesn't belong to the world.");var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._jointList&&(this._jointList=this._jointList._next),a==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),a._next=null,a._prev=null,a._world=null;var i=a._link1._prev,o=a._link1._next;i!=null&&(i._next=o),o!=null&&(o._prev=i),a._link1==a._b1._jointLinkList&&(a._b1._jointLinkList=a._b1._jointLinkList._next),a._link1==a._b1._jointLinkListLast&&(a._b1._jointLinkListLast=a._b1._jointLinkListLast._prev),a._link1._next=null,a._link1._prev=null;var _=a._link2._prev,s=a._link2._next;_!=null&&(_._next=s),s!=null&&(s._prev=_),a._link2==a._b2._jointLinkList&&(a._b2._jointLinkList=a._b2._jointLinkList._next),a._link2==a._b2._jointLinkListLast&&(a._b2._jointLinkListLast=a._b2._jointLinkListLast._prev),a._link2._next=null,a._link2._prev=null,a._link1._other=null,a._link2._other=null,a._b1._numJointLinks--,a._b2._numJointLinks--;var h=a._b1;h._sleeping=!1,h._sleepTime=0;var v=a._b2;v._sleeping=!1,v._sleepTime=0,this._numJoints--}setDebugDraw(a){this._debugDraw=a}getDebugDraw(){return this._debugDraw}debugDraw(){if(this._debugDraw!=null){if(this._broadPhase._type==2){var a=this._broadPhase;this._drawBvh(this._debugDraw,a._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}}rayCast(a,t,r){var i=this._rayCastWrapper.begin;i.x=a.x,i.y=a.y,i.z=a.z;var o=this._rayCastWrapper.end;o.x=t.x,o.y=t.y,o.z=t.z,this._rayCastWrapper.callback=r,this._broadPhase.rayCast(a,t,this._rayCastWrapper)}convexCast(a,t,r,i){this._convexCastWrapper.convex=a;var o=this._convexCastWrapper.begin;o._positionX=t._positionX,o._positionY=t._positionY,o._positionZ=t._positionZ,o._rotation00=t._rotation00,o._rotation01=t._rotation01,o._rotation02=t._rotation02,o._rotation10=t._rotation10,o._rotation11=t._rotation11,o._rotation12=t._rotation12,o._rotation20=t._rotation20,o._rotation21=t._rotation21,o._rotation22=t._rotation22;var _=this._convexCastWrapper.translation;_.x=r.x,_.y=r.y,_.z=r.z,this._convexCastWrapper.callback=i,this._broadPhase.convexCast(a,t,r,this._convexCastWrapper)}aabbTest(a,t){this._aabbTestWrapper._aabb.copyFrom(a),this._aabbTestWrapper._callback=t,this._broadPhase.aabbTest(a,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(a){this._numVelocityIterations=a}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(a){this._numPositionIterations=a}getGravity(){return this._gravity}setGravity(a){var t=this._gravity;t.x=a.x,t.y=a.y,t.z=a.z}};x.dynamics._World||(x.dynamics._World={});x.dynamics._World.RayCastWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new x.collision.geometry.RayCastHit,this.begin=new x.common.Vec3,this.end=new x.common.Vec3,this.callback=null}process(a){var t=a.userData;t._geom.rayCast(this.begin,this.end,t._transform,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}};x.dynamics._World.ConvexCastWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new x.collision.geometry.RayCastHit,this.begin=new x.common.Transform,this.translation=new x.common.Vec3,this.zero=new x.common.Vec3,this.callback=null,this.convex=null}process(a){var t=a.userData,r=t._geom._type;if(!(r<0||r>5)){var i=t._geom;x.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i,this.begin,t._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}}};x.dynamics._World.AabbTestWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new x.collision.geometry.Aabb,this._callback=null}process(a){var t=a.userData,r=t._aabb;r._minX<this._aabb._maxX&&r._maxX>this._aabb._minX&&r._minY<this._aabb._maxY&&r._maxY>this._aabb._minY&&r._minZ<this._aabb._maxZ&&r._maxZ>this._aabb._minZ&&this._callback.process(t)}};x.dynamics.callback||(x.dynamics.callback={});x.dynamics.callback.AabbTestCallback=class{constructor(){}process(a){}};x.dynamics.callback.ContactCallback=class{constructor(){}beginContact(a){}preSolve(a){}postSolve(a){}endContact(a){}};x.dynamics.callback.RayCastCallback=class{constructor(){}process(a,t){}};x.dynamics.callback.RayCastClosest=class extends x.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new x.common.Vec3,this.normal=new x.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(a,t){if(t.fraction<this.fraction){this.shape=a,this.hit=!0,this.fraction=t.fraction;var r=this.position,i=t.position;r.x=i.x,r.y=i.y,r.z=i.z;var o=this.normal,_=t.normal;o.x=_.x,o.y=_.y,o.z=_.z}}};x.dynamics.common||(x.dynamics.common={});x.dynamics.common.DebugDraw=class{constructor(){this.p=new x.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var a=4,t=3.14159265358979/a,r=8,i=6.28318530717958/r,o=new Array(a+1);this.sphereCoords=o;var _=new Array(a+1);this.tmpSphereVerts=_;var s=new Array(a+1);this.tmpSphereNorms=s;for(var h=0,v=a+1;h<v;){var e=h++,l=e==0||e==a?1:r,u=this.sphereCoords,b=new Array(l);u[e]=b;var f=this.tmpSphereVerts,n=new Array(l);f[e]=n;var c=this.tmpSphereNorms,M=new Array(l);c[e]=M;for(var m=0,y=r;m<y;){var V=m++,z=e*t,I=V*i;this.sphereCoords[e][V]=new x.common.Vec3(Math.sin(z)*Math.cos(I),Math.cos(z),-Math.sin(z)*Math.sin(I)),this.tmpSphereVerts[e][V]=new x.common.Vec3,this.tmpSphereNorms[e][V]=new x.common.Vec3}}var k=new Array(8);this.circleCoords=k;var X=new Array(8);this.circleCoordsShift=X;var L=new Array(8);this.tmpCircleVerts1=L;var p=new Array(8);this.tmpCircleVerts2=p;var g=new Array(8);this.tmpCircleNorms=g;for(var N=.7853981633974475,A=0;A<8;){var F=A++;this.circleCoords[F]=new x.common.Vec3(Math.cos(F*N),0,-Math.sin(F*N)),this.circleCoordsShift[F]=new x.common.Vec3(Math.cos((F+.5)*N),0,-Math.sin((F+.5)*N)),this.tmpCircleVerts1[F]=new x.common.Vec3,this.tmpCircleVerts2[F]=new x.common.Vec3,this.tmpCircleNorms[F]=new x.common.Vec3}this.style=new x.dynamics.common.DebugDrawStyle}aabb(a,t,r){var i=this.p,o=(i.sizeVec3==0?new x.common.Vec3:i.stackVec3[--i.sizeVec3]).init(a.x,a.y,a.z),_=this.p,s=(_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3]).init(a.x,a.y,t.z),h=this.p,v=(h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3]).init(a.x,t.y,a.z),e=this.p,l=(e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3]).init(a.x,t.y,t.z),u=this.p,b=(u.sizeVec3==0?new x.common.Vec3:u.stackVec3[--u.sizeVec3]).init(t.x,a.y,a.z),f=this.p,n=(f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3]).init(t.x,a.y,t.z),c=this.p,M=(c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3]).init(t.x,t.y,a.z),m=this.p,y=(m.sizeVec3==0?new x.common.Vec3:m.stackVec3[--m.sizeVec3]).init(t.x,t.y,t.z);this.line(o,s,r),this.line(v,l,r),this.line(b,n,r),this.line(M,y,r),this.line(o,v,r),this.line(s,l,r),this.line(b,M,r),this.line(n,y,r),this.line(o,b,r),this.line(s,n,r),this.line(v,M,r),this.line(l,y,r);var V=this.p;if(o!=null){if(o.zero(),V.sizeVec3==V.stackVec3.length){for(var z=V.sizeVec3<<1,I=new Array(z),k=I,X=0,L=V.sizeVec3;X<L;){var p=X++;k[p]=V.stackVec3[p],V.stackVec3[p]=null}V.stackVec3=k}V.stackVec3[V.sizeVec3++]=o}var g=this.p;if(s!=null){if(s.zero(),g.sizeVec3==g.stackVec3.length){for(var N=g.sizeVec3<<1,A=new Array(N),F=A,S=0,Y=g.sizeVec3;S<Y;){var R=S++;F[R]=g.stackVec3[R],g.stackVec3[R]=null}g.stackVec3=F}g.stackVec3[g.sizeVec3++]=s}var C=this.p;if(v!=null){if(v.zero(),C.sizeVec3==C.stackVec3.length){for(var d=C.sizeVec3<<1,Z=new Array(d),$=Z,j=0,E=C.sizeVec3;j<E;){var G=j++;$[G]=C.stackVec3[G],C.stackVec3[G]=null}C.stackVec3=$}C.stackVec3[C.sizeVec3++]=v}var B=this.p;if(l!=null){if(l.zero(),B.sizeVec3==B.stackVec3.length){for(var Q=B.sizeVec3<<1,U=new Array(Q),J=U,D=0,H=B.sizeVec3;D<H;){var K=D++;J[K]=B.stackVec3[K],B.stackVec3[K]=null}B.stackVec3=J}B.stackVec3[B.sizeVec3++]=l}var ra=this.p;if(b!=null){if(b.zero(),ra.sizeVec3==ra.stackVec3.length){for(var sa=ra.sizeVec3<<1,W=new Array(sa),q=W,na=0,oa=ra.sizeVec3;na<oa;){var aa=na++;q[aa]=ra.stackVec3[aa],ra.stackVec3[aa]=null}ra.stackVec3=q}ra.stackVec3[ra.sizeVec3++]=b}var T=this.p;if(n!=null){if(n.zero(),T.sizeVec3==T.stackVec3.length){for(var ca=T.sizeVec3<<1,_a=new Array(ca),w=_a,ta=0,ia=T.sizeVec3;ta<ia;){var la=ta++;w[la]=T.stackVec3[la],T.stackVec3[la]=null}T.stackVec3=w}T.stackVec3[T.sizeVec3++]=n}var va=this.p;if(M!=null){if(M.zero(),va.sizeVec3==va.stackVec3.length){for(var xa=va.sizeVec3<<1,Ma=new Array(xa),za=Ma,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;za[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=za}va.stackVec3[va.sizeVec3++]=M}var ba=this.p;if(y!=null){if(y.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ea=ba.sizeVec3<<1,ha=new Array(ea),pa=ha,ya=0,da=ba.sizeVec3;ya<da;){var ma=ya++;pa[ma]=ba.stackVec3[ma],ba.stackVec3[ma]=null}ba.stackVec3=pa}ba.stackVec3[ba.sizeVec3++]=y}}basis(a,t,r,i,o){var _=this.p,s=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,v=h.sizeMat3==0?new x.common.Mat3:h.stackMat3[--h.sizeMat3],e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3],u=this.p,b=u.sizeVec3==0?new x.common.Vec3:u.stackVec3[--u.sizeVec3],f=this.p,n=f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3],c=s;c.x=a._positionX,c.y=a._positionY,c.z=a._positionZ;var M=v;M.e00=a._rotation00,M.e01=a._rotation01,M.e02=a._rotation02,M.e10=a._rotation10,M.e11=a._rotation11,M.e12=a._rotation12,M.e20=a._rotation20,M.e21=a._rotation21,M.e22=a._rotation22,l.init(v.e00,v.e10,v.e20),b.init(v.e01,v.e11,v.e21),n.init(v.e02,v.e12,v.e22);var m=l.x*t,y=l.y*t,V=l.z*t;l.x=m,l.y=y,l.z=V;var z=l,I=z.x+s.x,k=z.y+s.y,X=z.z+s.z;z.x=I,z.y=k,z.z=X;var L=b.x*t,p=b.y*t,g=b.z*t;b.x=L,b.y=p,b.z=g;var N=b,A=N.x+s.x,F=N.y+s.y,S=N.z+s.z;N.x=A,N.y=F,N.z=S;var Y=n.x*t,R=n.y*t,C=n.z*t;n.x=Y,n.y=R,n.z=C;var d=n,Z=d.x+s.x,$=d.y+s.y,j=d.z+s.z;d.x=Z,d.y=$,d.z=j,this.line(s,l,r),this.line(s,b,i),this.line(s,n,o);var E=this.p;if(s!=null){if(s.zero(),E.sizeVec3==E.stackVec3.length){for(var G=E.sizeVec3<<1,B=new Array(G),Q=B,U=0,J=E.sizeVec3;U<J;){var D=U++;Q[D]=E.stackVec3[D],E.stackVec3[D]=null}E.stackVec3=Q}E.stackVec3[E.sizeVec3++]=s}var H=this.p;if(v!=null){var K=1,ra=0,sa=0,W=0,q=1,na=0,oa=0,aa=0,T=1;if(v.e00=K,v.e01=ra,v.e02=sa,v.e10=W,v.e11=q,v.e12=na,v.e20=oa,v.e21=aa,v.e22=T,H.sizeMat3==H.stackMat3.length){for(var ca=H.sizeMat3<<1,_a=new Array(ca),w=_a,ta=0,ia=H.sizeMat3;ta<ia;){var la=ta++;w[la]=H.stackMat3[la],H.stackMat3[la]=null}H.stackMat3=w}H.stackMat3[H.sizeMat3++]=v}var va=this.p;if(l!=null){if(l.zero(),va.sizeVec3==va.stackVec3.length){for(var xa=va.sizeVec3<<1,Ma=new Array(xa),za=Ma,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;za[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=za}va.stackVec3[va.sizeVec3++]=l}var ba=this.p;if(b!=null){if(b.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ea=ba.sizeVec3<<1,ha=new Array(ea),pa=ha,ya=0,da=ba.sizeVec3;ya<da;){var ma=ya++;pa[ma]=ba.stackVec3[ma],ba.stackVec3[ma]=null}ba.stackVec3=pa}ba.stackVec3[ba.sizeVec3++]=b}var Ya=this.p;if(n!=null){if(n.zero(),Ya.sizeVec3==Ya.stackVec3.length){for(var Qa=Ya.sizeVec3<<1,ga=new Array(Qa),ua=ga,wa=0,ka=Ya.sizeVec3;wa<ka;){var Pa=wa++;ua[Pa]=Ya.stackVec3[Pa],Ya.stackVec3[Pa]=null}Ya.stackVec3=ua}Ya.stackVec3[Ya.sizeVec3++]=n}}ellipse(a,t,r,i,o,_){this.arc(a,t,r,i,o,0,6.28318530717958,!1,_)}arc(a,t,r,i,o,_,s,h,v){var e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var u=l,b=u.x*i,f=u.y*i,n=u.z*i;u.x=b,u.y=f,u.z=n,t=u;var c=this.p,M=c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3];M.x=r.x,M.y=r.y,M.z=r.z;var m=M,y=m.x*o,V=m.y*o,z=m.z*o;m.x=y,m.y=V,m.z=z,r=m;var I=.5235987755982984,k=s-_;k<0&&(k=-k);var X=k/I+.5|0;X==0&&(X=1);var L=_,p=(s-_)/X,g=this.p,N=g.sizeVec3==0?new x.common.Vec3:g.stackVec3[--g.sizeVec3];N.x=a.x,N.y=a.y,N.z=a.z;var A=N,F=Math.cos(L),S=A.x+t.x*F,Y=A.y+t.y*F,R=A.z+t.z*F;A.x=S,A.y=Y,A.z=R;var C=A,d=Math.sin(L),Z=C.x+r.x*d,$=C.y+r.y*d,j=C.z+r.z*d;C.x=Z,C.y=$,C.z=j;var E=C,G=E;h&&this.line(a,G,v);for(var B=0,Q=X;B<Q;){B++,L+=p;var U=this.p,J=U.sizeVec3==0?new x.common.Vec3:U.stackVec3[--U.sizeVec3];J.x=a.x,J.y=a.y,J.z=a.z;var D=J,H=Math.cos(L),K=D.x+t.x*H,ra=D.y+t.y*H,sa=D.z+t.z*H;D.x=K,D.y=ra,D.z=sa;var W=D,q=Math.sin(L),na=W.x+r.x*q,oa=W.y+r.y*q,aa=W.z+r.z*q;W.x=na,W.y=oa,W.z=aa;var T=W,ca=T;this.line(G,ca,v);var _a=this.p,w=null,ta=null,ia=null;if(G!=null){if(G.zero(),_a.sizeVec3==_a.stackVec3.length){for(var la=_a.sizeVec3<<1,va=new Array(la),xa=va,Ma=0,za=_a.sizeVec3;Ma<za;){var Xa=Ma++;xa[Xa]=_a.stackVec3[Xa],_a.stackVec3[Xa]=null}_a.stackVec3=xa}_a.stackVec3[_a.sizeVec3++]=G}if(w!=null){var Za=1,fa=0,ba=0,ea=0,ha=1,pa=0,ya=0,da=0,ma=1;if(w.e00=Za,w.e01=fa,w.e02=ba,w.e10=ea,w.e11=ha,w.e12=pa,w.e20=ya,w.e21=da,w.e22=ma,_a.sizeMat3==_a.stackMat3.length){for(var Ya=_a.sizeMat3<<1,Qa=new Array(Ya),ga=Qa,ua=0,wa=_a.sizeMat3;ua<wa;){var ka=ua++;ga[ka]=_a.stackMat3[ka],_a.stackMat3[ka]=null}_a.stackMat3=ga}_a.stackMat3[_a.sizeMat3++]=w}if(ta!=null){var Pa=1,Mt=0,Ha=0,Ba=0,nt=0,Ea=1,Fa=0,Aa=0,ft=0,Ua=0,ja=1,bt=0,rt=0,$a=0,_t=0,gt=1;if(ta.e00=Pa,ta.e01=Mt,ta.e02=Ha,ta.e03=Ba,ta.e10=nt,ta.e11=Ea,ta.e12=Fa,ta.e13=Aa,ta.e20=ft,ta.e21=Ua,ta.e22=ja,ta.e23=bt,ta.e30=rt,ta.e31=$a,ta.e32=_t,ta.e33=gt,_a.sizeMat4==_a.stackMat4.length){for(var mt=_a.sizeMat4<<1,Wa=new Array(mt),it=Wa,ut=0,Da=_a.sizeMat4;ut<Da;){var Ta=ut++;it[Ta]=_a.stackMat4[Ta],_a.stackMat4[Ta]=null}_a.stackMat4=it}_a.stackMat4[_a.sizeMat4++]=ta}if(ia!=null){var Na=0,Vt=0,Pt=0,et=1;if(ia.x=Na,ia.y=Vt,ia.z=Pt,ia.w=et,_a.sizeQuat==_a.stackQuat.length){for(var Xt=_a.sizeQuat<<1,Yt=new Array(Xt),zt=Yt,Ia=0,O=_a.sizeQuat;Ia<O;){var Va=Ia++;zt[Va]=_a.stackQuat[Va],_a.stackQuat[Va]=null}_a.stackQuat=zt}_a.stackQuat[_a.sizeQuat++]=ia}G=ca}h&&this.line(a,G,v);var lt=this.p;if(G!=null){if(G.zero(),lt.sizeVec3==lt.stackVec3.length){for(var P=lt.sizeVec3<<1,wt=new Array(P),Bt=wt,At=0,yt=lt.sizeVec3;At<yt;){var kt=At++;Bt[kt]=lt.stackVec3[kt],lt.stackVec3[kt]=null}lt.stackVec3=Bt}lt.stackVec3[lt.sizeVec3++]=G}var pt=this.p;if(t!=null){if(t.zero(),pt.sizeVec3==pt.stackVec3.length){for(var ht=pt.sizeVec3<<1,xt=new Array(ht),Ra=xt,st=0,Ca=pt.sizeVec3;st<Ca;){var vt=st++;Ra[vt]=pt.stackVec3[vt],pt.stackVec3[vt]=null}pt.stackVec3=Ra}pt.stackVec3[pt.sizeVec3++]=t}var qa=this.p;if(r!=null){if(r.zero(),qa.sizeVec3==qa.stackVec3.length){for(var at=qa.sizeVec3<<1,Oa=new Array(at),tt=Oa,ct=0,Sa=qa.sizeVec3;ct<Sa;){var Ga=ct++;tt[Ga]=qa.stackVec3[Ga],qa.stackVec3[Ga]=null}qa.stackVec3=tt}qa.stackVec3[qa.sizeVec3++]=r}}cone(a,t,r,i){var o=this.p,_=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],s=this.p,h=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,_.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);var M=this.p,m=M.sizeVec3==0?new x.common.Vec3:M.stackVec3[--M.sizeVec3];m.x=u.x,m.y=u.y,m.z=u.z;var y=m,V=y.x+h.x*r,z=y.y+h.y*r,I=y.z+h.z*r;y.x=V,y.y=z,y.z=I;var k=y,X=this.p,L=X.sizeVec3==0?new x.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=u.x,L.y=u.y,L.z=u.z;var p=L,g=-r,N=p.x+h.x*g,A=p.y+h.y*g,F=p.z+h.z*g;p.x=N,p.y=A,p.z=F;var S=p;if(this.wireframe){var Y=this.p,R=Y.sizeVec3==0?new x.common.Vec3:Y.stackVec3[--Y.sizeVec3];R.x=S.x,R.y=S.y,R.z=S.z;var C=R,d=-t,Z=C.x+_.x*d,$=C.y+_.y*d,j=C.z+_.z*d;C.x=Z,C.y=$,C.z=j;var E=C,G=E.x+e.x*0,B=E.y+e.y*0,Q=E.z+e.z*0;E.x=G,E.y=B,E.z=Q;var U=E,J=this.p,D=J.sizeVec3==0?new x.common.Vec3:J.stackVec3[--J.sizeVec3];D.x=S.x,D.y=S.y,D.z=S.z;var H=D,K=H.x+_.x*t,ra=H.y+_.y*t,sa=H.z+_.z*t;H.x=K,H.y=ra,H.z=sa;var W=H,q=W.x+e.x*0,na=W.y+e.y*0,oa=W.z+e.z*0;W.x=q,W.y=na,W.z=oa;var aa=W,T=this.p,ca=T.sizeVec3==0?new x.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=S.x,ca.y=S.y,ca.z=S.z;var _a=ca,w=_a.x+_.x*0,ta=_a.y+_.y*0,ia=_a.z+_.z*0;_a.x=w,_a.y=ta,_a.z=ia;var la=_a,va=-t,xa=la.x+e.x*va,Ma=la.y+e.y*va,za=la.z+e.z*va;la.x=xa,la.y=Ma,la.z=za;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new x.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=S.x,fa.y=S.y,fa.z=S.z;var ba=fa,ea=ba.x+_.x*0,ha=ba.y+_.y*0,pa=ba.z+_.z*0;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+e.x*t,ma=ya.y+e.y*t,Ya=ya.z+e.z*t;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya;this.ellipse(S,_,e,t,t,i),this.line(k,U,i),this.line(k,aa,i),this.line(k,Xa,i),this.line(k,Qa,i);var ga=this.p,ua=null,wa=null,ka=null;if(U!=null){if(U.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Pa=ga.sizeVec3<<1,Mt=new Array(Pa),Ha=Mt,Ba=0,nt=ga.sizeVec3;Ba<nt;){var Ea=Ba++;Ha[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Ha}ga.stackVec3[ga.sizeVec3++]=U}if(ua!=null){var Fa=1,Aa=0,ft=0,Ua=0,ja=1,bt=0,rt=0,$a=0,_t=1;if(ua.e00=Fa,ua.e01=Aa,ua.e02=ft,ua.e10=Ua,ua.e11=ja,ua.e12=bt,ua.e20=rt,ua.e21=$a,ua.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,mt=new Array(gt),Wa=mt,it=0,ut=ga.sizeMat3;it<ut;){var Da=it++;Wa[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Wa}ga.stackMat3[ga.sizeMat3++]=ua}if(wa!=null){var Ta=1,Na=0,Vt=0,Pt=0,et=0,Xt=1,Yt=0,zt=0,Ia=0,O=0,Va=1,lt=0,P=0,wt=0,Bt=0,At=1;if(wa.e00=Ta,wa.e01=Na,wa.e02=Vt,wa.e03=Pt,wa.e10=et,wa.e11=Xt,wa.e12=Yt,wa.e13=zt,wa.e20=Ia,wa.e21=O,wa.e22=Va,wa.e23=lt,wa.e30=P,wa.e31=wt,wa.e32=Bt,wa.e33=At,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,kt=new Array(yt),pt=kt,ht=0,xt=ga.sizeMat4;ht<xt;){var Ra=ht++;pt[Ra]=ga.stackMat4[Ra],ga.stackMat4[Ra]=null}ga.stackMat4=pt}ga.stackMat4[ga.sizeMat4++]=wa}if(ka!=null){var st=0,Ca=0,vt=0,qa=1;if(ka.x=st,ka.y=Ca,ka.z=vt,ka.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Oa=new Array(at),tt=Oa,ct=0,Sa=ga.sizeQuat;ct<Sa;){var Ga=ct++;tt[Ga]=ga.stackQuat[Ga],ga.stackQuat[Ga]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=ka}var Ka=this.p,La=null,ot=null,It=null;if(aa!=null){if(aa.zero(),Ka.sizeVec3==Ka.stackVec3.length){for(var or=Ka.sizeVec3<<1,gr=new Array(or),ar=gr,Ct=0,_r=Ka.sizeVec3;Ct<_r;){var Et=Ct++;ar[Et]=Ka.stackVec3[Et],Ka.stackVec3[Et]=null}Ka.stackVec3=ar}Ka.stackVec3[Ka.sizeVec3++]=aa}if(La!=null){var St=1,Gt=0,jr=0,vr=0,lr=1,tr=0,Or=0,Xr=0,Mr=1;if(La.e00=St,La.e01=Gt,La.e02=jr,La.e10=vr,La.e11=lr,La.e12=tr,La.e20=Or,La.e21=Xr,La.e22=Mr,Ka.sizeMat3==Ka.stackMat3.length){for(var Zt=Ka.sizeMat3<<1,ir=new Array(Zt),Wt=ir,nr=0,$r=Ka.sizeMat3;nr<$r;){var Ut=nr++;Wt[Ut]=Ka.stackMat3[Ut],Ka.stackMat3[Ut]=null}Ka.stackMat3=Wt}Ka.stackMat3[Ka.sizeMat3++]=La}if(ot!=null){var Kr=1,Ir=0,mi=0,Wr=0,Lt=0,Kt=1,Tt=0,br=0,zr=0,vi=0,qt=1,fr=0,dt=0,ur=0,hr=0,ei=1;if(ot.e00=Kr,ot.e01=Ir,ot.e02=mi,ot.e03=Wr,ot.e10=Lt,ot.e11=Kt,ot.e12=Tt,ot.e13=br,ot.e20=zr,ot.e21=vi,ot.e22=qt,ot.e23=fr,ot.e30=dt,ot.e31=ur,ot.e32=hr,ot.e33=ei,Ka.sizeMat4==Ka.stackMat4.length){for(var Xi=Ka.sizeMat4<<1,io=new Array(Xi),Jt=io,fi=0,pi=Ka.sizeMat4;fi<pi;){var Dt=fi++;Jt[Dt]=Ka.stackMat4[Dt],Ka.stackMat4[Dt]=null}Ka.stackMat4=Jt}Ka.stackMat4[Ka.sizeMat4++]=ot}if(It!=null){var di=0,Sr=0,Di=0,Hn=1;if(It.x=di,It.y=Sr,It.z=Di,It.w=Hn,Ka.sizeQuat==Ka.stackQuat.length){for(var oo=Ka.sizeQuat<<1,Bi=new Array(oo),no=Bi,yn=0,Ao=Ka.sizeQuat;yn<Ao;){var Io=yn++;no[Io]=Ka.stackQuat[Io],Ka.stackQuat[Io]=null}Ka.stackQuat=no}Ka.stackQuat[Ka.sizeQuat++]=It}var xr=this.p,qi=null,Ai=null,yi=null;if(Xa!=null){if(Xa.zero(),xr.sizeVec3==xr.stackVec3.length){for(var So=xr.sizeVec3<<1,Dr=new Array(So),Si=Dr,gi=0,Rt=xr.sizeVec3;gi<Rt;){var Hr=gi++;Si[Hr]=xr.stackVec3[Hr],xr.stackVec3[Hr]=null}xr.stackVec3=Si}xr.stackVec3[xr.sizeVec3++]=Xa}if(qi!=null){var Lr=1,Cn=0,zs=0,Ke=0,ms=1,Te=0,qe=0,D_=0,gn=1;if(qi.e00=Lr,qi.e01=Cn,qi.e02=zs,qi.e10=Ke,qi.e11=ms,qi.e12=Te,qi.e20=qe,qi.e21=D_,qi.e22=gn,xr.sizeMat3==xr.stackMat3.length){for(var Pr=xr.sizeMat3<<1,No=new Array(Pr),Wi=No,ke=0,on=xr.sizeMat3;ke<on;){var Tn=ke++;Wi[Tn]=xr.stackMat3[Tn],xr.stackMat3[Tn]=null}xr.stackMat3=Wi}xr.stackMat3[xr.sizeMat3++]=qi}if(Ai!=null){var jn=1,we=0,k_=0,Re=0,Vr=0,Ii=1,ui=0,eo=0,Rn=0,ps=0,nn=1,Qn=0,cr=0,ho=0,Fi=0,En=1;if(Ai.e00=jn,Ai.e01=we,Ai.e02=k_,Ai.e03=Re,Ai.e10=Vr,Ai.e11=Ii,Ai.e12=ui,Ai.e13=eo,Ai.e20=Rn,Ai.e21=ps,Ai.e22=nn,Ai.e23=Qn,Ai.e30=cr,Ai.e31=ho,Ai.e32=Fi,Ai.e33=En,xr.sizeMat4==xr.stackMat4.length){for(var as=xr.sizeMat4<<1,Qe=new Array(as),Ee=Qe,De=0,he=xr.sizeMat4;De<he;){var rr=De++;Ee[rr]=xr.stackMat4[rr],xr.stackMat4[rr]=null}xr.stackMat4=Ee}xr.stackMat4[xr.sizeMat4++]=Ai}if(yi!=null){var ri=0,Qr=0,Fr=0,fo=1;if(yi.x=ri,yi.y=Qr,yi.z=Fr,yi.w=fo,xr.sizeQuat==xr.stackQuat.length){for(var Po=xr.sizeQuat<<1,s_=new Array(Po),Fe=s_,ts=0,Dn=xr.sizeQuat;ts<Dn;){var co=ts++;Fe[co]=xr.stackQuat[co],xr.stackQuat[co]=null}xr.stackQuat=Fe}xr.stackQuat[xr.sizeQuat++]=yi}var Ft=this.p,Nr=null,li=null,Vo=null;if(Qa!=null){if(Qa.zero(),Ft.sizeVec3==Ft.stackVec3.length){for(var ce=Ft.sizeVec3<<1,Xe=new Array(ce),Le=Xe,uo=0,$t=Ft.sizeVec3;uo<$t;){var Vi=uo++;Le[Vi]=Ft.stackVec3[Vi],Ft.stackVec3[Vi]=null}Ft.stackVec3=Le}Ft.stackVec3[Ft.sizeVec3++]=Qa}if(Nr!=null){var si=1,Go=0,Ns=0,Co=0,ko=1,Ni=0,Pi=0,Ci=0,Li=1;if(Nr.e00=si,Nr.e01=Go,Nr.e02=Ns,Nr.e10=Co,Nr.e11=ko,Nr.e12=Ni,Nr.e20=Pi,Nr.e21=Ci,Nr.e22=Li,Ft.sizeMat3==Ft.stackMat3.length){for(var Qt=Ft.sizeMat3<<1,Gr=new Array(Qt),Yr=Gr,Rr=0,Mi=Ft.sizeMat3;Rr<Mi;){var qr=Rr++;Yr[qr]=Ft.stackMat3[qr],Ft.stackMat3[qr]=null}Ft.stackMat3=Yr}Ft.stackMat3[Ft.sizeMat3++]=Nr}if(li!=null){var Gi=1,Ji=0,ao=0,be=0,kr=0,en=1,Yi=0,Jo=0,ys=0,In=0,gs=1,Vn=0,Cr=0,To=0,so=0,Fn=1;if(li.e00=Gi,li.e01=Ji,li.e02=ao,li.e03=be,li.e10=kr,li.e11=en,li.e12=Yi,li.e13=Jo,li.e20=ys,li.e21=In,li.e22=gs,li.e23=Vn,li.e30=Cr,li.e31=To,li.e32=so,li.e33=Fn,Ft.sizeMat4==Ft.stackMat4.length){for(var Ne=Ft.sizeMat4<<1,Nn=new Array(Ne),Wo=Nn,kn=0,Ye=Ft.sizeMat4;kn<Ye;){var Ot=kn++;Wo[Ot]=Ft.stackMat4[Ot],Ft.stackMat4[Ot]=null}Ft.stackMat4=Wo}Ft.stackMat4[Ft.sizeMat4++]=li}if(Vo!=null){var Ro=0,Ui=0,wn=0,Gn=1;if(Vo.x=Ro,Vo.y=Ui,Vo.z=wn,Vo.w=Gn,Ft.sizeQuat==Ft.stackQuat.length){for(var fe=Ft.sizeQuat<<1,Is=new Array(fe),Uo=Is,Vs=0,w_=Ft.sizeQuat;Vs<w_;){var Gs=Vs++;Uo[Gs]=Ft.stackQuat[Gs],Ft.stackQuat[Gs]=null}Ft.stackQuat=Uo}Ft.stackQuat[Ft.sizeQuat++]=Vo}}else{for(var X_=1/Math.sqrt(t*t+4*r*r),Ge=2*r*X_,F_=t*X_,N_=0;N_<8;){var Oi=N_++,wo=this.tmpCircleNorms[Oi],Xo=this.circleCoords[Oi];wo.x=Xo.x,wo.y=Xo.y,wo.z=Xo.z;var Jn=wo,wr=Jn.x*Ge,Wn=Jn.y*Ge,Qo=Jn.z*Ge;Jn.x=wr,Jn.y=Wn,Jn.z=Qo,Jn.y+=F_;var to=this.tmpCircleNorms[Oi],G_=to.x*f.e00+to.y*f.e01+to.z*f.e02,J_=to.x*f.e10+to.y*f.e11+to.z*f.e12,L_=to.x*f.e20+to.y*f.e21+to.z*f.e22;to.x=G_,to.y=J_,to.z=L_;var rs=this.tmpCircleVerts1[Oi],__=this.circleCoordsShift[Oi];rs.x=__.x,rs.y=__.y,rs.z=__.z;var v_=rs,is=v_.x*Ge,mr=v_.y*Ge,Oo=v_.z*Ge;v_.x=is,v_.y=mr,v_.z=Oo,v_.y+=F_;var ai=this.tmpCircleVerts1[Oi],Ze=ai.x*f.e00+ai.y*f.e01+ai.z*f.e02,Js=ai.x*f.e10+ai.y*f.e11+ai.z*f.e12,hv=ai.x*f.e20+ai.y*f.e21+ai.z*f.e22;ai.x=Ze,ai.y=Js,ai.z=hv;var ue=this.tmpCircleVerts2[Oi],Je=this.circleCoords[Oi];ue.x=Je.x,ue.y=Je.y,ue.z=Je.z;var $n=ue,Ws=$n.x*f.e00+$n.y*f.e01+$n.z*f.e02,Tr=$n.x*f.e10+$n.y*f.e11+$n.z*f.e12,Lo=$n.x*f.e20+$n.y*f.e21+$n.z*f.e22;$n.x=Ws,$n.y=Tr,$n.z=Lo;var Ti=$n,sn=Ti.x*t,ks=Ti.y*t,Y_=Ti.z*t;Ti.x=sn,Ti.y=ks,Ti.z=Y_;var We=Ti,Kn=We.x+u.x,Xn=We.y+u.y,os=We.z+u.z;We.x=Kn,We.y=Xn,We.z=os;var de=this.tmpCircleVerts2[Oi],ns=-r,Us=de.x+h.x*ns,l_=de.y+h.y*ns,Be=de.z+h.z*ns;de.x=Us,de.y=l_,de.z=Be}for(var Ae=0;Ae<8;){var qn=Ae++,pr=k,xo=this.tmpCircleVerts2[qn],Zi=this.tmpCircleVerts2[(qn+1)%8],Ho=this.tmpCircleVerts1[qn],Yo=this.tmpCircleNorms[qn],Hi=this.tmpCircleNorms[(qn+1)%8];this.triangle(pr,xo,Zi,Ho,Yo,Hi,i),pr=S,xo=this.tmpCircleVerts2[(qn+1)%8],Zi=this.tmpCircleVerts2[qn];var Eo=this.p,ws=Eo.sizeVec3==0?new x.common.Vec3:Eo.stackVec3[--Eo.sizeVec3];ws.x=h.x,ws.y=h.y,ws.z=h.z;var ae=ws,Os=-ae.x,W_=-ae.y,te=-ae.z;ae.x=Os,ae.y=W_,ae.z=te,Ho=ae,this.triangle(pr,xo,Zi,Ho,Ho,Ho,i);var Nt=this.p,ji=null,Do=null,Xs=null;if(Ho!=null){if(Ho.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var kv=Nt.sizeVec3<<1,r0=new Array(kv),U_=r0,Ht=0,Ln=Nt.sizeVec3;Ht<Ln;){var Ri=Ht++;U_[Ri]=Nt.stackVec3[Ri],Nt.stackVec3[Ri]=null}Nt.stackVec3=U_}Nt.stackVec3[Nt.sizeVec3++]=Ho}if(ji!=null){var Yn=1,Z_=0,Hs=0,h_=0,bo=1,es=0,ss=0,xe=0,Zr=1;if(ji.e00=Yn,ji.e01=Z_,ji.e02=Hs,ji.e10=h_,ji.e11=bo,ji.e12=es,ji.e20=ss,ji.e21=xe,ji.e22=Zr,Nt.sizeMat3==Nt.stackMat3.length){for(var jo=Nt.sizeMat3<<1,ki=new Array(jo),Zo=ki,Ue=0,cv=Nt.sizeMat3;Ue<cv;){var Me=Ue++;Zo[Me]=Nt.stackMat3[Me],Nt.stackMat3[Me]=null}Nt.stackMat3=Zo}Nt.stackMat3[Nt.sizeMat3++]=ji}if(Do!=null){var js=1,wv=0,Oe=0,er=0,Zn=0,_n=1,vn=0,d_=0,bv=0,re=0,Se=1,c_=0,O_=0,fv=0,uv=0,b_=1;if(Do.e00=js,Do.e01=wv,Do.e02=Oe,Do.e03=er,Do.e10=Zn,Do.e11=_n,Do.e12=vn,Do.e13=d_,Do.e20=bv,Do.e21=re,Do.e22=Se,Do.e23=c_,Do.e30=O_,Do.e31=fv,Do.e32=uv,Do.e33=b_,Nt.sizeMat4==Nt.stackMat4.length){for(var He=Nt.sizeMat4<<1,Mo=new Array(He),_s=Mo,vs=0,Ur=Nt.sizeMat4;vs<Ur;){var zo=vs++;_s[zo]=Nt.stackMat4[zo],Nt.stackMat4[zo]=null}Nt.stackMat4=_s}Nt.stackMat4[Nt.sizeMat4++]=Do}if(Xs!=null){var _o=0,ls=0,Ls=0,Ys=1;if(Xs.x=_o,Xs.y=ls,Xs.z=Ls,Xs.w=Ys,Nt.sizeQuat==Nt.stackQuat.length){for(var Zs=Nt.sizeQuat<<1,B_=new Array(Zs),ze=B_,hs=0,H_=Nt.sizeQuat;hs<H_;){var $s=hs++;ze[$s]=Nt.stackQuat[$s],Nt.stackQuat[$s]=null}Nt.stackQuat=ze}Nt.stackQuat[Nt.sizeQuat++]=Xs}}}var Un=this.p;if(k!=null){if(k.zero(),Un.sizeVec3==Un.stackVec3.length){for(var me=Un.sizeVec3<<1,Xv=new Array(me),A_=Xv,$o=0,ln=Un.sizeVec3;$o<ln;){var mo=$o++;A_[mo]=Un.stackVec3[mo],Un.stackVec3[mo]=null}Un.stackVec3=A_}Un.stackVec3[Un.sizeVec3++]=k}var jt=this.p;if(S!=null){if(S.zero(),jt.sizeVec3==jt.stackVec3.length){for(var $i=jt.sizeVec3<<1,vo=new Array($i),Ks=vo,ds=0,qs=jt.sizeVec3;ds<qs;){var S_=ds++;Ks[S_]=jt.stackVec3[S_],jt.stackVec3[S_]=null}jt.stackVec3=Ks}jt.stackVec3[jt.sizeVec3++]=S}var Ko=this.p;if(u!=null){if(u.zero(),Ko.sizeVec3==Ko.stackVec3.length){for(var ie=Ko.sizeVec3<<1,j_=new Array(ie),xv=j_,dr=0,po=Ko.sizeVec3;dr<po;){var Qi=dr++;xv[Qi]=Ko.stackVec3[Qi],Ko.stackVec3[Qi]=null}Ko.stackVec3=xv}Ko.stackVec3[Ko.sizeVec3++]=u}var ro=this.p;if(f!=null){var $_=1,K_=0,Lv=0,a_=0,Yv=1,q_=0,Br=0,av=0,Bs=1;if(f.e00=$_,f.e01=K_,f.e02=Lv,f.e10=a_,f.e11=Yv,f.e12=q_,f.e20=Br,f.e21=av,f.e22=Bs,ro.sizeMat3==ro.stackMat3.length){for(var As=ro.sizeMat3<<1,cs=new Array(As),bs=cs,Ss=0,Zv=ro.sizeMat3;Ss<Zv;){var pe=Ss++;bs[pe]=ro.stackMat3[pe],ro.stackMat3[pe]=null}ro.stackMat3=bs}ro.stackMat3[ro.sizeMat3++]=f}var Ki=this.p;if(_!=null){if(_.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var t_=Ki.sizeVec3<<1,yo=new Array(t_),r_=yo,Fo=0,Ps=Ki.sizeVec3;Fo<Ps;){var qo=Fo++;r_[qo]=Ki.stackVec3[qo],Ki.stackVec3[qo]=null}Ki.stackVec3=r_}Ki.stackVec3[Ki.sizeVec3++]=_}var ye=this.p;if(h!=null){if(h.zero(),ye.sizeVec3==ye.stackVec3.length){for(var sr=ye.sizeVec3<<1,an=new Array(sr),_i=an,oe=0,ge=ye.sizeVec3;oe<ge;){var Bo=oe++;_i[Bo]=ye.stackVec3[Bo],ye.stackVec3[Bo]=null}ye.stackVec3=_i}ye.stackVec3[ye.sizeVec3++]=h}var Ei=this.p;if(e!=null){if(e.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var dn=Ei.sizeVec3<<1,tv=new Array(dn),i_=tv,P_=0,rv=Ei.sizeVec3;P_<rv;){var ne=P_++;i_[ne]=Ei.stackVec3[ne],Ei.stackVec3[ne]=null}Ei.stackVec3=i_}Ei.stackVec3[Ei.sizeVec3++]=e}}cylinder(a,t,r,i){var o=this.p,_=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],s=this.p,h=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,_.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);var M=this.p,m=M.sizeVec3==0?new x.common.Vec3:M.stackVec3[--M.sizeVec3];m.x=u.x,m.y=u.y,m.z=u.z;var y=m,V=y.x+h.x*r,z=y.y+h.y*r,I=y.z+h.z*r;y.x=V,y.y=z,y.z=I;var k=y,X=this.p,L=X.sizeVec3==0?new x.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=u.x,L.y=u.y,L.z=u.z;var p=L,g=-r,N=p.x+h.x*g,A=p.y+h.y*g,F=p.z+h.z*g;p.x=N,p.y=A,p.z=F;var S=p;if(this.wireframe){var Y=this.p,R=Y.sizeVec3==0?new x.common.Vec3:Y.stackVec3[--Y.sizeVec3];R.x=k.x,R.y=k.y,R.z=k.z;var C=R,d=-t,Z=C.x+_.x*d,$=C.y+_.y*d,j=C.z+_.z*d;C.x=Z,C.y=$,C.z=j;var E=C,G=E.x+e.x*0,B=E.y+e.y*0,Q=E.z+e.z*0;E.x=G,E.y=B,E.z=Q;var U=E,J=this.p,D=J.sizeVec3==0?new x.common.Vec3:J.stackVec3[--J.sizeVec3];D.x=k.x,D.y=k.y,D.z=k.z;var H=D,K=H.x+_.x*t,ra=H.y+_.y*t,sa=H.z+_.z*t;H.x=K,H.y=ra,H.z=sa;var W=H,q=W.x+e.x*0,na=W.y+e.y*0,oa=W.z+e.z*0;W.x=q,W.y=na,W.z=oa;var aa=W,T=this.p,ca=T.sizeVec3==0?new x.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=k.x,ca.y=k.y,ca.z=k.z;var _a=ca,w=_a.x+_.x*0,ta=_a.y+_.y*0,ia=_a.z+_.z*0;_a.x=w,_a.y=ta,_a.z=ia;var la=_a,va=-t,xa=la.x+e.x*va,Ma=la.y+e.y*va,za=la.z+e.z*va;la.x=xa,la.y=Ma,la.z=za;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new x.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=k.x,fa.y=k.y,fa.z=k.z;var ba=fa,ea=ba.x+_.x*0,ha=ba.y+_.y*0,pa=ba.z+_.z*0;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+e.x*t,ma=ya.y+e.y*t,Ya=ya.z+e.z*t;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya,ga=this.p,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3];ua.x=S.x,ua.y=S.y,ua.z=S.z;var wa=ua,ka=-t,Pa=wa.x+_.x*ka,Mt=wa.y+_.y*ka,Ha=wa.z+_.z*ka;wa.x=Pa,wa.y=Mt,wa.z=Ha;var Ba=wa,nt=Ba.x+e.x*0,Ea=Ba.y+e.y*0,Fa=Ba.z+e.z*0;Ba.x=nt,Ba.y=Ea,Ba.z=Fa;var Aa=Ba,ft=this.p,Ua=ft.sizeVec3==0?new x.common.Vec3:ft.stackVec3[--ft.sizeVec3];Ua.x=S.x,Ua.y=S.y,Ua.z=S.z;var ja=Ua,bt=ja.x+_.x*t,rt=ja.y+_.y*t,$a=ja.z+_.z*t;ja.x=bt,ja.y=rt,ja.z=$a;var _t=ja,gt=_t.x+e.x*0,mt=_t.y+e.y*0,Wa=_t.z+e.z*0;_t.x=gt,_t.y=mt,_t.z=Wa;var it=_t,ut=this.p,Da=ut.sizeVec3==0?new x.common.Vec3:ut.stackVec3[--ut.sizeVec3];Da.x=S.x,Da.y=S.y,Da.z=S.z;var Ta=Da,Na=Ta.x+_.x*0,Vt=Ta.y+_.y*0,Pt=Ta.z+_.z*0;Ta.x=Na,Ta.y=Vt,Ta.z=Pt;var et=Ta,Xt=-t,Yt=et.x+e.x*Xt,zt=et.y+e.y*Xt,Ia=et.z+e.z*Xt;et.x=Yt,et.y=zt,et.z=Ia;var O=et,Va=this.p,lt=Va.sizeVec3==0?new x.common.Vec3:Va.stackVec3[--Va.sizeVec3];lt.x=S.x,lt.y=S.y,lt.z=S.z;var P=lt,wt=P.x+_.x*0,Bt=P.y+_.y*0,At=P.z+_.z*0;P.x=wt,P.y=Bt,P.z=At;var yt=P,kt=yt.x+e.x*t,pt=yt.y+e.y*t,ht=yt.z+e.z*t;yt.x=kt,yt.y=pt,yt.z=ht;var xt=yt;this.ellipse(k,_,e,t,t,i),this.ellipse(S,_,e,t,t,i),this.line(U,Aa,i),this.line(aa,it,i),this.line(Xa,O,i),this.line(Qa,xt,i);var Ra=this.p,st=null,Ca=null,vt=null;if(U!=null){if(U.zero(),Ra.sizeVec3==Ra.stackVec3.length){for(var qa=Ra.sizeVec3<<1,at=new Array(qa),Oa=at,tt=0,ct=Ra.sizeVec3;tt<ct;){var Sa=tt++;Oa[Sa]=Ra.stackVec3[Sa],Ra.stackVec3[Sa]=null}Ra.stackVec3=Oa}Ra.stackVec3[Ra.sizeVec3++]=U}if(st!=null){var Ga=1,Ka=0,La=0,ot=0,It=1,or=0,gr=0,ar=0,Ct=1;if(st.e00=Ga,st.e01=Ka,st.e02=La,st.e10=ot,st.e11=It,st.e12=or,st.e20=gr,st.e21=ar,st.e22=Ct,Ra.sizeMat3==Ra.stackMat3.length){for(var _r=Ra.sizeMat3<<1,Et=new Array(_r),St=Et,Gt=0,jr=Ra.sizeMat3;Gt<jr;){var vr=Gt++;St[vr]=Ra.stackMat3[vr],Ra.stackMat3[vr]=null}Ra.stackMat3=St}Ra.stackMat3[Ra.sizeMat3++]=st}if(Ca!=null){var lr=1,tr=0,Or=0,Xr=0,Mr=0,Zt=1,ir=0,Wt=0,nr=0,$r=0,Ut=1,Kr=0,Ir=0,mi=0,Wr=0,Lt=1;if(Ca.e00=lr,Ca.e01=tr,Ca.e02=Or,Ca.e03=Xr,Ca.e10=Mr,Ca.e11=Zt,Ca.e12=ir,Ca.e13=Wt,Ca.e20=nr,Ca.e21=$r,Ca.e22=Ut,Ca.e23=Kr,Ca.e30=Ir,Ca.e31=mi,Ca.e32=Wr,Ca.e33=Lt,Ra.sizeMat4==Ra.stackMat4.length){for(var Kt=Ra.sizeMat4<<1,Tt=new Array(Kt),br=Tt,zr=0,vi=Ra.sizeMat4;zr<vi;){var qt=zr++;br[qt]=Ra.stackMat4[qt],Ra.stackMat4[qt]=null}Ra.stackMat4=br}Ra.stackMat4[Ra.sizeMat4++]=Ca}if(vt!=null){var fr=0,dt=0,ur=0,hr=1;if(vt.x=fr,vt.y=dt,vt.z=ur,vt.w=hr,Ra.sizeQuat==Ra.stackQuat.length){for(var ei=Ra.sizeQuat<<1,Xi=new Array(ei),io=Xi,Jt=0,fi=Ra.sizeQuat;Jt<fi;){var pi=Jt++;io[pi]=Ra.stackQuat[pi],Ra.stackQuat[pi]=null}Ra.stackQuat=io}Ra.stackQuat[Ra.sizeQuat++]=vt}var Dt=this.p,di=null,Sr=null,Di=null;if(aa!=null){if(aa.zero(),Dt.sizeVec3==Dt.stackVec3.length){for(var Hn=Dt.sizeVec3<<1,oo=new Array(Hn),Bi=oo,no=0,yn=Dt.sizeVec3;no<yn;){var Ao=no++;Bi[Ao]=Dt.stackVec3[Ao],Dt.stackVec3[Ao]=null}Dt.stackVec3=Bi}Dt.stackVec3[Dt.sizeVec3++]=aa}if(di!=null){var Io=1,xr=0,qi=0,Ai=0,yi=1,So=0,Dr=0,Si=0,gi=1;if(di.e00=Io,di.e01=xr,di.e02=qi,di.e10=Ai,di.e11=yi,di.e12=So,di.e20=Dr,di.e21=Si,di.e22=gi,Dt.sizeMat3==Dt.stackMat3.length){for(var Rt=Dt.sizeMat3<<1,Hr=new Array(Rt),Lr=Hr,Cn=0,zs=Dt.sizeMat3;Cn<zs;){var Ke=Cn++;Lr[Ke]=Dt.stackMat3[Ke],Dt.stackMat3[Ke]=null}Dt.stackMat3=Lr}Dt.stackMat3[Dt.sizeMat3++]=di}if(Sr!=null){var ms=1,Te=0,qe=0,D_=0,gn=0,Pr=1,No=0,Wi=0,ke=0,on=0,Tn=1,jn=0,we=0,k_=0,Re=0,Vr=1;if(Sr.e00=ms,Sr.e01=Te,Sr.e02=qe,Sr.e03=D_,Sr.e10=gn,Sr.e11=Pr,Sr.e12=No,Sr.e13=Wi,Sr.e20=ke,Sr.e21=on,Sr.e22=Tn,Sr.e23=jn,Sr.e30=we,Sr.e31=k_,Sr.e32=Re,Sr.e33=Vr,Dt.sizeMat4==Dt.stackMat4.length){for(var Ii=Dt.sizeMat4<<1,ui=new Array(Ii),eo=ui,Rn=0,ps=Dt.sizeMat4;Rn<ps;){var nn=Rn++;eo[nn]=Dt.stackMat4[nn],Dt.stackMat4[nn]=null}Dt.stackMat4=eo}Dt.stackMat4[Dt.sizeMat4++]=Sr}if(Di!=null){var Qn=0,cr=0,ho=0,Fi=1;if(Di.x=Qn,Di.y=cr,Di.z=ho,Di.w=Fi,Dt.sizeQuat==Dt.stackQuat.length){for(var En=Dt.sizeQuat<<1,as=new Array(En),Qe=as,Ee=0,De=Dt.sizeQuat;Ee<De;){var he=Ee++;Qe[he]=Dt.stackQuat[he],Dt.stackQuat[he]=null}Dt.stackQuat=Qe}Dt.stackQuat[Dt.sizeQuat++]=Di}var rr=this.p,ri=null,Qr=null,Fr=null;if(Xa!=null){if(Xa.zero(),rr.sizeVec3==rr.stackVec3.length){for(var fo=rr.sizeVec3<<1,Po=new Array(fo),s_=Po,Fe=0,ts=rr.sizeVec3;Fe<ts;){var Dn=Fe++;s_[Dn]=rr.stackVec3[Dn],rr.stackVec3[Dn]=null}rr.stackVec3=s_}rr.stackVec3[rr.sizeVec3++]=Xa}if(ri!=null){var co=1,Ft=0,Nr=0,li=0,Vo=1,ce=0,Xe=0,Le=0,uo=1;if(ri.e00=co,ri.e01=Ft,ri.e02=Nr,ri.e10=li,ri.e11=Vo,ri.e12=ce,ri.e20=Xe,ri.e21=Le,ri.e22=uo,rr.sizeMat3==rr.stackMat3.length){for(var $t=rr.sizeMat3<<1,Vi=new Array($t),si=Vi,Go=0,Ns=rr.sizeMat3;Go<Ns;){var Co=Go++;si[Co]=rr.stackMat3[Co],rr.stackMat3[Co]=null}rr.stackMat3=si}rr.stackMat3[rr.sizeMat3++]=ri}if(Qr!=null){var ko=1,Ni=0,Pi=0,Ci=0,Li=0,Qt=1,Gr=0,Yr=0,Rr=0,Mi=0,qr=1,Gi=0,Ji=0,ao=0,be=0,kr=1;if(Qr.e00=ko,Qr.e01=Ni,Qr.e02=Pi,Qr.e03=Ci,Qr.e10=Li,Qr.e11=Qt,Qr.e12=Gr,Qr.e13=Yr,Qr.e20=Rr,Qr.e21=Mi,Qr.e22=qr,Qr.e23=Gi,Qr.e30=Ji,Qr.e31=ao,Qr.e32=be,Qr.e33=kr,rr.sizeMat4==rr.stackMat4.length){for(var en=rr.sizeMat4<<1,Yi=new Array(en),Jo=Yi,ys=0,In=rr.sizeMat4;ys<In;){var gs=ys++;Jo[gs]=rr.stackMat4[gs],rr.stackMat4[gs]=null}rr.stackMat4=Jo}rr.stackMat4[rr.sizeMat4++]=Qr}if(Fr!=null){var Vn=0,Cr=0,To=0,so=1;if(Fr.x=Vn,Fr.y=Cr,Fr.z=To,Fr.w=so,rr.sizeQuat==rr.stackQuat.length){for(var Fn=rr.sizeQuat<<1,Ne=new Array(Fn),Nn=Ne,Wo=0,kn=rr.sizeQuat;Wo<kn;){var Ye=Wo++;Nn[Ye]=rr.stackQuat[Ye],rr.stackQuat[Ye]=null}rr.stackQuat=Nn}rr.stackQuat[rr.sizeQuat++]=Fr}var Ot=this.p,Ro=null,Ui=null,wn=null;if(Qa!=null){if(Qa.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var Gn=Ot.sizeVec3<<1,fe=new Array(Gn),Is=fe,Uo=0,Vs=Ot.sizeVec3;Uo<Vs;){var w_=Uo++;Is[w_]=Ot.stackVec3[w_],Ot.stackVec3[w_]=null}Ot.stackVec3=Is}Ot.stackVec3[Ot.sizeVec3++]=Qa}if(Ro!=null){var Gs=1,X_=0,Ge=0,F_=0,N_=1,Oi=0,wo=0,Xo=0,Jn=1;if(Ro.e00=Gs,Ro.e01=X_,Ro.e02=Ge,Ro.e10=F_,Ro.e11=N_,Ro.e12=Oi,Ro.e20=wo,Ro.e21=Xo,Ro.e22=Jn,Ot.sizeMat3==Ot.stackMat3.length){for(var wr=Ot.sizeMat3<<1,Wn=new Array(wr),Qo=Wn,to=0,G_=Ot.sizeMat3;to<G_;){var J_=to++;Qo[J_]=Ot.stackMat3[J_],Ot.stackMat3[J_]=null}Ot.stackMat3=Qo}Ot.stackMat3[Ot.sizeMat3++]=Ro}if(Ui!=null){var L_=1,rs=0,__=0,v_=0,is=0,mr=1,Oo=0,ai=0,Ze=0,Js=0,hv=1,ue=0,Je=0,$n=0,Ws=0,Tr=1;if(Ui.e00=L_,Ui.e01=rs,Ui.e02=__,Ui.e03=v_,Ui.e10=is,Ui.e11=mr,Ui.e12=Oo,Ui.e13=ai,Ui.e20=Ze,Ui.e21=Js,Ui.e22=hv,Ui.e23=ue,Ui.e30=Je,Ui.e31=$n,Ui.e32=Ws,Ui.e33=Tr,Ot.sizeMat4==Ot.stackMat4.length){for(var Lo=Ot.sizeMat4<<1,Ti=new Array(Lo),sn=Ti,ks=0,Y_=Ot.sizeMat4;ks<Y_;){var We=ks++;sn[We]=Ot.stackMat4[We],Ot.stackMat4[We]=null}Ot.stackMat4=sn}Ot.stackMat4[Ot.sizeMat4++]=Ui}if(wn!=null){var Kn=0,Xn=0,os=0,de=1;if(wn.x=Kn,wn.y=Xn,wn.z=os,wn.w=de,Ot.sizeQuat==Ot.stackQuat.length){for(var ns=Ot.sizeQuat<<1,Us=new Array(ns),l_=Us,Be=0,Ae=Ot.sizeQuat;Be<Ae;){var qn=Be++;l_[qn]=Ot.stackQuat[qn],Ot.stackQuat[qn]=null}Ot.stackQuat=l_}Ot.stackQuat[Ot.sizeQuat++]=wn}var pr=this.p,xo=null,Zi=null,Ho=null;if(Aa!=null){if(Aa.zero(),pr.sizeVec3==pr.stackVec3.length){for(var Yo=pr.sizeVec3<<1,Hi=new Array(Yo),Eo=Hi,ws=0,ae=pr.sizeVec3;ws<ae;){var Os=ws++;Eo[Os]=pr.stackVec3[Os],pr.stackVec3[Os]=null}pr.stackVec3=Eo}pr.stackVec3[pr.sizeVec3++]=Aa}if(xo!=null){var W_=1,te=0,Nt=0,ji=0,Do=1,Xs=0,kv=0,r0=0,U_=1;if(xo.e00=W_,xo.e01=te,xo.e02=Nt,xo.e10=ji,xo.e11=Do,xo.e12=Xs,xo.e20=kv,xo.e21=r0,xo.e22=U_,pr.sizeMat3==pr.stackMat3.length){for(var Ht=pr.sizeMat3<<1,Ln=new Array(Ht),Ri=Ln,Yn=0,Z_=pr.sizeMat3;Yn<Z_;){var Hs=Yn++;Ri[Hs]=pr.stackMat3[Hs],pr.stackMat3[Hs]=null}pr.stackMat3=Ri}pr.stackMat3[pr.sizeMat3++]=xo}if(Zi!=null){var h_=1,bo=0,es=0,ss=0,xe=0,Zr=1,jo=0,ki=0,Zo=0,Ue=0,cv=1,Me=0,js=0,wv=0,Oe=0,er=1;if(Zi.e00=h_,Zi.e01=bo,Zi.e02=es,Zi.e03=ss,Zi.e10=xe,Zi.e11=Zr,Zi.e12=jo,Zi.e13=ki,Zi.e20=Zo,Zi.e21=Ue,Zi.e22=cv,Zi.e23=Me,Zi.e30=js,Zi.e31=wv,Zi.e32=Oe,Zi.e33=er,pr.sizeMat4==pr.stackMat4.length){for(var Zn=pr.sizeMat4<<1,_n=new Array(Zn),vn=_n,d_=0,bv=pr.sizeMat4;d_<bv;){var re=d_++;vn[re]=pr.stackMat4[re],pr.stackMat4[re]=null}pr.stackMat4=vn}pr.stackMat4[pr.sizeMat4++]=Zi}if(Ho!=null){var Se=0,c_=0,O_=0,fv=1;if(Ho.x=Se,Ho.y=c_,Ho.z=O_,Ho.w=fv,pr.sizeQuat==pr.stackQuat.length){for(var uv=pr.sizeQuat<<1,b_=new Array(uv),He=b_,Mo=0,_s=pr.sizeQuat;Mo<_s;){var vs=Mo++;He[vs]=pr.stackQuat[vs],pr.stackQuat[vs]=null}pr.stackQuat=He}pr.stackQuat[pr.sizeQuat++]=Ho}var Ur=this.p,zo=null,_o=null,ls=null;if(it!=null){if(it.zero(),Ur.sizeVec3==Ur.stackVec3.length){for(var Ls=Ur.sizeVec3<<1,Ys=new Array(Ls),Zs=Ys,B_=0,ze=Ur.sizeVec3;B_<ze;){var hs=B_++;Zs[hs]=Ur.stackVec3[hs],Ur.stackVec3[hs]=null}Ur.stackVec3=Zs}Ur.stackVec3[Ur.sizeVec3++]=it}if(zo!=null){var H_=1,$s=0,Un=0,me=0,Xv=1,A_=0,$o=0,ln=0,mo=1;if(zo.e00=H_,zo.e01=$s,zo.e02=Un,zo.e10=me,zo.e11=Xv,zo.e12=A_,zo.e20=$o,zo.e21=ln,zo.e22=mo,Ur.sizeMat3==Ur.stackMat3.length){for(var jt=Ur.sizeMat3<<1,$i=new Array(jt),vo=$i,Ks=0,ds=Ur.sizeMat3;Ks<ds;){var qs=Ks++;vo[qs]=Ur.stackMat3[qs],Ur.stackMat3[qs]=null}Ur.stackMat3=vo}Ur.stackMat3[Ur.sizeMat3++]=zo}if(_o!=null){var S_=1,Ko=0,ie=0,j_=0,xv=0,dr=1,po=0,Qi=0,ro=0,$_=0,K_=1,Lv=0,a_=0,Yv=0,q_=0,Br=1;if(_o.e00=S_,_o.e01=Ko,_o.e02=ie,_o.e03=j_,_o.e10=xv,_o.e11=dr,_o.e12=po,_o.e13=Qi,_o.e20=ro,_o.e21=$_,_o.e22=K_,_o.e23=Lv,_o.e30=a_,_o.e31=Yv,_o.e32=q_,_o.e33=Br,Ur.sizeMat4==Ur.stackMat4.length){for(var av=Ur.sizeMat4<<1,Bs=new Array(av),As=Bs,cs=0,bs=Ur.sizeMat4;cs<bs;){var Ss=cs++;As[Ss]=Ur.stackMat4[Ss],Ur.stackMat4[Ss]=null}Ur.stackMat4=As}Ur.stackMat4[Ur.sizeMat4++]=_o}if(ls!=null){var Zv=0,pe=0,Ki=0,t_=1;if(ls.x=Zv,ls.y=pe,ls.z=Ki,ls.w=t_,Ur.sizeQuat==Ur.stackQuat.length){for(var yo=Ur.sizeQuat<<1,r_=new Array(yo),Fo=r_,Ps=0,qo=Ur.sizeQuat;Ps<qo;){var ye=Ps++;Fo[ye]=Ur.stackQuat[ye],Ur.stackQuat[ye]=null}Ur.stackQuat=Fo}Ur.stackQuat[Ur.sizeQuat++]=ls}var sr=this.p,an=null,_i=null,oe=null;if(O!=null){if(O.zero(),sr.sizeVec3==sr.stackVec3.length){for(var ge=sr.sizeVec3<<1,Bo=new Array(ge),Ei=Bo,dn=0,tv=sr.sizeVec3;dn<tv;){var i_=dn++;Ei[i_]=sr.stackVec3[i_],sr.stackVec3[i_]=null}sr.stackVec3=Ei}sr.stackVec3[sr.sizeVec3++]=O}if(an!=null){var P_=1,rv=0,ne=0,Bn=0,Ie=1,E0=0,z0=0,hl=0,D0=1;if(an.e00=P_,an.e01=rv,an.e02=ne,an.e10=Bn,an.e11=Ie,an.e12=E0,an.e20=z0,an.e21=hl,an.e22=D0,sr.sizeMat3==sr.stackMat3.length){for(var hi=sr.sizeMat3<<1,On=new Array(hi),go=On,fs=0,iv=sr.sizeMat3;fs<iv;){var Mv=fs++;go[Mv]=sr.stackMat3[Mv],sr.stackMat3[Mv]=null}sr.stackMat3=go}sr.stackMat3[sr.sizeMat3++]=an}if(_i!=null){var o_=1,dv=0,Cs=0,f_=0,u_=0,Ar=1,Ts=0,lo=0,Pe=0,zv=0,Rs=1,x_=0,ov=0,i0=0,o0=0,nv=1;if(_i.e00=o_,_i.e01=dv,_i.e02=Cs,_i.e03=f_,_i.e10=u_,_i.e11=Ar,_i.e12=Ts,_i.e13=lo,_i.e20=Pe,_i.e21=zv,_i.e22=Rs,_i.e23=x_,_i.e30=ov,_i.e31=i0,_i.e32=o0,_i.e33=nv,sr.sizeMat4==sr.stackMat4.length){for(var ti=sr.sizeMat4<<1,je=new Array(ti),An=je,us=0,F0=sr.sizeMat4;us<F0;){var Dv=us++;An[Dv]=sr.stackMat4[Dv],sr.stackMat4[Dv]=null}sr.stackMat4=An}sr.stackMat4[sr.sizeMat4++]=_i}if(oe!=null){var C_=0,m0=0,Bv=0,n0=1;if(oe.x=C_,oe.y=m0,oe.z=Bv,oe.w=n0,sr.sizeQuat==sr.stackQuat.length){for(var p0=sr.sizeQuat<<1,N0=new Array(p0),e0=N0,s0=0,y0=sr.sizeQuat;s0<y0;){var Fv=s0++;e0[Fv]=sr.stackQuat[Fv],sr.stackQuat[Fv]=null}sr.stackQuat=e0}sr.stackQuat[sr.sizeQuat++]=oe}var ci=this.p,mv=null,hn=null,Nv=null;if(xt!=null){if(xt.zero(),ci.sizeVec3==ci.stackVec3.length){for(var Hl=ci.sizeVec3<<1,g0=new Array(Hl),I0=g0,cl=0,dl=ci.sizeVec3;cl<dl;){var Gv=cl++;I0[Gv]=ci.stackVec3[Gv],ci.stackVec3[Gv]=null}ci.stackVec3=I0}ci.stackVec3[ci.sizeVec3++]=xt}if(mv!=null){var jl=1,$l=0,bl=0,Bl=0,Al=1,Kl=0,fl=0,ql=0,ul=1;if(mv.e00=jl,mv.e01=$l,mv.e02=bl,mv.e10=Bl,mv.e11=Al,mv.e12=Kl,mv.e20=fl,mv.e21=ql,mv.e22=ul,ci.sizeMat3==ci.stackMat3.length){for(var ii=ci.sizeMat3<<1,xs=new Array(ii),tn=xs,pv=0,yh=ci.sizeMat3;pv<yh;){var Jv=pv++;tn[Jv]=ci.stackMat3[Jv],ci.stackMat3[Jv]=null}ci.stackMat3=tn}ci.stackMat3[ci.sizeMat3++]=mv}if(hn!=null){var G0=1,xl=0,V0=0,k0=0,J0=0,zi=1,Ms=0,ee=0,_0=0,Sl=0,lh=1,W0=0,hh=0,U0=0,Pl=0,Ml=1;if(hn.e00=G0,hn.e01=xl,hn.e02=V0,hn.e03=k0,hn.e10=J0,hn.e11=zi,hn.e12=Ms,hn.e13=ee,hn.e20=_0,hn.e21=Sl,hn.e22=lh,hn.e23=W0,hn.e30=hh,hn.e31=U0,hn.e32=Pl,hn.e33=Ml,ci.sizeMat4==ci.stackMat4.length){for(var Ce=ci.sizeMat4<<1,w0=new Array(Ce),M_=w0,Cl=0,O0=ci.sizeMat4;Cl<O0;){var H0=Cl++;M_[H0]=ci.stackMat4[H0],ci.stackMat4[H0]=null}ci.stackMat4=M_}ci.stackMat4[ci.sizeMat4++]=hn}if(Nv!=null){var Tl=0,zl=0,X0=0,v0=1;if(Nv.x=Tl,Nv.y=zl,Nv.z=X0,Nv.w=v0,ci.sizeQuat==ci.stackQuat.length){for(var z_=ci.sizeQuat<<1,Wv=new Array(z_),Uv=Wv,ev=0,L0=ci.sizeQuat;ev<L0;){var Av=ev++;Uv[Av]=ci.stackQuat[Av],ci.stackQuat[Av]=null}ci.stackQuat=Uv}ci.stackQuat[ci.sizeQuat++]=Nv}}else{for(var l0=0;l0<8;){var se=l0++,h0=this.tmpCircleNorms[se],Y0=this.circleCoords[se];h0.x=Y0.x,h0.y=Y0.y,h0.z=Y0.z;var Qs=h0,j0=Qs.x*f.e00+Qs.y*f.e01+Qs.z*f.e02,yr=Qs.x*f.e10+Qs.y*f.e11+Qs.z*f.e12,cn=Qs.x*f.e20+Qs.y*f.e21+Qs.z*f.e22;Qs.x=j0,Qs.y=yr,Qs.z=cn;var wi=this.tmpCircleVerts1[se],Ov=this.tmpCircleNorms[se];wi.x=Ov.x,wi.y=Ov.y,wi.z=Ov.z;var c0=wi,ch=c0.x*t,ah=c0.y*t,m_=c0.z*t;c0.x=ch,c0.y=ah,c0.z=m_;var $e=c0,Es=$e.x+u.x,th=$e.y+u.y,bh=$e.z+u.z;$e.x=Es,$e.y=th,$e.z=bh;var Rl=this.tmpCircleVerts2[se],bi=this.tmpCircleVerts1[se];Rl.x=bi.x,Rl.y=bi.y,Rl.z=bi.z;var n_=this.tmpCircleVerts1[se],bn=n_.x+h.x*r,yv=n_.y+h.y*r,$0=n_.z+h.z*r;n_.x=bn,n_.y=yv,n_.z=$0;var gv=this.tmpCircleVerts2[se],ml=-r,pl=gv.x+h.x*ml,yl=gv.y+h.y*ml,T_=gv.z+h.z*ml;gv.x=pl,gv.y=yl,gv.z=T_}for(var Sv=0;Sv<8;){var Sn=Sv++,Iv=k,Pv=this.tmpCircleVerts1[Sn],R_=this.tmpCircleVerts1[(Sn+1)%8],_e=h;this.triangle(Iv,Pv,R_,_e,_e,_e,i),Iv=S,Pv=this.tmpCircleVerts2[(Sn+1)%8],R_=this.tmpCircleVerts2[Sn];var Q_=this.p,Cv=Q_.sizeVec3==0?new x.common.Vec3:Q_.stackVec3[--Q_.sizeVec3];Cv.x=h.x,Cv.y=h.y,Cv.z=h.z;var Hv=Cv,oi=-Hv.x,p_=-Hv.y,ve=-Hv.z;Hv.x=oi,Hv.y=p_,Hv.z=ve,_e=Hv,this.triangle(Iv,Pv,R_,_e,_e,_e,i);var Jr=this.p,y_=null,Pn=null,K0=null;if(_e!=null){if(_e.zero(),Jr.sizeVec3==Jr.stackVec3.length){for(var b0=Jr.sizeVec3<<1,fh=new Array(b0),q0=fh,al=0,gl=Jr.sizeVec3;al<gl;){var Z0=al++;q0[Z0]=Jr.stackVec3[Z0],Jr.stackVec3[Z0]=null}Jr.stackVec3=q0}Jr.stackVec3[Jr.sizeVec3++]=_e}if(y_!=null){var uh=1,Il=0,gh=0,rh=0,Vl=1,d0=0,B0=0,kl=0,ih=1;if(y_.e00=uh,y_.e01=Il,y_.e02=gh,y_.e10=rh,y_.e11=Vl,y_.e12=d0,y_.e20=B0,y_.e21=kl,y_.e22=ih,Jr.sizeMat3==Jr.stackMat3.length){for(var jv=Jr.sizeMat3<<1,Ql=new Array(jv),$v=Ql,ni=0,g_=Jr.sizeMat3;ni<g_;){var rn=ni++;$v[rn]=Jr.stackMat3[rn],Jr.stackMat3[rn]=null}Jr.stackMat3=$v}Jr.stackMat3[Jr.sizeMat3++]=y_}if(Pn!=null){var wl=1,A0=0,oh=0,El=0,tl=0,Dl=1,S0=0,nh=0,eh=0,Fl=0,Nl=1,sv=0,Tv=0,Kv=0,Ds=0,xh=1;if(Pn.e00=wl,Pn.e01=A0,Pn.e02=oh,Pn.e03=El,Pn.e10=tl,Pn.e11=Dl,Pn.e12=S0,Pn.e13=nh,Pn.e20=eh,Pn.e21=Fl,Pn.e22=Nl,Pn.e23=sv,Pn.e30=Tv,Pn.e31=Kv,Pn.e32=Ds,Pn.e33=xh,Jr.sizeMat4==Jr.stackMat4.length){for(var f0=Jr.sizeMat4<<1,Xl=new Array(f0),Rv=Xl,qv=0,Qv=Jr.sizeMat4;qv<Qv;){var u0=qv++;Rv[u0]=Jr.stackMat4[u0],Jr.stackMat4[u0]=null}Jr.stackMat4=Rv}Jr.stackMat4[Jr.sizeMat4++]=Pn}if(K0!=null){var Zh=0,P0=0,a0=0,Gl=1;if(K0.x=Zh,K0.y=P0,K0.z=a0,K0.w=Gl,Jr.sizeQuat==Jr.stackQuat.length){for(var Jl=Jr.sizeQuat<<1,Mh=new Array(Jl),Ev=Mh,xi=0,Ve=Jr.sizeQuat;xi<Ve;){var le=xi++;Ev[le]=Jr.stackQuat[le],Jr.stackQuat[le]=null}Jr.stackQuat=Ev}Jr.stackQuat[Jr.sizeQuat++]=K0}Iv=this.tmpCircleVerts1[Sn],Pv=this.tmpCircleVerts2[Sn],R_=this.tmpCircleVerts2[(Sn+1)%8];var C0=this.tmpCircleVerts1[(Sn+1)%8];_e=this.tmpCircleNorms[Sn];var Wl=this.tmpCircleNorms[(Sn+1)%8];this.rect(Iv,Pv,R_,C0,_e,_e,Wl,Wl,i)}}var Fs=this.p;if(k!=null){if(k.zero(),Fs.sizeVec3==Fs.stackVec3.length){for(var x0=Fs.sizeVec3<<1,Ll=new Array(x0),Ul=Ll,Ol=0,Ih=Fs.sizeVec3;Ol<Ih;){var _v=Ol++;Ul[_v]=Fs.stackVec3[_v],Fs.stackVec3[_v]=null}Fs.stackVec3=Ul}Fs.stackVec3[Fs.sizeVec3++]=k}var vv=this.p;if(S!=null){if(S.zero(),vv.sizeVec3==vv.stackVec3.length){for(var T0=vv.sizeVec3<<1,I_=new Array(T0),Yl=I_,Vh=0,dh=vv.sizeVec3;Vh<dh;){var t0=Vh++;Yl[t0]=vv.stackVec3[t0],vv.stackVec3[t0]=null}vv.stackVec3=Yl}vv.stackVec3[vv.sizeVec3++]=S}var lv=this.p;if(u!=null){if(u.zero(),lv.sizeVec3==lv.stackVec3.length){for(var kh=lv.sizeVec3<<1,Zl=new Array(kh),wh=Zl,jh=0,sh=lv.sizeVec3;jh<sh;){var Er=jh++;wh[Er]=lv.stackVec3[Er],lv.stackVec3[Er]=null}lv.stackVec3=wh}lv.stackVec3[lv.sizeVec3++]=u}var e_=this.p;if(f!=null){var V_=1,_h=0,Bh=0,Ah=0,zh=1,Vv=0,Rh=0,Qh=0,$h=1;if(f.e00=V_,f.e01=_h,f.e02=Bh,f.e10=Ah,f.e11=zh,f.e12=Vv,f.e20=Rh,f.e21=Qh,f.e22=$h,e_.sizeMat3==e_.stackMat3.length){for(var Kh=e_.sizeMat3<<1,mh=new Array(Kh),Sh=mh,rl=0,rc=e_.sizeMat3;rl<rc;){var Xh=rl++;Sh[Xh]=e_.stackMat3[Xh],e_.stackMat3[Xh]=null}e_.stackMat3=Sh}e_.stackMat3[e_.sizeMat3++]=f}var E_=this.p;if(_!=null){if(_.zero(),E_.sizeVec3==E_.stackVec3.length){for(var Eh=E_.sizeVec3<<1,ph=new Array(Eh),qh=ph,Lh=0,ac=E_.sizeVec3;Lh<ac;){var Ph=Lh++;qh[Ph]=E_.stackVec3[Ph],E_.stackVec3[Ph]=null}E_.stackVec3=qh}E_.stackVec3[E_.sizeVec3++]=_}var R0=this.p;if(h!=null){if(h.zero(),R0.sizeVec3==R0.stackVec3.length){for(var ic=R0.sizeVec3<<1,vh=new Array(ic),Yh=vh,Dh=0,Ch=R0.sizeVec3;Dh<Ch;){var Q0=Dh++;Yh[Q0]=R0.stackVec3[Q0],R0.stackVec3[Q0]=null}R0.stackVec3=Yh}R0.stackVec3[R0.sizeVec3++]=h}var M0=this.p;if(e!=null){if(e.zero(),M0.sizeVec3==M0.stackVec3.length){for(var nc=M0.sizeVec3<<1,ec=new Array(nc),Fh=ec,oc=0,tc=M0.sizeVec3;oc<tc;){var il=oc++;Fh[il]=M0.stackVec3[il],M0.stackVec3[il]=null}M0.stackVec3=Fh}M0.stackVec3[M0.sizeVec3++]=e}}capsule(a,t,r,i){var o=this.p,_=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],s=this.p,h=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,_.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);for(var M=4,m=8,y=this.tmpSphereVerts,V=this.tmpSphereNorms,z=0,I=M+1;z<I;)for(var k=z++,X=this.tmpSphereVerts[k].length,L=0,p=X;L<p;){var g=L++,N=V[k][g],A=this.sphereCoords[k][g];N.x=A.x,N.y=A.y,N.z=A.z;var F=N,S=F.x*f.e00+F.y*f.e01+F.z*f.e02,Y=F.x*f.e10+F.y*f.e11+F.z*f.e12,R=F.x*f.e20+F.y*f.e21+F.z*f.e22;F.x=S,F.y=Y,F.z=R}for(var C=0,d=M;C<d;){var Z=C++;if(Z==0)for(var $=M>>1,j=0,E=$+1;j<E;)for(var G=j++,B=this.tmpSphereVerts[G].length,Q=0,U=B;Q<U;){var J=Q++,D=y[G][J],H=V[G][J];D.x=H.x,D.y=H.y,D.z=H.z;var K=D,ra=K.x*t,sa=K.y*t,W=K.z*t;K.x=ra,K.y=sa,K.z=W;var q=K,na=q.x+u.x,oa=q.y+u.y,aa=q.z+u.z;q.x=na,q.y=oa,q.z=aa;var T=q,ca=T.x+h.x*r,_a=T.y+h.y*r,w=T.z+h.z*r;T.x=ca,T.y=_a,T.z=w}if(Z==M>>1)for(var ta=M>>1,ia=ta,la=M+1;ia<la;)for(var va=ia++,xa=this.tmpSphereVerts[va].length,Ma=0,za=xa;Ma<za;){var Xa=Ma++,Za=y[va][Xa],fa=V[va][Xa];Za.x=fa.x,Za.y=fa.y,Za.z=fa.z;var ba=Za,ea=ba.x*t,ha=ba.y*t,pa=ba.z*t;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+u.x,ma=ya.y+u.y,Ya=ya.z+u.z;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya,ga=-r,ua=Qa.x+h.x*ga,wa=Qa.y+h.y*ga,ka=Qa.z+h.z*ga;Qa.x=ua,Qa.y=wa,Qa.z=ka}for(var Pa=0,Mt=m;Pa<Mt;){var Ha=Pa++,Ba,nt,Ea,Fa,Aa,ft,Ua,ja;Z==0?this.wireframe?(Ba=y[0][0],nt=y[1][Ha],this.line(Ba,nt,i)):(Ba=y[0][0],nt=y[1][Ha],Ea=y[1][(Ha+1)%m],Aa=V[0][0],ft=V[1][Ha],Ua=V[1][(Ha+1)%m],this.triangle(Ba,nt,Ea,Aa,ft,Ua,i)):Z==M-1?this.wireframe?(Ba=y[M][0],nt=y[Z][(Ha+1)%m],Ea=y[Z][Ha],this.line(Ba,nt,i),this.line(nt,Ea,i)):(Ba=y[M][0],nt=y[Z][(Ha+1)%m],Ea=y[Z][Ha],Aa=V[M][0],ft=V[Z][(Ha+1)%m],Ua=V[Z][Ha],this.triangle(Ba,nt,Ea,Aa,ft,Ua,i)):this.wireframe?(Ba=y[Z][Ha],nt=y[Z][(Ha+1)%m],Ea=y[Z+1][Ha],this.line(Ba,nt,i),this.line(Ba,Ea,i)):(Ba=y[Z][Ha],nt=y[Z][(Ha+1)%m],Ea=y[Z+1][Ha],Fa=y[Z+1][(Ha+1)%m],Aa=V[Z][Ha],ft=V[Z][(Ha+1)%m],Ua=V[Z+1][Ha],ja=V[Z+1][(Ha+1)%m],this.rect(Ba,Ea,Fa,nt,Aa,Ua,ja,ft,i))}}var bt=this.p,rt=bt.sizeVec3==0?new x.common.Vec3:bt.stackVec3[--bt.sizeVec3];rt.x=u.x,rt.y=u.y,rt.z=u.z;var $a=rt,_t=$a.x+h.x*r,gt=$a.y+h.y*r,mt=$a.z+h.z*r;$a.x=_t,$a.y=gt,$a.z=mt;var Wa=$a,it=this.p,ut=it.sizeVec3==0?new x.common.Vec3:it.stackVec3[--it.sizeVec3];ut.x=u.x,ut.y=u.y,ut.z=u.z;var Da=ut,Ta=-r,Na=Da.x+h.x*Ta,Vt=Da.y+h.y*Ta,Pt=Da.z+h.z*Ta;Da.x=Na,Da.y=Vt,Da.z=Pt;var et=Da;if(this.wireframe){var Xt=this.p,Yt=Xt.sizeVec3==0?new x.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=Wa.x,Yt.y=Wa.y,Yt.z=Wa.z;var zt=Yt,Ia=-t,O=zt.x+_.x*Ia,Va=zt.y+_.y*Ia,lt=zt.z+_.z*Ia;zt.x=O,zt.y=Va,zt.z=lt;var P=zt,wt=P.x+e.x*0,Bt=P.y+e.y*0,At=P.z+e.z*0;P.x=wt,P.y=Bt,P.z=At;var yt=P,kt=this.p,pt=kt.sizeVec3==0?new x.common.Vec3:kt.stackVec3[--kt.sizeVec3];pt.x=Wa.x,pt.y=Wa.y,pt.z=Wa.z;var ht=pt,xt=ht.x+_.x*t,Ra=ht.y+_.y*t,st=ht.z+_.z*t;ht.x=xt,ht.y=Ra,ht.z=st;var Ca=ht,vt=Ca.x+e.x*0,qa=Ca.y+e.y*0,at=Ca.z+e.z*0;Ca.x=vt,Ca.y=qa,Ca.z=at;var Oa=Ca,tt=this.p,ct=tt.sizeVec3==0?new x.common.Vec3:tt.stackVec3[--tt.sizeVec3];ct.x=Wa.x,ct.y=Wa.y,ct.z=Wa.z;var Sa=ct,Ga=Sa.x+_.x*0,Ka=Sa.y+_.y*0,La=Sa.z+_.z*0;Sa.x=Ga,Sa.y=Ka,Sa.z=La;var ot=Sa,It=-t,or=ot.x+e.x*It,gr=ot.y+e.y*It,ar=ot.z+e.z*It;ot.x=or,ot.y=gr,ot.z=ar;var Ct=ot,_r=this.p,Et=_r.sizeVec3==0?new x.common.Vec3:_r.stackVec3[--_r.sizeVec3];Et.x=Wa.x,Et.y=Wa.y,Et.z=Wa.z;var St=Et,Gt=St.x+_.x*0,jr=St.y+_.y*0,vr=St.z+_.z*0;St.x=Gt,St.y=jr,St.z=vr;var lr=St,tr=lr.x+e.x*t,Or=lr.y+e.y*t,Xr=lr.z+e.z*t;lr.x=tr,lr.y=Or,lr.z=Xr;var Mr=lr,Zt=this.p,ir=Zt.sizeVec3==0?new x.common.Vec3:Zt.stackVec3[--Zt.sizeVec3];ir.x=et.x,ir.y=et.y,ir.z=et.z;var Wt=ir,nr=-t,$r=Wt.x+_.x*nr,Ut=Wt.y+_.y*nr,Kr=Wt.z+_.z*nr;Wt.x=$r,Wt.y=Ut,Wt.z=Kr;var Ir=Wt,mi=Ir.x+e.x*0,Wr=Ir.y+e.y*0,Lt=Ir.z+e.z*0;Ir.x=mi,Ir.y=Wr,Ir.z=Lt;var Kt=Ir,Tt=this.p,br=Tt.sizeVec3==0?new x.common.Vec3:Tt.stackVec3[--Tt.sizeVec3];br.x=et.x,br.y=et.y,br.z=et.z;var zr=br,vi=zr.x+_.x*t,qt=zr.y+_.y*t,fr=zr.z+_.z*t;zr.x=vi,zr.y=qt,zr.z=fr;var dt=zr,ur=dt.x+e.x*0,hr=dt.y+e.y*0,ei=dt.z+e.z*0;dt.x=ur,dt.y=hr,dt.z=ei;var Xi=dt,io=this.p,Jt=io.sizeVec3==0?new x.common.Vec3:io.stackVec3[--io.sizeVec3];Jt.x=et.x,Jt.y=et.y,Jt.z=et.z;var fi=Jt,pi=fi.x+_.x*0,Dt=fi.y+_.y*0,di=fi.z+_.z*0;fi.x=pi,fi.y=Dt,fi.z=di;var Sr=fi,Di=-t,Hn=Sr.x+e.x*Di,oo=Sr.y+e.y*Di,Bi=Sr.z+e.z*Di;Sr.x=Hn,Sr.y=oo,Sr.z=Bi;var no=Sr,yn=this.p,Ao=yn.sizeVec3==0?new x.common.Vec3:yn.stackVec3[--yn.sizeVec3];Ao.x=et.x,Ao.y=et.y,Ao.z=et.z;var Io=Ao,xr=Io.x+_.x*0,qi=Io.y+_.y*0,Ai=Io.z+_.z*0;Io.x=xr,Io.y=qi,Io.z=Ai;var yi=Io,So=yi.x+e.x*t,Dr=yi.y+e.y*t,Si=yi.z+e.z*t;yi.x=So,yi.y=Dr,yi.z=Si;var gi=yi;this.ellipse(Wa,_,e,t,t,i),this.ellipse(et,_,e,t,t,i),this.line(yt,Kt,i),this.line(Oa,Xi,i),this.line(Ct,no,i),this.line(Mr,gi,i);var Rt=this.p,Hr=null,Lr=null,Cn=null;if(yt!=null){if(yt.zero(),Rt.sizeVec3==Rt.stackVec3.length){for(var zs=Rt.sizeVec3<<1,Ke=new Array(zs),ms=Ke,Te=0,qe=Rt.sizeVec3;Te<qe;){var D_=Te++;ms[D_]=Rt.stackVec3[D_],Rt.stackVec3[D_]=null}Rt.stackVec3=ms}Rt.stackVec3[Rt.sizeVec3++]=yt}if(Hr!=null){var gn=1,Pr=0,No=0,Wi=0,ke=1,on=0,Tn=0,jn=0,we=1;if(Hr.e00=gn,Hr.e01=Pr,Hr.e02=No,Hr.e10=Wi,Hr.e11=ke,Hr.e12=on,Hr.e20=Tn,Hr.e21=jn,Hr.e22=we,Rt.sizeMat3==Rt.stackMat3.length){for(var k_=Rt.sizeMat3<<1,Re=new Array(k_),Vr=Re,Ii=0,ui=Rt.sizeMat3;Ii<ui;){var eo=Ii++;Vr[eo]=Rt.stackMat3[eo],Rt.stackMat3[eo]=null}Rt.stackMat3=Vr}Rt.stackMat3[Rt.sizeMat3++]=Hr}if(Lr!=null){var Rn=1,ps=0,nn=0,Qn=0,cr=0,ho=1,Fi=0,En=0,as=0,Qe=0,Ee=1,De=0,he=0,rr=0,ri=0,Qr=1;if(Lr.e00=Rn,Lr.e01=ps,Lr.e02=nn,Lr.e03=Qn,Lr.e10=cr,Lr.e11=ho,Lr.e12=Fi,Lr.e13=En,Lr.e20=as,Lr.e21=Qe,Lr.e22=Ee,Lr.e23=De,Lr.e30=he,Lr.e31=rr,Lr.e32=ri,Lr.e33=Qr,Rt.sizeMat4==Rt.stackMat4.length){for(var Fr=Rt.sizeMat4<<1,fo=new Array(Fr),Po=fo,s_=0,Fe=Rt.sizeMat4;s_<Fe;){var ts=s_++;Po[ts]=Rt.stackMat4[ts],Rt.stackMat4[ts]=null}Rt.stackMat4=Po}Rt.stackMat4[Rt.sizeMat4++]=Lr}if(Cn!=null){var Dn=0,co=0,Ft=0,Nr=1;if(Cn.x=Dn,Cn.y=co,Cn.z=Ft,Cn.w=Nr,Rt.sizeQuat==Rt.stackQuat.length){for(var li=Rt.sizeQuat<<1,Vo=new Array(li),ce=Vo,Xe=0,Le=Rt.sizeQuat;Xe<Le;){var uo=Xe++;ce[uo]=Rt.stackQuat[uo],Rt.stackQuat[uo]=null}Rt.stackQuat=ce}Rt.stackQuat[Rt.sizeQuat++]=Cn}var $t=this.p,Vi=null,si=null,Go=null;if(Oa!=null){if(Oa.zero(),$t.sizeVec3==$t.stackVec3.length){for(var Ns=$t.sizeVec3<<1,Co=new Array(Ns),ko=Co,Ni=0,Pi=$t.sizeVec3;Ni<Pi;){var Ci=Ni++;ko[Ci]=$t.stackVec3[Ci],$t.stackVec3[Ci]=null}$t.stackVec3=ko}$t.stackVec3[$t.sizeVec3++]=Oa}if(Vi!=null){var Li=1,Qt=0,Gr=0,Yr=0,Rr=1,Mi=0,qr=0,Gi=0,Ji=1;if(Vi.e00=Li,Vi.e01=Qt,Vi.e02=Gr,Vi.e10=Yr,Vi.e11=Rr,Vi.e12=Mi,Vi.e20=qr,Vi.e21=Gi,Vi.e22=Ji,$t.sizeMat3==$t.stackMat3.length){for(var ao=$t.sizeMat3<<1,be=new Array(ao),kr=be,en=0,Yi=$t.sizeMat3;en<Yi;){var Jo=en++;kr[Jo]=$t.stackMat3[Jo],$t.stackMat3[Jo]=null}$t.stackMat3=kr}$t.stackMat3[$t.sizeMat3++]=Vi}if(si!=null){var ys=1,In=0,gs=0,Vn=0,Cr=0,To=1,so=0,Fn=0,Ne=0,Nn=0,Wo=1,kn=0,Ye=0,Ot=0,Ro=0,Ui=1;if(si.e00=ys,si.e01=In,si.e02=gs,si.e03=Vn,si.e10=Cr,si.e11=To,si.e12=so,si.e13=Fn,si.e20=Ne,si.e21=Nn,si.e22=Wo,si.e23=kn,si.e30=Ye,si.e31=Ot,si.e32=Ro,si.e33=Ui,$t.sizeMat4==$t.stackMat4.length){for(var wn=$t.sizeMat4<<1,Gn=new Array(wn),fe=Gn,Is=0,Uo=$t.sizeMat4;Is<Uo;){var Vs=Is++;fe[Vs]=$t.stackMat4[Vs],$t.stackMat4[Vs]=null}$t.stackMat4=fe}$t.stackMat4[$t.sizeMat4++]=si}if(Go!=null){var w_=0,Gs=0,X_=0,Ge=1;if(Go.x=w_,Go.y=Gs,Go.z=X_,Go.w=Ge,$t.sizeQuat==$t.stackQuat.length){for(var F_=$t.sizeQuat<<1,N_=new Array(F_),Oi=N_,wo=0,Xo=$t.sizeQuat;wo<Xo;){var Jn=wo++;Oi[Jn]=$t.stackQuat[Jn],$t.stackQuat[Jn]=null}$t.stackQuat=Oi}$t.stackQuat[$t.sizeQuat++]=Go}var wr=this.p,Wn=null,Qo=null,to=null;if(Ct!=null){if(Ct.zero(),wr.sizeVec3==wr.stackVec3.length){for(var G_=wr.sizeVec3<<1,J_=new Array(G_),L_=J_,rs=0,__=wr.sizeVec3;rs<__;){var v_=rs++;L_[v_]=wr.stackVec3[v_],wr.stackVec3[v_]=null}wr.stackVec3=L_}wr.stackVec3[wr.sizeVec3++]=Ct}if(Wn!=null){var is=1,mr=0,Oo=0,ai=0,Ze=1,Js=0,hv=0,ue=0,Je=1;if(Wn.e00=is,Wn.e01=mr,Wn.e02=Oo,Wn.e10=ai,Wn.e11=Ze,Wn.e12=Js,Wn.e20=hv,Wn.e21=ue,Wn.e22=Je,wr.sizeMat3==wr.stackMat3.length){for(var $n=wr.sizeMat3<<1,Ws=new Array($n),Tr=Ws,Lo=0,Ti=wr.sizeMat3;Lo<Ti;){var sn=Lo++;Tr[sn]=wr.stackMat3[sn],wr.stackMat3[sn]=null}wr.stackMat3=Tr}wr.stackMat3[wr.sizeMat3++]=Wn}if(Qo!=null){var ks=1,Y_=0,We=0,Kn=0,Xn=0,os=1,de=0,ns=0,Us=0,l_=0,Be=1,Ae=0,qn=0,pr=0,xo=0,Zi=1;if(Qo.e00=ks,Qo.e01=Y_,Qo.e02=We,Qo.e03=Kn,Qo.e10=Xn,Qo.e11=os,Qo.e12=de,Qo.e13=ns,Qo.e20=Us,Qo.e21=l_,Qo.e22=Be,Qo.e23=Ae,Qo.e30=qn,Qo.e31=pr,Qo.e32=xo,Qo.e33=Zi,wr.sizeMat4==wr.stackMat4.length){for(var Ho=wr.sizeMat4<<1,Yo=new Array(Ho),Hi=Yo,Eo=0,ws=wr.sizeMat4;Eo<ws;){var ae=Eo++;Hi[ae]=wr.stackMat4[ae],wr.stackMat4[ae]=null}wr.stackMat4=Hi}wr.stackMat4[wr.sizeMat4++]=Qo}if(to!=null){var Os=0,W_=0,te=0,Nt=1;if(to.x=Os,to.y=W_,to.z=te,to.w=Nt,wr.sizeQuat==wr.stackQuat.length){for(var ji=wr.sizeQuat<<1,Do=new Array(ji),Xs=Do,kv=0,r0=wr.sizeQuat;kv<r0;){var U_=kv++;Xs[U_]=wr.stackQuat[U_],wr.stackQuat[U_]=null}wr.stackQuat=Xs}wr.stackQuat[wr.sizeQuat++]=to}var Ht=this.p,Ln=null,Ri=null,Yn=null;if(Mr!=null){if(Mr.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Z_=Ht.sizeVec3<<1,Hs=new Array(Z_),h_=Hs,bo=0,es=Ht.sizeVec3;bo<es;){var ss=bo++;h_[ss]=Ht.stackVec3[ss],Ht.stackVec3[ss]=null}Ht.stackVec3=h_}Ht.stackVec3[Ht.sizeVec3++]=Mr}if(Ln!=null){var xe=1,Zr=0,jo=0,ki=0,Zo=1,Ue=0,cv=0,Me=0,js=1;if(Ln.e00=xe,Ln.e01=Zr,Ln.e02=jo,Ln.e10=ki,Ln.e11=Zo,Ln.e12=Ue,Ln.e20=cv,Ln.e21=Me,Ln.e22=js,Ht.sizeMat3==Ht.stackMat3.length){for(var wv=Ht.sizeMat3<<1,Oe=new Array(wv),er=Oe,Zn=0,_n=Ht.sizeMat3;Zn<_n;){var vn=Zn++;er[vn]=Ht.stackMat3[vn],Ht.stackMat3[vn]=null}Ht.stackMat3=er}Ht.stackMat3[Ht.sizeMat3++]=Ln}if(Ri!=null){var d_=1,bv=0,re=0,Se=0,c_=0,O_=1,fv=0,uv=0,b_=0,He=0,Mo=1,_s=0,vs=0,Ur=0,zo=0,_o=1;if(Ri.e00=d_,Ri.e01=bv,Ri.e02=re,Ri.e03=Se,Ri.e10=c_,Ri.e11=O_,Ri.e12=fv,Ri.e13=uv,Ri.e20=b_,Ri.e21=He,Ri.e22=Mo,Ri.e23=_s,Ri.e30=vs,Ri.e31=Ur,Ri.e32=zo,Ri.e33=_o,Ht.sizeMat4==Ht.stackMat4.length){for(var ls=Ht.sizeMat4<<1,Ls=new Array(ls),Ys=Ls,Zs=0,B_=Ht.sizeMat4;Zs<B_;){var ze=Zs++;Ys[ze]=Ht.stackMat4[ze],Ht.stackMat4[ze]=null}Ht.stackMat4=Ys}Ht.stackMat4[Ht.sizeMat4++]=Ri}if(Yn!=null){var hs=0,H_=0,$s=0,Un=1;if(Yn.x=hs,Yn.y=H_,Yn.z=$s,Yn.w=Un,Ht.sizeQuat==Ht.stackQuat.length){for(var me=Ht.sizeQuat<<1,Xv=new Array(me),A_=Xv,$o=0,ln=Ht.sizeQuat;$o<ln;){var mo=$o++;A_[mo]=Ht.stackQuat[mo],Ht.stackQuat[mo]=null}Ht.stackQuat=A_}Ht.stackQuat[Ht.sizeQuat++]=Yn}var jt=this.p,$i=null,vo=null,Ks=null;if(Kt!=null){if(Kt.zero(),jt.sizeVec3==jt.stackVec3.length){for(var ds=jt.sizeVec3<<1,qs=new Array(ds),S_=qs,Ko=0,ie=jt.sizeVec3;Ko<ie;){var j_=Ko++;S_[j_]=jt.stackVec3[j_],jt.stackVec3[j_]=null}jt.stackVec3=S_}jt.stackVec3[jt.sizeVec3++]=Kt}if($i!=null){var xv=1,dr=0,po=0,Qi=0,ro=1,$_=0,K_=0,Lv=0,a_=1;if($i.e00=xv,$i.e01=dr,$i.e02=po,$i.e10=Qi,$i.e11=ro,$i.e12=$_,$i.e20=K_,$i.e21=Lv,$i.e22=a_,jt.sizeMat3==jt.stackMat3.length){for(var Yv=jt.sizeMat3<<1,q_=new Array(Yv),Br=q_,av=0,Bs=jt.sizeMat3;av<Bs;){var As=av++;Br[As]=jt.stackMat3[As],jt.stackMat3[As]=null}jt.stackMat3=Br}jt.stackMat3[jt.sizeMat3++]=$i}if(vo!=null){var cs=1,bs=0,Ss=0,Zv=0,pe=0,Ki=1,t_=0,yo=0,r_=0,Fo=0,Ps=1,qo=0,ye=0,sr=0,an=0,_i=1;if(vo.e00=cs,vo.e01=bs,vo.e02=Ss,vo.e03=Zv,vo.e10=pe,vo.e11=Ki,vo.e12=t_,vo.e13=yo,vo.e20=r_,vo.e21=Fo,vo.e22=Ps,vo.e23=qo,vo.e30=ye,vo.e31=sr,vo.e32=an,vo.e33=_i,jt.sizeMat4==jt.stackMat4.length){for(var oe=jt.sizeMat4<<1,ge=new Array(oe),Bo=ge,Ei=0,dn=jt.sizeMat4;Ei<dn;){var tv=Ei++;Bo[tv]=jt.stackMat4[tv],jt.stackMat4[tv]=null}jt.stackMat4=Bo}jt.stackMat4[jt.sizeMat4++]=vo}if(Ks!=null){var i_=0,P_=0,rv=0,ne=1;if(Ks.x=i_,Ks.y=P_,Ks.z=rv,Ks.w=ne,jt.sizeQuat==jt.stackQuat.length){for(var Bn=jt.sizeQuat<<1,Ie=new Array(Bn),E0=Ie,z0=0,hl=jt.sizeQuat;z0<hl;){var D0=z0++;E0[D0]=jt.stackQuat[D0],jt.stackQuat[D0]=null}jt.stackQuat=E0}jt.stackQuat[jt.sizeQuat++]=Ks}var hi=this.p,On=null,go=null,fs=null;if(Xi!=null){if(Xi.zero(),hi.sizeVec3==hi.stackVec3.length){for(var iv=hi.sizeVec3<<1,Mv=new Array(iv),o_=Mv,dv=0,Cs=hi.sizeVec3;dv<Cs;){var f_=dv++;o_[f_]=hi.stackVec3[f_],hi.stackVec3[f_]=null}hi.stackVec3=o_}hi.stackVec3[hi.sizeVec3++]=Xi}if(On!=null){var u_=1,Ar=0,Ts=0,lo=0,Pe=1,zv=0,Rs=0,x_=0,ov=1;if(On.e00=u_,On.e01=Ar,On.e02=Ts,On.e10=lo,On.e11=Pe,On.e12=zv,On.e20=Rs,On.e21=x_,On.e22=ov,hi.sizeMat3==hi.stackMat3.length){for(var i0=hi.sizeMat3<<1,o0=new Array(i0),nv=o0,ti=0,je=hi.sizeMat3;ti<je;){var An=ti++;nv[An]=hi.stackMat3[An],hi.stackMat3[An]=null}hi.stackMat3=nv}hi.stackMat3[hi.sizeMat3++]=On}if(go!=null){var us=1,F0=0,Dv=0,C_=0,m0=0,Bv=1,n0=0,p0=0,N0=0,e0=0,s0=1,y0=0,Fv=0,ci=0,mv=0,hn=1;if(go.e00=us,go.e01=F0,go.e02=Dv,go.e03=C_,go.e10=m0,go.e11=Bv,go.e12=n0,go.e13=p0,go.e20=N0,go.e21=e0,go.e22=s0,go.e23=y0,go.e30=Fv,go.e31=ci,go.e32=mv,go.e33=hn,hi.sizeMat4==hi.stackMat4.length){for(var Nv=hi.sizeMat4<<1,Hl=new Array(Nv),g0=Hl,I0=0,cl=hi.sizeMat4;I0<cl;){var dl=I0++;g0[dl]=hi.stackMat4[dl],hi.stackMat4[dl]=null}hi.stackMat4=g0}hi.stackMat4[hi.sizeMat4++]=go}if(fs!=null){var Gv=0,jl=0,$l=0,bl=1;if(fs.x=Gv,fs.y=jl,fs.z=$l,fs.w=bl,hi.sizeQuat==hi.stackQuat.length){for(var Bl=hi.sizeQuat<<1,Al=new Array(Bl),Kl=Al,fl=0,ql=hi.sizeQuat;fl<ql;){var ul=fl++;Kl[ul]=hi.stackQuat[ul],hi.stackQuat[ul]=null}hi.stackQuat=Kl}hi.stackQuat[hi.sizeQuat++]=fs}var ii=this.p,xs=null,tn=null,pv=null;if(no!=null){if(no.zero(),ii.sizeVec3==ii.stackVec3.length){for(var yh=ii.sizeVec3<<1,Jv=new Array(yh),G0=Jv,xl=0,V0=ii.sizeVec3;xl<V0;){var k0=xl++;G0[k0]=ii.stackVec3[k0],ii.stackVec3[k0]=null}ii.stackVec3=G0}ii.stackVec3[ii.sizeVec3++]=no}if(xs!=null){var J0=1,zi=0,Ms=0,ee=0,_0=1,Sl=0,lh=0,W0=0,hh=1;if(xs.e00=J0,xs.e01=zi,xs.e02=Ms,xs.e10=ee,xs.e11=_0,xs.e12=Sl,xs.e20=lh,xs.e21=W0,xs.e22=hh,ii.sizeMat3==ii.stackMat3.length){for(var U0=ii.sizeMat3<<1,Pl=new Array(U0),Ml=Pl,Ce=0,w0=ii.sizeMat3;Ce<w0;){var M_=Ce++;Ml[M_]=ii.stackMat3[M_],ii.stackMat3[M_]=null}ii.stackMat3=Ml}ii.stackMat3[ii.sizeMat3++]=xs}if(tn!=null){var Cl=1,O0=0,H0=0,Tl=0,zl=0,X0=1,v0=0,z_=0,Wv=0,Uv=0,ev=1,L0=0,Av=0,l0=0,se=0,h0=1;if(tn.e00=Cl,tn.e01=O0,tn.e02=H0,tn.e03=Tl,tn.e10=zl,tn.e11=X0,tn.e12=v0,tn.e13=z_,tn.e20=Wv,tn.e21=Uv,tn.e22=ev,tn.e23=L0,tn.e30=Av,tn.e31=l0,tn.e32=se,tn.e33=h0,ii.sizeMat4==ii.stackMat4.length){for(var Y0=ii.sizeMat4<<1,Qs=new Array(Y0),j0=Qs,yr=0,cn=ii.sizeMat4;yr<cn;){var wi=yr++;j0[wi]=ii.stackMat4[wi],ii.stackMat4[wi]=null}ii.stackMat4=j0}ii.stackMat4[ii.sizeMat4++]=tn}if(pv!=null){var Ov=0,c0=0,ch=0,ah=1;if(pv.x=Ov,pv.y=c0,pv.z=ch,pv.w=ah,ii.sizeQuat==ii.stackQuat.length){for(var m_=ii.sizeQuat<<1,$e=new Array(m_),Es=$e,th=0,bh=ii.sizeQuat;th<bh;){var Rl=th++;Es[Rl]=ii.stackQuat[Rl],ii.stackQuat[Rl]=null}ii.stackQuat=Es}ii.stackQuat[ii.sizeQuat++]=pv}var bi=this.p,n_=null,bn=null,yv=null;if(gi!=null){if(gi.zero(),bi.sizeVec3==bi.stackVec3.length){for(var $0=bi.sizeVec3<<1,gv=new Array($0),ml=gv,pl=0,yl=bi.sizeVec3;pl<yl;){var T_=pl++;ml[T_]=bi.stackVec3[T_],bi.stackVec3[T_]=null}bi.stackVec3=ml}bi.stackVec3[bi.sizeVec3++]=gi}if(n_!=null){var Sv=1,Sn=0,Iv=0,Pv=0,R_=1,_e=0,Q_=0,Cv=0,Hv=1;if(n_.e00=Sv,n_.e01=Sn,n_.e02=Iv,n_.e10=Pv,n_.e11=R_,n_.e12=_e,n_.e20=Q_,n_.e21=Cv,n_.e22=Hv,bi.sizeMat3==bi.stackMat3.length){for(var oi=bi.sizeMat3<<1,p_=new Array(oi),ve=p_,Jr=0,y_=bi.sizeMat3;Jr<y_;){var Pn=Jr++;ve[Pn]=bi.stackMat3[Pn],bi.stackMat3[Pn]=null}bi.stackMat3=ve}bi.stackMat3[bi.sizeMat3++]=n_}if(bn!=null){var K0=1,b0=0,fh=0,q0=0,al=0,gl=1,Z0=0,uh=0,Il=0,gh=0,rh=1,Vl=0,d0=0,B0=0,kl=0,ih=1;if(bn.e00=K0,bn.e01=b0,bn.e02=fh,bn.e03=q0,bn.e10=al,bn.e11=gl,bn.e12=Z0,bn.e13=uh,bn.e20=Il,bn.e21=gh,bn.e22=rh,bn.e23=Vl,bn.e30=d0,bn.e31=B0,bn.e32=kl,bn.e33=ih,bi.sizeMat4==bi.stackMat4.length){for(var jv=bi.sizeMat4<<1,Ql=new Array(jv),$v=Ql,ni=0,g_=bi.sizeMat4;ni<g_;){var rn=ni++;$v[rn]=bi.stackMat4[rn],bi.stackMat4[rn]=null}bi.stackMat4=$v}bi.stackMat4[bi.sizeMat4++]=bn}if(yv!=null){var wl=0,A0=0,oh=0,El=1;if(yv.x=wl,yv.y=A0,yv.z=oh,yv.w=El,bi.sizeQuat==bi.stackQuat.length){for(var tl=bi.sizeQuat<<1,Dl=new Array(tl),S0=Dl,nh=0,eh=bi.sizeQuat;nh<eh;){var Fl=nh++;S0[Fl]=bi.stackQuat[Fl],bi.stackQuat[Fl]=null}bi.stackQuat=S0}bi.stackQuat[bi.sizeQuat++]=yv}}else{for(var Nl=0;Nl<8;){var sv=Nl++,Tv=this.tmpCircleNorms[sv],Kv=this.circleCoords[sv];Tv.x=Kv.x,Tv.y=Kv.y,Tv.z=Kv.z;var Ds=Tv,xh=Ds.x*f.e00+Ds.y*f.e01+Ds.z*f.e02,f0=Ds.x*f.e10+Ds.y*f.e11+Ds.z*f.e12,Xl=Ds.x*f.e20+Ds.y*f.e21+Ds.z*f.e22;Ds.x=xh,Ds.y=f0,Ds.z=Xl;var Rv=this.tmpCircleVerts1[sv],qv=this.tmpCircleNorms[sv];Rv.x=qv.x,Rv.y=qv.y,Rv.z=qv.z;var Qv=Rv,u0=Qv.x*t,Zh=Qv.y*t,P0=Qv.z*t;Qv.x=u0,Qv.y=Zh,Qv.z=P0;var a0=Qv,Gl=a0.x+u.x,Jl=a0.y+u.y,Mh=a0.z+u.z;a0.x=Gl,a0.y=Jl,a0.z=Mh;var Ev=this.tmpCircleVerts2[sv],xi=this.tmpCircleVerts1[sv];Ev.x=xi.x,Ev.y=xi.y,Ev.z=xi.z;var Ve=this.tmpCircleVerts1[sv],le=Ve.x+h.x*r,C0=Ve.y+h.y*r,Wl=Ve.z+h.z*r;Ve.x=le,Ve.y=C0,Ve.z=Wl;var Fs=this.tmpCircleVerts2[sv],x0=-r,Ll=Fs.x+h.x*x0,Ul=Fs.y+h.y*x0,Ol=Fs.z+h.z*x0;Fs.x=Ll,Fs.y=Ul,Fs.z=Ol}for(var Ih=0;Ih<8;){var _v=Ih++,vv=this.tmpCircleVerts1[_v],T0=this.tmpCircleVerts2[_v],I_=this.tmpCircleVerts2[(_v+1)%8],Yl=this.tmpCircleVerts1[(_v+1)%8],Vh=this.tmpCircleNorms[_v],dh=this.tmpCircleNorms[(_v+1)%8];this.rect(vv,T0,I_,Yl,Vh,Vh,dh,dh,i)}}var t0=this.p;if(Wa!=null){if(Wa.zero(),t0.sizeVec3==t0.stackVec3.length){for(var lv=t0.sizeVec3<<1,kh=new Array(lv),Zl=kh,wh=0,jh=t0.sizeVec3;wh<jh;){var sh=wh++;Zl[sh]=t0.stackVec3[sh],t0.stackVec3[sh]=null}t0.stackVec3=Zl}t0.stackVec3[t0.sizeVec3++]=Wa}var Er=this.p;if(et!=null){if(et.zero(),Er.sizeVec3==Er.stackVec3.length){for(var e_=Er.sizeVec3<<1,V_=new Array(e_),_h=V_,Bh=0,Ah=Er.sizeVec3;Bh<Ah;){var zh=Bh++;_h[zh]=Er.stackVec3[zh],Er.stackVec3[zh]=null}Er.stackVec3=_h}Er.stackVec3[Er.sizeVec3++]=et}var Vv=this.p;if(u!=null){if(u.zero(),Vv.sizeVec3==Vv.stackVec3.length){for(var Rh=Vv.sizeVec3<<1,Qh=new Array(Rh),$h=Qh,Kh=0,mh=Vv.sizeVec3;Kh<mh;){var Sh=Kh++;$h[Sh]=Vv.stackVec3[Sh],Vv.stackVec3[Sh]=null}Vv.stackVec3=$h}Vv.stackVec3[Vv.sizeVec3++]=u}var rl=this.p;if(f!=null){var rc=1,Xh=0,E_=0,Eh=0,ph=1,qh=0,Lh=0,ac=0,Ph=1;if(f.e00=rc,f.e01=Xh,f.e02=E_,f.e10=Eh,f.e11=ph,f.e12=qh,f.e20=Lh,f.e21=ac,f.e22=Ph,rl.sizeMat3==rl.stackMat3.length){for(var R0=rl.sizeMat3<<1,ic=new Array(R0),vh=ic,Yh=0,Dh=rl.sizeMat3;Yh<Dh;){var Ch=Yh++;vh[Ch]=rl.stackMat3[Ch],rl.stackMat3[Ch]=null}rl.stackMat3=vh}rl.stackMat3[rl.sizeMat3++]=f}var Q0=this.p;if(_!=null){if(_.zero(),Q0.sizeVec3==Q0.stackVec3.length){for(var M0=Q0.sizeVec3<<1,nc=new Array(M0),ec=nc,Fh=0,oc=Q0.sizeVec3;Fh<oc;){var tc=Fh++;ec[tc]=Q0.stackVec3[tc],Q0.stackVec3[tc]=null}Q0.stackVec3=ec}Q0.stackVec3[Q0.sizeVec3++]=_}var il=this.p;if(h!=null){if(h.zero(),il.sizeVec3==il.stackVec3.length){for(var Xc=il.sizeVec3<<1,Lc=new Array(Xc),yc=Lc,gc=0,Yc=il.sizeVec3;gc<Yc;){var _c=gc++;yc[_c]=il.stackVec3[_c],il.stackVec3[_c]=null}il.stackVec3=yc}il.stackVec3[il.sizeVec3++]=h}var Th=this.p;if(e!=null){if(e.zero(),Th.sizeVec3==Th.stackVec3.length){for(var Zc=Th.sizeVec3<<1,Mc=new Array(Zc),Ic=Mc,Vc=0,dc=Th.sizeVec3;Vc<dc;){var zc=Vc++;Ic[zc]=Th.stackVec3[zc],Th.stackVec3[zc]=null}Th.stackVec3=Ic}Th.stackVec3[Th.sizeVec3++]=e}}sphere(a,t,r){var i=this.p,o=i.sizeVec3==0?new x.common.Vec3:i.stackVec3[--i.sizeVec3],_=this.p,s=_.sizeMat3==0?new x.common.Mat3:_.stackMat3[--_.sizeMat3],h=o;h.x=a._positionX,h.y=a._positionY,h.z=a._positionZ;var v=s;v.e00=a._rotation00,v.e01=a._rotation01,v.e02=a._rotation02,v.e10=a._rotation10,v.e11=a._rotation11,v.e12=a._rotation12,v.e20=a._rotation20,v.e21=a._rotation21,v.e22=a._rotation22;for(var e=4,l=8,u=this.tmpSphereVerts,b=this.tmpSphereNorms,f=0,n=e+1;f<n;)for(var c=f++,M=this.tmpSphereVerts[c].length,m=0,y=M;m<y;){var V=m++,z=b[c][V],I=this.sphereCoords[c][V];z.x=I.x,z.y=I.y,z.z=I.z;var k=z,X=k.x*s.e00+k.y*s.e01+k.z*s.e02,L=k.x*s.e10+k.y*s.e11+k.z*s.e12,p=k.x*s.e20+k.y*s.e21+k.z*s.e22;k.x=X,k.y=L,k.z=p;var g=u[c][V],N=b[c][V];g.x=N.x,g.y=N.y,g.z=N.z;var A=g,F=A.x*t,S=A.y*t,Y=A.z*t;A.x=F,A.y=S,A.z=Y;var R=A,C=R.x+o.x,d=R.y+o.y,Z=R.z+o.z;R.x=C,R.y=d,R.z=Z}for(var $=0,j=e;$<j;)for(var E=$++,G=0,B=l;G<B;){var Q=G++,U,J,D,H,K,ra,sa,W;E==0?this.wireframe?(U=u[0][0],J=u[1][Q],this.line(U,J,r)):(U=u[0][0],J=u[1][Q],D=u[1][(Q+1)%l],K=b[0][0],ra=b[1][Q],sa=b[1][(Q+1)%l],this.triangle(U,J,D,K,ra,sa,r)):E==e-1?this.wireframe?(U=u[e][0],J=u[E][(Q+1)%l],D=u[E][Q],this.line(U,J,r),this.line(J,D,r)):(U=u[e][0],J=u[E][(Q+1)%l],D=u[E][Q],K=b[e][0],ra=b[E][(Q+1)%l],sa=b[E][Q],this.triangle(U,J,D,K,ra,sa,r)):this.wireframe?(U=u[E][Q],J=u[E][(Q+1)%l],D=u[E+1][Q],this.line(U,J,r),this.line(U,D,r)):(U=u[E][Q],J=u[E][(Q+1)%l],D=u[E+1][Q],H=u[E+1][(Q+1)%l],K=b[E][Q],ra=b[E][(Q+1)%l],sa=b[E+1][Q],W=b[E+1][(Q+1)%l],this.rect(U,D,H,J,K,sa,W,ra,r))}var q=this.p;if(o!=null){if(o.zero(),q.sizeVec3==q.stackVec3.length){for(var na=q.sizeVec3<<1,oa=new Array(na),aa=oa,T=0,ca=q.sizeVec3;T<ca;){var _a=T++;aa[_a]=q.stackVec3[_a],q.stackVec3[_a]=null}q.stackVec3=aa}q.stackVec3[q.sizeVec3++]=o}var w=this.p;if(s!=null){var ta=1,ia=0,la=0,va=0,xa=1,Ma=0,za=0,Xa=0,Za=1;if(s.e00=ta,s.e01=ia,s.e02=la,s.e10=va,s.e11=xa,s.e12=Ma,s.e20=za,s.e21=Xa,s.e22=Za,w.sizeMat3==w.stackMat3.length){for(var fa=w.sizeMat3<<1,ba=new Array(fa),ea=ba,ha=0,pa=w.sizeMat3;ha<pa;){var ya=ha++;ea[ya]=w.stackMat3[ya],w.stackMat3[ya]=null}w.stackMat3=ea}w.stackMat3[w.sizeMat3++]=s}}box(a,t,r){var i=this.p,o=i.sizeVec3==0?new x.common.Vec3:i.stackVec3[--i.sizeVec3],_=this.p,s=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,v=h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3],e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3],u=this.p,b=u.sizeMat3==0?new x.common.Mat3:u.stackMat3[--u.sizeMat3],f=l;f.x=a._positionX,f.y=a._positionY,f.z=a._positionZ;var n=b;n.e00=a._rotation00,n.e01=a._rotation01,n.e02=a._rotation02,n.e10=a._rotation10,n.e11=a._rotation11,n.e12=a._rotation12,n.e20=a._rotation20,n.e21=a._rotation21,n.e22=a._rotation22,o.init(b.e00,b.e10,b.e20),s.init(b.e01,b.e11,b.e21),v.init(b.e02,b.e12,b.e22);var c=t.x,M=t.y,m=t.z,y=this.p,V=y.sizeVec3==0?new x.common.Vec3:y.stackVec3[--y.sizeVec3];V.x=l.x,V.y=l.y,V.z=l.z;var z=V,I=-c,k=z.x+o.x*I,X=z.y+o.y*I,L=z.z+o.z*I;z.x=k,z.y=X,z.z=L;var p=z,g=-M,N=p.x+s.x*g,A=p.y+s.y*g,F=p.z+s.z*g;p.x=N,p.y=A,p.z=F;var S=p,Y=-m,R=S.x+v.x*Y,C=S.y+v.y*Y,d=S.z+v.z*Y;S.x=R,S.y=C,S.z=d;var Z=S,$=this.p,j=$.sizeVec3==0?new x.common.Vec3:$.stackVec3[--$.sizeVec3];j.x=l.x,j.y=l.y,j.z=l.z;var E=j,G=-c,B=E.x+o.x*G,Q=E.y+o.y*G,U=E.z+o.z*G;E.x=B,E.y=Q,E.z=U;var J=E,D=-M,H=J.x+s.x*D,K=J.y+s.y*D,ra=J.z+s.z*D;J.x=H,J.y=K,J.z=ra;var sa=J,W=sa.x+v.x*m,q=sa.y+v.y*m,na=sa.z+v.z*m;sa.x=W,sa.y=q,sa.z=na;var oa=sa,aa=this.p,T=aa.sizeVec3==0?new x.common.Vec3:aa.stackVec3[--aa.sizeVec3];T.x=l.x,T.y=l.y,T.z=l.z;var ca=T,_a=-c,w=ca.x+o.x*_a,ta=ca.y+o.y*_a,ia=ca.z+o.z*_a;ca.x=w,ca.y=ta,ca.z=ia;var la=ca,va=la.x+s.x*M,xa=la.y+s.y*M,Ma=la.z+s.z*M;la.x=va,la.y=xa,la.z=Ma;var za=la,Xa=-m,Za=za.x+v.x*Xa,fa=za.y+v.y*Xa,ba=za.z+v.z*Xa;za.x=Za,za.y=fa,za.z=ba;var ea=za,ha=this.p,pa=ha.sizeVec3==0?new x.common.Vec3:ha.stackVec3[--ha.sizeVec3];pa.x=l.x,pa.y=l.y,pa.z=l.z;var ya=pa,da=-c,ma=ya.x+o.x*da,Ya=ya.y+o.y*da,Qa=ya.z+o.z*da;ya.x=ma,ya.y=Ya,ya.z=Qa;var ga=ya,ua=ga.x+s.x*M,wa=ga.y+s.y*M,ka=ga.z+s.z*M;ga.x=ua,ga.y=wa,ga.z=ka;var Pa=ga,Mt=Pa.x+v.x*m,Ha=Pa.y+v.y*m,Ba=Pa.z+v.z*m;Pa.x=Mt,Pa.y=Ha,Pa.z=Ba;var nt=Pa,Ea=this.p,Fa=Ea.sizeVec3==0?new x.common.Vec3:Ea.stackVec3[--Ea.sizeVec3];Fa.x=l.x,Fa.y=l.y,Fa.z=l.z;var Aa=Fa,ft=Aa.x+o.x*c,Ua=Aa.y+o.y*c,ja=Aa.z+o.z*c;Aa.x=ft,Aa.y=Ua,Aa.z=ja;var bt=Aa,rt=-M,$a=bt.x+s.x*rt,_t=bt.y+s.y*rt,gt=bt.z+s.z*rt;bt.x=$a,bt.y=_t,bt.z=gt;var mt=bt,Wa=-m,it=mt.x+v.x*Wa,ut=mt.y+v.y*Wa,Da=mt.z+v.z*Wa;mt.x=it,mt.y=ut,mt.z=Da;var Ta=mt,Na=this.p,Vt=Na.sizeVec3==0?new x.common.Vec3:Na.stackVec3[--Na.sizeVec3];Vt.x=l.x,Vt.y=l.y,Vt.z=l.z;var Pt=Vt,et=Pt.x+o.x*c,Xt=Pt.y+o.y*c,Yt=Pt.z+o.z*c;Pt.x=et,Pt.y=Xt,Pt.z=Yt;var zt=Pt,Ia=-M,O=zt.x+s.x*Ia,Va=zt.y+s.y*Ia,lt=zt.z+s.z*Ia;zt.x=O,zt.y=Va,zt.z=lt;var P=zt,wt=P.x+v.x*m,Bt=P.y+v.y*m,At=P.z+v.z*m;P.x=wt,P.y=Bt,P.z=At;var yt=P,kt=this.p,pt=kt.sizeVec3==0?new x.common.Vec3:kt.stackVec3[--kt.sizeVec3];pt.x=l.x,pt.y=l.y,pt.z=l.z;var ht=pt,xt=ht.x+o.x*c,Ra=ht.y+o.y*c,st=ht.z+o.z*c;ht.x=xt,ht.y=Ra,ht.z=st;var Ca=ht,vt=Ca.x+s.x*M,qa=Ca.y+s.y*M,at=Ca.z+s.z*M;Ca.x=vt,Ca.y=qa,Ca.z=at;var Oa=Ca,tt=-m,ct=Oa.x+v.x*tt,Sa=Oa.y+v.y*tt,Ga=Oa.z+v.z*tt;Oa.x=ct,Oa.y=Sa,Oa.z=Ga;var Ka=Oa,La=this.p,ot=La.sizeVec3==0?new x.common.Vec3:La.stackVec3[--La.sizeVec3];ot.x=l.x,ot.y=l.y,ot.z=l.z;var It=ot,or=It.x+o.x*c,gr=It.y+o.y*c,ar=It.z+o.z*c;It.x=or,It.y=gr,It.z=ar;var Ct=It,_r=Ct.x+s.x*M,Et=Ct.y+s.y*M,St=Ct.z+s.z*M;Ct.x=_r,Ct.y=Et,Ct.z=St;var Gt=Ct,jr=Gt.x+v.x*m,vr=Gt.y+v.y*m,lr=Gt.z+v.z*m;Gt.x=jr,Gt.y=vr,Gt.z=lr;var tr=Gt;if(this.wireframe)this.line(Z,oa,r),this.line(ea,nt,r),this.line(Ta,yt,r),this.line(Ka,tr,r),this.line(Z,ea,r),this.line(oa,nt,r),this.line(Ta,Ka,r),this.line(yt,tr,r),this.line(Z,Ta,r),this.line(oa,yt,r),this.line(ea,Ka,r),this.line(nt,tr,r);else{var Or=this.p,Xr=Or.sizeVec3==0?new x.common.Vec3:Or.stackVec3[--Or.sizeVec3];Xr.x=o.x,Xr.y=o.y,Xr.z=o.z;var Mr=Xr,Zt=-Mr.x,ir=-Mr.y,Wt=-Mr.z;Mr.x=Zt,Mr.y=ir,Mr.z=Wt;var nr=Mr,$r=this.p,Ut=$r.sizeVec3==0?new x.common.Vec3:$r.stackVec3[--$r.sizeVec3];Ut.x=s.x,Ut.y=s.y,Ut.z=s.z;var Kr=Ut,Ir=-Kr.x,mi=-Kr.y,Wr=-Kr.z;Kr.x=Ir,Kr.y=mi,Kr.z=Wr;var Lt=Kr,Kt=this.p,Tt=Kt.sizeVec3==0?new x.common.Vec3:Kt.stackVec3[--Kt.sizeVec3];Tt.x=v.x,Tt.y=v.y,Tt.z=v.z;var br=Tt,zr=-br.x,vi=-br.y,qt=-br.z;br.x=zr,br.y=vi,br.z=qt;var fr=br;this.rect(Z,oa,nt,ea,nr,nr,nr,nr,r),this.rect(Ta,Ka,tr,yt,o,o,o,o,r),this.rect(Z,Ta,yt,oa,Lt,Lt,Lt,Lt,r),this.rect(ea,nt,tr,Ka,s,s,s,s,r),this.rect(Z,ea,Ka,Ta,fr,fr,fr,fr,r),this.rect(oa,yt,tr,nt,v,v,v,v,r);var dt=this.p,ur=null,hr=null,ei=null;if(nr!=null){if(nr.zero(),dt.sizeVec3==dt.stackVec3.length){for(var Xi=dt.sizeVec3<<1,io=new Array(Xi),Jt=io,fi=0,pi=dt.sizeVec3;fi<pi;){var Dt=fi++;Jt[Dt]=dt.stackVec3[Dt],dt.stackVec3[Dt]=null}dt.stackVec3=Jt}dt.stackVec3[dt.sizeVec3++]=nr}if(ur!=null){var di=1,Sr=0,Di=0,Hn=0,oo=1,Bi=0,no=0,yn=0,Ao=1;if(ur.e00=di,ur.e01=Sr,ur.e02=Di,ur.e10=Hn,ur.e11=oo,ur.e12=Bi,ur.e20=no,ur.e21=yn,ur.e22=Ao,dt.sizeMat3==dt.stackMat3.length){for(var Io=dt.sizeMat3<<1,xr=new Array(Io),qi=xr,Ai=0,yi=dt.sizeMat3;Ai<yi;){var So=Ai++;qi[So]=dt.stackMat3[So],dt.stackMat3[So]=null}dt.stackMat3=qi}dt.stackMat3[dt.sizeMat3++]=ur}if(hr!=null){var Dr=1,Si=0,gi=0,Rt=0,Hr=0,Lr=1,Cn=0,zs=0,Ke=0,ms=0,Te=1,qe=0,D_=0,gn=0,Pr=0,No=1;if(hr.e00=Dr,hr.e01=Si,hr.e02=gi,hr.e03=Rt,hr.e10=Hr,hr.e11=Lr,hr.e12=Cn,hr.e13=zs,hr.e20=Ke,hr.e21=ms,hr.e22=Te,hr.e23=qe,hr.e30=D_,hr.e31=gn,hr.e32=Pr,hr.e33=No,dt.sizeMat4==dt.stackMat4.length){for(var Wi=dt.sizeMat4<<1,ke=new Array(Wi),on=ke,Tn=0,jn=dt.sizeMat4;Tn<jn;){var we=Tn++;on[we]=dt.stackMat4[we],dt.stackMat4[we]=null}dt.stackMat4=on}dt.stackMat4[dt.sizeMat4++]=hr}if(ei!=null){var k_=0,Re=0,Vr=0,Ii=1;if(ei.x=k_,ei.y=Re,ei.z=Vr,ei.w=Ii,dt.sizeQuat==dt.stackQuat.length){for(var ui=dt.sizeQuat<<1,eo=new Array(ui),Rn=eo,ps=0,nn=dt.sizeQuat;ps<nn;){var Qn=ps++;Rn[Qn]=dt.stackQuat[Qn],dt.stackQuat[Qn]=null}dt.stackQuat=Rn}dt.stackQuat[dt.sizeQuat++]=ei}var cr=this.p,ho=null,Fi=null,En=null;if(Lt!=null){if(Lt.zero(),cr.sizeVec3==cr.stackVec3.length){for(var as=cr.sizeVec3<<1,Qe=new Array(as),Ee=Qe,De=0,he=cr.sizeVec3;De<he;){var rr=De++;Ee[rr]=cr.stackVec3[rr],cr.stackVec3[rr]=null}cr.stackVec3=Ee}cr.stackVec3[cr.sizeVec3++]=Lt}if(ho!=null){var ri=1,Qr=0,Fr=0,fo=0,Po=1,s_=0,Fe=0,ts=0,Dn=1;if(ho.e00=ri,ho.e01=Qr,ho.e02=Fr,ho.e10=fo,ho.e11=Po,ho.e12=s_,ho.e20=Fe,ho.e21=ts,ho.e22=Dn,cr.sizeMat3==cr.stackMat3.length){for(var co=cr.sizeMat3<<1,Ft=new Array(co),Nr=Ft,li=0,Vo=cr.sizeMat3;li<Vo;){var ce=li++;Nr[ce]=cr.stackMat3[ce],cr.stackMat3[ce]=null}cr.stackMat3=Nr}cr.stackMat3[cr.sizeMat3++]=ho}if(Fi!=null){var Xe=1,Le=0,uo=0,$t=0,Vi=0,si=1,Go=0,Ns=0,Co=0,ko=0,Ni=1,Pi=0,Ci=0,Li=0,Qt=0,Gr=1;if(Fi.e00=Xe,Fi.e01=Le,Fi.e02=uo,Fi.e03=$t,Fi.e10=Vi,Fi.e11=si,Fi.e12=Go,Fi.e13=Ns,Fi.e20=Co,Fi.e21=ko,Fi.e22=Ni,Fi.e23=Pi,Fi.e30=Ci,Fi.e31=Li,Fi.e32=Qt,Fi.e33=Gr,cr.sizeMat4==cr.stackMat4.length){for(var Yr=cr.sizeMat4<<1,Rr=new Array(Yr),Mi=Rr,qr=0,Gi=cr.sizeMat4;qr<Gi;){var Ji=qr++;Mi[Ji]=cr.stackMat4[Ji],cr.stackMat4[Ji]=null}cr.stackMat4=Mi}cr.stackMat4[cr.sizeMat4++]=Fi}if(En!=null){var ao=0,be=0,kr=0,en=1;if(En.x=ao,En.y=be,En.z=kr,En.w=en,cr.sizeQuat==cr.stackQuat.length){for(var Yi=cr.sizeQuat<<1,Jo=new Array(Yi),ys=Jo,In=0,gs=cr.sizeQuat;In<gs;){var Vn=In++;ys[Vn]=cr.stackQuat[Vn],cr.stackQuat[Vn]=null}cr.stackQuat=ys}cr.stackQuat[cr.sizeQuat++]=En}var Cr=this.p,To=null,so=null,Fn=null;if(fr!=null){if(fr.zero(),Cr.sizeVec3==Cr.stackVec3.length){for(var Ne=Cr.sizeVec3<<1,Nn=new Array(Ne),Wo=Nn,kn=0,Ye=Cr.sizeVec3;kn<Ye;){var Ot=kn++;Wo[Ot]=Cr.stackVec3[Ot],Cr.stackVec3[Ot]=null}Cr.stackVec3=Wo}Cr.stackVec3[Cr.sizeVec3++]=fr}if(To!=null){var Ro=1,Ui=0,wn=0,Gn=0,fe=1,Is=0,Uo=0,Vs=0,w_=1;if(To.e00=Ro,To.e01=Ui,To.e02=wn,To.e10=Gn,To.e11=fe,To.e12=Is,To.e20=Uo,To.e21=Vs,To.e22=w_,Cr.sizeMat3==Cr.stackMat3.length){for(var Gs=Cr.sizeMat3<<1,X_=new Array(Gs),Ge=X_,F_=0,N_=Cr.sizeMat3;F_<N_;){var Oi=F_++;Ge[Oi]=Cr.stackMat3[Oi],Cr.stackMat3[Oi]=null}Cr.stackMat3=Ge}Cr.stackMat3[Cr.sizeMat3++]=To}if(so!=null){var wo=1,Xo=0,Jn=0,wr=0,Wn=0,Qo=1,to=0,G_=0,J_=0,L_=0,rs=1,__=0,v_=0,is=0,mr=0,Oo=1;if(so.e00=wo,so.e01=Xo,so.e02=Jn,so.e03=wr,so.e10=Wn,so.e11=Qo,so.e12=to,so.e13=G_,so.e20=J_,so.e21=L_,so.e22=rs,so.e23=__,so.e30=v_,so.e31=is,so.e32=mr,so.e33=Oo,Cr.sizeMat4==Cr.stackMat4.length){for(var ai=Cr.sizeMat4<<1,Ze=new Array(ai),Js=Ze,hv=0,ue=Cr.sizeMat4;hv<ue;){var Je=hv++;Js[Je]=Cr.stackMat4[Je],Cr.stackMat4[Je]=null}Cr.stackMat4=Js}Cr.stackMat4[Cr.sizeMat4++]=so}if(Fn!=null){var $n=0,Ws=0,Tr=0,Lo=1;if(Fn.x=$n,Fn.y=Ws,Fn.z=Tr,Fn.w=Lo,Cr.sizeQuat==Cr.stackQuat.length){for(var Ti=Cr.sizeQuat<<1,sn=new Array(Ti),ks=sn,Y_=0,We=Cr.sizeQuat;Y_<We;){var Kn=Y_++;ks[Kn]=Cr.stackQuat[Kn],Cr.stackQuat[Kn]=null}Cr.stackQuat=ks}Cr.stackQuat[Cr.sizeQuat++]=Fn}}var Xn=this.p;if(Z!=null){if(Z.zero(),Xn.sizeVec3==Xn.stackVec3.length){for(var os=Xn.sizeVec3<<1,de=new Array(os),ns=de,Us=0,l_=Xn.sizeVec3;Us<l_;){var Be=Us++;ns[Be]=Xn.stackVec3[Be],Xn.stackVec3[Be]=null}Xn.stackVec3=ns}Xn.stackVec3[Xn.sizeVec3++]=Z}var Ae=this.p;if(oa!=null){if(oa.zero(),Ae.sizeVec3==Ae.stackVec3.length){for(var qn=Ae.sizeVec3<<1,pr=new Array(qn),xo=pr,Zi=0,Ho=Ae.sizeVec3;Zi<Ho;){var Yo=Zi++;xo[Yo]=Ae.stackVec3[Yo],Ae.stackVec3[Yo]=null}Ae.stackVec3=xo}Ae.stackVec3[Ae.sizeVec3++]=oa}var Hi=this.p;if(ea!=null){if(ea.zero(),Hi.sizeVec3==Hi.stackVec3.length){for(var Eo=Hi.sizeVec3<<1,ws=new Array(Eo),ae=ws,Os=0,W_=Hi.sizeVec3;Os<W_;){var te=Os++;ae[te]=Hi.stackVec3[te],Hi.stackVec3[te]=null}Hi.stackVec3=ae}Hi.stackVec3[Hi.sizeVec3++]=ea}var Nt=this.p;if(nt!=null){if(nt.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var ji=Nt.sizeVec3<<1,Do=new Array(ji),Xs=Do,kv=0,r0=Nt.sizeVec3;kv<r0;){var U_=kv++;Xs[U_]=Nt.stackVec3[U_],Nt.stackVec3[U_]=null}Nt.stackVec3=Xs}Nt.stackVec3[Nt.sizeVec3++]=nt}var Ht=this.p;if(Ta!=null){if(Ta.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Ln=Ht.sizeVec3<<1,Ri=new Array(Ln),Yn=Ri,Z_=0,Hs=Ht.sizeVec3;Z_<Hs;){var h_=Z_++;Yn[h_]=Ht.stackVec3[h_],Ht.stackVec3[h_]=null}Ht.stackVec3=Yn}Ht.stackVec3[Ht.sizeVec3++]=Ta}var bo=this.p;if(yt!=null){if(yt.zero(),bo.sizeVec3==bo.stackVec3.length){for(var es=bo.sizeVec3<<1,ss=new Array(es),xe=ss,Zr=0,jo=bo.sizeVec3;Zr<jo;){var ki=Zr++;xe[ki]=bo.stackVec3[ki],bo.stackVec3[ki]=null}bo.stackVec3=xe}bo.stackVec3[bo.sizeVec3++]=yt}var Zo=this.p;if(Ka!=null){if(Ka.zero(),Zo.sizeVec3==Zo.stackVec3.length){for(var Ue=Zo.sizeVec3<<1,cv=new Array(Ue),Me=cv,js=0,wv=Zo.sizeVec3;js<wv;){var Oe=js++;Me[Oe]=Zo.stackVec3[Oe],Zo.stackVec3[Oe]=null}Zo.stackVec3=Me}Zo.stackVec3[Zo.sizeVec3++]=Ka}var er=this.p;if(tr!=null){if(tr.zero(),er.sizeVec3==er.stackVec3.length){for(var Zn=er.sizeVec3<<1,_n=new Array(Zn),vn=_n,d_=0,bv=er.sizeVec3;d_<bv;){var re=d_++;vn[re]=er.stackVec3[re],er.stackVec3[re]=null}er.stackVec3=vn}er.stackVec3[er.sizeVec3++]=tr}var Se=this.p;if(l!=null){if(l.zero(),Se.sizeVec3==Se.stackVec3.length){for(var c_=Se.sizeVec3<<1,O_=new Array(c_),fv=O_,uv=0,b_=Se.sizeVec3;uv<b_;){var He=uv++;fv[He]=Se.stackVec3[He],Se.stackVec3[He]=null}Se.stackVec3=fv}Se.stackVec3[Se.sizeVec3++]=l}var Mo=this.p;if(b!=null){var _s=1,vs=0,Ur=0,zo=0,_o=1,ls=0,Ls=0,Ys=0,Zs=1;if(b.e00=_s,b.e01=vs,b.e02=Ur,b.e10=zo,b.e11=_o,b.e12=ls,b.e20=Ls,b.e21=Ys,b.e22=Zs,Mo.sizeMat3==Mo.stackMat3.length){for(var B_=Mo.sizeMat3<<1,ze=new Array(B_),hs=ze,H_=0,$s=Mo.sizeMat3;H_<$s;){var Un=H_++;hs[Un]=Mo.stackMat3[Un],Mo.stackMat3[Un]=null}Mo.stackMat3=hs}Mo.stackMat3[Mo.sizeMat3++]=b}var me=this.p;if(o!=null){if(o.zero(),me.sizeVec3==me.stackVec3.length){for(var Xv=me.sizeVec3<<1,A_=new Array(Xv),$o=A_,ln=0,mo=me.sizeVec3;ln<mo;){var jt=ln++;$o[jt]=me.stackVec3[jt],me.stackVec3[jt]=null}me.stackVec3=$o}me.stackVec3[me.sizeVec3++]=o}var $i=this.p;if(s!=null){if(s.zero(),$i.sizeVec3==$i.stackVec3.length){for(var vo=$i.sizeVec3<<1,Ks=new Array(vo),ds=Ks,qs=0,S_=$i.sizeVec3;qs<S_;){var Ko=qs++;ds[Ko]=$i.stackVec3[Ko],$i.stackVec3[Ko]=null}$i.stackVec3=ds}$i.stackVec3[$i.sizeVec3++]=s}var ie=this.p;if(v!=null){if(v.zero(),ie.sizeVec3==ie.stackVec3.length){for(var j_=ie.sizeVec3<<1,xv=new Array(j_),dr=xv,po=0,Qi=ie.sizeVec3;po<Qi;){var ro=po++;dr[ro]=ie.stackVec3[ro],ie.stackVec3[ro]=null}ie.stackVec3=dr}ie.stackVec3[ie.sizeVec3++]=v}}rect(a,t,r,i,o,_,s,h,v){this.triangle(a,t,r,o,_,s,v),this.triangle(a,r,i,o,s,h,v)}point(a,t){}triangle(a,t,r,i,o,_,s){}line(a,t,r){}};x.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new x.common.Vec3(0,0,1),this.basisColorY=new x.common.Vec3(0,1,0),this.basisColorX=new x.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new x.common.Vec3(1,.1,.1),this.jointLineColor=new x.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new x.common.Vec3(.2,.2,1),this.contactTangentColor=new x.common.Vec3(.1,.8,.1),this.contactNormalColor=new x.common.Vec3(1,.1,.1),this.disabledContactColor=new x.common.Vec3(.5,.1,.1),this.newContactColor=new x.common.Vec3(1,1,.1),this.contactColor4=new x.common.Vec3(.8,.1,1),this.contactColor3=new x.common.Vec3(.1,.8,.6),this.contactColor2=new x.common.Vec3(1,.6,.1),this.contactColor=new x.common.Vec3(1,.1,.1),this.pairColor=new x.common.Vec3(1,1,.1),this.bvhNodeColor=new x.common.Vec3(.4,.4,.4),this.aabbColor=new x.common.Vec3(1,.1,.1),this.kinematicShapeColor=new x.common.Vec3(1,.5,.1),this.staticShapeColor=new x.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new x.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new x.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new x.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new x.common.Vec3(.5,.25,.6),this.shapeColor2=new x.common.Vec3(1,.8,.1),this.shapeColor1=new x.common.Vec3(.7,.2,.4)}};x.dynamics.common.Performance=class{};x.dynamics.constraint||(x.dynamics.constraint={});x.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(a){}warmStart(a){}solveVelocity(){}postSolveVelocity(a){}preSolvePosition(a){}solvePositionSplitImpulse(){}solvePositionNgs(a){}postSolve(){}};x.dynamics.constraint.PositionCorrectionAlgorithm=class{};x.dynamics.constraint.contact||(x.dynamics.constraint.contact={});x.dynamics.constraint.contact.ContactConstraint=class{constructor(a){this._solver=new x.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=a}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2;var r,i,o,_,s,h,v,e,l;r=this._manifold._normalX,i=this._manifold._normalY,o=this._manifold._normalZ,_=this._manifold._tangentX,s=this._manifold._tangentY,h=this._manifold._tangentZ,v=this._manifold._binormalX,e=this._manifold._binormalY,l=this._manifold._binormalZ;var u=Math.sqrt(this._s1._friction*this._s2._friction),b=Math.sqrt(this._s1._restitution*this._s2._restitution),f=this._manifold._numPoints;t.numRows=0,this._tf1._positionX-this._tf2._positionX,this._tf1._positionY-this._tf2._positionY,this._tf1._positionZ-this._tf2._positionZ;for(var n=0,c=f;n<c;){var M=n++,m=this._manifold._points[M];if(m._depth<0){m._disabled=!0;var y=m._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0;continue}else m._disabled=!1;var V=t.rows[t.numRows++];V.friction=u,V.cfm=0;var z=V.jacobianN;z.lin1X=r,z.lin1Y=i,z.lin1Z=o,z.lin2X=r,z.lin2Y=i,z.lin2Z=o,z.ang1X=m._relPos1Y*o-m._relPos1Z*i,z.ang1Y=m._relPos1Z*r-m._relPos1X*o,z.ang1Z=m._relPos1X*i-m._relPos1Y*r,z.ang2X=m._relPos2Y*o-m._relPos2Z*i,z.ang2Y=m._relPos2Z*r-m._relPos2X*o,z.ang2Z=m._relPos2X*i-m._relPos2Y*r,z=V.jacobianT,z.lin1X=_,z.lin1Y=s,z.lin1Z=h,z.lin2X=_,z.lin2Y=s,z.lin2Z=h,z.ang1X=m._relPos1Y*h-m._relPos1Z*s,z.ang1Y=m._relPos1Z*_-m._relPos1X*h,z.ang1Z=m._relPos1X*s-m._relPos1Y*_,z.ang2X=m._relPos2Y*h-m._relPos2Z*s,z.ang2Y=m._relPos2Z*_-m._relPos2X*h,z.ang2Z=m._relPos2X*s-m._relPos2Y*_,z=V.jacobianB,z.lin1X=v,z.lin1Y=e,z.lin1Z=l,z.lin2X=v,z.lin2Y=e,z.lin2Z=l,z.ang1X=m._relPos1Y*l-m._relPos1Z*e,z.ang1Y=m._relPos1Z*v-m._relPos1X*l,z.ang1Z=m._relPos1X*e-m._relPos1Y*v,z.ang2X=m._relPos2Y*l-m._relPos2Z*e,z.ang2Y=m._relPos2Z*v-m._relPos2X*l,z.ang2Z=m._relPos2X*e-m._relPos2Y*v,z=V.jacobianN;var I=z.lin1X*this._b1._velX+z.lin1Y*this._b1._velY+z.lin1Z*this._b1._velZ+(z.ang1X*this._b1._angVelX+z.ang1Y*this._b1._angVelY+z.ang1Z*this._b1._angVelZ)-(z.lin2X*this._b2._velX+z.lin2Y*this._b2._velY+z.lin2Z*this._b2._velZ+(z.ang2X*this._b2._angVelX+z.ang2Y*this._b2._angVelY+z.ang2Z*this._b2._angVelZ));if(I<-x.common.Setting.contactEnableBounceThreshold&&!m._warmStarted?V.rhs=-I*b:V.rhs=0,this._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&m._depth>x.common.Setting.linearSlop){var k=(m._depth-x.common.Setting.linearSlop)*x.common.Setting.velocityBaumgarte*a.invDt;V.rhs<k&&(V.rhs=k)}if(!m._warmStarted){var X=m._impulse;X.impulseN=0,X.impulseT=0,X.impulseB=0,X.impulseP=0,X.impulseLX=0,X.impulseLY=0,X.impulseLZ=0}V.impulse=m._impulse}}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2;var t,r,i;t=this._manifold._normalX,r=this._manifold._normalY,i=this._manifold._normalZ;var o=this._manifold._numPoints;a.numRows=0;for(var _=0,s=o;_<s;){var h=_++,v=this._manifold._points[h];if(!v._disabled){var e=a.rows[a.numRows++],l=e.jacobianN;l.lin1X=t,l.lin1Y=r,l.lin1Z=i,l.lin2X=t,l.lin2Y=r,l.lin2Z=i,l.ang1X=v._relPos1Y*i-v._relPos1Z*r,l.ang1Y=v._relPos1Z*t-v._relPos1X*i,l.ang1Z=v._relPos1X*r-v._relPos1Y*t,l.ang2X=v._relPos2Y*i-v._relPos2Z*r,l.ang2Y=v._relPos2Z*t-v._relPos2X*i,l.ang2Z=v._relPos2X*r-v._relPos2Y*t,e.rhs=v._depth-x.common.Setting.linearSlop,e.rhs<0&&(e.rhs=0),e.impulse=v._impulse}}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){for(var a=0,t=this._manifold._numPoints;a<t;){var r=a++;if(this._manifold._points[r]._depth>=0)return!0}return!1}};x.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(a){this.impulseN=a.impulseN,this.impulseT=a.impulseT,this.impulseB=a.impulseB,this.impulseLX=a.impulseLX,this.impulseLY=a.impulseLY,this.impulseLZ=a.impulseLZ}};x.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var a=new Array(x.common.Setting.maxManifoldPoints);this._points=a;for(var t=0,r=x.common.Setting.maxManifoldPoints;t<r;){var i=t++;this._points[i]=new x.dynamics.constraint.contact.ManifoldPoint}}_clear(){for(var a=0,t=this._numPoints;a<t;){var r=a++,i=this._points[r];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;var o=i._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(a){var t=a;this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;var r=a.x,i=a.y,o=a.z,_=r*r,s=i*i,h=o*o,v,e,l,u,b,f;if(_<s)if(_<h){var n=1/Math.sqrt(s+h);v=0,e=-o*n,l=i*n,u=i*l-o*e,b=-r*l,f=r*e}else{var c=1/Math.sqrt(_+s);v=-i*c,e=r*c,l=0,u=-o*e,b=o*v,f=r*e-i*v}else if(s<h){var M=1/Math.sqrt(_+h);v=o*M,e=0,l=-r*M,u=i*l,b=o*v-r*l,f=-i*v}else{var m=1/Math.sqrt(_+s);v=-i*m,e=r*m,l=0,u=-o*e,b=o*v,f=r*e-i*v}this._tangentX=v,this._tangentY=e,this._tangentZ=l,this._binormalX=u,this._binormalY=b,this._binormalZ=f}_updateDepthsAndPositions(a,t){for(var r=0,i=this._numPoints;r<i;){var o=r++,_=this._points[o],s,h,v;s=a._rotation00*_._localPos1X+a._rotation01*_._localPos1Y+a._rotation02*_._localPos1Z,h=a._rotation10*_._localPos1X+a._rotation11*_._localPos1Y+a._rotation12*_._localPos1Z,v=a._rotation20*_._localPos1X+a._rotation21*_._localPos1Y+a._rotation22*_._localPos1Z,_._relPos1X=s,_._relPos1Y=h,_._relPos1Z=v;var e,l,u;e=t._rotation00*_._localPos2X+t._rotation01*_._localPos2Y+t._rotation02*_._localPos2Z,l=t._rotation10*_._localPos2X+t._rotation11*_._localPos2Y+t._rotation12*_._localPos2Z,u=t._rotation20*_._localPos2X+t._rotation21*_._localPos2Y+t._rotation22*_._localPos2Z,_._relPos2X=e,_._relPos2Y=l,_._relPos2Z=u,_._pos1X=_._relPos1X+a._positionX,_._pos1Y=_._relPos1Y+a._positionY,_._pos1Z=_._relPos1Z+a._positionZ,_._pos2X=_._relPos2X+t._positionX,_._pos2Y=_._relPos2Y+t._positionY,_._pos2Z=_._relPos2Z+t._positionZ;var b,f,n;b=_._pos1X-_._pos2X,f=_._pos1Y-_._pos2Y,n=_._pos1Z-_._pos2Z;var c=b*this._normalX+f*this._normalY+n*this._normalZ;_._depth=-c}}getNormal(){var a=new x.common.Vec3,t=a;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,a}getNormalTo(a){var t=a;t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){var a=new x.common.Vec3,t=a;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,a}getTangentTo(a){var t=a;t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){var a=new x.common.Vec3,t=a;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,a}getBinormalTo(a){var t=a;t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};x.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new x.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){var a=new x.common.Vec3,t=a;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,a}getPosition1To(a){var t=a;t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){var a=new x.common.Vec3,t=a;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,a}getPosition2To(a){var t=a;t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};x.dynamics.constraint.contact.ManifoldUpdater=class{constructor(a){this._manifold=a,this.numOldPoints=0;var t=new Array(x.common.Setting.maxManifoldPoints);this.oldPoints=t;for(var r=0,i=x.common.Setting.maxManifoldPoints;r<i;){var o=r++;this.oldPoints[o]=new x.dynamics.constraint.contact.ManifoldPoint}}removeOutdatedPoints(){for(var a=this._manifold._numPoints,t=a;--t>=0;){var r=this._manifold._points[t],i,o,_;i=r._pos1X-r._pos2X,o=r._pos1Y-r._pos2Y,_=r._pos1Z-r._pos2Z;var s=this._manifold._normalX*i+this._manifold._normalY*o+this._manifold._normalZ*_;if(s>x.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(i+=this._manifold._normalX*-s,o+=this._manifold._normalY*-s,_+=this._manifold._normalZ*-s,i*i+o*o+_*_>x.common.Setting.contactPersistenceThreshold*x.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(a){var t=--this._manifold._numPoints;if(a!=t){var r=this._manifold._points[a];this._manifold._points[a]=this._manifold._points[t],this._manifold._points[t]=r}var i=this._manifold._points[t];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;var o=i._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}addManifoldPoint(a,t,r){var i=this._manifold._numPoints;if(i==x.common.Setting.maxManifoldPoints){var o=this.computeTargetIndex(a,t,r),_=this._manifold._points[o],s=a.position1;_._pos1X=s.x,_._pos1Y=s.y,_._pos1Z=s.z;var h=a.position2;_._pos2X=h.x,_._pos2Y=h.y,_._pos2Z=h.z,_._relPos1X=_._pos1X-t._positionX,_._relPos1Y=_._pos1Y-t._positionY,_._relPos1Z=_._pos1Z-t._positionZ,_._relPos2X=_._pos2X-r._positionX,_._relPos2Y=_._pos2Y-r._positionY,_._relPos2Z=_._pos2Z-r._positionZ;var v,e,l;v=t._rotation00*_._relPos1X+t._rotation10*_._relPos1Y+t._rotation20*_._relPos1Z,e=t._rotation01*_._relPos1X+t._rotation11*_._relPos1Y+t._rotation21*_._relPos1Z,l=t._rotation02*_._relPos1X+t._rotation12*_._relPos1Y+t._rotation22*_._relPos1Z,_._localPos1X=v,_._localPos1Y=e,_._localPos1Z=l;var u,b,f;u=r._rotation00*_._relPos2X+r._rotation10*_._relPos2Y+r._rotation20*_._relPos2Z,b=r._rotation01*_._relPos2X+r._rotation11*_._relPos2Y+r._rotation21*_._relPos2Z,f=r._rotation02*_._relPos2X+r._rotation12*_._relPos2Y+r._rotation22*_._relPos2Z,_._localPos2X=u,_._localPos2Y=b,_._localPos2Z=f,_._depth=a.depth;var n=_._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,_._id=a.id,_._warmStarted=!1,_._disabled=!1;return}var c=this._manifold._points[i],M=a.position1;c._pos1X=M.x,c._pos1Y=M.y,c._pos1Z=M.z;var m=a.position2;c._pos2X=m.x,c._pos2Y=m.y,c._pos2Z=m.z,c._relPos1X=c._pos1X-t._positionX,c._relPos1Y=c._pos1Y-t._positionY,c._relPos1Z=c._pos1Z-t._positionZ,c._relPos2X=c._pos2X-r._positionX,c._relPos2Y=c._pos2Y-r._positionY,c._relPos2Z=c._pos2Z-r._positionZ;var y,V,z;y=t._rotation00*c._relPos1X+t._rotation10*c._relPos1Y+t._rotation20*c._relPos1Z,V=t._rotation01*c._relPos1X+t._rotation11*c._relPos1Y+t._rotation21*c._relPos1Z,z=t._rotation02*c._relPos1X+t._rotation12*c._relPos1Y+t._rotation22*c._relPos1Z,c._localPos1X=y,c._localPos1Y=V,c._localPos1Z=z;var I,k,X;I=r._rotation00*c._relPos2X+r._rotation10*c._relPos2Y+r._rotation20*c._relPos2Z,k=r._rotation01*c._relPos2X+r._rotation11*c._relPos2Y+r._rotation21*c._relPos2Z,X=r._rotation02*c._relPos2X+r._rotation12*c._relPos2Y+r._rotation22*c._relPos2Z,c._localPos2X=I,c._localPos2Y=k,c._localPos2Z=X,c._depth=a.depth;var L=c._impulse;L.impulseN=0,L.impulseT=0,L.impulseB=0,L.impulseP=0,L.impulseLX=0,L.impulseLY=0,L.impulseLZ=0,c._id=a.id,c._warmStarted=!1,c._disabled=!1,this._manifold._numPoints++}computeTargetIndex(a,t,r){var i=this._manifold._points[0],o=this._manifold._points[1],_=this._manifold._points[2],s=this._manifold._points[3],h=i._depth,v=0;o._depth>h&&(h=o._depth,v=1),_._depth>h&&(h=_._depth,v=2),s._depth>h&&(h=s._depth,v=3);var e,l,u,b=a.position1;e=b.x,l=b.y,u=b.z,e-=t._positionX,l-=t._positionY,u-=t._positionZ;var f=o._relPos1X,n=o._relPos1Y,c=o._relPos1Z,M=_._relPos1X,m=_._relPos1Y,y=_._relPos1Z,V=s._relPos1X,z=s._relPos1Y,I=s._relPos1Z,k,X,L,p,g,N,A,F,S,Y,R,C,d,Z,$,j,E,G;k=M-f,X=m-n,L=y-c,p=e-V,g=l-z,N=u-I,A=V-f,F=z-n,S=I-c,Y=e-M,R=l-m,C=u-y,d=e-f,Z=l-n,$=u-c,j=V-M,E=z-m,G=I-y;var B,Q,U,J,D,H,K,ra,sa;B=X*N-L*g,Q=L*p-k*N,U=k*g-X*p,J=F*C-S*R,D=S*Y-A*C,H=A*R-F*Y,K=Z*G-$*E,ra=$*j-d*G,sa=d*E-Z*j;var W=B*B+Q*Q+U*U,q=J*J+D*D+H*H,na=K*K+ra*ra+sa*sa,oa=W>q?W>na?W:na:q>na?q:na,aa=i._relPos1X,T=i._relPos1Y,ca=i._relPos1Z,_a=_._relPos1X,w=_._relPos1Y,ta=_._relPos1Z,ia=s._relPos1X,la=s._relPos1Y,va=s._relPos1Z,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya,Qa,ga,ua,wa;xa=_a-aa,Ma=w-T,za=ta-ca,Xa=e-ia,Za=l-la,fa=u-va,ba=ia-aa,ea=la-T,ha=va-ca,pa=e-_a,ya=l-w,da=u-ta,ma=e-aa,Ya=l-T,Qa=u-ca,ga=ia-_a,ua=la-w,wa=va-ta;var ka,Pa,Mt,Ha,Ba,nt,Ea,Fa,Aa;ka=Ma*fa-za*Za,Pa=za*Xa-xa*fa,Mt=xa*Za-Ma*Xa,Ha=ea*da-ha*ya,Ba=ha*pa-ba*da,nt=ba*ya-ea*pa,Ea=Ya*wa-Qa*ua,Fa=Qa*ga-ma*wa,Aa=ma*ua-Ya*ga;var ft=ka*ka+Pa*Pa+Mt*Mt,Ua=Ha*Ha+Ba*Ba+nt*nt,ja=Ea*Ea+Fa*Fa+Aa*Aa,bt=ft>Ua?ft>ja?ft:ja:Ua>ja?Ua:ja,rt=i._relPos1X,$a=i._relPos1Y,_t=i._relPos1Z,gt=o._relPos1X,mt=o._relPos1Y,Wa=o._relPos1Z,it=s._relPos1X,ut=s._relPos1Y,Da=s._relPos1Z,Ta,Na,Vt,Pt,et,Xt,Yt,zt,Ia,O,Va,lt,P,wt,Bt,At,yt,kt;Ta=gt-rt,Na=mt-$a,Vt=Wa-_t,Pt=e-it,et=l-ut,Xt=u-Da,Yt=it-rt,zt=ut-$a,Ia=Da-_t,O=e-gt,Va=l-mt,lt=u-Wa,P=e-rt,wt=l-$a,Bt=u-_t,At=it-gt,yt=ut-mt,kt=Da-Wa;var pt,ht,xt,Ra,st,Ca,vt,qa,at;pt=Na*Xt-Vt*et,ht=Vt*Pt-Ta*Xt,xt=Ta*et-Na*Pt,Ra=zt*lt-Ia*Va,st=Ia*O-Yt*lt,Ca=Yt*Va-zt*O,vt=wt*kt-Bt*yt,qa=Bt*At-P*kt,at=P*yt-wt*At;var Oa=pt*pt+ht*ht+xt*xt,tt=Ra*Ra+st*st+Ca*Ca,ct=vt*vt+qa*qa+at*at,Sa=Oa>tt?Oa>ct?Oa:ct:tt>ct?tt:ct,Ga=i._relPos1X,Ka=i._relPos1Y,La=i._relPos1Z,ot=o._relPos1X,It=o._relPos1Y,or=o._relPos1Z,gr=_._relPos1X,ar=_._relPos1Y,Ct=_._relPos1Z,_r,Et,St,Gt,jr,vr,lr,tr,Or,Xr,Mr,Zt,ir,Wt,nr,$r,Ut,Kr;_r=ot-Ga,Et=It-Ka,St=or-La,Gt=e-gr,jr=l-ar,vr=u-Ct,lr=gr-Ga,tr=ar-Ka,Or=Ct-La,Xr=e-ot,Mr=l-It,Zt=u-or,ir=e-Ga,Wt=l-Ka,nr=u-La,$r=gr-ot,Ut=ar-It,Kr=Ct-or;var Ir,mi,Wr,Lt,Kt,Tt,br,zr,vi;Ir=Et*vr-St*jr,mi=St*Gt-_r*vr,Wr=_r*jr-Et*Gt,Lt=tr*Zt-Or*Mr,Kt=Or*Xr-lr*Zt,Tt=lr*Mr-tr*Xr,br=Wt*Kr-nr*Ut,zr=nr*$r-ir*Kr,vi=ir*Ut-Wt*$r;var qt=Ir*Ir+mi*mi+Wr*Wr,fr=Lt*Lt+Kt*Kt+Tt*Tt,dt=br*br+zr*zr+vi*vi,ur=qt>fr?qt>dt?qt:dt:fr>dt?fr:dt,hr=oa,ei=0;return(bt>hr&&v!=1||v==0)&&(hr=bt,ei=1),Sa>hr&&v!=2&&(hr=Sa,ei=2),ur>hr&&v!=3&&(hr=ur,ei=3),ei}computeRelativePositions(a,t){for(var r=this._manifold._numPoints,i=0,o=r;i<o;){var _=i++,s=this._manifold._points[_],h,v,e;h=a._rotation00*s._localPos1X+a._rotation01*s._localPos1Y+a._rotation02*s._localPos1Z,v=a._rotation10*s._localPos1X+a._rotation11*s._localPos1Y+a._rotation12*s._localPos1Z,e=a._rotation20*s._localPos1X+a._rotation21*s._localPos1Y+a._rotation22*s._localPos1Z,s._relPos1X=h,s._relPos1Y=v,s._relPos1Z=e;var l,u,b;l=t._rotation00*s._localPos2X+t._rotation01*s._localPos2Y+t._rotation02*s._localPos2Z,u=t._rotation10*s._localPos2X+t._rotation11*s._localPos2Y+t._rotation12*s._localPos2Z,b=t._rotation20*s._localPos2X+t._rotation21*s._localPos2Y+t._rotation22*s._localPos2Z,s._relPos2X=l,s._relPos2Y=u,s._relPos2Z=b,s._warmStarted=!0}}findNearestContactPointIndex(a,t,r){for(var i=x.common.Setting.contactPersistenceThreshold*x.common.Setting.contactPersistenceThreshold,o=-1,_=0,s=this._manifold._numPoints;_<s;){var h=_++,v=this._manifold._points[h],e,l,u,b,f,n,c=a.position1;e=c.x,l=c.y,u=c.z;var M=a.position2;b=M.x,f=M.y,n=M.z,e-=t._positionX,l-=t._positionY,u-=t._positionZ,b-=r._positionX,f-=r._positionY,n-=r._positionZ;var m,y,V,z,I,k;m=v._relPos1X-e,y=v._relPos1Y-l,V=v._relPos1Z-u,z=v._relPos2X-b,I=v._relPos2Y-f,k=v._relPos2Z-n;var X=m*m+y*y+V*V,L=z*z+I*I+k*k,p=X<L?X:L;p<i&&(i=p,o=h)}return o}totalUpdate(a,t,r){this.numOldPoints=this._manifold._numPoints;for(var i=0,o=this.numOldPoints;i<o;){var _=i++,s=this.oldPoints[_],h=this._manifold._points[_];s._localPos1X=h._localPos1X,s._localPos1Y=h._localPos1Y,s._localPos1Z=h._localPos1Z,s._localPos2X=h._localPos2X,s._localPos2Y=h._localPos2Y,s._localPos2Z=h._localPos2Z,s._relPos1X=h._relPos1X,s._relPos1Y=h._relPos1Y,s._relPos1Z=h._relPos1Z,s._relPos2X=h._relPos2X,s._relPos2Y=h._relPos2Y,s._relPos2Z=h._relPos2Z,s._pos1X=h._pos1X,s._pos1Y=h._pos1Y,s._pos1Z=h._pos1Z,s._pos2X=h._pos2X,s._pos2Y=h._pos2Y,s._pos2Z=h._pos2Z,s._depth=h._depth,s._impulse.copyFrom(h._impulse),s._id=h._id,s._warmStarted=h._warmStarted,s._disabled=!1}var v=a.numPoints;this._manifold._numPoints=v;for(var e=0,l=v;e<l;){var u=e++,b=this._manifold._points[u],f=a.points[u],n=f.position1;b._pos1X=n.x,b._pos1Y=n.y,b._pos1Z=n.z;var c=f.position2;b._pos2X=c.x,b._pos2Y=c.y,b._pos2Z=c.z,b._relPos1X=b._pos1X-t._positionX,b._relPos1Y=b._pos1Y-t._positionY,b._relPos1Z=b._pos1Z-t._positionZ,b._relPos2X=b._pos2X-r._positionX,b._relPos2Y=b._pos2Y-r._positionY,b._relPos2Z=b._pos2Z-r._positionZ;var M,m,y;M=t._rotation00*b._relPos1X+t._rotation10*b._relPos1Y+t._rotation20*b._relPos1Z,m=t._rotation01*b._relPos1X+t._rotation11*b._relPos1Y+t._rotation21*b._relPos1Z,y=t._rotation02*b._relPos1X+t._rotation12*b._relPos1Y+t._rotation22*b._relPos1Z,b._localPos1X=M,b._localPos1Y=m,b._localPos1Z=y;var V,z,I;V=r._rotation00*b._relPos2X+r._rotation10*b._relPos2Y+r._rotation20*b._relPos2Z,z=r._rotation01*b._relPos2X+r._rotation11*b._relPos2Y+r._rotation21*b._relPos2Z,I=r._rotation02*b._relPos2X+r._rotation12*b._relPos2Y+r._rotation22*b._relPos2Z,b._localPos2X=V,b._localPos2Y=z,b._localPos2Z=I,b._depth=f.depth;var k=b._impulse;k.impulseN=0,k.impulseT=0,k.impulseB=0,k.impulseP=0,k.impulseLX=0,k.impulseLY=0,k.impulseLZ=0,b._id=f.id,b._warmStarted=!1,b._disabled=!1;for(var X=0,L=this.numOldPoints;X<L;){var p=X++,g=this.oldPoints[p];if(b._id==g._id){b._impulse.copyFrom(g._impulse),b._warmStarted=!0;break}}}}incrementalUpdate(a,t,r){this._manifold._updateDepthsAndPositions(t,r);for(var i=0,o=this._manifold._numPoints;i<o;){var _=i++;this._manifold._points[_]._warmStarted=!0}var s=a.points[0],h=this.findNearestContactPointIndex(s,t,r);if(h==-1)this.addManifoldPoint(s,t,r);else{var v=this._manifold._points[h],e=s.position1;v._pos1X=e.x,v._pos1Y=e.y,v._pos1Z=e.z;var l=s.position2;v._pos2X=l.x,v._pos2Y=l.y,v._pos2Z=l.z,v._relPos1X=v._pos1X-t._positionX,v._relPos1Y=v._pos1Y-t._positionY,v._relPos1Z=v._pos1Z-t._positionZ,v._relPos2X=v._pos2X-r._positionX,v._relPos2Y=v._pos2Y-r._positionY,v._relPos2Z=v._pos2Z-r._positionZ;var u,b,f;u=t._rotation00*v._relPos1X+t._rotation10*v._relPos1Y+t._rotation20*v._relPos1Z,b=t._rotation01*v._relPos1X+t._rotation11*v._relPos1Y+t._rotation21*v._relPos1Z,f=t._rotation02*v._relPos1X+t._rotation12*v._relPos1Y+t._rotation22*v._relPos1Z,v._localPos1X=u,v._localPos1Y=b,v._localPos1Z=f;var n,c,M;n=r._rotation00*v._relPos2X+r._rotation10*v._relPos2Y+r._rotation20*v._relPos2Z,c=r._rotation01*v._relPos2X+r._rotation11*v._relPos2Y+r._rotation21*v._relPos2Z,M=r._rotation02*v._relPos2X+r._rotation12*v._relPos2Y+r._rotation22*v._relPos2Z,v._localPos2X=n,v._localPos2Y=c,v._localPos2Z=M,v._depth=s.depth}this.removeOutdatedPoints()}};x.dynamics.constraint.info||(x.dynamics.constraint.info={});x.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};x.dynamics.constraint.info.contact||(x.dynamics.constraint.info.contact={});x.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(x.common.Setting.maxManifoldPoints);this.rows=a;for(var t=0,r=this.rows.length;t<r;){var i=t++;this.rows[i]=new x.dynamics.constraint.info.contact.ContactSolverInfoRow}}};x.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new x.dynamics.constraint.info.JacobianRow,this.jacobianT=new x.dynamics.constraint.info.JacobianRow,this.jacobianB=new x.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};x.dynamics.constraint.info.joint||(x.dynamics.constraint.info.joint={});x.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(x.common.Setting.maxJacobianRows);this.rows=a;for(var t=0,r=this.rows.length;t<r;){var i=t++;this.rows[i]=new x.dynamics.constraint.info.joint.JointSolverInfoRow}}};x.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new x.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};x.dynamics.constraint.joint||(x.dynamics.constraint.joint={});x.dynamics.constraint.joint.BasisTracker=class{constructor(a){this.joint=a,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};x.dynamics.constraint.joint.Joint=class{constructor(a,t){switch(this._link1=new x.dynamics.constraint.joint.JointLink(this),this._link2=new x.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=x.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=t,this._world=null,this._b1=a.rigidBody1,this._b2=a.rigidBody2,this._allowCollision=a.allowCollision,this._breakForce=a.breakForce,this._breakTorque=a.breakTorque,a.solverType){case 0:this._solver=new x.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new x.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}var r=a.localAnchor1;this._localAnchor1X=r.x,this._localAnchor1Y=r.y,this._localAnchor1Z=r.z;var i=a.localAnchor2;this._localAnchor2X=i.x,this._localAnchor2Y=i.y,this._localAnchor2Z=i.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var o=new Array(x.common.Setting.maxJacobianRows);this._impulses=o;for(var _=0,s=x.common.Setting.maxJacobianRows;_<s;){var h=_++;this._impulses[h]=new x.dynamics.constraint.joint.JointImpulse}}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}var r,i,o,_,s,h,v,e,l,u,b,f,n,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){var M,m,y,V=this._localBasisX1X,z=this._localBasisX1Y,I=this._localBasisX1Z,k=V*V,X=z*z,L=I*I,p;k<X?k<L?(p=1/Math.sqrt(X+L),M=0,m=I*p,y=-z*p):(p=1/Math.sqrt(k+X),M=z*p,m=-V*p,y=0):X<L?(p=1/Math.sqrt(L+k),M=-I*p,m=0,y=V*p):(p=1/Math.sqrt(k+X),M=z*p,m=-V*p,y=0),r=M,i=m,o=y,_=0}else{var g,N,A;g=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,N=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var F=Math.sqrt((1+c)*.5);c=.5/F,g*=c,N*=c,A*=c,r=g,i=N,o=A,_=F}var S=r,Y=i,R=o,C=_,d=2*S,Z=2*Y,$=2*R,j=S*d,E=Y*Z,G=R*$,B=S*Z,Q=Y*$,U=S*$,J=C*d,D=C*Z,H=C*$;s=1-E-G,h=B-H,v=U+D,e=B+H,l=1-j-G,u=Q-J,b=U-D,f=Q+J,n=1-j-E;var K=this._localBasisX1X,ra=this._localBasisX1Y,sa=this._localBasisX1Z,W=K*K,q=ra*ra,na=sa*sa,oa;W<q?W<na?(oa=1/Math.sqrt(q+na),this._localBasisY1X=0,this._localBasisY1Y=sa*oa,this._localBasisY1Z=-ra*oa):(oa=1/Math.sqrt(W+q),this._localBasisY1X=ra*oa,this._localBasisY1Y=-K*oa,this._localBasisY1Z=0):q<na?(oa=1/Math.sqrt(na+W),this._localBasisY1X=-sa*oa,this._localBasisY1Y=0,this._localBasisY1Z=K*oa):(oa=1/Math.sqrt(W+q),this._localBasisY1X=ra*oa,this._localBasisY1Y=-K*oa,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var aa,T,ca;aa=s*this._localBasisX1X+h*this._localBasisX1Y+v*this._localBasisX1Z,T=e*this._localBasisX1X+l*this._localBasisX1Y+u*this._localBasisX1Z,ca=b*this._localBasisX1X+f*this._localBasisX1Y+n*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,w,ta;_a=s*this._localBasisY1X+h*this._localBasisY1Y+v*this._localBasisY1Z,w=e*this._localBasisY1X+l*this._localBasisY1Y+u*this._localBasisY1Z,ta=b*this._localBasisY1X+f*this._localBasisY1Y+n*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=w,this._localBasisY2Z=ta;var ia,la,va;ia=s*this._localBasisZ1X+h*this._localBasisZ1Y+v*this._localBasisZ1Z,la=e*this._localBasisZ1X+l*this._localBasisZ1Y+u*this._localBasisZ1Z,va=b*this._localBasisZ1X+f*this._localBasisZ1Y+n*this._localBasisZ1Z,this._localBasisZ2X=ia,this._localBasisZ2Y=la,this._localBasisZ2Z=va}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var r=this._localBasisX1X,i=this._localBasisX1Y,o=this._localBasisX1Z,_=r*r,s=i*i,h=o*o,v;_<s?_<h?(v=1/Math.sqrt(s+h),this._localBasisY1X=0,this._localBasisY1Y=o*v,this._localBasisY1Z=-i*v):(v=1/Math.sqrt(_+s),this._localBasisY1X=i*v,this._localBasisY1Y=-r*v,this._localBasisY1Z=0):s<h?(v=1/Math.sqrt(h+_),this._localBasisY1X=-o*v,this._localBasisY1Y=0,this._localBasisY1Z=r*v):(v=1/Math.sqrt(_+s),this._localBasisY1X=i*v,this._localBasisY1Y=-r*v,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var e=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;e>0&&(e=1/Math.sqrt(e)),this._localBasisZ1X*=e,this._localBasisZ1Y*=e,this._localBasisZ1Z*=e,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l=this._localBasisX2X,u=this._localBasisX2Y,b=this._localBasisX2Z,f=l*l,n=u*u,c=b*b,M;f<n?f<c?(M=1/Math.sqrt(n+c),this._localBasisY2X=0,this._localBasisY2Y=b*M,this._localBasisY2Z=-u*M):(M=1/Math.sqrt(f+n),this._localBasisY2X=u*M,this._localBasisY2Y=-l*M,this._localBasisY2Z=0):n<c?(M=1/Math.sqrt(c+f),this._localBasisY2X=-b*M,this._localBasisY2Y=0,this._localBasisY2Z=l*M):(M=1/Math.sqrt(f+n),this._localBasisY2X=u*M,this._localBasisY2Y=-l*M,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var m=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;m>0&&(m=1/Math.sqrt(m)),this._localBasisZ2X*=m,this._localBasisZ2Y*=m,this._localBasisZ2Z*=m,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}var r=this._b1._transform,i=this._b2._transform,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I;V=r._rotation00*this._localBasisX1X+r._rotation01*this._localBasisX1Y+r._rotation02*this._localBasisX1Z,z=r._rotation10*this._localBasisX1X+r._rotation11*this._localBasisX1Y+r._rotation12*this._localBasisX1Z,I=r._rotation20*this._localBasisX1X+r._rotation21*this._localBasisX1Y+r._rotation22*this._localBasisX1Z,o=V,_=z,s=I;var k,X,L;if(k=i._rotation00*this._localBasisZ2X+i._rotation01*this._localBasisZ2Y+i._rotation02*this._localBasisZ2Z,X=i._rotation10*this._localBasisZ2X+i._rotation11*this._localBasisZ2Y+i._rotation12*this._localBasisZ2Z,L=i._rotation20*this._localBasisZ2X+i._rotation21*this._localBasisZ2Y+i._rotation22*this._localBasisZ2Z,M=k,m=X,y=L,l=m*s-y*_,u=y*o-M*s,b=M*_-m*o,l*l+u*u+b*b==0){var p=o,g=_,N=s,A=p*p,F=g*g,S=N*N,Y;A<F?A<S?(Y=1/Math.sqrt(F+S),l=0,u=N*Y,b=-g*Y):(Y=1/Math.sqrt(A+F),l=g*Y,u=-p*Y,b=0):F<S?(Y=1/Math.sqrt(S+A),l=-N*Y,u=0,b=p*Y):(Y=1/Math.sqrt(A+F),l=g*Y,u=-p*Y,b=0)}h=_*b-s*u,v=s*l-o*b,e=o*u-_*l,f=u*y-b*m,n=b*M-l*y,c=l*m-u*M;var R,C,d;R=r._rotation00*o+r._rotation10*_+r._rotation20*s,C=r._rotation01*o+r._rotation11*_+r._rotation21*s,d=r._rotation02*o+r._rotation12*_+r._rotation22*s,this._localBasisX1X=R,this._localBasisX1Y=C,this._localBasisX1Z=d;var Z,$,j;Z=r._rotation00*l+r._rotation10*u+r._rotation20*b,$=r._rotation01*l+r._rotation11*u+r._rotation21*b,j=r._rotation02*l+r._rotation12*u+r._rotation22*b,this._localBasisY1X=Z,this._localBasisY1Y=$,this._localBasisY1Z=j;var E,G,B;E=r._rotation00*h+r._rotation10*v+r._rotation20*e,G=r._rotation01*h+r._rotation11*v+r._rotation21*e,B=r._rotation02*h+r._rotation12*v+r._rotation22*e,this._localBasisZ1X=E,this._localBasisZ1Y=G,this._localBasisZ1Z=B;var Q,U,J;Q=i._rotation00*f+i._rotation10*n+i._rotation20*c,U=i._rotation01*f+i._rotation11*n+i._rotation21*c,J=i._rotation02*f+i._rotation12*n+i._rotation22*c,this._localBasisX2X=Q,this._localBasisX2Y=U,this._localBasisX2Z=J;var D,H,K;D=i._rotation00*l+i._rotation10*u+i._rotation20*b,H=i._rotation01*l+i._rotation11*u+i._rotation21*b,K=i._rotation02*l+i._rotation12*u+i._rotation22*b,this._localBasisY2X=D,this._localBasisY2Y=H,this._localBasisY2Z=K;var ra,sa,W;ra=i._rotation00*M+i._rotation10*m+i._rotation20*y,sa=i._rotation01*M+i._rotation11*m+i._rotation21*y,W=i._rotation02*M+i._rotation12*m+i._rotation22*y,this._localBasisZ2X=ra,this._localBasisZ2Y=sa,this._localBasisZ2Z=W}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var t=this._localBasisX1X,r=this._localBasisX1Y,i=this._localBasisX1Z,o=t*t,_=r*r,s=i*i,h;o<_?o<s?(h=1/Math.sqrt(_+s),this._localBasisY1X=0,this._localBasisY1Y=i*h,this._localBasisY1Z=-r*h):(h=1/Math.sqrt(o+_),this._localBasisY1X=r*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0):_<s?(h=1/Math.sqrt(s+o),this._localBasisY1X=-i*h,this._localBasisY1Y=0,this._localBasisY1Z=t*h):(h=1/Math.sqrt(o+_),this._localBasisY1X=r*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var v=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;v>0&&(v=1/Math.sqrt(v)),this._localBasisZ1X*=v,this._localBasisZ1Y*=v,this._localBasisZ1Z*=v,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var e,l,u,b,f,n,c,M,m,y,V,z,I,k=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(k<-.999999999){var X,L,p,g=this._localBasisX1X,N=this._localBasisX1Y,A=this._localBasisX1Z,F=g*g,S=N*N,Y=A*A,R;F<S?F<Y?(R=1/Math.sqrt(S+Y),X=0,L=A*R,p=-N*R):(R=1/Math.sqrt(F+S),X=N*R,L=-g*R,p=0):S<Y?(R=1/Math.sqrt(Y+F),X=-A*R,L=0,p=g*R):(R=1/Math.sqrt(F+S),X=N*R,L=-g*R,p=0),e=X,l=L,u=p,b=0}else{var C,d,Z;C=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,d=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Z=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var $=Math.sqrt((1+k)*.5);k=.5/$,C*=k,d*=k,Z*=k,e=C,l=d,u=Z,b=$}var j=e,E=l,G=u,B=b,Q=2*j,U=2*E,J=2*G,D=j*Q,H=E*U,K=G*J,ra=j*U,sa=E*J,W=j*J,q=B*Q,na=B*U,oa=B*J;f=1-H-K,n=ra-oa,c=W+na,M=ra+oa,m=1-D-K,y=sa-q,V=W-na,z=sa+q,I=1-D-H;var aa,T,ca;aa=f*this._localBasisX1X+n*this._localBasisX1Y+c*this._localBasisX1Z,T=M*this._localBasisX1X+m*this._localBasisX1Y+y*this._localBasisX1Z,ca=V*this._localBasisX1X+z*this._localBasisX1Y+I*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,w,ta;_a=f*this._localBasisY1X+n*this._localBasisY1Y+c*this._localBasisY1Z,w=M*this._localBasisY1X+m*this._localBasisY1Y+y*this._localBasisY1Z,ta=V*this._localBasisY1X+z*this._localBasisY1Y+I*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=w,this._localBasisY2Z=ta;var ia,la,va;ia=f*this._localBasisZ1X+n*this._localBasisZ1Y+c*this._localBasisZ1Z,la=M*this._localBasisZ1X+m*this._localBasisZ1Y+y*this._localBasisZ1Z,va=V*this._localBasisZ1X+z*this._localBasisZ1Y+I*this._localBasisZ1Z,this._localBasisZ2X=ia,this._localBasisZ2Y=la,this._localBasisZ2Z=va}setSolverInfoRowLinear(a,t,r,i,o,_,s){var h,v,e=x.common.Setting.linearSlop;if(s)h=0,v=1;else{if(o.frequency>0){e=0;var l=6.28318530717958*o.frequency,u=o.dampingRatio;u<x.common.Setting.minSpringDamperDampingRatio&&(u=x.common.Setting.minSpringDamperDampingRatio);var b=_.dt,f=2*u*l,n=l*l;o.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(_,!1);r.motorForce>0?(a.motorSpeed=r.motorSpeed,a.motorMaxImpulse=r.motorForce*_.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=r.lowerLimit,M=r.upperLimit,m,y,V;c>M?(m=0,y=0,V=0):c==M?(m=-1/0,y=1/0,V=t-c):t<c?(m=-1/0,y=0,V=t-c+e,V>0&&(V=0)):t>M?(m=0,y=1/0,V=t-M-e,V<0&&(V=0)):(m=0,y=0,V=0);var z=i==0?0:1/i;a.minImpulse=m,a.maxImpulse=y,a.cfm=h*z,a.rhs=V*v}setSolverInfoRowAngular(a,t,r,i,o,_,s){var h,v,e=x.common.Setting.angularSlop;if(s)h=0,v=1;else{if(o.frequency>0){e=0;var l=6.28318530717958*o.frequency,u=o.dampingRatio;u<x.common.Setting.minSpringDamperDampingRatio&&(u=x.common.Setting.minSpringDamperDampingRatio);var b=_.dt,f=2*u*l,n=l*l;o.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(_,!1);r.motorTorque>0?(a.motorSpeed=r.motorSpeed,a.motorMaxImpulse=r.motorTorque*_.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=r.lowerLimit,M=r.upperLimit,m=(c+M)*.5;t-=m,t=((t+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,t+=m;var y,V,z;c>M?(y=0,V=0,z=0):c==M?(y=-1/0,V=1/0,z=t-c):t<c?(y=-1/0,V=0,z=t-c+e,z>0&&(z=0)):t>M?(y=0,V=1/0,z=t-M-e,z<0&&(z=0)):(y=0,V=0,z=0);var I=i==0?0:1/i;a.minImpulse=y,a.maxImpulse=V,a.cfm=h*I,a.rhs=z*v}getErp(a,t){return t?1:this._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?a.invDt*x.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(a,t,r){var i,o,_,s,h,v,e,l,u;e=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*r,l=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*r,u=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*r,i=e,o=l,_=u;var b,f,n;b=this._b2._invInertia00*a+this._b2._invInertia01*t+this._b2._invInertia02*r,f=this._b2._invInertia10*a+this._b2._invInertia11*t+this._b2._invInertia12*r,n=this._b2._invInertia20*a+this._b2._invInertia21*t+this._b2._invInertia22*r,s=b,h=f,v=n;var c=i*a+o*t+_*r,M=s*a+h*t+v*r;if(c>0){var m=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,y=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+r*this._relativeAnchor1Z,V=m-y*y;V>0&&(this._b1._invMass>0?c=1/(1/c+this._b1._mass*V):c=0)}if(M>0){var z=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,I=a*this._relativeAnchor2X+t*this._relativeAnchor2Y+r*this._relativeAnchor2Z,k=z-I*I;k>0&&(this._b2._invMass>0?M=1/(1/M+this._b2._mass*k):M=0)}return c+M==0?0:1/(c+M)}computeEffectiveInertiaMoment2(a,t,r,i,o,_){var s,h,v,e,l,u,b,f,n;b=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*r,f=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*r,n=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*r,s=b,h=f,v=n;var c,M,m;c=this._b2._invInertia00*i+this._b2._invInertia01*o+this._b2._invInertia02*_,M=this._b2._invInertia10*i+this._b2._invInertia11*o+this._b2._invInertia12*_,m=this._b2._invInertia20*i+this._b2._invInertia21*o+this._b2._invInertia22*_,e=c,l=M,u=m;var y=s*a+h*t+v*r,V=e*i+l*o+u*_;if(y>0){var z=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,I=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+r*this._relativeAnchor1Z,k=z*z-I*I;k>0&&(this._b1._invMass>0?y=1/(1/y+this._b1._mass*k):y=0)}if(V>0){var X=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,L=i*this._relativeAnchor2X+o*this._relativeAnchor2Y+_*this._relativeAnchor2Z,p=X*X-L*L;p>0&&(this._b2._invMass>0?V=1/(1/V+this._b2._mass*p):V=0)}return y+V==0?0:1/(y+V)}_syncAnchors(){var a=this._b1._transform,t=this._b2._transform,r,i,o;r=a._rotation00*this._localAnchor1X+a._rotation01*this._localAnchor1Y+a._rotation02*this._localAnchor1Z,i=a._rotation10*this._localAnchor1X+a._rotation11*this._localAnchor1Y+a._rotation12*this._localAnchor1Z,o=a._rotation20*this._localAnchor1X+a._rotation21*this._localAnchor1Y+a._rotation22*this._localAnchor1Z,this._relativeAnchor1X=r,this._relativeAnchor1Y=i,this._relativeAnchor1Z=o;var _,s,h;_=t._rotation00*this._localAnchor2X+t._rotation01*this._localAnchor2Y+t._rotation02*this._localAnchor2Z,s=t._rotation10*this._localAnchor2X+t._rotation11*this._localAnchor2Y+t._rotation12*this._localAnchor2Z,h=t._rotation20*this._localAnchor2X+t._rotation21*this._localAnchor2Y+t._rotation22*this._localAnchor2Z,this._relativeAnchor2X=_,this._relativeAnchor2Y=s,this._relativeAnchor2Z=h,this._anchor1X=this._relativeAnchor1X+a._positionX,this._anchor1Y=this._relativeAnchor1Y+a._positionY,this._anchor1Z=this._relativeAnchor1Z+a._positionZ,this._anchor2X=this._relativeAnchor2X+t._positionX,this._anchor2Y=this._relativeAnchor2Y+t._positionY,this._anchor2Z=this._relativeAnchor2Z+t._positionZ;var v,e,l;v=a._rotation00*this._localBasisX1X+a._rotation01*this._localBasisX1Y+a._rotation02*this._localBasisX1Z,e=a._rotation10*this._localBasisX1X+a._rotation11*this._localBasisX1Y+a._rotation12*this._localBasisX1Z,l=a._rotation20*this._localBasisX1X+a._rotation21*this._localBasisX1Y+a._rotation22*this._localBasisX1Z,this._basisX1X=v,this._basisX1Y=e,this._basisX1Z=l;var u,b,f;u=a._rotation00*this._localBasisY1X+a._rotation01*this._localBasisY1Y+a._rotation02*this._localBasisY1Z,b=a._rotation10*this._localBasisY1X+a._rotation11*this._localBasisY1Y+a._rotation12*this._localBasisY1Z,f=a._rotation20*this._localBasisY1X+a._rotation21*this._localBasisY1Y+a._rotation22*this._localBasisY1Z,this._basisY1X=u,this._basisY1Y=b,this._basisY1Z=f;var n,c,M;n=a._rotation00*this._localBasisZ1X+a._rotation01*this._localBasisZ1Y+a._rotation02*this._localBasisZ1Z,c=a._rotation10*this._localBasisZ1X+a._rotation11*this._localBasisZ1Y+a._rotation12*this._localBasisZ1Z,M=a._rotation20*this._localBasisZ1X+a._rotation21*this._localBasisZ1Y+a._rotation22*this._localBasisZ1Z,this._basisZ1X=n,this._basisZ1Y=c,this._basisZ1Z=M;var m,y,V;m=t._rotation00*this._localBasisX2X+t._rotation01*this._localBasisX2Y+t._rotation02*this._localBasisX2Z,y=t._rotation10*this._localBasisX2X+t._rotation11*this._localBasisX2Y+t._rotation12*this._localBasisX2Z,V=t._rotation20*this._localBasisX2X+t._rotation21*this._localBasisX2Y+t._rotation22*this._localBasisX2Z,this._basisX2X=m,this._basisX2Y=y,this._basisX2Z=V;var z,I,k;z=t._rotation00*this._localBasisY2X+t._rotation01*this._localBasisY2Y+t._rotation02*this._localBasisY2Z,I=t._rotation10*this._localBasisY2X+t._rotation11*this._localBasisY2Y+t._rotation12*this._localBasisY2Z,k=t._rotation20*this._localBasisY2X+t._rotation21*this._localBasisY2Y+t._rotation22*this._localBasisY2Z,this._basisY2X=z,this._basisY2Y=I,this._basisY2Z=k;var X,L,p;X=t._rotation00*this._localBasisZ2X+t._rotation01*this._localBasisZ2Y+t._rotation02*this._localBasisZ2Z,L=t._rotation10*this._localBasisZ2X+t._rotation11*this._localBasisZ2Y+t._rotation12*this._localBasisZ2Z,p=t._rotation20*this._localBasisZ2X+t._rotation21*this._localBasisZ2Y+t._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=L,this._basisZ2Z=p}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2,a.numRows=0}_checkDestruction(){var a=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&a>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){var a=new x.common.Vec3,t=a;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,a}getAnchor2(){var a=new x.common.Vec3,t=a;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,a}getAnchor1To(a){var t=a;t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(a){var t=a;t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){var a=new x.common.Vec3,t=a;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,a}getLocalAnchor2(){var a=new x.common.Vec3,t=a;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,a}getLocalAnchor1To(a){var t=a;t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(a){var t=a;t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){var a=new x.common.Mat3,t,r,i,o,_,s,h,v,e;t=this._basisX1X,r=this._basisY1X,i=this._basisZ1X,o=this._basisX1Y,_=this._basisY1Y,s=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,e=this._basisZ1Z;var l=a;return l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=_,l.e12=s,l.e20=h,l.e21=v,l.e22=e,a}getBasis2(){var a=new x.common.Mat3,t,r,i,o,_,s,h,v,e;t=this._basisX2X,r=this._basisY2X,i=this._basisZ2X,o=this._basisX2Y,_=this._basisY2Y,s=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,e=this._basisZ2Z;var l=a;return l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=_,l.e12=s,l.e20=h,l.e21=v,l.e22=e,a}getBasis1To(a){var t,r,i,o,_,s,h,v,e;t=this._basisX1X,r=this._basisY1X,i=this._basisZ1X,o=this._basisX1Y,_=this._basisY1Y,s=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,e=this._basisZ1Z;var l=a;l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=_,l.e12=s,l.e20=h,l.e21=v,l.e22=e}getBasis2To(a){var t,r,i,o,_,s,h,v,e;t=this._basisX2X,r=this._basisY2X,i=this._basisZ2X,o=this._basisX2Y,_=this._basisY2Y,s=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,e=this._basisZ2Z;var l=a;l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=_,l.e12=s,l.e20=h,l.e21=v,l.e22=e}getAllowCollision(){return this._allowCollision}setAllowCollision(a){this._allowCollision=a}getBreakForce(){return this._breakForce}setBreakForce(a){this._breakForce=a}getBreakTorque(){return this._breakTorque}setBreakTorque(a){this._breakTorque=a}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(a){switch(a){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+a)}this._positionCorrectionAlgorithm=a}getAppliedForce(){var a=new x.common.Vec3,t=a;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,a}getAppliedForceTo(a){var t=a;t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){var a=new x.common.Vec3,t=a;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,a}getAppliedTorqueTo(a){var t=a;t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.constraint.joint.CylindricalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,2);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this._translSd=a.translationalSpringDamper.clone(),this._translLm=a.translationalLimitMotor.clone(),this._rotSd=a.rotationalSpringDamper.clone(),this._rotLm=a.rotationalLimitMotor.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o=this.linearErrorY*i,_=this.linearErrorZ*i,s=this.angularErrorY*i,h=this.angularErrorZ*i,v,e,l=1/(this._b1._invMass+this._b2._invMass),u=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!r){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,v=f,this.setSolverInfoRowLinear(v,this.translation,this._translLm,l,this._translSd,t,r),e=v.jacobian,e.lin1X=this._basis.xX,e.lin1Y=this._basis.xY,e.lin1Z=this._basis.xZ,e.lin2X=this._basis.xX,e.lin2Y=this._basis.xY,e.lin2Z=this._basis.xZ,e.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,e.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,e.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,e.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,e.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,e.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],M=a.rows[a.numRows++],m=M.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=c,v=M,v.rhs=o,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.lin1X=this._basis.yX,e.lin1Y=this._basis.yY,e.lin1Z=this._basis.yZ,e.lin2X=this._basis.yX,e.lin2Y=this._basis.yY,e.lin2Z=this._basis.yZ,e.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,e.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,e.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,e.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,e.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,e.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],z=V.jacobian;if(z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,v=V,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.lin1X=this._basis.zX,e.lin1Y=this._basis.zY,e.lin1Z=this._basis.zZ,e.lin2X=this._basis.zX,e.lin2Y=this._basis.zY,e.lin2Z=this._basis.zZ,e.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,e.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,e.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,e.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,e.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,e.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!r){var I=this._impulses[3],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,v=k,this.setSolverInfoRowAngular(v,this.angle,this._rotLm,u,this._rotSd,t,r),e=v.jacobian,e.ang1X=this._basis.xX,e.ang1Y=this._basis.xY,e.ang1Z=this._basis.xZ,e.ang2X=this._basis.xX,e.ang2Y=this._basis.xY,e.ang2Z=this._basis.xZ}var L=this._impulses[4],p=a.rows[a.numRows++],g=p.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=L,v=p,v.rhs=s,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.ang1X=this._basis.yX,e.ang1Y=this._basis.yY,e.ang1Z=this._basis.yZ,e.ang2X=this._basis.yX,e.ang2Y=this._basis.yY,e.ang2Z=this._basis.yZ;var N=this._impulses[5],A=a.rows[a.numRows++],F=A.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=N,v=A,v.rhs=h,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.ang1X=this._basis.zX,e.ang1Y=this._basis.zY,e.ang1Z=this._basis.zZ,e.ang2X=this._basis.zX,e.ang2Y=this._basis.zY,e.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,r=a.joint._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y,R,C,d,Z,$,j,E,G=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(G<-.999999999){var B,Q,U,J=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,K=J*J,ra=D*D,sa=H*H,W;K<ra?K<sa?(W=1/Math.sqrt(ra+sa),B=0,Q=H*W,U=-D*W):(W=1/Math.sqrt(K+ra),B=D*W,Q=-J*W,U=0):ra<sa?(W=1/Math.sqrt(sa+K),B=-H*W,Q=0,U=J*W):(W=1/Math.sqrt(K+ra),B=D*W,Q=-J*W,U=0),i=B,o=Q,_=U,s=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+G)*.5);G=.5/aa,q*=G,na*=G,oa*=G,i=q,o=na,_=oa,s=aa}h=0,v=0,e=0,l=1;var T,ca,_a,w,ta,ia,la,va;T=h,ca=v,_a=e,w=l,ta=i,ia=o,la=_,va=s;var xa=T*ta+ca*ia+_a*la+w*va;if(xa<0&&(xa=-xa,ta=-ta,ia=-ia,la=-la,va=-va),xa>.999999){var Ma,za,Xa,Za;Ma=ta-T,za=ia-ca,Xa=la-_a,Za=va-w,ta=T+Ma*(t/(t+r)),ia=ca+za*(t/(t+r)),la=_a+Xa*(t/(t+r)),va=w+Za*(t/(t+r));var fa=ta*ta+ia*ia+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ia*fa,f=la*fa,n=va*fa}else{var ba=t/(t+r)*Math.acos(xa);ta+=T*-xa,ia+=ca*-xa,la+=_a*-xa,va+=w*-xa;var ea=ta*ta+ia*ia+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ia*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),pa=Math.cos(ba);T*=pa,ca*=pa,_a*=pa,w*=pa,u=T+ta*ha,b=ca+ia*ha,f=_a+la*ha,n=w+va*ha}var ya=u,da=b,ma=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*ma,wa=ya*Qa,ka=da*ga,Pa=ma*ua,Mt=ya*ga,Ha=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Fa=Ya*ua;c=1-ka-Pa,M=Mt-Fa,m=Ba+Ea,y=Mt+Fa,V=1-wa-Pa,z=Ha-nt,I=Ba-Ea,k=Ha+nt,X=1-wa-ka;var Aa,ft,Ua;Aa=c*a.joint._basisX1X+M*a.joint._basisX1Y+m*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+z*a.joint._basisX1Z,Ua=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Aa,p=ft,g=Ua,C=a.xX,d=a.xY,Z=a.xZ,$=a.yX,j=a.yY,E=a.yZ;var ja=C*L+d*p+Z*g;if(ja<-.999999999){var bt,rt,$a,_t=C,gt=d,mt=Z,Wa=_t*_t,it=gt*gt,ut=mt*mt,Da;Wa<it?Wa<ut?(Da=1/Math.sqrt(it+ut),bt=0,rt=mt*Da,$a=-gt*Da):(Da=1/Math.sqrt(Wa+it),bt=gt*Da,rt=-_t*Da,$a=0):it<ut?(Da=1/Math.sqrt(ut+Wa),bt=-mt*Da,rt=0,$a=_t*Da):(Da=1/Math.sqrt(Wa+it),bt=gt*Da,rt=-_t*Da,$a=0),u=bt,b=rt,f=$a,n=0}else{var Ta,Na,Vt;Ta=d*g-Z*p,Na=Z*L-C*g,Vt=C*p-d*L;var Pt=Math.sqrt((1+ja)*.5);ja=.5/Pt,Ta*=ja,Na*=ja,Vt*=ja,u=Ta,b=Na,f=Vt,n=Pt}var et=u,Xt=b,Yt=f,zt=n,Ia=2*et,O=2*Xt,Va=2*Yt,lt=et*Ia,P=Xt*O,wt=Yt*Va,Bt=et*O,At=Xt*Va,yt=et*Va,kt=zt*Ia,pt=zt*O,ht=zt*Va;c=1-P-wt,M=Bt-ht,m=yt+pt,y=Bt+ht,V=1-lt-wt,z=At-kt,I=yt-pt,k=At+kt,X=1-lt-P;var xt,Ra,st;if(xt=c*$+M*j+m*E,Ra=y*$+V*j+z*E,st=I*$+k*j+X*E,N=xt,A=Ra,F=st,S=p*F-g*A,Y=g*N-L*F,R=L*A-p*N,S*S+Y*Y+R*R>1e-6){var Ca=S*S+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),S*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=p,at=g,Oa=vt*vt,tt=qa*qa,ct=at*at,Sa;Oa<tt?Oa<ct?(Sa=1/Math.sqrt(tt+ct),S=0,Y=at*Sa,R=-qa*Sa):(Sa=1/Math.sqrt(Oa+tt),S=qa*Sa,Y=-vt*Sa,R=0):tt<ct?(Sa=1/Math.sqrt(ct+Oa),S=-at*Sa,Y=0,R=vt*Sa):(Sa=1/Math.sqrt(Oa+tt),S=qa*Sa,Y=-vt*Sa,R=0)}N=Y*g-R*p,A=R*L-S*g,F=S*p-Y*L,a.xX=L,a.xY=p,a.xZ=g,a.yX=N,a.yY=A,a.yZ=F,a.zX=S,a.zY=Y,a.zZ=R;var Ga,Ka,La;Ga=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ka=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),or=Ga*Ga+Ka*Ka+La*La;or>0&&(or=1/Math.sqrt(or)),Ga*=or,Ka*=or,La*=or,Ga*=It,Ka*=It,La*=It,this.angularErrorY=Ga*this._basis.yX+Ka*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ga*this._basis.zX+Ka*this._basis.zY+La*this._basis.zZ;var gr,ar,Ct;gr=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ar=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gr*this._basis.xX+ar*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle);var _r,Et,St;_r=this._anchor2X-this._anchor1X,Et=this._anchor2Y-this._anchor1Y,St=this._anchor2Z-this._anchor1Z,this.translation=_r*this._basis.xX+Et*this._basis.xY+St*this._basis.xZ,this.linearErrorY=_r*this._basis.yX+Et*this._basis.yY+St*this._basis.yZ,this.linearErrorZ=_r*this._basis.zX+Et*this._basis.zY+St*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};x.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new x.common.Vec3,this.localAnchor2=new x.common.Vec3,this.allowCollision=!1,this.solverType=x.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=x.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(a,t,r){this.rigidBody1=a,this.rigidBody2=t;var i=this.rigidBody1,o,_,s,h=r;o=h.x,_=h.y,s=h.z,o-=i._transform._positionX,_-=i._transform._positionY,s-=i._transform._positionZ;var v,e,l;v=i._transform._rotation00*o+i._transform._rotation10*_+i._transform._rotation20*s,e=i._transform._rotation01*o+i._transform._rotation11*_+i._transform._rotation21*s,l=i._transform._rotation02*o+i._transform._rotation12*_+i._transform._rotation22*s,o=v,_=e,s=l;var u=this.localAnchor1;u.x=o,u.y=_,u.z=s;var b=this.rigidBody2,f,n,c,M=r;f=M.x,n=M.y,c=M.z,f-=b._transform._positionX,n-=b._transform._positionY,c-=b._transform._positionZ;var m,y,V;m=b._transform._rotation00*f+b._transform._rotation10*n+b._transform._rotation20*c,y=b._transform._rotation01*f+b._transform._rotation11*n+b._transform._rotation21*c,V=b._transform._rotation02*f+b._transform._rotation12*n+b._transform._rotation22*c,f=m,n=y,c=V;var z=this.localAnchor2;z.x=f,z.y=n,z.z=c}};x.dynamics.constraint.joint.CylindricalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.translationalLimitMotor=new x.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,r,i){this._init(a,t,r);var o,_,s,h=i;o=h.x,_=h.y,s=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*_+a._transform._rotation20*s,e=a._transform._rotation01*o+a._transform._rotation11*_+a._transform._rotation21*s,l=a._transform._rotation02*o+a._transform._rotation12*_+a._transform._rotation22*s,o=v,_=e,s=l;var u=this.localAxis1;u.x=o,u.y=_,u.z=s;var b,f,n,c=i;b=c.x,f=c.y,n=c.z;var M,m,y;M=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,m=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=M,f=m,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.GenericJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.GENERIC);var t,r=a.localBasis1;if(r.e00*(r.e11*r.e22-r.e12*r.e21)-r.e01*(r.e10*r.e22-r.e12*r.e20)+r.e02*(r.e10*r.e21-r.e11*r.e20)<0)t=!0;else{var i=a.localBasis2;t=i.e00*(i.e11*i.e22-i.e12*i.e21)-i.e01*(i.e10*i.e22-i.e12*i.e20)+i.e02*(i.e10*i.e21-i.e11*i.e20)<0}t&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k=a.localBasis1;o=k.e00,_=k.e01,s=k.e02,h=k.e10,v=k.e11,e=k.e12,l=k.e20,u=k.e21,b=k.e22;var X=a.localBasis2;f=X.e00,n=X.e01,c=X.e02,M=X.e10,m=X.e11,y=X.e12,V=X.e20,z=X.e21,I=X.e22,this._localBasisX1X=o,this._localBasisX1Y=h,this._localBasisX1Z=l,this._localBasisY1X=_,this._localBasisY1Y=v,this._localBasisY1Z=u,this._localBasisZ1X=s,this._localBasisZ1Y=e,this._localBasisZ1Z=b,this._localBasisX2X=f,this._localBasisX2Y=M,this._localBasisX2Z=V,this._localBasisY2X=n,this._localBasisY2Y=m,this._localBasisY2Z=z,this._localBasisZ2X=c,this._localBasisZ2Y=y,this._localBasisZ2Z=I,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1;var L=new Array(3);this._translLms=L;var p=new Array(3);this._translSds=p;var g=new Array(3);this._rotLms=g;var N=new Array(3);this._rotSds=N,this._translLms[0]=a.translationalLimitMotors[0].clone(),this._translLms[1]=a.translationalLimitMotors[1].clone(),this._translLms[2]=a.translationalLimitMotors[2].clone(),this._translSds[0]=a.translationalSpringDampers[0].clone(),this._translSds[1]=a.translationalSpringDampers[1].clone(),this._translSds[2]=a.translationalSpringDampers[2].clone(),this._rotLms[0]=a.rotationalLimitMotors[0].clone(),this._rotLms[1]=a.rotationalLimitMotors[1].clone(),this._rotLms[2]=a.rotationalLimitMotors[2].clone(),this._rotSds[0]=a.rotationalSpringDampers[0].clone(),this._rotSds[1]=a.rotationalSpringDampers[1].clone(),this._rotSds[2]=a.rotationalSpringDampers[2].clone()}getInfo(a,t,r){var i,o,_=1/(this._b1._invMass+this._b2._invMass),s=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),h=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),v=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!r){var e=this._impulses[0],l=a.rows[a.numRows++],u=l.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=e,i=l,this.setSolverInfoRowLinear(i,this.translationX,this._translLms[0],_,this._translSds[0],t,r),o=i.jacobian,o.lin1X=this._basisX1X,o.lin1Y=this._basisX1Y,o.lin1Z=this._basisX1Z,o.lin2X=this._basisX1X,o.lin2Y=this._basisX1Y,o.lin2Z=this._basisX1Z,o.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,o.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,o.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,o.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,o.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,o.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!r){var b=this._impulses[1],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,i=f,this.setSolverInfoRowLinear(i,this.translationY,this._translLms[1],_,this._translSds[1],t,r),o=i.jacobian,o.lin1X=this._basisY1X,o.lin1Y=this._basisY1Y,o.lin1Z=this._basisY1Z,o.lin2X=this._basisY1X,o.lin2Y=this._basisY1Y,o.lin2Z=this._basisY1Z,o.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,o.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,o.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,o.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,o.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,o.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!r){var c=this._impulses[2],M=a.rows[a.numRows++],m=M.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=c,i=M,this.setSolverInfoRowLinear(i,this.translationZ,this._translLms[2],_,this._translSds[2],t,r),o=i.jacobian,o.lin1X=this._basisZ1X,o.lin1Y=this._basisZ1Y,o.lin1Z=this._basisZ1Z,o.lin2X=this._basisZ1X,o.lin2Y=this._basisZ1Y,o.lin2Z=this._basisZ1Z,o.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,o.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,o.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,o.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,o.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,o.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!r)){var y=this._impulses[3],V=a.rows[a.numRows++],z=V.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,i=V,this.setSolverInfoRowAngular(i,this._angleX,this._rotLms[0],s,this._rotSds[0],t,r),o=i.jacobian,o.ang1X=this._axisXX,o.ang1Y=this._axisXY,o.ang1Z=this._axisXZ,o.ang2X=this._axisXX,o.ang2Y=this._axisXY,o.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!r)){var I=this._impulses[4],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,i=k,this.setSolverInfoRowAngular(i,this._angleY,this._rotLms[1],h,this._rotSds[1],t,r),o=i.jacobian,o.ang1X=this._axisYX,o.ang1Y=this._axisYY,o.ang1Z=this._axisYZ,o.ang2X=this._axisYX,o.ang2Y=this._axisYY,o.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!r)){var L=this._impulses[5],p=a.rows[a.numRows++],g=p.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=L,i=p,this.setSolverInfoRowAngular(i,this._angleZ,this._rotLms[2],v,this._rotSds[2],t,r),o=i.jacobian,o.ang1X=this._axisZX,o.ang1Y=this._axisZY,o.ang1Z=this._axisZZ,o.ang2X=this._axisZX,o.ang2Y=this._axisZY,o.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,r,i,o,_,s,h,v;a=this._basisX1X,t=this._basisX1Y,r=this._basisX1Z,s=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,i=h*r-v*t,o=v*a-s*r,_=s*t-h*a,this._axisXX=o*v-_*h,this._axisXY=_*s-i*v,this._axisXZ=i*h-o*s,this._axisYX=i,this._axisYY=o,this._axisYZ=_,this._axisZX=t*_-r*o,this._axisZY=r*i-a*_,this._axisZZ=a*o-t*i;var e=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;e>0&&(e=1/Math.sqrt(e)),this._axisXX*=e,this._axisXY*=e,this._axisXZ*=e;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,M=this._basisY1Y,m=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,z=this._basisZ1Z,I=this._basisX2X,k=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,p=this._basisY2Y,g=this._basisZ2Y,N=this._basisX2Z,A=this._basisY2Z,F=this._basisZ2Z;var S,Y,R,C,d,Z,$,j,E,G,B,Q,U,J;j=b*I+c*L+y*N,E=b*k+c*p+y*A,G=b*X+c*g+y*F,B=f*k+M*p+V*A,Q=f*X+M*g+V*F,U=n*k+m*p+z*A,J=n*X+m*g+z*F,S=j,Y=E,R=G,C=B,d=Q,Z=U,$=J;var D,H,K,ra=R;if(ra<=-1){var sa=Math.atan2(Z,C);D=sa*.5,H=-1.570796326794895,K=-sa*.5}else if(ra>=1){var W=Math.atan2(Z,C);D=W*.5,H=1.570796326794895,K=W*.5}else{var q=Math.asin(ra),na=Math.atan2(-d,$),oa=Math.atan2(-Y,S);D=na,H=q,K=oa}this._angleX=D,this._angleY=H,this._angleZ=K;var aa,T,ca;aa=this._anchor2X-this._anchor1X,T=this._anchor2Y-this._anchor1Y,ca=this._anchor2Z-this._anchor1Z,this.translationX=aa*this._basisX1X+T*this._basisX1Y+ca*this._basisX1Z,this.translationY=aa*this._basisY1X+T*this._basisY1Y+ca*this._basisY1Z,this.translationZ=aa*this._basisZ1X+T*this._basisZ1Y+ca*this._basisZ1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxisX(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxisY(){var a=new x.common.Vec3,t=a;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,a}getAxisZ(){var a=new x.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new x.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new x.common.Vec3(this.translationX,this.translationY,this.translationZ)}};x.dynamics.constraint.joint.GenericJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new x.common.Mat3,this.localBasis2=new x.common.Mat3;var a=[];a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=a;var t=[];t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=t,this.translationalSpringDampers=[new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper]}init(a,t,r,i,o){this._init(a,t,r);var _=a._transform,s=t._transform,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y,R,C,d,Z,$,j,E,G,B,Q,U,J=i;h=J.e00,v=J.e01,e=J.e02,l=J.e10,u=J.e11,b=J.e12,f=J.e20,n=J.e21,c=J.e22;var D=o;M=D.e00,m=D.e01,y=D.e02,V=D.e10,z=D.e11,I=D.e12,k=D.e20,X=D.e21,L=D.e22;var H,K,ra,sa,W,q,na,oa,aa;H=_._rotation00*h+_._rotation10*l+_._rotation20*f,K=_._rotation00*v+_._rotation10*u+_._rotation20*n,ra=_._rotation00*e+_._rotation10*b+_._rotation20*c,sa=_._rotation01*h+_._rotation11*l+_._rotation21*f,W=_._rotation01*v+_._rotation11*u+_._rotation21*n,q=_._rotation01*e+_._rotation11*b+_._rotation21*c,na=_._rotation02*h+_._rotation12*l+_._rotation22*f,oa=_._rotation02*v+_._rotation12*u+_._rotation22*n,aa=_._rotation02*e+_._rotation12*b+_._rotation22*c,p=H,g=K,N=ra,A=sa,F=W,S=q,Y=na,R=oa,C=aa;var T,ca,_a,w,ta,ia,la,va,xa;T=s._rotation00*M+s._rotation10*V+s._rotation20*k,ca=s._rotation00*m+s._rotation10*z+s._rotation20*X,_a=s._rotation00*y+s._rotation10*I+s._rotation20*L,w=s._rotation01*M+s._rotation11*V+s._rotation21*k,ta=s._rotation01*m+s._rotation11*z+s._rotation21*X,ia=s._rotation01*y+s._rotation11*I+s._rotation21*L,la=s._rotation02*M+s._rotation12*V+s._rotation22*k,va=s._rotation02*m+s._rotation12*z+s._rotation22*X,xa=s._rotation02*y+s._rotation12*I+s._rotation22*L,d=T,Z=ca,$=_a,j=w,E=ta,G=ia,B=la,Q=va,U=xa;var Ma=this.localBasis1;Ma.e00=p,Ma.e01=g,Ma.e02=N,Ma.e10=A,Ma.e11=F,Ma.e12=S,Ma.e20=Y,Ma.e21=R,Ma.e22=C;var za=this.localBasis2;return za.e00=d,za.e01=Z,za.e02=$,za.e10=j,za.e11=E,za.e12=G,za.e20=B,za.e21=Q,za.e22=U,this}};x.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};x.dynamics.constraint.joint.JointLink=class{constructor(a){this._joint=a}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.constraint.joint.JointMacro=class{};x.dynamics.constraint.joint.JointType=class{};x.dynamics.constraint.joint.PrismaticJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.PRISMATIC);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromX(),this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o=this.linearErrorY*i,_=this.linearErrorZ*i,s=this.angularErrorX*i,h=this.angularErrorY*i,v=this.angularErrorZ*i,e,l,u=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!r){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,e=f,this.setSolverInfoRowLinear(e,this.translation,this._lm,u,this._sd,t,r),l=e.jacobian,l.lin1X=this._basis.xX,l.lin1Y=this._basis.xY,l.lin1Z=this._basis.xZ,l.lin2X=this._basis.xX,l.lin2Y=this._basis.xY,l.lin2Z=this._basis.xZ,l.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,l.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,l.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,l.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,l.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,l.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],M=a.rows[a.numRows++],m=M.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=c,e=M,e.rhs=o,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.lin1X=this._basis.yX,l.lin1Y=this._basis.yY,l.lin1Z=this._basis.yZ,l.lin2X=this._basis.yX,l.lin2Y=this._basis.yY,l.lin2Z=this._basis.yZ,l.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,l.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,l.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,l.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,l.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,l.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],z=V.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,e=V,e.rhs=_,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.lin1X=this._basis.zX,l.lin1Y=this._basis.zY,l.lin1Z=this._basis.zZ,l.lin2X=this._basis.zX,l.lin2Y=this._basis.zY,l.lin2Z=this._basis.zZ,l.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,l.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,l.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,l.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,l.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,l.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var I=this._impulses[3],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,e=k,e.rhs=s,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=1,l.ang1Y=0,l.ang1Z=0,l.ang2X=1,l.ang2Y=0,l.ang2Z=0;var L=this._impulses[4],p=a.rows[a.numRows++],g=p.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=L,e=p,e.rhs=h,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=0,l.ang1Y=1,l.ang1Z=0,l.ang2X=0,l.ang2Y=1,l.ang2Z=0;var N=this._impulses[5],A=a.rows[a.numRows++],F=A.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=N,e=A,e.rhs=v,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=0,l.ang1Y=0,l.ang1Z=1,l.ang2X=0,l.ang2Y=0,l.ang2Z=1}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,r=a.joint._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y,R,C,d,Z,$,j,E,G=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(G<-.999999999){var B,Q,U,J=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,K=J*J,ra=D*D,sa=H*H,W;K<ra?K<sa?(W=1/Math.sqrt(ra+sa),B=0,Q=H*W,U=-D*W):(W=1/Math.sqrt(K+ra),B=D*W,Q=-J*W,U=0):ra<sa?(W=1/Math.sqrt(sa+K),B=-H*W,Q=0,U=J*W):(W=1/Math.sqrt(K+ra),B=D*W,Q=-J*W,U=0),i=B,o=Q,_=U,s=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+G)*.5);G=.5/aa,q*=G,na*=G,oa*=G,i=q,o=na,_=oa,s=aa}h=0,v=0,e=0,l=1;var T,ca,_a,w,ta,ia,la,va;T=h,ca=v,_a=e,w=l,ta=i,ia=o,la=_,va=s;var xa=T*ta+ca*ia+_a*la+w*va;if(xa<0&&(xa=-xa,ta=-ta,ia=-ia,la=-la,va=-va),xa>.999999){var Ma,za,Xa,Za;Ma=ta-T,za=ia-ca,Xa=la-_a,Za=va-w,ta=T+Ma*(t/(t+r)),ia=ca+za*(t/(t+r)),la=_a+Xa*(t/(t+r)),va=w+Za*(t/(t+r));var fa=ta*ta+ia*ia+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ia*fa,f=la*fa,n=va*fa}else{var ba=t/(t+r)*Math.acos(xa);ta+=T*-xa,ia+=ca*-xa,la+=_a*-xa,va+=w*-xa;var ea=ta*ta+ia*ia+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ia*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),pa=Math.cos(ba);T*=pa,ca*=pa,_a*=pa,w*=pa,u=T+ta*ha,b=ca+ia*ha,f=_a+la*ha,n=w+va*ha}var ya=u,da=b,ma=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*ma,wa=ya*Qa,ka=da*ga,Pa=ma*ua,Mt=ya*ga,Ha=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Fa=Ya*ua;c=1-ka-Pa,M=Mt-Fa,m=Ba+Ea,y=Mt+Fa,V=1-wa-Pa,z=Ha-nt,I=Ba-Ea,k=Ha+nt,X=1-wa-ka;var Aa,ft,Ua;Aa=c*a.joint._basisX1X+M*a.joint._basisX1Y+m*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+z*a.joint._basisX1Z,Ua=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Aa,p=ft,g=Ua,C=a.xX,d=a.xY,Z=a.xZ,$=a.yX,j=a.yY,E=a.yZ;var ja=C*L+d*p+Z*g;if(ja<-.999999999){var bt,rt,$a,_t=C,gt=d,mt=Z,Wa=_t*_t,it=gt*gt,ut=mt*mt,Da;Wa<it?Wa<ut?(Da=1/Math.sqrt(it+ut),bt=0,rt=mt*Da,$a=-gt*Da):(Da=1/Math.sqrt(Wa+it),bt=gt*Da,rt=-_t*Da,$a=0):it<ut?(Da=1/Math.sqrt(ut+Wa),bt=-mt*Da,rt=0,$a=_t*Da):(Da=1/Math.sqrt(Wa+it),bt=gt*Da,rt=-_t*Da,$a=0),u=bt,b=rt,f=$a,n=0}else{var Ta,Na,Vt;Ta=d*g-Z*p,Na=Z*L-C*g,Vt=C*p-d*L;var Pt=Math.sqrt((1+ja)*.5);ja=.5/Pt,Ta*=ja,Na*=ja,Vt*=ja,u=Ta,b=Na,f=Vt,n=Pt}var et=u,Xt=b,Yt=f,zt=n,Ia=2*et,O=2*Xt,Va=2*Yt,lt=et*Ia,P=Xt*O,wt=Yt*Va,Bt=et*O,At=Xt*Va,yt=et*Va,kt=zt*Ia,pt=zt*O,ht=zt*Va;c=1-P-wt,M=Bt-ht,m=yt+pt,y=Bt+ht,V=1-lt-wt,z=At-kt,I=yt-pt,k=At+kt,X=1-lt-P;var xt,Ra,st;if(xt=c*$+M*j+m*E,Ra=y*$+V*j+z*E,st=I*$+k*j+X*E,N=xt,A=Ra,F=st,S=p*F-g*A,Y=g*N-L*F,R=L*A-p*N,S*S+Y*Y+R*R>1e-6){var Ca=S*S+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),S*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=p,at=g,Oa=vt*vt,tt=qa*qa,ct=at*at,Sa;Oa<tt?Oa<ct?(Sa=1/Math.sqrt(tt+ct),S=0,Y=at*Sa,R=-qa*Sa):(Sa=1/Math.sqrt(Oa+tt),S=qa*Sa,Y=-vt*Sa,R=0):tt<ct?(Sa=1/Math.sqrt(ct+Oa),S=-at*Sa,Y=0,R=vt*Sa):(Sa=1/Math.sqrt(Oa+tt),S=qa*Sa,Y=-vt*Sa,R=0)}N=Y*g-R*p,A=R*L-S*g,F=S*p-Y*L,a.xX=L,a.xY=p,a.xZ=g,a.yX=N,a.yY=A,a.yZ=F,a.zX=S,a.zY=Y,a.zZ=R;var Ga,Ka,La,ot,It,or,gr,ar,Ct,_r,Et,St,Gt,jr,vr,lr,tr,Or;Ga=this._basisX1X,Ka=this._basisY1X,La=this._basisZ1X,ot=this._basisX1Y,It=this._basisY1Y,or=this._basisZ1Y,gr=this._basisX1Z,ar=this._basisY1Z,Ct=this._basisZ1Z,_r=this._basisX2X,Et=this._basisY2X,St=this._basisZ2X,Gt=this._basisX2Y,jr=this._basisY2Y,vr=this._basisZ2Y,lr=this._basisX2Z,tr=this._basisY2Z,Or=this._basisZ2Z;var Xr,Mr,Zt,ir,Wt,nr,$r,Ut,Kr,Ir,mi,Wr,Lt,Kt,Tt,br,zr,vi;Ir=_r*Ga+Et*Ka+St*La,mi=_r*ot+Et*It+St*or,Wr=_r*gr+Et*ar+St*Ct,Lt=Gt*Ga+jr*Ka+vr*La,Kt=Gt*ot+jr*It+vr*or,Tt=Gt*gr+jr*ar+vr*Ct,br=lr*Ga+tr*Ka+Or*La,zr=lr*ot+tr*It+Or*or,vi=lr*gr+tr*ar+Or*Ct,Xr=Ir,Mr=mi,Zt=Wr,ir=Lt,Wt=Kt,nr=Tt,$r=br,Ut=zr,Kr=vi;var qt,fr,dt,ur,hr=Xr,ei=Wt,Xi=Kr,io=hr+ei+Xi,Jt;io>0?(Jt=Math.sqrt(io+1),ur=.5*Jt,Jt=.5/Jt,qt=(Ut-nr)*Jt,fr=(Zt-$r)*Jt,dt=(ir-Mr)*Jt):hr>ei?hr>Xi?(Jt=Math.sqrt(hr-ei-Xi+1),qt=.5*Jt,Jt=.5/Jt,fr=(Mr+ir)*Jt,dt=(Zt+$r)*Jt,ur=(Ut-nr)*Jt):(Jt=Math.sqrt(Xi-hr-ei+1),dt=.5*Jt,Jt=.5/Jt,qt=(Zt+$r)*Jt,fr=(nr+Ut)*Jt,ur=(ir-Mr)*Jt):ei>Xi?(Jt=Math.sqrt(ei-Xi-hr+1),fr=.5*Jt,Jt=.5/Jt,qt=(Mr+ir)*Jt,dt=(nr+Ut)*Jt,ur=(Zt-$r)*Jt):(Jt=Math.sqrt(Xi-hr-ei+1),dt=.5*Jt,Jt=.5/Jt,qt=(Zt+$r)*Jt,fr=(nr+Ut)*Jt,ur=(ir-Mr)*Jt);var fi=ur,pi=(fi<=-1?3.14159265358979:fi>=1?0:Math.acos(fi))*2;this.angularErrorX=qt,this.angularErrorY=fr,this.angularErrorZ=dt;var Dt=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Dt>0&&(Dt=1/Math.sqrt(Dt)),this.angularErrorX*=Dt,this.angularErrorY*=Dt,this.angularErrorZ*=Dt,this.angularErrorX*=pi,this.angularErrorY*=pi,this.angularErrorZ*=pi;var di,Sr,Di;di=this._anchor2X-this._anchor1X,Sr=this._anchor2Y-this._anchor1Y,Di=this._anchor2Z-this._anchor1Z,this.translation=di*this._basis.xX+Sr*this._basis.xY+Di*this._basis.xZ,this.linearErrorY=di*this._basis.yX+Sr*this._basis.yY+Di*this._basis.yZ,this.linearErrorZ=di*this._basis.zX+Sr*this._basis.zY+Di*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};x.dynamics.constraint.joint.PrismaticJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.limitMotor=new x.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,r,i){this._init(a,t,r);var o,_,s,h=i;o=h.x,_=h.y,s=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*_+a._transform._rotation20*s,e=a._transform._rotation01*o+a._transform._rotation11*_+a._transform._rotation21*s,l=a._transform._rotation02*o+a._transform._rotation12*_+a._transform._rotation22*s,o=v,_=e,s=l;var u=this.localAxis1;u.x=o,u.y=_,u.z=s;var b,f,n,c=i;b=c.x,f=c.y,n=c.z;var M,m,y;M=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,m=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=M,f=m,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.RagdollJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.RAGDOLL);var t=a.localTwistAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localSwingAxis1;this._localBasisY1X=r.x,this._localBasisY1Y=r.y,this._localBasisY1Z=r.z;var i=a.localTwistAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromXY1X2(),this._twistSd=a.twistSpringDamper.clone(),this._twistLm=a.twistLimitMotor.clone(),this._swingSd=a.swingSpringDamper.clone(),this._maxSwingAngle1=a.maxSwingAngle1,this._maxSwingAngle2=a.maxSwingAngle2,this._maxSwingAngle1<x.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=x.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<x.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=x.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new x.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(a,t,r){var i=this.getErp(t,r),o,_,s;o=this.linearErrorX*i,_=this.linearErrorY*i,s=this.linearErrorZ*i;var h=o,v=_,e=s,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N;l=0,u=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,f=this._relativeAnchor1Z,n=0,c=-this._relativeAnchor1X,M=-this._relativeAnchor1Y,m=this._relativeAnchor1X,y=0,V=0,z=-this._relativeAnchor2Z,I=this._relativeAnchor2Y,k=this._relativeAnchor2Z,X=0,L=-this._relativeAnchor2X,p=-this._relativeAnchor2Y,g=this._relativeAnchor2X,N=0,l=-l,u=-u,b=-b,f=-f,n=-n,c=-c,M=-M,m=-m,y=-y,V=-V,z=-z,I=-I,k=-k,X=-X,L=-L,p=-p,g=-g,N=-N;var A=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),F=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),S=this._impulses[0],Y=a.rows[a.numRows++],R=Y.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=S;var C=Y;C.rhs=h,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0;var d=C.jacobian;d.lin1X=1,d.lin1Y=0,d.lin1Z=0,d.lin2X=1,d.lin2Y=0,d.lin2Z=0,d.ang1X=l,d.ang1Y=u,d.ang1Z=b,d.ang2X=V,d.ang2Y=z,d.ang2Z=I;var Z=this._impulses[1],$=a.rows[a.numRows++],j=$.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=Z,C=$,C.rhs=v,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,d=C.jacobian,d.lin1X=0,d.lin1Y=1,d.lin1Z=0,d.lin2X=0,d.lin2Y=1,d.lin2Z=0,d.ang1X=f,d.ang1Y=n,d.ang1Z=c,d.ang2X=k,d.ang2Y=X,d.ang2Z=L;var E=this._impulses[2],G=a.rows[a.numRows++],B=G.jacobian;if(B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=E,C=G,C.rhs=e,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,d=C.jacobian,d.lin1X=0,d.lin1Y=0,d.lin1Z=1,d.lin2X=0,d.lin2Y=0,d.lin2Z=1,d.ang1X=M,d.ang1Y=m,d.ang1Z=y,d.ang2X=p,d.ang2Y=g,d.ang2Z=N,this.swingError>0&&(this._swingSd.frequency<=0||!r)){var Q=this._impulses[3],U=a.rows[a.numRows++],J=U.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=Q,C=U,this.setSolverInfoRowAngular(C,this.swingError,this.dummySwingLm,A,this._swingSd,t,r),d=C.jacobian,d.ang1X=this.swingAxisX,d.ang1Y=this.swingAxisY,d.ang1Z=this.swingAxisZ,d.ang2X=this.swingAxisX,d.ang2Y=this.swingAxisY,d.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!r){var D=this._impulses[4],H=a.rows[a.numRows++],K=H.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=D,C=H,this.setSolverInfoRowAngular(C,this._twistAngle,this._twistLm,F,this._twistSd,t,r),d=C.jacobian,d.ang1X=this.twistAxisX,d.ang1Y=this.twistAxisY,d.ang1Z=this.twistAxisZ,d.ang2X=this.twistAxisX,d.ang2Y=this.twistAxisY,d.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors(),this._b1._transform,this._b2._transform;var a,t,r,i,o,_;a=this._basisX1X,t=this._basisX1Y,r=this._basisX1Z,i=this._basisX2X,o=this._basisX2Y,_=this._basisX2Z;var s,h,v,e,l,u,b,f,n;s=this._basisX1X,h=this._basisY1X,v=this._basisZ1X,e=this._basisX1Y,l=this._basisY1Y,u=this._basisZ1Y,b=this._basisX1Z,f=this._basisY1Z,n=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y=a*i+t*o+r*_;if(Y<-.999999999){var R,C,d,Z=a,$=t,j=r,E=Z*Z,G=$*$,B=j*j,Q;E<G?E<B?(Q=1/Math.sqrt(G+B),R=0,C=j*Q,d=-$*Q):(Q=1/Math.sqrt(E+G),R=$*Q,C=-Z*Q,d=0):G<B?(Q=1/Math.sqrt(B+E),R=-j*Q,C=0,d=Z*Q):(Q=1/Math.sqrt(E+G),R=$*Q,C=-Z*Q,d=0),c=R,M=C,m=d,y=0}else{var U,J,D;U=t*_-r*o,J=r*i-a*_,D=a*o-t*i;var H=Math.sqrt((1+Y)*.5);Y=.5/H,U*=Y,J*=Y,D*=Y,c=U,M=J,m=D,y=H}var K=c,ra=M,sa=m,W=y,q=2*K,na=2*ra,oa=2*sa,aa=K*q,T=ra*na,ca=sa*oa,_a=K*na,w=ra*oa,ta=K*oa,ia=W*q,la=W*na,va=W*oa;V=1-T-ca,z=_a-va,I=ta+la,k=_a+va,X=1-aa-ca,L=w-ia,p=ta-la,g=w+ia,N=1-aa-T,this._swingAngle=(y<=-1?3.14159265358979:y>=1?0:Math.acos(y))*2,A=c,F=M,S=m;var xa,Ma,za,Xa,Za,fa;Xa=V*this._basisY2X+k*this._basisY2Y+p*this._basisY2Z,Za=z*this._basisY2X+X*this._basisY2Y+g*this._basisY2Z,fa=I*this._basisY2X+L*this._basisY2Y+N*this._basisY2Z,xa=Xa,Ma=Za,za=fa;var ba=this._basisY1X*xa+this._basisY1Y*Ma+this._basisY1Z*za,ea=this._basisZ1X*xa+this._basisZ1Y*Ma+this._basisZ1Z*za;this._twistAngle=Math.atan2(ea,ba),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ha=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ha>0&&(ha=1/Math.sqrt(ha)),this.twistAxisX*=ha,this.twistAxisY*=ha,this.twistAxisZ*=ha;var pa=Math.sqrt(A*A+F*F+S*S);pa>0&&(pa=1/pa),A*=pa*this._swingAngle,F*=pa*this._swingAngle,S*=pa*this._swingAngle;var ya,da,ma;ya=s*A+e*F+b*S,da=h*A+l*F+f*S,ma=v*A+u*F+n*S,A=ya,F=da,S=ma;var Ya=F,Qa=S,ga=this._maxSwingAngle1,ua=this._maxSwingAngle2,wa=1/(ga*ga),ka=1/(ua*ua),Pa=Ya*Ya*wa+Qa*Qa*ka;if(Pa==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var Mt=Math.sqrt(1/Pa),Ha=Ya*Mt,Ba=Qa*Mt,nt=Ha*wa,Ea=Ba*ka;pa=1/Math.sqrt(nt*nt+Ea*Ea),nt*=pa,Ea*=pa;var Fa=(Ya-Ha)*nt+(Qa-Ba)*Ea;if(Fa>0){this.swingError=Fa,this.swingAxisX=0,this.swingAxisY=nt,this.swingAxisZ=Ea;var Aa,ft,Ua;Aa=s*this.swingAxisX+h*this.swingAxisY+v*this.swingAxisZ,ft=e*this.swingAxisX+l*this.swingAxisY+u*this.swingAxisZ,Ua=b*this.swingAxisX+f*this.swingAxisY+n*this.swingAxisZ,this.swingAxisX=Aa,this.swingAxisY=ft,this.swingAxisZ=Ua;var ja,bt,rt;ja=V*this.swingAxisX+z*this.swingAxisY+I*this.swingAxisZ,bt=k*this.swingAxisX+X*this.swingAxisY+L*this.swingAxisZ,rt=p*this.swingAxisX+g*this.swingAxisY+N*this.swingAxisZ,this.swingAxisX=ja,this.swingAxisY=bt,this.swingAxisZ=rt}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){var a=new x.common.Vec3,t=a;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,a}getSwingAxisTo(a){var t=a;t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};x.dynamics.constraint.joint.RagdollJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new x.common.Vec3(1,0,0),this.localTwistAxis2=new x.common.Vec3(1,0,0),this.localSwingAxis1=new x.common.Vec3(0,1,0),this.twistSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(a,t,r,i,o){this._init(a,t,r);var _,s,h,v=i;_=v.x,s=v.y,h=v.z;var e,l,u;e=a._transform._rotation00*_+a._transform._rotation10*s+a._transform._rotation20*h,l=a._transform._rotation01*_+a._transform._rotation11*s+a._transform._rotation21*h,u=a._transform._rotation02*_+a._transform._rotation12*s+a._transform._rotation22*h,_=e,s=l,h=u;var b=this.localTwistAxis1;b.x=_,b.y=s,b.z=h;var f,n,c,M=i;f=M.x,n=M.y,c=M.z;var m,y,V;m=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=m,n=y,c=V;var z=this.localTwistAxis2;z.x=f,z.y=n,z.z=c;var I,k,X,L=o;I=L.x,k=L.y,X=L.z;var p,g,N;p=a._transform._rotation00*I+a._transform._rotation10*k+a._transform._rotation20*X,g=a._transform._rotation01*I+a._transform._rotation11*k+a._transform._rotation21*X,N=a._transform._rotation02*I+a._transform._rotation12*k+a._transform._rotation22*X,I=p,k=g,X=N;var A=this.localSwingAxis1;return A.x=I,A.y=k,A.z=X,this}};x.dynamics.constraint.joint.RevoluteJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,1);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o,_,s;o=this.linearErrorX*i,_=this.linearErrorY*i,s=this.linearErrorZ*i;var h=o,v=_,e=s,l=this.angularErrorY*i,u=this.angularErrorZ*i,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F;b=0,f=-this._relativeAnchor1Z,n=this._relativeAnchor1Y,c=this._relativeAnchor1Z,M=0,m=-this._relativeAnchor1X,y=-this._relativeAnchor1Y,V=this._relativeAnchor1X,z=0,I=0,k=-this._relativeAnchor2Z,X=this._relativeAnchor2Y,L=this._relativeAnchor2Z,p=0,g=-this._relativeAnchor2X,N=-this._relativeAnchor2Y,A=this._relativeAnchor2X,F=0,b=-b,f=-f,n=-n,c=-c,M=-M,m=-m,y=-y,V=-V,z=-z,I=-I,k=-k,X=-X,L=-L,p=-p,g=-g,N=-N,A=-A,F=-F;var S=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),Y=this._impulses[0],R=a.rows[a.numRows++],C=R.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=Y;var d=R;d.rhs=h,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0;var Z=d.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=b,Z.ang1Y=f,Z.ang1Z=n,Z.ang2X=I,Z.ang2Y=k,Z.ang2Z=X;var $=this._impulses[1],j=a.rows[a.numRows++],E=j.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=$,d=j,d.rhs=v,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=c,Z.ang1Y=M,Z.ang1Z=m,Z.ang2X=L,Z.ang2Y=p,Z.ang2Z=g;var G=this._impulses[2],B=a.rows[a.numRows++],Q=B.jacobian;if(Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=G,d=B,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=y,Z.ang1Y=V,Z.ang1Z=z,Z.ang2X=N,Z.ang2Y=A,Z.ang2Z=F,this._sd.frequency<=0||!r){var U=this._impulses[3],J=a.rows[a.numRows++],D=J.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=U,d=J,this.setSolverInfoRowAngular(d,this.angle,this._lm,S,this._sd,t,r),Z=d.jacobian,Z.ang1X=this._basis.xX,Z.ang1Y=this._basis.xY,Z.ang1Z=this._basis.xZ,Z.ang2X=this._basis.xX,Z.ang2Y=this._basis.xY,Z.ang2Z=this._basis.xZ}var H=this._impulses[4],K=a.rows[a.numRows++],ra=K.jacobian;ra.lin1X=0,ra.lin1Y=0,ra.lin1Z=0,ra.lin2X=0,ra.lin2Y=0,ra.lin2Z=0,ra.ang1X=0,ra.ang1Y=0,ra.ang1Z=0,ra.ang2X=0,ra.ang2Y=0,ra.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=H,d=K,d.rhs=l,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._basis.yX,Z.ang1Y=this._basis.yY,Z.ang1Z=this._basis.yZ,Z.ang2X=this._basis.yX,Z.ang2Y=this._basis.yY,Z.ang2Z=this._basis.yZ;var sa=this._impulses[5],W=a.rows[a.numRows++],q=W.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=sa,d=W,d.rhs=u,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._basis.zX,Z.ang1Y=this._basis.zY,Z.ang1Z=this._basis.zZ,Z.ang2X=this._basis.zX,Z.ang2Y=this._basis.zY,Z.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,r=a.joint._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y,R,C,d,Z,$,j,E,G=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(G<-.999999999){var B,Q,U,J=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,K=J*J,ra=D*D,sa=H*H,W;K<ra?K<sa?(W=1/Math.sqrt(ra+sa),B=0,Q=H*W,U=-D*W):(W=1/Math.sqrt(K+ra),B=D*W,Q=-J*W,U=0):ra<sa?(W=1/Math.sqrt(sa+K),B=-H*W,Q=0,U=J*W):(W=1/Math.sqrt(K+ra),B=D*W,Q=-J*W,U=0),i=B,o=Q,_=U,s=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+G)*.5);G=.5/aa,q*=G,na*=G,oa*=G,i=q,o=na,_=oa,s=aa}h=0,v=0,e=0,l=1;var T,ca,_a,w,ta,ia,la,va;T=h,ca=v,_a=e,w=l,ta=i,ia=o,la=_,va=s;var xa=T*ta+ca*ia+_a*la+w*va;if(xa<0&&(xa=-xa,ta=-ta,ia=-ia,la=-la,va=-va),xa>.999999){var Ma,za,Xa,Za;Ma=ta-T,za=ia-ca,Xa=la-_a,Za=va-w,ta=T+Ma*(t/(t+r)),ia=ca+za*(t/(t+r)),la=_a+Xa*(t/(t+r)),va=w+Za*(t/(t+r));var fa=ta*ta+ia*ia+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ia*fa,f=la*fa,n=va*fa}else{var ba=t/(t+r)*Math.acos(xa);ta+=T*-xa,ia+=ca*-xa,la+=_a*-xa,va+=w*-xa;var ea=ta*ta+ia*ia+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ia*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),pa=Math.cos(ba);T*=pa,ca*=pa,_a*=pa,w*=pa,u=T+ta*ha,b=ca+ia*ha,f=_a+la*ha,n=w+va*ha}var ya=u,da=b,ma=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*ma,wa=ya*Qa,ka=da*ga,Pa=ma*ua,Mt=ya*ga,Ha=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Fa=Ya*ua;c=1-ka-Pa,M=Mt-Fa,m=Ba+Ea,y=Mt+Fa,V=1-wa-Pa,z=Ha-nt,I=Ba-Ea,k=Ha+nt,X=1-wa-ka;var Aa,ft,Ua;Aa=c*a.joint._basisX1X+M*a.joint._basisX1Y+m*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+z*a.joint._basisX1Z,Ua=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Aa,p=ft,g=Ua,C=a.xX,d=a.xY,Z=a.xZ,$=a.yX,j=a.yY,E=a.yZ;var ja=C*L+d*p+Z*g;if(ja<-.999999999){var bt,rt,$a,_t=C,gt=d,mt=Z,Wa=_t*_t,it=gt*gt,ut=mt*mt,Da;Wa<it?Wa<ut?(Da=1/Math.sqrt(it+ut),bt=0,rt=mt*Da,$a=-gt*Da):(Da=1/Math.sqrt(Wa+it),bt=gt*Da,rt=-_t*Da,$a=0):it<ut?(Da=1/Math.sqrt(ut+Wa),bt=-mt*Da,rt=0,$a=_t*Da):(Da=1/Math.sqrt(Wa+it),bt=gt*Da,rt=-_t*Da,$a=0),u=bt,b=rt,f=$a,n=0}else{var Ta,Na,Vt;Ta=d*g-Z*p,Na=Z*L-C*g,Vt=C*p-d*L;var Pt=Math.sqrt((1+ja)*.5);ja=.5/Pt,Ta*=ja,Na*=ja,Vt*=ja,u=Ta,b=Na,f=Vt,n=Pt}var et=u,Xt=b,Yt=f,zt=n,Ia=2*et,O=2*Xt,Va=2*Yt,lt=et*Ia,P=Xt*O,wt=Yt*Va,Bt=et*O,At=Xt*Va,yt=et*Va,kt=zt*Ia,pt=zt*O,ht=zt*Va;c=1-P-wt,M=Bt-ht,m=yt+pt,y=Bt+ht,V=1-lt-wt,z=At-kt,I=yt-pt,k=At+kt,X=1-lt-P;var xt,Ra,st;if(xt=c*$+M*j+m*E,Ra=y*$+V*j+z*E,st=I*$+k*j+X*E,N=xt,A=Ra,F=st,S=p*F-g*A,Y=g*N-L*F,R=L*A-p*N,S*S+Y*Y+R*R>1e-6){var Ca=S*S+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),S*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=p,at=g,Oa=vt*vt,tt=qa*qa,ct=at*at,Sa;Oa<tt?Oa<ct?(Sa=1/Math.sqrt(tt+ct),S=0,Y=at*Sa,R=-qa*Sa):(Sa=1/Math.sqrt(Oa+tt),S=qa*Sa,Y=-vt*Sa,R=0):tt<ct?(Sa=1/Math.sqrt(ct+Oa),S=-at*Sa,Y=0,R=vt*Sa):(Sa=1/Math.sqrt(Oa+tt),S=qa*Sa,Y=-vt*Sa,R=0)}N=Y*g-R*p,A=R*L-S*g,F=S*p-Y*L,a.xX=L,a.xY=p,a.xZ=g,a.yX=N,a.yY=A,a.yZ=F,a.zX=S,a.zY=Y,a.zZ=R;var Ga,Ka,La;Ga=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ka=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),or=Ga*Ga+Ka*Ka+La*La;or>0&&(or=1/Math.sqrt(or)),Ga*=or,Ka*=or,La*=or,Ga*=It,Ka*=It,La*=It,this.angularErrorY=Ga*this._basis.yX+Ka*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ga*this._basis.zX+Ka*this._basis.zY+La*this._basis.zZ;var gr,ar,Ct;gr=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ar=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gr*this._basis.xX+ar*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};x.dynamics.constraint.joint.RevoluteJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.springDamper=new x.dynamics.constraint.joint.SpringDamper,this.limitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,r,i){this._init(a,t,r);var o,_,s,h=i;o=h.x,_=h.y,s=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*_+a._transform._rotation20*s,e=a._transform._rotation01*o+a._transform._rotation11*_+a._transform._rotation21*s,l=a._transform._rotation02*o+a._transform._rotation12*_+a._transform._rotation22*s,o=v,_=e,s=l;var u=this.localAxis1;u.x=o,u.y=_,u.z=s;var b,f,n,c=i;b=c.x,f=c.y,n=c.z;var M,m,y;M=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,m=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=M,f=m,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorTorque=t,this}clone(){var a=new x.dynamics.constraint.joint.RotationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorTorque=this.motorTorque,a}};x.dynamics.constraint.joint.SphericalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,0),this._sd=a.springDamper.clone()}getInfo(a,t,r){if(!(this._sd.frequency>0&&r)){var i,o,_;i=this._anchor2X-this._anchor1X,o=this._anchor2Y-this._anchor1Y,_=this._anchor2Z-this._anchor1Z;var s,h;if(this._sd.frequency>0){var v=6.28318530717958*this._sd.frequency,e=this._sd.dampingRatio;e<x.common.Setting.minSpringDamperDampingRatio&&(e=x.common.Setting.minSpringDamperDampingRatio);var l=t.dt,u=2*e*v,b=v*v;this._sd.useSymplecticEuler?(s=1/(l*u),h=b/u):(s=1/(l*(l*b+u)),h=b/(l*b+u)),s*=this._b1._invMass+this._b2._invMass}else s=0,h=this.getErp(t,r);var f,n,c;f=i*h,n=o*h,c=_*h;var M=f,m=n,y=c,V,z,I,k,X,L,p,g,N,A,F,S,Y,R,C,d,Z,$;V=0,z=-this._relativeAnchor1Z,I=this._relativeAnchor1Y,k=this._relativeAnchor1Z,X=0,L=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,g=this._relativeAnchor1X,N=0,A=0,F=-this._relativeAnchor2Z,S=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,R=0,C=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,Z=this._relativeAnchor2X,$=0,V=-V,z=-z,I=-I,k=-k,X=-X,L=-L,p=-p,g=-g,N=-N,A=-A,F=-F,S=-S,Y=-Y,R=-R,C=-C,d=-d,Z=-Z,$=-$;var j=this._impulses[0],E=a.rows[a.numRows++],G=E.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=j;var B=E;B.rhs=M,B.cfm=s,B.minImpulse=-1/0,B.maxImpulse=1/0;var Q=B.jacobian;Q.lin1X=1,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=1,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=V,Q.ang1Y=z,Q.ang1Z=I,Q.ang2X=A,Q.ang2Y=F,Q.ang2Z=S;var U=this._impulses[1],J=a.rows[a.numRows++],D=J.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=U,B=J,B.rhs=m,B.cfm=s,B.minImpulse=-1/0,B.maxImpulse=1/0,Q=B.jacobian,Q.lin1X=0,Q.lin1Y=1,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=1,Q.lin2Z=0,Q.ang1X=k,Q.ang1Y=X,Q.ang1Z=L,Q.ang2X=Y,Q.ang2Y=R,Q.ang2Z=C;var H=this._impulses[2],K=a.rows[a.numRows++],ra=K.jacobian;ra.lin1X=0,ra.lin1Y=0,ra.lin1Z=0,ra.lin2X=0,ra.lin2Y=0,ra.lin2Z=0,ra.ang1X=0,ra.ang1Y=0,ra.ang1Z=0,ra.ang2X=0,ra.ang2Y=0,ra.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=H,B=K,B.rhs=y,B.cfm=s,B.minImpulse=-1/0,B.maxImpulse=1/0,Q=B.jacobian,Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=1,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=1,Q.ang1X=p,Q.ang1Y=g,Q.ang1Z=N,Q.ang2X=d,Q.ang2Y=Z,Q.ang2Z=$}}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getSpringDamper(){return this._sd}};x.dynamics.constraint.joint.SphericalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,r){return this._init(a,t,r),this}};x.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(a,t){return this.frequency=a,this.dampingRatio=t,this}setSymplecticEuler(a){return this.useSymplecticEuler=a,this}clone(){var a=new x.dynamics.constraint.joint.SpringDamper;return a.frequency=this.frequency,a.dampingRatio=this.dampingRatio,a.useSymplecticEuler=this.useSymplecticEuler,a}};x.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorForce=t,this}clone(){var a=new x.dynamics.constraint.joint.TranslationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorForce=this.motorForce,a}};x.dynamics.constraint.joint.UniversalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.UNIVERSAL);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisZ2X=r.x,this._localBasisZ2Y=r.y,this._localBasisZ2Z=r.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=a.springDamper1.clone(),this._sd2=a.springDamper2.clone(),this._lm1=a.limitMotor1.clone(),this._lm2=a.limitMotor2.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o,_,s;o=this.linearErrorX*i,_=this.linearErrorY*i,s=this.linearErrorZ*i;var h=o,v=_,e=s,l=this._angleY*i,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A;u=0,b=-this._relativeAnchor1Z,f=this._relativeAnchor1Y,n=this._relativeAnchor1Z,c=0,M=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,y=this._relativeAnchor1X,V=0,z=0,I=-this._relativeAnchor2Z,k=this._relativeAnchor2Y,X=this._relativeAnchor2Z,L=0,p=-this._relativeAnchor2X,g=-this._relativeAnchor2Y,N=this._relativeAnchor2X,A=0,u=-u,b=-b,f=-f,n=-n,c=-c,M=-M,m=-m,y=-y,V=-V,z=-z,I=-I,k=-k,X=-X,L=-L,p=-p,g=-g,N=-N,A=-A;var F=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),S=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),Y=this._impulses[0],R=a.rows[a.numRows++],C=R.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=Y;var d=R;d.rhs=h,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0;var Z=d.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=u,Z.ang1Y=b,Z.ang1Z=f,Z.ang2X=z,Z.ang2Y=I,Z.ang2Z=k;var $=this._impulses[1],j=a.rows[a.numRows++],E=j.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=$,d=j,d.rhs=v,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=n,Z.ang1Y=c,Z.ang1Z=M,Z.ang2X=X,Z.ang2Y=L,Z.ang2Z=p;var G=this._impulses[2],B=a.rows[a.numRows++],Q=B.jacobian;if(Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=G,d=B,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=m,Z.ang1Y=y,Z.ang1Z=V,Z.ang2X=g,Z.ang2Y=N,Z.ang2Z=A,!this.xSingular&&(this._sd1.frequency<=0||!r)){var U=this._impulses[3],J=a.rows[a.numRows++],D=J.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=U,d=J,this.setSolverInfoRowAngular(d,this._angleX,this._lm1,F,this._sd1,t,r),Z=d.jacobian,Z.ang1X=this._axisXX,Z.ang1Y=this._axisXY,Z.ang1Z=this._axisXZ,Z.ang2X=this._axisXX,Z.ang2Y=this._axisXY,Z.ang2Z=this._axisXZ}if(!this.ySingular){var H=this._impulses[4],K=a.rows[a.numRows++],ra=K.jacobian;ra.lin1X=0,ra.lin1Y=0,ra.lin1Z=0,ra.lin2X=0,ra.lin2Y=0,ra.lin2Z=0,ra.ang1X=0,ra.ang1Y=0,ra.ang1Z=0,ra.ang2X=0,ra.ang2Y=0,ra.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=H,d=K,d.rhs=l,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._axisYX,Z.ang1Y=this._axisYY,Z.ang1Z=this._axisYZ,Z.ang2X=this._axisYX,Z.ang2Y=this._axisYY,Z.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!r)){var sa=this._impulses[5],W=a.rows[a.numRows++],q=W.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=sa,d=W,this.setSolverInfoRowAngular(d,this._angleZ,this._lm2,S,this._sd2,t,r),Z=d.jacobian,Z.ang1X=this._axisZX,Z.ang1Y=this._axisZY,Z.ang1Z=this._axisZZ,Z.ang2X=this._axisZX,Z.ang2Y=this._axisZY,Z.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,r,i,o,_,s,h,v;a=this._basisX1X,t=this._basisX1Y,r=this._basisX1Z,s=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,i=h*r-v*t,o=v*a-s*r,_=s*t-h*a,this._axisXX=o*v-_*h,this._axisXY=_*s-i*v,this._axisXZ=i*h-o*s,this._axisYX=i,this._axisYY=o,this._axisYZ=_,this._axisZX=t*_-r*o,this._axisZY=r*i-a*_,this._axisZZ=a*o-t*i;var e=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;e>0&&(e=1/Math.sqrt(e)),this._axisXX*=e,this._axisXY*=e,this._axisXZ*=e;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,M=this._basisY1Y,m=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,z=this._basisZ1Z,I=this._basisX2X,k=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,p=this._basisY2Y,g=this._basisZ2Y,N=this._basisX2Z,A=this._basisY2Z,F=this._basisZ2Z;var S,Y,R,C,d,Z,$,j,E,G,B,Q,U,J;j=b*I+c*L+y*N,E=b*k+c*p+y*A,G=b*X+c*g+y*F,B=f*k+M*p+V*A,Q=f*X+M*g+V*F,U=n*k+m*p+z*A,J=n*X+m*g+z*F,S=j,Y=E,R=G,C=B,d=Q,Z=U,$=J;var D,H,K,ra=R;if(ra<=-1){var sa=Math.atan2(Z,C);D=sa*.5,H=-1.570796326794895,K=-sa*.5}else if(ra>=1){var W=Math.atan2(Z,C);D=W*.5,H=1.570796326794895,K=W*.5}else{var q=Math.asin(ra),na=Math.atan2(-d,$),oa=Math.atan2(-Y,S);D=na,H=q,K=oa}this._angleX=D,this._angleY=H,this._angleZ=K,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};x.dynamics.constraint.joint.UniversalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.springDamper1=new x.dynamics.constraint.joint.SpringDamper,this.springDamper2=new x.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new x.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new x.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,r,i,o){this._init(a,t,r);var _,s,h,v=i;_=v.x,s=v.y,h=v.z;var e,l,u;e=a._transform._rotation00*_+a._transform._rotation10*s+a._transform._rotation20*h,l=a._transform._rotation01*_+a._transform._rotation11*s+a._transform._rotation21*h,u=a._transform._rotation02*_+a._transform._rotation12*s+a._transform._rotation22*h,_=e,s=l,h=u;var b=this.localAxis1;b.x=_,b.y=s,b.z=h;var f,n,c,M=o;f=M.x,n=M.y,c=M.z;var m,y,V;m=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=m,n=y,c=V;var z=this.localAxis2;return z.x=f,z.y=n,z.z=c,this}};x.dynamics.constraint.solver||(x.dynamics.constraint.solver={});x.dynamics.constraint.solver.ConstraintSolverType=class{};x.dynamics.constraint.solver.common||(x.dynamics.constraint.solver.common={});x.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};x.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};x.dynamics.constraint.solver.direct||(x.dynamics.constraint.solver.direct={});x.dynamics.constraint.solver.direct.Boundary=class{constructor(a){var t=new Array(a);this.iBounded=t;var r=new Array(a);this.iUnbounded=r;var i=new Array(a);this.signs=i;var o=new Array(a);this.b=o,this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(a){this.numBounded=a.numBounded;for(var t=0,r=this.numBounded;t<r;){var i=t++;this.iBounded[i]=a.iBounded[i],this.signs[i]=a.signs[i]}this.numUnbounded=a.numUnbounded,this.matrixId=0;for(var o=0,_=this.numUnbounded;o<_;){var s=o++,h=a.iUnbounded[s];this.iUnbounded[s]=h,this.matrixId|=1<<h}}computeImpulses(a,t,r,i,o,_,s){for(var h=0,v=this.numUnbounded;h<v;){var e=h++,l=this.iUnbounded[e],u=a.rows[l],b=r[l];this.b[l]=u.rhs*_-b-u.cfm*i[l]}for(var f=t._invMassWithoutCfm,n=0,c=this.numBounded;n<c;){var M=n++,m=this.iBounded[M],y=this.signs[M],V=a.rows[m],z=i[m],I=y<0?V.minImpulse:y>0?V.maxImpulse:0,k=I-z;if(o[m]=k,k!=0)for(var X=0,L=this.numUnbounded;X<L;){var p=X++,g=this.iUnbounded[p],N=f[m][g]*k,A=g,F=this.b;F[A]=F[A]-N}}for(var S=this.iUnbounded,Y=this.numUnbounded,R=0,C=0,d=Y;C<d;){var Z=C++;R|=1<<S[Z]}var $;t._cacheComputed[R]||(t.computeSubmatrix(R,S,Y),t._cacheComputed[R]=!0),$=t._cachedSubmatrices[R];for(var j=!0,E=0,G=this.numUnbounded;E<G;){for(var B=E++,Q=this.iUnbounded[B],U=a.rows[Q],J=i[Q],D=J,H=0,K=this.numUnbounded;H<K;){var ra=H++,sa=this.iUnbounded[ra];D+=this.b[sa]*$[B][ra]}if(D<U.minImpulse-x.common.Setting.directMlcpSolverEps||D>U.maxImpulse+x.common.Setting.directMlcpSolverEps){j=!1;break}o[Q]=D-J}if(s)return!0;if(!j)return!1;for(var W=0,q=this.numBounded;W<q;){for(var na=W++,oa=this.iBounded[na],aa=a.rows[oa],T=this.signs[na],ca=0,_a=i[oa]+o[oa],w=r[oa],ta=0,ia=a.numRows;ta<ia;){var la=ta++;w+=f[oa][la]*o[la]}if(ca=aa.rhs*_-w-aa.cfm*_a,T<0&&ca>x.common.Setting.directMlcpSolverEps||T>0&&ca<-x.common.Setting.directMlcpSolverEps){j=!1;break}}return j}};x.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(a){this.size=a,this.numBounded=0;var t=new Array(a);this.iBounded=t;var r=new Array(a);this.signs=r,this.numUnbounded=0;var i=new Array(a);this.iUnbounded=i}};x.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(a){this.maxRows=a,this.numBoundaries=0;var t=new Array(1<<a);this.boundaries=t,this.bbInfo=new x.dynamics.constraint.solver.direct.BoundaryBuildInfo(a)}buildBoundariesRecursive(a,t){if(t==a.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new x.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}var r=a.rows[t],i=r.minImpulse>-1/0,o=r.maxImpulse<1/0,_=r.minImpulse==0&&r.maxImpulse==0;if(_){var s=this.bbInfo;s.iBounded[s.numBounded]=t,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--;return}var h=this.bbInfo;if(h.iUnbounded[h.numUnbounded]=t,h.numUnbounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numUnbounded--,i){var v=this.bbInfo;v.iBounded[v.numBounded]=t,v.signs[v.numBounded]=-1,v.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}if(o){var e=this.bbInfo;e.iBounded[e.numBounded]=t,e.signs[e.numBounded]=1,e.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}}buildBoundaries(a){this.numBoundaries=0;var t=this.bbInfo;t.numBounded=0,t.numUnbounded=0,this.buildBoundariesRecursive(a,0)}};x.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(a){this.n=a;var t=new Array(a);this.indices=t;var r=new Array(a);this.tmpIndices=r;for(var i=0,o=a;i<o;){var _=i++;this.indices[_]=_}}getIndex(a){return this.indices[a]}select(a){for(var t=0;this.indices[t]!=a;)++t;for(;t>0;){var r=this.indices[t];this.indices[t]=this.indices[t-1],this.indices[t-1]=r,--t}}setSize(a){for(var t=0,r=0,i=0,o=this.n;i<o;){var _=i++,s=this.indices[_];s<a?(this.tmpIndices[t]=s,++t):(this.tmpIndices[a+r]=s,++r)}var h=this.indices;this.indices=this.tmpIndices,this.tmpIndices=h}};x.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new x.dynamics.constraint.info.joint.JointSolverInfo;var t=x.common.Setting.maxJacobianRows;this.massMatrix=new x.dynamics.constraint.solver.direct.MassMatrix(t),this.boundaryBuilder=new x.dynamics.constraint.solver.direct.BoundaryBuilder(t);var r=new Array(t);this.massData=r;for(var i=0,o=this.massData.length;i<o;){var _=i++;this.massData[_]=new x.dynamics.constraint.solver.common.JointSolverMassDataRow}var s=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new x.dynamics.constraint.solver.direct.BoundarySelector(s),this.posBoundarySelector=new x.dynamics.constraint.solver.direct.BoundarySelector(s);var h=new Array(t);this.relVels=h;var v=new Array(t);this.impulses=v;var e=new Array(t);this.dImpulses=e;var l=new Array(t);this.dTotalImpulses=l;for(var u=0,b=t;u<b;){var f=u++;this.relVels[f]=0,this.impulses[f]=0,this.dImpulses[f]=0,this.dTotalImpulses[f]=0}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var r=t.bbInfo;r.numBounded=0,r.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var i=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,_=0,s=0,h=0,v=i.n;h<v;){var e=h++,l=i.indices[e];l<o?(i.tmpIndices[_]=l,++_):(i.tmpIndices[o+s]=l,++s)}var u=i.indices;i.indices=i.tmpIndices,i.tmpIndices=u}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?x.common.Setting.jointWarmStartingFactorForBaungarte:x.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var r=0,i=this.info.numRows;r<i;){var o=r++,_=this.info.rows[o],s=_.impulse;s.impulse=0,s.impulseM=0,s.impulseP=0}return}for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=u.impulse*t;if(b<l.minImpulse?b=l.minImpulse:b>l.maxImpulse&&(b=l.maxImpulse),u.impulse=b,l.motorMaxImpulse>0){var f=u.impulseM*t,n=l.motorMaxImpulse;f<-n?f=-n:f>n&&(f=n),u.impulseM=f}else u.impulseM=0;this.dImpulses[e]=u.impulse+u.impulseM}var c=this.dImpulses,M=!1,m=!1,y,V,z,I,k,X,L,p,g,N,A,F;y=this._b1._velX,V=this._b1._velY,z=this._b1._velZ,I=this._b2._velX,k=this._b2._velY,X=this._b2._velZ,L=this._b1._angVelX,p=this._b1._angVelY,g=this._b1._angVelZ,N=this._b2._angVelX,A=this._b2._angVelY,F=this._b2._angVelZ;for(var S=0,Y=this.info.numRows;S<Y;){var R=S++,C=this.info.rows[R],d=C.jacobian,Z=this.massData[R],$=c[R];d.flag&1&&(y+=Z.invMLin1X*$,V+=Z.invMLin1Y*$,z+=Z.invMLin1Z*$,I+=Z.invMLin2X*-$,k+=Z.invMLin2Y*-$,X+=Z.invMLin2Z*-$,M=!0),d.flag&2&&(L+=Z.invMAng1X*$,p+=Z.invMAng1Y*$,g+=Z.invMAng1Z*$,N+=Z.invMAng2X*-$,A+=Z.invMAng2Y*-$,F+=Z.invMAng2Z*-$,m=!0)}M&&(this._b1._velX=y,this._b1._velY=V,this._b1._velZ=z,this._b2._velX=I,this._b2._velY=k,this._b2._velZ=X),m&&(this._b1._angVelX=L,this._b1._angVelY=p,this._b1._angVelZ=g,this._b2._angVelX=N,this._b2._angVelY=A,this._b2._angVelZ=F)}solveVelocity(){var a=this.info.numRows,t,r,i,o,_,s,h,v,e,l,u,b;t=this._b1._velX,r=this._b1._velY,i=this._b1._velZ,o=this._b2._velX,_=this._b2._velY,s=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,e=this._b1._angVelZ,l=this._b2._angVelX,u=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=a;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse,y=M.jacobian,V=0;V+=t*y.lin1X+r*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+_*y.lin2Y+s*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+e*y.ang1Z,V-=l*y.ang2X+u*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=m.impulse,this.dTotalImpulses[c]=0}for(var z=this.massMatrix._invMassWithoutCfm,I=0,k=a;I<k;){var X=I++,L=this.info.rows[X],p=L.impulse,g=this.massData[X];if(L.motorMaxImpulse>0){var N=p.impulseM,A=N+g.massWithoutCfm*(-L.motorSpeed-this.relVels[X]),F=L.motorMaxImpulse;A<-F?A=-F:A>F&&(A=F),p.impulseM=A;var S=A-N;this.dTotalImpulses[X]=S;for(var Y=0,R=a;Y<R;){var C=Y++,d=C,Z=this.relVels;Z[d]=Z[d]+S*z[X][C]}}}for(var $=!1,j=0,E=this.boundaryBuilder.numBoundaries;j<E;){var G=j++,B=this.velBoundarySelector.indices[G],Q=this.boundaryBuilder.boundaries[B];if(Q.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var U=0,J=a;U<J;){var D=U++,H=this.info.rows[D],K=H.impulse,ra=this.dImpulses[D];K.impulse+=ra;var sa=D,W=this.dTotalImpulses;W[sa]=W[sa]+ra}var q=this.dTotalImpulses,na=!1,oa=!1,aa,T,ca,_a,w,ta,ia,la,va,xa,Ma,za;aa=this._b1._velX,T=this._b1._velY,ca=this._b1._velZ,_a=this._b2._velX,w=this._b2._velY,ta=this._b2._velZ,ia=this._b1._angVelX,la=this._b1._angVelY,va=this._b1._angVelZ,xa=this._b2._angVelX,Ma=this._b2._angVelY,za=this._b2._angVelZ;for(var Xa=0,Za=this.info.numRows;Xa<Za;){var fa=Xa++,ba=this.info.rows[fa],ea=ba.jacobian,ha=this.massData[fa],pa=q[fa];ea.flag&1&&(aa+=ha.invMLin1X*pa,T+=ha.invMLin1Y*pa,ca+=ha.invMLin1Z*pa,_a+=ha.invMLin2X*-pa,w+=ha.invMLin2Y*-pa,ta+=ha.invMLin2Z*-pa,na=!0),ea.flag&2&&(ia+=ha.invMAng1X*pa,la+=ha.invMAng1Y*pa,va+=ha.invMAng1Z*pa,xa+=ha.invMAng2X*-pa,Ma+=ha.invMAng2Y*-pa,za+=ha.invMAng2Z*-pa,oa=!0)}na&&(this._b1._velX=aa,this._b1._velY=T,this._b1._velZ=ca,this._b2._velX=_a,this._b2._velY=w,this._b2._velZ=ta),oa&&(this._b1._angVelX=ia,this._b1._angVelY=la,this._b1._angVelZ=va,this._b2._angVelX=xa,this._b2._angVelY=Ma,this._b2._angVelZ=za);for(var ya=this.velBoundarySelector,da=0;ya.indices[da]!=B;)++da;for(;da>0;){var ma=ya.indices[da];ya.indices[da]=ya.indices[da-1],ya.indices[da-1]=ma,--da}$=!0;break}}if(!$){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(a){var t,r,i,o,_,s;t=0,r=0,i=0,o=0,_=0,s=0;for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*u.impulse,r+=b.lin1Y*u.impulse,i+=b.lin1Z*u.impulse):b.flag&2&&(o+=b.ang1X*u.impulse,_+=b.ang1Y*u.impulse,s+=b.ang1Z*u.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=r*a.invDt,this.joint._appliedForceZ=i*a.invDt,this.joint._appliedTorqueX=o*a.invDt,this.joint._appliedTorqueY=_*a.invDt,this.joint._appliedTorqueZ=s*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var r=t.bbInfo;r.numBounded=0,r.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var i=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,_=0,s=0,h=0,v=i.n;h<v;){var e=h++,l=i.indices[e];l<o?(i.tmpIndices[_]=l,++_):(i.tmpIndices[o+s]=l,++s)}var u=i.indices;i.indices=i.tmpIndices,i.tmpIndices=u;for(var b=0,f=this.info.numRows;b<f;){var n=b++;this.info.rows[n].impulse.impulseP=0}}solvePositionSplitImpulse(){var a=this.info.numRows,t,r,i,o,_,s,h,v,e,l,u,b;t=this._b1._pseudoVelX,r=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,_=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,h=this._b1._angPseudoVelX,v=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,u=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;for(var f=0,n=a;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse,y=M.jacobian,V=0;V+=t*y.lin1X+r*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+_*y.lin2Y+s*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+e*y.ang1Z,V-=l*y.ang2X+u*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=m.impulseP}for(var z=!1,I=0,k=this.boundaryBuilder.numBoundaries;I<k;){var X=I++,L=this.posBoundarySelector.indices[X],p=this.boundaryBuilder.boundaries[L];if(p.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,x.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var g=0,N=a;g<N;){var A=g++,F=this.info.rows[A],S=F.impulse,Y=this.dImpulses[A];S.impulseP+=Y}var R=this.dImpulses,C=!1,d=!1,Z,$,j,E,G,B,Q,U,J,D,H,K;Z=this._b1._pseudoVelX,$=this._b1._pseudoVelY,j=this._b1._pseudoVelZ,E=this._b2._pseudoVelX,G=this._b2._pseudoVelY,B=this._b2._pseudoVelZ,Q=this._b1._angPseudoVelX,U=this._b1._angPseudoVelY,J=this._b1._angPseudoVelZ,D=this._b2._angPseudoVelX,H=this._b2._angPseudoVelY,K=this._b2._angPseudoVelZ;for(var ra=0,sa=this.info.numRows;ra<sa;){var W=ra++,q=this.info.rows[W],na=q.jacobian,oa=this.massData[W],aa=R[W];na.flag&1&&(Z+=oa.invMLin1X*aa,$+=oa.invMLin1Y*aa,j+=oa.invMLin1Z*aa,E+=oa.invMLin2X*-aa,G+=oa.invMLin2Y*-aa,B+=oa.invMLin2Z*-aa,C=!0),na.flag&2&&(Q+=oa.invMAng1X*aa,U+=oa.invMAng1Y*aa,J+=oa.invMAng1Z*aa,D+=oa.invMAng2X*-aa,H+=oa.invMAng2Y*-aa,K+=oa.invMAng2Z*-aa,d=!0)}C&&(this._b1._pseudoVelX=Z,this._b1._pseudoVelY=$,this._b1._pseudoVelZ=j,this._b2._pseudoVelX=E,this._b2._pseudoVelY=G,this._b2._pseudoVelZ=B),d&&(this._b1._angPseudoVelX=Q,this._b1._angPseudoVelY=U,this._b1._angPseudoVelZ=J,this._b2._angPseudoVelX=D,this._b2._angPseudoVelY=H,this._b2._angPseudoVelZ=K);for(var T=this.posBoundarySelector,ca=0;T.indices[ca]!=L;)++ca;for(;ca>0;){var _a=T.indices[ca];T.indices[ca]=T.indices[ca-1],T.indices[ca-1]=_a,--ca}z=!0;break}}if(!z){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var r=t.bbInfo;r.numBounded=0,r.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var i=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,_=0,s=0,h=0,v=i.n;h<v;){var e=h++,l=i.indices[e];l<o?(i.tmpIndices[_]=l,++_):(i.tmpIndices[o+s]=l,++s)}var u=i.indices;i.indices=i.tmpIndices,i.tmpIndices=u;for(var b=this.info.numRows,f=0,n=b;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse;M.jacobian,this.relVels[c]=0,this.impulses[c]=m.impulseP}for(var y=!1,V=0,z=this.boundaryBuilder.numBoundaries;V<z;){var I=V++,k=this.posBoundarySelector.indices[I],X=this.boundaryBuilder.boundaries[k];if(X.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,x.common.Setting.positionNgsBaumgarte,!1)){for(var L=0,p=b;L<p;){var g=L++,N=this.info.rows[g],A=N.impulse,F=this.dImpulses[g];A.impulseP+=F}var S=this.dImpulses,Y=!1,R=!1,C,d,Z,$,j,E,G,B,Q,U,J,D;C=0,d=0,Z=0,$=0,j=0,E=0,G=0,B=0,Q=0,U=0,J=0,D=0;for(var H=0,K=this.info.numRows;H<K;){var ra=H++,sa=this.info.rows[ra],W=sa.jacobian,q=this.massData[ra],na=S[ra];W.flag&1&&(C+=q.invMLin1X*na,d+=q.invMLin1Y*na,Z+=q.invMLin1Z*na,$+=q.invMLin2X*-na,j+=q.invMLin2Y*-na,E+=q.invMLin2Z*-na,Y=!0),W.flag&2&&(G+=q.invMAng1X*na,B+=q.invMAng1Y*na,Q+=q.invMAng1Z*na,U+=q.invMAng2X*-na,J+=q.invMAng2Y*-na,D+=q.invMAng2Z*-na,R=!0)}if(Y){var oa=this._b1;oa._transform._positionX+=C,oa._transform._positionY+=d,oa._transform._positionZ+=Z;var aa=this._b2;aa._transform._positionX+=$,aa._transform._positionY+=j,aa._transform._positionZ+=E}if(R){var T=this._b1,ca=Math.sqrt(G*G+B*B+Q*Q),_a=ca*.5,w,ta;if(_a<.5){var ia=_a*_a;w=.5*(1-ia*.16666666666666666+ia*ia*.008333333333333333),ta=1-ia*.5+ia*ia*.041666666666666664}else w=Math.sin(_a)/ca,ta=Math.cos(_a);var la,va,xa;la=G*w,va=B*w,xa=Q*w;var Ma,za,Xa,Za;Ma=la,za=va,Xa=xa,Za=ta;var fa,ba,ea,ha,pa=T._transform._rotation00,ya=T._transform._rotation11,da=T._transform._rotation22,ma=pa+ya+da,Ya;ma>0?(Ya=Math.sqrt(ma+1),ha=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation21-T._transform._rotation12)*Ya,ba=(T._transform._rotation02-T._transform._rotation20)*Ya,ea=(T._transform._rotation10-T._transform._rotation01)*Ya):pa>ya?pa>da?(Ya=Math.sqrt(pa-ya-da+1),fa=.5*Ya,Ya=.5/Ya,ba=(T._transform._rotation01+T._transform._rotation10)*Ya,ea=(T._transform._rotation02+T._transform._rotation20)*Ya,ha=(T._transform._rotation21-T._transform._rotation12)*Ya):(Ya=Math.sqrt(da-pa-ya+1),ea=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya):ya>da?(Ya=Math.sqrt(ya-da-pa+1),ba=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation01+T._transform._rotation10)*Ya,ea=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation02-T._transform._rotation20)*Ya):(Ya=Math.sqrt(da-pa-ya+1),ea=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya),fa=Za*fa+Ma*ha+za*ea-Xa*ba,ba=Za*ba-Ma*ea+za*ha+Xa*fa,ea=Za*ea+Ma*ba-za*fa+Xa*ha,ha=Za*ha-Ma*fa-za*ba-Xa*ea;var Qa=fa*fa+ba*ba+ea*ea+ha*ha;Qa>1e-32&&(Qa=1/Math.sqrt(Qa)),fa*=Qa,ba*=Qa,ea*=Qa,ha*=Qa;var ga=fa,ua=ba,wa=ea,ka=ha,Pa=2*ga,Mt=2*ua,Ha=2*wa,Ba=ga*Pa,nt=ua*Mt,Ea=wa*Ha,Fa=ga*Mt,Aa=ua*Ha,ft=ga*Ha,Ua=ka*Pa,ja=ka*Mt,bt=ka*Ha;T._transform._rotation00=1-nt-Ea,T._transform._rotation01=Fa-bt,T._transform._rotation02=ft+ja,T._transform._rotation10=Fa+bt,T._transform._rotation11=1-Ba-Ea,T._transform._rotation12=Aa-Ua,T._transform._rotation20=ft-ja,T._transform._rotation21=Aa+Ua,T._transform._rotation22=1-Ba-nt;var rt,$a,_t,gt,mt,Wa,it,ut,Da;rt=T._transform._rotation00*T._invLocalInertia00+T._transform._rotation01*T._invLocalInertia10+T._transform._rotation02*T._invLocalInertia20,$a=T._transform._rotation00*T._invLocalInertia01+T._transform._rotation01*T._invLocalInertia11+T._transform._rotation02*T._invLocalInertia21,_t=T._transform._rotation00*T._invLocalInertia02+T._transform._rotation01*T._invLocalInertia12+T._transform._rotation02*T._invLocalInertia22,gt=T._transform._rotation10*T._invLocalInertia00+T._transform._rotation11*T._invLocalInertia10+T._transform._rotation12*T._invLocalInertia20,mt=T._transform._rotation10*T._invLocalInertia01+T._transform._rotation11*T._invLocalInertia11+T._transform._rotation12*T._invLocalInertia21,Wa=T._transform._rotation10*T._invLocalInertia02+T._transform._rotation11*T._invLocalInertia12+T._transform._rotation12*T._invLocalInertia22,it=T._transform._rotation20*T._invLocalInertia00+T._transform._rotation21*T._invLocalInertia10+T._transform._rotation22*T._invLocalInertia20,ut=T._transform._rotation20*T._invLocalInertia01+T._transform._rotation21*T._invLocalInertia11+T._transform._rotation22*T._invLocalInertia21,Da=T._transform._rotation20*T._invLocalInertia02+T._transform._rotation21*T._invLocalInertia12+T._transform._rotation22*T._invLocalInertia22,T._invInertia00=rt,T._invInertia01=$a,T._invInertia02=_t,T._invInertia10=gt,T._invInertia11=mt,T._invInertia12=Wa,T._invInertia20=it,T._invInertia21=ut,T._invInertia22=Da;var Ta,Na,Vt,Pt,et,Xt,Yt,zt,Ia;Ta=T._invInertia00*T._transform._rotation00+T._invInertia01*T._transform._rotation01+T._invInertia02*T._transform._rotation02,Na=T._invInertia00*T._transform._rotation10+T._invInertia01*T._transform._rotation11+T._invInertia02*T._transform._rotation12,Vt=T._invInertia00*T._transform._rotation20+T._invInertia01*T._transform._rotation21+T._invInertia02*T._transform._rotation22,Pt=T._invInertia10*T._transform._rotation00+T._invInertia11*T._transform._rotation01+T._invInertia12*T._transform._rotation02,et=T._invInertia10*T._transform._rotation10+T._invInertia11*T._transform._rotation11+T._invInertia12*T._transform._rotation12,Xt=T._invInertia10*T._transform._rotation20+T._invInertia11*T._transform._rotation21+T._invInertia12*T._transform._rotation22,Yt=T._invInertia20*T._transform._rotation00+T._invInertia21*T._transform._rotation01+T._invInertia22*T._transform._rotation02,zt=T._invInertia20*T._transform._rotation10+T._invInertia21*T._transform._rotation11+T._invInertia22*T._transform._rotation12,Ia=T._invInertia20*T._transform._rotation20+T._invInertia21*T._transform._rotation21+T._invInertia22*T._transform._rotation22,T._invInertia00=Ta,T._invInertia01=Na,T._invInertia02=Vt,T._invInertia10=Pt,T._invInertia11=et,T._invInertia12=Xt,T._invInertia20=Yt,T._invInertia21=zt,T._invInertia22=Ia,T._invInertia00*=T._rotFactor.x,T._invInertia01*=T._rotFactor.x,T._invInertia02*=T._rotFactor.x,T._invInertia10*=T._rotFactor.y,T._invInertia11*=T._rotFactor.y,T._invInertia12*=T._rotFactor.y,T._invInertia20*=T._rotFactor.z,T._invInertia21*=T._rotFactor.z,T._invInertia22*=T._rotFactor.z;var O=this._b2,Va=Math.sqrt(U*U+J*J+D*D),lt=Va*.5,P,wt;if(lt<.5){var Bt=lt*lt;P=.5*(1-Bt*.16666666666666666+Bt*Bt*.008333333333333333),wt=1-Bt*.5+Bt*Bt*.041666666666666664}else P=Math.sin(lt)/Va,wt=Math.cos(lt);var At,yt,kt;At=U*P,yt=J*P,kt=D*P;var pt,ht,xt,Ra;pt=At,ht=yt,xt=kt,Ra=wt;var st,Ca,vt,qa,at=O._transform._rotation00,Oa=O._transform._rotation11,tt=O._transform._rotation22,ct=at+Oa+tt,Sa;ct>0?(Sa=Math.sqrt(ct+1),qa=.5*Sa,Sa=.5/Sa,st=(O._transform._rotation21-O._transform._rotation12)*Sa,Ca=(O._transform._rotation02-O._transform._rotation20)*Sa,vt=(O._transform._rotation10-O._transform._rotation01)*Sa):at>Oa?at>tt?(Sa=Math.sqrt(at-Oa-tt+1),st=.5*Sa,Sa=.5/Sa,Ca=(O._transform._rotation01+O._transform._rotation10)*Sa,vt=(O._transform._rotation02+O._transform._rotation20)*Sa,qa=(O._transform._rotation21-O._transform._rotation12)*Sa):(Sa=Math.sqrt(tt-at-Oa+1),vt=.5*Sa,Sa=.5/Sa,st=(O._transform._rotation02+O._transform._rotation20)*Sa,Ca=(O._transform._rotation12+O._transform._rotation21)*Sa,qa=(O._transform._rotation10-O._transform._rotation01)*Sa):Oa>tt?(Sa=Math.sqrt(Oa-tt-at+1),Ca=.5*Sa,Sa=.5/Sa,st=(O._transform._rotation01+O._transform._rotation10)*Sa,vt=(O._transform._rotation12+O._transform._rotation21)*Sa,qa=(O._transform._rotation02-O._transform._rotation20)*Sa):(Sa=Math.sqrt(tt-at-Oa+1),vt=.5*Sa,Sa=.5/Sa,st=(O._transform._rotation02+O._transform._rotation20)*Sa,Ca=(O._transform._rotation12+O._transform._rotation21)*Sa,qa=(O._transform._rotation10-O._transform._rotation01)*Sa),st=Ra*st+pt*qa+ht*vt-xt*Ca,Ca=Ra*Ca-pt*vt+ht*qa+xt*st,vt=Ra*vt+pt*Ca-ht*st+xt*qa,qa=Ra*qa-pt*st-ht*Ca-xt*vt;var Ga=st*st+Ca*Ca+vt*vt+qa*qa;Ga>1e-32&&(Ga=1/Math.sqrt(Ga)),st*=Ga,Ca*=Ga,vt*=Ga,qa*=Ga;var Ka=st,La=Ca,ot=vt,It=qa,or=2*Ka,gr=2*La,ar=2*ot,Ct=Ka*or,_r=La*gr,Et=ot*ar,St=Ka*gr,Gt=La*ar,jr=Ka*ar,vr=It*or,lr=It*gr,tr=It*ar;O._transform._rotation00=1-_r-Et,O._transform._rotation01=St-tr,O._transform._rotation02=jr+lr,O._transform._rotation10=St+tr,O._transform._rotation11=1-Ct-Et,O._transform._rotation12=Gt-vr,O._transform._rotation20=jr-lr,O._transform._rotation21=Gt+vr,O._transform._rotation22=1-Ct-_r;var Or,Xr,Mr,Zt,ir,Wt,nr,$r,Ut;Or=O._transform._rotation00*O._invLocalInertia00+O._transform._rotation01*O._invLocalInertia10+O._transform._rotation02*O._invLocalInertia20,Xr=O._transform._rotation00*O._invLocalInertia01+O._transform._rotation01*O._invLocalInertia11+O._transform._rotation02*O._invLocalInertia21,Mr=O._transform._rotation00*O._invLocalInertia02+O._transform._rotation01*O._invLocalInertia12+O._transform._rotation02*O._invLocalInertia22,Zt=O._transform._rotation10*O._invLocalInertia00+O._transform._rotation11*O._invLocalInertia10+O._transform._rotation12*O._invLocalInertia20,ir=O._transform._rotation10*O._invLocalInertia01+O._transform._rotation11*O._invLocalInertia11+O._transform._rotation12*O._invLocalInertia21,Wt=O._transform._rotation10*O._invLocalInertia02+O._transform._rotation11*O._invLocalInertia12+O._transform._rotation12*O._invLocalInertia22,nr=O._transform._rotation20*O._invLocalInertia00+O._transform._rotation21*O._invLocalInertia10+O._transform._rotation22*O._invLocalInertia20,$r=O._transform._rotation20*O._invLocalInertia01+O._transform._rotation21*O._invLocalInertia11+O._transform._rotation22*O._invLocalInertia21,Ut=O._transform._rotation20*O._invLocalInertia02+O._transform._rotation21*O._invLocalInertia12+O._transform._rotation22*O._invLocalInertia22,O._invInertia00=Or,O._invInertia01=Xr,O._invInertia02=Mr,O._invInertia10=Zt,O._invInertia11=ir,O._invInertia12=Wt,O._invInertia20=nr,O._invInertia21=$r,O._invInertia22=Ut;var Kr,Ir,mi,Wr,Lt,Kt,Tt,br,zr;Kr=O._invInertia00*O._transform._rotation00+O._invInertia01*O._transform._rotation01+O._invInertia02*O._transform._rotation02,Ir=O._invInertia00*O._transform._rotation10+O._invInertia01*O._transform._rotation11+O._invInertia02*O._transform._rotation12,mi=O._invInertia00*O._transform._rotation20+O._invInertia01*O._transform._rotation21+O._invInertia02*O._transform._rotation22,Wr=O._invInertia10*O._transform._rotation00+O._invInertia11*O._transform._rotation01+O._invInertia12*O._transform._rotation02,Lt=O._invInertia10*O._transform._rotation10+O._invInertia11*O._transform._rotation11+O._invInertia12*O._transform._rotation12,Kt=O._invInertia10*O._transform._rotation20+O._invInertia11*O._transform._rotation21+O._invInertia12*O._transform._rotation22,Tt=O._invInertia20*O._transform._rotation00+O._invInertia21*O._transform._rotation01+O._invInertia22*O._transform._rotation02,br=O._invInertia20*O._transform._rotation10+O._invInertia21*O._transform._rotation11+O._invInertia22*O._transform._rotation12,zr=O._invInertia20*O._transform._rotation20+O._invInertia21*O._transform._rotation21+O._invInertia22*O._transform._rotation22,O._invInertia00=Kr,O._invInertia01=Ir,O._invInertia02=mi,O._invInertia10=Wr,O._invInertia11=Lt,O._invInertia12=Kt,O._invInertia20=Tt,O._invInertia21=br,O._invInertia22=zr,O._invInertia00*=O._rotFactor.x,O._invInertia01*=O._rotFactor.x,O._invInertia02*=O._rotFactor.x,O._invInertia10*=O._rotFactor.y,O._invInertia11*=O._rotFactor.y,O._invInertia12*=O._rotFactor.y,O._invInertia20*=O._rotFactor.z,O._invInertia21*=O._rotFactor.z,O._invInertia22*=O._rotFactor.z}for(var vi=this.posBoundarySelector,qt=0;vi.indices[qt]!=k;)++qt;for(;qt>0;){var fr=vi.indices[qt];vi.indices[qt]=vi.indices[qt-1],vi.indices[qt-1]=fr,--qt}y=!0;break}}if(!y){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};x.dynamics.constraint.solver.direct.MassMatrix=class{constructor(a){this._size=a;var t=new Array(this._size);this.tmpMatrix=t;var r=new Array(this._size);this._invMass=r;var i=new Array(this._size);this._invMassWithoutCfm=i;for(var o=0,_=this._size;o<_;){var s=o++,h=this.tmpMatrix,v=new Array(this._size);h[s]=v;var e=this._invMass,l=new Array(this._size);e[s]=l;var u=this._invMassWithoutCfm,b=new Array(this._size);u[s]=b;for(var f=0,n=this._size;f<n;){var c=f++;this.tmpMatrix[s][c]=0,this._invMass[s][c]=0,this._invMassWithoutCfm[s][c]=0}}this._maxSubmatrixId=1<<this._size;var M=new Array(this._maxSubmatrixId);this._cacheComputed=M;var m=new Array(this._maxSubmatrixId);this._cachedSubmatrices=m;for(var y=0,V=this._maxSubmatrixId;y<V;){var z=y++,I=z;I=(I&85)+(I>>1&85),I=(I&51)+(I>>2&51),I=(I&15)+(I>>4&15);for(var k=I,X=new Array(k),L=X,p=0,g=k;p<g;){var N=p++,A=new Array(k);L[N]=A;for(var F=0,S=k;F<S;){var Y=F++;L[N][Y]=0}}this._cacheComputed[z]=!1,this._cachedSubmatrices[z]=L}}computeSubmatrix(a,t,r){for(var i=0,o=r;i<o;)for(var _=i++,s=t[_],h=0,v=r;h<v;){var e=h++;this.tmpMatrix[_][e]=this._invMass[s][t[e]]}var l=this.tmpMatrix,u=this._cachedSubmatrices[a],b,f,n,c,M;switch(r){case 4:b=l[0],f=u[0],M=1/b[0],f[0]=M,b[1]=b[1]*M,b[2]=b[2]*M,b[3]=b[3]*M,n=l[1],c=u[1],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[2],c=u[2],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[3],c=u[3],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],b=l[1],f=u[1],M=1/b[1],f[1]=M,f[0]=f[0]*M,b[2]=b[2]*M,b[3]=b[3]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],b=l[2],f=u[2],M=1/b[2],f[2]=M,f[0]=f[0]*M,f[1]=f[1]*M,b[3]=b[3]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],b=l[3],f=u[3],M=1/b[3],f[3]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2];break;case 5:b=l[0],f=u[0],M=1/b[0],f[0]=M,b[1]=b[1]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,n=l[1],c=u[1],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[2],c=u[2],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[3],c=u[3],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[4],c=u[4],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],b=l[1],f=u[1],M=1/b[1],f[1]=M,f[0]=f[0]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],b=l[2],f=u[2],M=1/b[2],f[2]=M,f[0]=f[0]*M,f[1]=f[1]*M,b[3]=b[3]*M,b[4]=b[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],b=l[3],f=u[3],M=1/b[3],f[3]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,b[4]=b[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-M*n[3],n[4]=n[4]-b[4]*n[3],b=l[4],f=u[4],M=1/b[4],f[4]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,f[3]=f[3]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[4],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2],f=u[4],u[0][4]=f[0],u[1][4]=f[1],u[2][4]=f[2],u[3][4]=f[3];break;case 6:b=l[0],f=u[0],M=1/b[0],f[0]=M,b[1]=b[1]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[1],c=u[1],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[2],c=u[2],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[3],c=u[3],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[4],c=u[4],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[5],c=u[5],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],b=l[1],f=u[1],M=1/b[1],f[1]=M,f[0]=f[0]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],b=l[2],f=u[2],M=1/b[2],f[2]=M,f[0]=f[0]*M,f[1]=f[1]*M,b[3]=b[3]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],b=l[3],f=u[3],M=1/b[3],f[3]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-M*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-M*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],b=l[4],f=u[4],M=1/b[4],f[4]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,f[3]=f[3]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[4],n[5]=n[5]-b[5]*n[4],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n[5]=n[5]-b[5]*n[4],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n[5]=n[5]-b[5]*n[4],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],n[5]=n[5]-b[5]*n[4],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],c[4]=-M*n[4],n[5]=n[5]-b[5]*n[4],b=l[5],f=u[5],M=1/b[5],f[5]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,f[3]=f[3]*M,f[4]=f[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[5],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],c[4]=c[4]-f[4]*n[5],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2],f=u[4],u[0][4]=f[0],u[1][4]=f[1],u[2][4]=f[2],u[3][4]=f[3],f=u[5],u[0][5]=f[0],u[1][5]=f[1],u[2][5]=f[2],u[3][5]=f[3],u[4][5]=f[4];break;default:for(var m=0,y=r;m<y;){var V=m++;b=l[V],f=u[V];var z=1/b[V];f[V]=z;for(var I=0,k=V;I<k;){var X=I++;f[X]=f[X]*z}for(var L=V+1,p=r;L<p;){var g=L++;b[g]=b[g]*z}for(var N=0,A=V;N<A;){var F=N++;n=l[F],c=u[F];for(var S=0,Y=F+1;S<Y;){var R=S++;c[R]=c[R]-f[R]*n[V]}for(var C=V+1,d=r;C<d;){var Z=C++;n[Z]=n[Z]-b[Z]*n[V]}}for(var $=V+1,j=r;$<j;){var E=$++;n=l[E],c=u[E];for(var G=0,B=V;G<B;){var Q=G++;c[Q]=c[Q]-f[Q]*n[V]}c[V]=-z*n[V];for(var U=V+1,J=r;U<J;){var D=U++;n[D]=n[D]-b[D]*n[V]}}}for(var H=1,K=r;H<K;){var ra=H++;f=u[ra];for(var sa=0,W=ra;sa<W;){var q=sa++;u[q][ra]=f[q]}}}}computeInvMass(a,t){var r=this._invMass,i=this._invMassWithoutCfm,o=a.numRows,_=a.b1,s=a.b2,h=_._invMass,v=s._invMass,e,l,u,b,f,n,c,M,m,y,V,z,I,k,X,L,p,g;e=_._invInertia00,l=_._invInertia01,u=_._invInertia02,b=_._invInertia10,f=_._invInertia11,n=_._invInertia12,c=_._invInertia20,M=_._invInertia21,m=_._invInertia22,y=s._invInertia00,V=s._invInertia01,z=s._invInertia02,I=s._invInertia10,k=s._invInertia11,X=s._invInertia12,L=s._invInertia20,p=s._invInertia21,g=s._invInertia22;for(var N=0,A=o;N<A;){var F=N++,S=a.rows[F].jacobian,Y=t[F];if(S.updateSparsity(),S.flag&1?(Y.invMLin1X=S.lin1X*h,Y.invMLin1Y=S.lin1Y*h,Y.invMLin1Z=S.lin1Z*h,Y.invMLin2X=S.lin2X*v,Y.invMLin2Y=S.lin2Y*v,Y.invMLin2Z=S.lin2Z*v):(Y.invMLin1X=0,Y.invMLin1Y=0,Y.invMLin1Z=0,Y.invMLin2X=0,Y.invMLin2Y=0,Y.invMLin2Z=0),S.flag&2){var R,C,d;R=e*S.ang1X+l*S.ang1Y+u*S.ang1Z,C=b*S.ang1X+f*S.ang1Y+n*S.ang1Z,d=c*S.ang1X+M*S.ang1Y+m*S.ang1Z,Y.invMAng1X=R,Y.invMAng1Y=C,Y.invMAng1Z=d;var Z,$,j;Z=y*S.ang2X+V*S.ang2Y+z*S.ang2Z,$=I*S.ang2X+k*S.ang2Y+X*S.ang2Z,j=L*S.ang2X+p*S.ang2Y+g*S.ang2Z,Y.invMAng2X=Z,Y.invMAng2Y=$,Y.invMAng2Z=j}else Y.invMAng1X=0,Y.invMAng1Y=0,Y.invMAng1Z=0,Y.invMAng2X=0,Y.invMAng2Y=0,Y.invMAng2Z=0}for(var E=0,G=o;E<G;)for(var B=E++,Q=a.rows[B].jacobian,U=B,J=o;U<J;){var D=U++;a.rows[D].jacobian;var H=t[D],K=Q.lin1X*H.invMLin1X+Q.lin1Y*H.invMLin1Y+Q.lin1Z*H.invMLin1Z+(Q.ang1X*H.invMAng1X+Q.ang1Y*H.invMAng1Y+Q.ang1Z*H.invMAng1Z)+(Q.lin2X*H.invMLin2X+Q.lin2Y*H.invMLin2Y+Q.lin2Z*H.invMLin2Z)+(Q.ang2X*H.invMAng2X+Q.ang2Y*H.invMAng2Y+Q.ang2Z*H.invMAng2Z);B==D?(r[B][D]=K+a.rows[B].cfm,i[B][D]=K,H.mass=K+a.rows[B].cfm,H.massWithoutCfm=K,H.mass!=0&&(H.mass=1/H.mass),H.massWithoutCfm!=0&&(H.massWithoutCfm=1/H.massWithoutCfm)):(r[B][D]=K,r[D][B]=K,i[B][D]=K,i[D][B]=K)}for(var ra=0,sa=this._maxSubmatrixId;ra<sa;){var W=ra++;this._cacheComputed[W]=!1}}};x.dynamics.constraint.solver.pgs||(x.dynamics.constraint.solver.pgs={});x.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.constraint=a,this.info=new x.dynamics.constraint.info.contact.ContactSolverInfo;var t=new Array(x.common.Setting.maxManifoldPoints);this.massData=t;for(var r=0,i=this.massData.length;r<i;){var o=r++;this.massData[o]=new x.dynamics.constraint.solver.common.ContactSolverMassDataRow}}preSolveVelocity(a){this.constraint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,_=this._b1._invInertia02,s=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobianN;p.invMLinN1X=g.lin1X*t,p.invMLinN1Y=g.lin1Y*t,p.invMLinN1Z=g.lin1Z*t,p.invMLinN2X=g.lin2X*r,p.invMLinN2Y=g.lin2Y*r,p.invMLinN2Z=g.lin2Z*r;var N,A,F;N=i*g.ang1X+o*g.ang1Y+_*g.ang1Z,A=s*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAngN1X=N,p.invMAngN1Y=A,p.invMAngN1Z=F;var S,Y,R;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAngN2X=S,p.invMAngN2Y=Y,p.invMAngN2Z=R,p.massN=t+r+(p.invMAngN1X*g.ang1X+p.invMAngN1Y*g.ang1Y+p.invMAngN1Z*g.ang1Z)+(p.invMAngN2X*g.ang2X+p.invMAngN2Y*g.ang2Y+p.invMAngN2Z*g.ang2Z),p.massN!=0&&(p.massN=1/p.massN);var C=L.jacobianT,d=L.jacobianB;p.invMLinT1X=C.lin1X*t,p.invMLinT1Y=C.lin1Y*t,p.invMLinT1Z=C.lin1Z*t,p.invMLinT2X=C.lin2X*r,p.invMLinT2Y=C.lin2Y*r,p.invMLinT2Z=C.lin2Z*r,p.invMLinB1X=d.lin1X*t,p.invMLinB1Y=d.lin1Y*t,p.invMLinB1Z=d.lin1Z*t,p.invMLinB2X=d.lin2X*r,p.invMLinB2Y=d.lin2Y*r,p.invMLinB2Z=d.lin2Z*r;var Z,$,j;Z=i*C.ang1X+o*C.ang1Y+_*C.ang1Z,$=s*C.ang1X+h*C.ang1Y+v*C.ang1Z,j=e*C.ang1X+l*C.ang1Y+u*C.ang1Z,p.invMAngT1X=Z,p.invMAngT1Y=$,p.invMAngT1Z=j;var E,G,B;E=b*C.ang2X+f*C.ang2Y+n*C.ang2Z,G=c*C.ang2X+M*C.ang2Y+m*C.ang2Z,B=y*C.ang2X+V*C.ang2Y+z*C.ang2Z,p.invMAngT2X=E,p.invMAngT2Y=G,p.invMAngT2Z=B;var Q,U,J;Q=i*d.ang1X+o*d.ang1Y+_*d.ang1Z,U=s*d.ang1X+h*d.ang1Y+v*d.ang1Z,J=e*d.ang1X+l*d.ang1Y+u*d.ang1Z,p.invMAngB1X=Q,p.invMAngB1Y=U,p.invMAngB1Z=J;var D,H,K;D=b*d.ang2X+f*d.ang2Y+n*d.ang2Z,H=c*d.ang2X+M*d.ang2Y+m*d.ang2Z,K=y*d.ang2X+V*d.ang2Y+z*d.ang2Z,p.invMAngB2X=D,p.invMAngB2Y=H,p.invMAngB2Z=K;var ra=t+r+(p.invMAngT1X*C.ang1X+p.invMAngT1Y*C.ang1Y+p.invMAngT1Z*C.ang1Z)+(p.invMAngT2X*C.ang2X+p.invMAngT2Y*C.ang2Y+p.invMAngT2Z*C.ang2Z),sa=p.invMAngT1X*d.ang1X+p.invMAngT1Y*d.ang1Y+p.invMAngT1Z*d.ang1Z+(p.invMAngT2X*d.ang2X+p.invMAngT2Y*d.ang2Y+p.invMAngT2Z*d.ang2Z),W=sa,q=t+r+(p.invMAngB1X*d.ang1X+p.invMAngB1Y*d.ang1Y+p.invMAngB1Z*d.ang1Z)+(p.invMAngB2X*d.ang2X+p.invMAngB2Y*d.ang2Y+p.invMAngB2Z*d.ang2Z),na=ra*q-sa*W;na!=0&&(na=1/na),p.massTB00=q*na,p.massTB01=-sa*na,p.massTB10=-W*na,p.massTB11=ra*na}}warmStart(a){var t,r,i,o,_,s,h,v,e,l,u,b;t=this._b1._velX,r=this._b1._velY,i=this._b1._velZ,o=this._b2._velX,_=this._b2._velY,s=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,e=this._b1._angVelZ,l=this._b2._angVelX,u=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=this.info.numRows;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse,y=this.massData[c],V=M.jacobianT,z=M.jacobianB,I=m.impulseN,k=m.impulseLX*V.lin1X+m.impulseLY*V.lin1Y+m.impulseLZ*V.lin1Z,X=m.impulseLX*z.lin1X+m.impulseLY*z.lin1Y+m.impulseLZ*z.lin1Z;m.impulseT=k,m.impulseB=X,m.impulseN*=a.dtRatio,m.impulseT*=a.dtRatio,m.impulseB*=a.dtRatio,t+=y.invMLinN1X*I,r+=y.invMLinN1Y*I,i+=y.invMLinN1Z*I,t+=y.invMLinT1X*k,r+=y.invMLinT1Y*k,i+=y.invMLinT1Z*k,t+=y.invMLinB1X*X,r+=y.invMLinB1Y*X,i+=y.invMLinB1Z*X,o+=y.invMLinN2X*-I,_+=y.invMLinN2Y*-I,s+=y.invMLinN2Z*-I,o+=y.invMLinT2X*-k,_+=y.invMLinT2Y*-k,s+=y.invMLinT2Z*-k,o+=y.invMLinB2X*-X,_+=y.invMLinB2Y*-X,s+=y.invMLinB2Z*-X,h+=y.invMAngN1X*I,v+=y.invMAngN1Y*I,e+=y.invMAngN1Z*I,h+=y.invMAngT1X*k,v+=y.invMAngT1Y*k,e+=y.invMAngT1Z*k,h+=y.invMAngB1X*X,v+=y.invMAngB1Y*X,e+=y.invMAngB1Z*X,l+=y.invMAngN2X*-I,u+=y.invMAngN2Y*-I,b+=y.invMAngN2Z*-I,l+=y.invMAngT2X*-k,u+=y.invMAngT2Y*-k,b+=y.invMAngT2Z*-k,l+=y.invMAngB2X*-X,u+=y.invMAngB2Y*-X,b+=y.invMAngB2Z*-X}this._b1._velX=t,this._b1._velY=r,this._b1._velZ=i,this._b2._velX=o,this._b2._velY=_,this._b2._velZ=s,this._b1._angVelX=h,this._b1._angVelY=v,this._b1._angVelZ=e,this._b2._angVelX=l,this._b2._angVelY=u,this._b2._angVelZ=b}solveVelocity(){var a,t,r,i,o,_,s,h,v,e,l,u;a=this._b1._velX,t=this._b1._velY,r=this._b1._velZ,i=this._b2._velX,o=this._b2._velY,_=this._b2._velZ,s=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,e=this._b2._angVelX,l=this._b2._angVelY,u=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=0,V=c.jacobianT;y+=a*V.lin1X+t*V.lin1Y+r*V.lin1Z,y-=i*V.lin2X+o*V.lin2Y+_*V.lin2Z,y+=s*V.ang1X+h*V.ang1Y+v*V.ang1Z,y-=e*V.ang2X+l*V.ang2Y+u*V.ang2Z;var z=0;V=c.jacobianB,z+=a*V.lin1X+t*V.lin1Y+r*V.lin1Z,z-=i*V.lin2X+o*V.lin2Y+_*V.lin2Z,z+=s*V.ang1X+h*V.ang1Y+v*V.ang1Z,z-=e*V.ang2X+l*V.ang2Y+u*V.ang2Z;var I=-(y*M.massTB00+z*M.massTB01),k=-(y*M.massTB10+z*M.massTB11),X=m.impulseT,L=m.impulseB;m.impulseT+=I,m.impulseB+=k;var p=c.friction*m.impulseN;if(p==0)m.impulseT=0,m.impulseB=0;else{var g=m.impulseT*m.impulseT+m.impulseB*m.impulseB;if(g>p*p){var N=p/Math.sqrt(g);m.impulseT*=N,m.impulseB*=N}}I=m.impulseT-X,k=m.impulseB-L,a+=M.invMLinT1X*I,t+=M.invMLinT1Y*I,r+=M.invMLinT1Z*I,a+=M.invMLinB1X*k,t+=M.invMLinB1Y*k,r+=M.invMLinB1Z*k,i+=M.invMLinT2X*-I,o+=M.invMLinT2Y*-I,_+=M.invMLinT2Z*-I,i+=M.invMLinB2X*-k,o+=M.invMLinB2Y*-k,_+=M.invMLinB2Z*-k,s+=M.invMAngT1X*I,h+=M.invMAngT1Y*I,v+=M.invMAngT1Z*I,s+=M.invMAngB1X*k,h+=M.invMAngB1Y*k,v+=M.invMAngB1Z*k,e+=M.invMAngT2X*-I,l+=M.invMAngT2Y*-I,u+=M.invMAngT2Z*-I,e+=M.invMAngB2X*-k,l+=M.invMAngB2Y*-k,u+=M.invMAngB2Z*-k}for(var A=0,F=this.info.numRows;A<F;){var S=A++,Y=this.info.rows[S],R=this.massData[S],C=Y.impulse,d=0,Z=Y.jacobianN;d+=a*Z.lin1X+t*Z.lin1Y+r*Z.lin1Z,d-=i*Z.lin2X+o*Z.lin2Y+_*Z.lin2Z,d+=s*Z.ang1X+h*Z.ang1Y+v*Z.ang1Z,d-=e*Z.ang2X+l*Z.ang2Y+u*Z.ang2Z;var $=(Y.rhs-d)*R.massN,j=C.impulseN;C.impulseN+=$,C.impulseN<0&&(C.impulseN=0),$=C.impulseN-j,a+=R.invMLinN1X*$,t+=R.invMLinN1Y*$,r+=R.invMLinN1Z*$,i+=R.invMLinN2X*-$,o+=R.invMLinN2Y*-$,_+=R.invMLinN2Z*-$,s+=R.invMAngN1X*$,h+=R.invMAngN1Y*$,v+=R.invMAngN1Z*$,e+=R.invMAngN2X*-$,l+=R.invMAngN2Y*-$,u+=R.invMAngN2Z*-$}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=r,this._b2._velX=i,this._b2._velY=o,this._b2._velZ=_,this._b1._angVelX=s,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=e,this._b2._angVelY=l,this._b2._angVelZ=u}preSolvePosition(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,r=this._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,_=this._b1._invInertia02,s=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobianN;p.invMLinN1X=g.lin1X*t,p.invMLinN1Y=g.lin1Y*t,p.invMLinN1Z=g.lin1Z*t,p.invMLinN2X=g.lin2X*r,p.invMLinN2Y=g.lin2Y*r,p.invMLinN2Z=g.lin2Z*r;var N,A,F;N=i*g.ang1X+o*g.ang1Y+_*g.ang1Z,A=s*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAngN1X=N,p.invMAngN1Y=A,p.invMAngN1Z=F;var S,Y,R;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAngN2X=S,p.invMAngN2Y=Y,p.invMAngN2Z=R,p.massN=t+r+(p.invMAngN1X*g.ang1X+p.invMAngN1Y*g.ang1Y+p.invMAngN1Z*g.ang1Z)+(p.invMAngN2X*g.ang2X+p.invMAngN2Y*g.ang2Y+p.invMAngN2Z*g.ang2Z),p.massN!=0&&(p.massN=1/p.massN)}for(var C=0,d=this.info.numRows;C<d;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,r,i,o,_,s,h,v,e,l,u;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,r=this._b1._pseudoVelZ,i=this._b2._pseudoVelX,o=this._b2._pseudoVelY,_=this._b2._pseudoVelZ,s=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,e=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=c.jacobianN,V=0;V+=a*y.lin1X+t*y.lin1Y+r*y.lin1Z,V-=i*y.lin2X+o*y.lin2Y+_*y.lin2Z,V+=s*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var z=(c.rhs-V)*M.massN*x.common.Setting.positionSplitImpulseBaumgarte,I=m.impulseP;m.impulseP+=z,m.impulseP<0&&(m.impulseP=0),z=m.impulseP-I,a+=M.invMLinN1X*z,t+=M.invMLinN1Y*z,r+=M.invMLinN1Z*z,i+=M.invMLinN2X*-z,o+=M.invMLinN2Y*-z,_+=M.invMLinN2Z*-z,s+=M.invMAngN1X*z,h+=M.invMAngN1Y*z,v+=M.invMAngN1Z*z,e+=M.invMAngN2X*-z,l+=M.invMAngN2Y*-z,u+=M.invMAngN2Z*-z}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=r,this._b2._pseudoVelX=i,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=_,this._b1._angPseudoVelX=s,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=e,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=u}solvePositionNgs(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,r=this._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,_=this._b1._invInertia02,s=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobianN;p.invMLinN1X=g.lin1X*t,p.invMLinN1Y=g.lin1Y*t,p.invMLinN1Z=g.lin1Z*t,p.invMLinN2X=g.lin2X*r,p.invMLinN2Y=g.lin2Y*r,p.invMLinN2Z=g.lin2Z*r;var N,A,F;N=i*g.ang1X+o*g.ang1Y+_*g.ang1Z,A=s*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAngN1X=N,p.invMAngN1Y=A,p.invMAngN1Z=F;var S,Y,R;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAngN2X=S,p.invMAngN2Y=Y,p.invMAngN2Z=R,p.massN=t+r+(p.invMAngN1X*g.ang1X+p.invMAngN1Y*g.ang1Y+p.invMAngN1Z*g.ang1Z)+(p.invMAngN2X*g.ang2X+p.invMAngN2Y*g.ang2Y+p.invMAngN2Z*g.ang2Z),p.massN!=0&&(p.massN=1/p.massN)}var C,d,Z,$,j,E,G,B,Q,U,J,D;C=0,d=0,Z=0,$=0,j=0,E=0,G=0,B=0,Q=0,U=0,J=0,D=0;for(var H=0,K=this.info.numRows;H<K;){var ra=H++,sa=this.info.rows[ra],W=this.massData[ra],q=sa.impulse,na=sa.jacobianN,oa=0;oa+=C*na.lin1X+d*na.lin1Y+Z*na.lin1Z,oa-=$*na.lin2X+j*na.lin2Y+E*na.lin2Z,oa+=G*na.ang1X+B*na.ang1Y+Q*na.ang1Z,oa-=U*na.ang2X+J*na.ang2Y+D*na.ang2Z;var aa=(sa.rhs-oa)*W.massN*x.common.Setting.positionNgsBaumgarte,T=q.impulseP;q.impulseP+=aa,q.impulseP<0&&(q.impulseP=0),aa=q.impulseP-T,C+=W.invMLinN1X*aa,d+=W.invMLinN1Y*aa,Z+=W.invMLinN1Z*aa,$+=W.invMLinN2X*-aa,j+=W.invMLinN2Y*-aa,E+=W.invMLinN2Z*-aa,G+=W.invMAngN1X*aa,B+=W.invMAngN1Y*aa,Q+=W.invMAngN1Z*aa,U+=W.invMAngN2X*-aa,J+=W.invMAngN2Y*-aa,D+=W.invMAngN2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=d,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=$,_a._transform._positionY+=j,_a._transform._positionZ+=E;var w=this._b1,ta=Math.sqrt(G*G+B*B+Q*Q),ia=ta*.5,la,va;if(ia<.5){var xa=ia*ia;la=.5*(1-xa*.16666666666666666+xa*xa*.008333333333333333),va=1-xa*.5+xa*xa*.041666666666666664}else la=Math.sin(ia)/ta,va=Math.cos(ia);var Ma,za,Xa;Ma=G*la,za=B*la,Xa=Q*la;var Za,fa,ba,ea;Za=Ma,fa=za,ba=Xa,ea=va;var ha,pa,ya,da,ma=w._transform._rotation00,Ya=w._transform._rotation11,Qa=w._transform._rotation22,ga=ma+Ya+Qa,ua;ga>0?(ua=Math.sqrt(ga+1),da=.5*ua,ua=.5/ua,ha=(w._transform._rotation21-w._transform._rotation12)*ua,pa=(w._transform._rotation02-w._transform._rotation20)*ua,ya=(w._transform._rotation10-w._transform._rotation01)*ua):ma>Ya?ma>Qa?(ua=Math.sqrt(ma-Ya-Qa+1),ha=.5*ua,ua=.5/ua,pa=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation02+w._transform._rotation20)*ua,da=(w._transform._rotation21-w._transform._rotation12)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,pa=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua):Ya>Qa?(ua=Math.sqrt(Ya-Qa-ma+1),pa=.5*ua,ua=.5/ua,ha=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation02-w._transform._rotation20)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,pa=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua),ha=ea*ha+Za*da+fa*ya-ba*pa,pa=ea*pa-Za*ya+fa*da+ba*ha,ya=ea*ya+Za*pa-fa*ha+ba*da,da=ea*da-Za*ha-fa*pa-ba*ya;var wa=ha*ha+pa*pa+ya*ya+da*da;wa>1e-32&&(wa=1/Math.sqrt(wa)),ha*=wa,pa*=wa,ya*=wa,da*=wa;var ka=ha,Pa=pa,Mt=ya,Ha=da,Ba=2*ka,nt=2*Pa,Ea=2*Mt,Fa=ka*Ba,Aa=Pa*nt,ft=Mt*Ea,Ua=ka*nt,ja=Pa*Ea,bt=ka*Ea,rt=Ha*Ba,$a=Ha*nt,_t=Ha*Ea;w._transform._rotation00=1-Aa-ft,w._transform._rotation01=Ua-_t,w._transform._rotation02=bt+$a,w._transform._rotation10=Ua+_t,w._transform._rotation11=1-Fa-ft,w._transform._rotation12=ja-rt,w._transform._rotation20=bt-$a,w._transform._rotation21=ja+rt,w._transform._rotation22=1-Fa-Aa;var gt,mt,Wa,it,ut,Da,Ta,Na,Vt;gt=w._transform._rotation00*w._invLocalInertia00+w._transform._rotation01*w._invLocalInertia10+w._transform._rotation02*w._invLocalInertia20,mt=w._transform._rotation00*w._invLocalInertia01+w._transform._rotation01*w._invLocalInertia11+w._transform._rotation02*w._invLocalInertia21,Wa=w._transform._rotation00*w._invLocalInertia02+w._transform._rotation01*w._invLocalInertia12+w._transform._rotation02*w._invLocalInertia22,it=w._transform._rotation10*w._invLocalInertia00+w._transform._rotation11*w._invLocalInertia10+w._transform._rotation12*w._invLocalInertia20,ut=w._transform._rotation10*w._invLocalInertia01+w._transform._rotation11*w._invLocalInertia11+w._transform._rotation12*w._invLocalInertia21,Da=w._transform._rotation10*w._invLocalInertia02+w._transform._rotation11*w._invLocalInertia12+w._transform._rotation12*w._invLocalInertia22,Ta=w._transform._rotation20*w._invLocalInertia00+w._transform._rotation21*w._invLocalInertia10+w._transform._rotation22*w._invLocalInertia20,Na=w._transform._rotation20*w._invLocalInertia01+w._transform._rotation21*w._invLocalInertia11+w._transform._rotation22*w._invLocalInertia21,Vt=w._transform._rotation20*w._invLocalInertia02+w._transform._rotation21*w._invLocalInertia12+w._transform._rotation22*w._invLocalInertia22,w._invInertia00=gt,w._invInertia01=mt,w._invInertia02=Wa,w._invInertia10=it,w._invInertia11=ut,w._invInertia12=Da,w._invInertia20=Ta,w._invInertia21=Na,w._invInertia22=Vt;var Pt,et,Xt,Yt,zt,Ia,O,Va,lt;Pt=w._invInertia00*w._transform._rotation00+w._invInertia01*w._transform._rotation01+w._invInertia02*w._transform._rotation02,et=w._invInertia00*w._transform._rotation10+w._invInertia01*w._transform._rotation11+w._invInertia02*w._transform._rotation12,Xt=w._invInertia00*w._transform._rotation20+w._invInertia01*w._transform._rotation21+w._invInertia02*w._transform._rotation22,Yt=w._invInertia10*w._transform._rotation00+w._invInertia11*w._transform._rotation01+w._invInertia12*w._transform._rotation02,zt=w._invInertia10*w._transform._rotation10+w._invInertia11*w._transform._rotation11+w._invInertia12*w._transform._rotation12,Ia=w._invInertia10*w._transform._rotation20+w._invInertia11*w._transform._rotation21+w._invInertia12*w._transform._rotation22,O=w._invInertia20*w._transform._rotation00+w._invInertia21*w._transform._rotation01+w._invInertia22*w._transform._rotation02,Va=w._invInertia20*w._transform._rotation10+w._invInertia21*w._transform._rotation11+w._invInertia22*w._transform._rotation12,lt=w._invInertia20*w._transform._rotation20+w._invInertia21*w._transform._rotation21+w._invInertia22*w._transform._rotation22,w._invInertia00=Pt,w._invInertia01=et,w._invInertia02=Xt,w._invInertia10=Yt,w._invInertia11=zt,w._invInertia12=Ia,w._invInertia20=O,w._invInertia21=Va,w._invInertia22=lt,w._invInertia00*=w._rotFactor.x,w._invInertia01*=w._rotFactor.x,w._invInertia02*=w._rotFactor.x,w._invInertia10*=w._rotFactor.y,w._invInertia11*=w._rotFactor.y,w._invInertia12*=w._rotFactor.y,w._invInertia20*=w._rotFactor.z,w._invInertia21*=w._rotFactor.z,w._invInertia22*=w._rotFactor.z;var P=this._b2,wt=Math.sqrt(U*U+J*J+D*D),Bt=wt*.5,At,yt;if(Bt<.5){var kt=Bt*Bt;At=.5*(1-kt*.16666666666666666+kt*kt*.008333333333333333),yt=1-kt*.5+kt*kt*.041666666666666664}else At=Math.sin(Bt)/wt,yt=Math.cos(Bt);var pt,ht,xt;pt=U*At,ht=J*At,xt=D*At;var Ra,st,Ca,vt;Ra=pt,st=ht,Ca=xt,vt=yt;var qa,at,Oa,tt,ct=P._transform._rotation00,Sa=P._transform._rotation11,Ga=P._transform._rotation22,Ka=ct+Sa+Ga,La;Ka>0?(La=Math.sqrt(Ka+1),tt=.5*La,La=.5/La,qa=(P._transform._rotation21-P._transform._rotation12)*La,at=(P._transform._rotation02-P._transform._rotation20)*La,Oa=(P._transform._rotation10-P._transform._rotation01)*La):ct>Sa?ct>Ga?(La=Math.sqrt(ct-Sa-Ga+1),qa=.5*La,La=.5/La,at=(P._transform._rotation01+P._transform._rotation10)*La,Oa=(P._transform._rotation02+P._transform._rotation20)*La,tt=(P._transform._rotation21-P._transform._rotation12)*La):(La=Math.sqrt(Ga-ct-Sa+1),Oa=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La):Sa>Ga?(La=Math.sqrt(Sa-Ga-ct+1),at=.5*La,La=.5/La,qa=(P._transform._rotation01+P._transform._rotation10)*La,Oa=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation02-P._transform._rotation20)*La):(La=Math.sqrt(Ga-ct-Sa+1),Oa=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La),qa=vt*qa+Ra*tt+st*Oa-Ca*at,at=vt*at-Ra*Oa+st*tt+Ca*qa,Oa=vt*Oa+Ra*at-st*qa+Ca*tt,tt=vt*tt-Ra*qa-st*at-Ca*Oa;var ot=qa*qa+at*at+Oa*Oa+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Oa*=ot,tt*=ot;var It=qa,or=at,gr=Oa,ar=tt,Ct=2*It,_r=2*or,Et=2*gr,St=It*Ct,Gt=or*_r,jr=gr*Et,vr=It*_r,lr=or*Et,tr=It*Et,Or=ar*Ct,Xr=ar*_r,Mr=ar*Et;P._transform._rotation00=1-Gt-jr,P._transform._rotation01=vr-Mr,P._transform._rotation02=tr+Xr,P._transform._rotation10=vr+Mr,P._transform._rotation11=1-St-jr,P._transform._rotation12=lr-Or,P._transform._rotation20=tr-Xr,P._transform._rotation21=lr+Or,P._transform._rotation22=1-St-Gt;var Zt,ir,Wt,nr,$r,Ut,Kr,Ir,mi;Zt=P._transform._rotation00*P._invLocalInertia00+P._transform._rotation01*P._invLocalInertia10+P._transform._rotation02*P._invLocalInertia20,ir=P._transform._rotation00*P._invLocalInertia01+P._transform._rotation01*P._invLocalInertia11+P._transform._rotation02*P._invLocalInertia21,Wt=P._transform._rotation00*P._invLocalInertia02+P._transform._rotation01*P._invLocalInertia12+P._transform._rotation02*P._invLocalInertia22,nr=P._transform._rotation10*P._invLocalInertia00+P._transform._rotation11*P._invLocalInertia10+P._transform._rotation12*P._invLocalInertia20,$r=P._transform._rotation10*P._invLocalInertia01+P._transform._rotation11*P._invLocalInertia11+P._transform._rotation12*P._invLocalInertia21,Ut=P._transform._rotation10*P._invLocalInertia02+P._transform._rotation11*P._invLocalInertia12+P._transform._rotation12*P._invLocalInertia22,Kr=P._transform._rotation20*P._invLocalInertia00+P._transform._rotation21*P._invLocalInertia10+P._transform._rotation22*P._invLocalInertia20,Ir=P._transform._rotation20*P._invLocalInertia01+P._transform._rotation21*P._invLocalInertia11+P._transform._rotation22*P._invLocalInertia21,mi=P._transform._rotation20*P._invLocalInertia02+P._transform._rotation21*P._invLocalInertia12+P._transform._rotation22*P._invLocalInertia22,P._invInertia00=Zt,P._invInertia01=ir,P._invInertia02=Wt,P._invInertia10=nr,P._invInertia11=$r,P._invInertia12=Ut,P._invInertia20=Kr,P._invInertia21=Ir,P._invInertia22=mi;var Wr,Lt,Kt,Tt,br,zr,vi,qt,fr;Wr=P._invInertia00*P._transform._rotation00+P._invInertia01*P._transform._rotation01+P._invInertia02*P._transform._rotation02,Lt=P._invInertia00*P._transform._rotation10+P._invInertia01*P._transform._rotation11+P._invInertia02*P._transform._rotation12,Kt=P._invInertia00*P._transform._rotation20+P._invInertia01*P._transform._rotation21+P._invInertia02*P._transform._rotation22,Tt=P._invInertia10*P._transform._rotation00+P._invInertia11*P._transform._rotation01+P._invInertia12*P._transform._rotation02,br=P._invInertia10*P._transform._rotation10+P._invInertia11*P._transform._rotation11+P._invInertia12*P._transform._rotation12,zr=P._invInertia10*P._transform._rotation20+P._invInertia11*P._transform._rotation21+P._invInertia12*P._transform._rotation22,vi=P._invInertia20*P._transform._rotation00+P._invInertia21*P._transform._rotation01+P._invInertia22*P._transform._rotation02,qt=P._invInertia20*P._transform._rotation10+P._invInertia21*P._transform._rotation11+P._invInertia22*P._transform._rotation12,fr=P._invInertia20*P._transform._rotation20+P._invInertia21*P._transform._rotation21+P._invInertia22*P._transform._rotation22,P._invInertia00=Wr,P._invInertia01=Lt,P._invInertia02=Kt,P._invInertia10=Tt,P._invInertia11=br,P._invInertia12=zr,P._invInertia20=vi,P._invInertia21=qt,P._invInertia22=fr,P._invInertia00*=P._rotFactor.x,P._invInertia01*=P._rotFactor.x,P._invInertia02*=P._rotFactor.x,P._invInertia10*=P._rotFactor.y,P._invInertia11*=P._rotFactor.y,P._invInertia12*=P._rotFactor.y,P._invInertia20*=P._rotFactor.z,P._invInertia21*=P._rotFactor.z,P._invInertia22*=P._rotFactor.z}postSolve(){var a,t,r,i,o,_,s,h,v;a=0,t=0,r=0,i=0,o=0,_=0,s=0,h=0,v=0;for(var e=0,l=this.info.numRows;e<l;){var u=e++,b=this.info.rows[u],f=b.impulse,n=b.jacobianN,c=b.jacobianT,M=b.jacobianB,m=f.impulseN,y=f.impulseT,V=f.impulseB,z,I,k;z=0,I=0,k=0,z+=c.lin1X*y,I+=c.lin1Y*y,k+=c.lin1Z*y,z+=M.lin1X*V,I+=M.lin1Y*V,k+=M.lin1Z*V,f.impulseLX=z,f.impulseLY=I,f.impulseLZ=k,a+=n.lin1X*m,t+=n.lin1Y*m,r+=n.lin1Z*m,i+=n.ang1X*m,o+=n.ang1Y*m,_+=n.ang1Z*m,s+=n.ang2X*m,h+=n.ang2Y*m,v+=n.ang2Z*m,a+=c.lin1X*y,t+=c.lin1Y*y,r+=c.lin1Z*y,i+=c.ang1X*y,o+=c.ang1Y*y,_+=c.ang1Z*y,s+=c.ang2X*y,h+=c.ang2Y*y,v+=c.ang2Z*y,a+=M.lin1X*V,t+=M.lin1Y*V,r+=M.lin1Z*V,i+=M.ang1X*V,o+=M.ang1Y*V,_+=M.ang1Z*V,s+=M.ang2X*V,h+=M.ang2Y*V,v+=M.ang2Z*V}this._b1._linearContactImpulseX+=a,this._b1._linearContactImpulseY+=t,this._b1._linearContactImpulseZ+=r,this._b1._angularContactImpulseX+=i,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=_,this._b2._linearContactImpulseX-=a,this._b2._linearContactImpulseY-=t,this._b2._linearContactImpulseZ-=r,this._b2._angularContactImpulseX-=s,this._b2._angularContactImpulseY-=h,this._b2._angularContactImpulseZ-=v,this.constraint._syncManifold()}};x.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new x.dynamics.constraint.info.joint.JointSolverInfo;var t=new Array(x.common.Setting.maxJacobianRows);this.massData=t;for(var r=0,i=this.massData.length;r<i;){var o=r++;this.massData[o]=new x.dynamics.constraint.solver.common.JointSolverMassDataRow}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,_=this._b1._invInertia02,s=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobian;if(g.updateSparsity(),g.flag&1?(p.invMLin1X=g.lin1X*t,p.invMLin1Y=g.lin1Y*t,p.invMLin1Z=g.lin1Z*t,p.invMLin2X=g.lin2X*r,p.invMLin2Y=g.lin2Y*r,p.invMLin2Z=g.lin2Z*r):(p.invMLin1X=0,p.invMLin1Y=0,p.invMLin1Z=0,p.invMLin2X=0,p.invMLin2Y=0,p.invMLin2Z=0),g.flag&2){var N,A,F;N=i*g.ang1X+o*g.ang1Y+_*g.ang1Z,A=s*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAng1X=N,p.invMAng1Y=A,p.invMAng1Z=F;var S,Y,R;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAng2X=S,p.invMAng2Y=Y,p.invMAng2Z=R}else p.invMAng1X=0,p.invMAng1Y=0,p.invMAng1Z=0,p.invMAng2X=0,p.invMAng2Y=0,p.invMAng2Z=0;p.massWithoutCfm=p.invMLin1X*g.lin1X+p.invMLin1Y*g.lin1Y+p.invMLin1Z*g.lin1Z+(p.invMLin2X*g.lin2X+p.invMLin2Y*g.lin2Y+p.invMLin2Z*g.lin2Z)+(p.invMAng1X*g.ang1X+p.invMAng1Y*g.ang1Y+p.invMAng1Z*g.ang1Z)+(p.invMAng2X*g.ang2X+p.invMAng2Y*g.ang2Y+p.invMAng2Z*g.ang2Z),p.mass=p.massWithoutCfm+L.cfm,p.massWithoutCfm!=0&&(p.massWithoutCfm=1/p.massWithoutCfm),p.mass!=0&&(p.mass=1/p.mass)}}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?x.common.Setting.jointWarmStartingFactorForBaungarte:x.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var r=0,i=this.info.numRows;r<i;){var o=r++,_=this.info.rows[o],s=_.impulse;s.impulse=0,s.impulseM=0,s.impulseP=0}return}var h,v,e,l,u,b,f,n,c,M,m,y;h=this._b1._velX,v=this._b1._velY,e=this._b1._velZ,l=this._b2._velX,u=this._b2._velY,b=this._b2._velZ,f=this._b1._angVelX,n=this._b1._angVelY,c=this._b1._angVelZ,M=this._b2._angVelX,m=this._b2._angVelY,y=this._b2._angVelZ;for(var V=0,z=this.info.numRows;V<z;){var I=V++,k=this.info.rows[I],X=this.massData[I],L=k.impulse;k.jacobian,L.impulse*=t,L.impulseM*=t;var p=L.impulse+L.impulseM;h+=X.invMLin1X*p,v+=X.invMLin1Y*p,e+=X.invMLin1Z*p,l+=X.invMLin2X*-p,u+=X.invMLin2Y*-p,b+=X.invMLin2Z*-p,f+=X.invMAng1X*p,n+=X.invMAng1Y*p,c+=X.invMAng1Z*p,M+=X.invMAng2X*-p,m+=X.invMAng2Y*-p,y+=X.invMAng2Z*-p}this._b1._velX=h,this._b1._velY=v,this._b1._velZ=e,this._b2._velX=l,this._b2._velY=u,this._b2._velZ=b,this._b1._angVelX=f,this._b1._angVelY=n,this._b1._angVelZ=c,this._b2._angVelX=M,this._b2._angVelY=m,this._b2._angVelZ=y}solveVelocity(){var a,t,r,i,o,_,s,h,v,e,l,u;a=this._b1._velX,t=this._b1._velY,r=this._b1._velZ,i=this._b2._velX,o=this._b2._velY,_=this._b2._velZ,s=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,e=this._b2._angVelX,l=this._b2._angVelY,u=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=c.jacobian;if(c.motorMaxImpulse!=0){var V=0;V+=a*y.lin1X+t*y.lin1Y+r*y.lin1Z,V-=i*y.lin2X+o*y.lin2Y+_*y.lin2Z,V+=s*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var z=(-c.motorSpeed-V)*M.massWithoutCfm,I=m.impulseM;m.impulseM+=z,m.impulseM<-c.motorMaxImpulse?m.impulseM=-c.motorMaxImpulse:m.impulseM>c.motorMaxImpulse&&(m.impulseM=c.motorMaxImpulse),z=m.impulseM-I,y.flag&1&&(a+=M.invMLin1X*z,t+=M.invMLin1Y*z,r+=M.invMLin1Z*z,i+=M.invMLin2X*-z,o+=M.invMLin2Y*-z,_+=M.invMLin2Z*-z),y.flag&2&&(s+=M.invMAng1X*z,h+=M.invMAng1Y*z,v+=M.invMAng1Z*z,e+=M.invMAng2X*-z,l+=M.invMAng2Y*-z,u+=M.invMAng2Z*-z)}}for(var k=0,X=this.info.numRows;k<X;){var L=k++,p=this.info.rows[L],g=this.massData[L],N=p.impulse,A=p.jacobian,F=0;F+=a*A.lin1X+t*A.lin1Y+r*A.lin1Z,F-=i*A.lin2X+o*A.lin2Y+_*A.lin2Z,F+=s*A.ang1X+h*A.ang1Y+v*A.ang1Z,F-=e*A.ang2X+l*A.ang2Y+u*A.ang2Z;var S=(p.rhs-F-N.impulse*p.cfm)*g.mass,Y=N.impulse;N.impulse+=S,N.impulse<p.minImpulse?N.impulse=p.minImpulse:N.impulse>p.maxImpulse&&(N.impulse=p.maxImpulse),S=N.impulse-Y,A.flag&1&&(a+=g.invMLin1X*S,t+=g.invMLin1Y*S,r+=g.invMLin1Z*S,i+=g.invMLin2X*-S,o+=g.invMLin2Y*-S,_+=g.invMLin2Z*-S),A.flag&2&&(s+=g.invMAng1X*S,h+=g.invMAng1Y*S,v+=g.invMAng1Z*S,e+=g.invMAng2X*-S,l+=g.invMAng2Y*-S,u+=g.invMAng2Z*-S)}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=r,this._b2._velX=i,this._b2._velY=o,this._b2._velZ=_,this._b1._angVelX=s,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=e,this._b2._angVelY=l,this._b2._angVelZ=u}postSolveVelocity(a){var t,r,i,o,_,s;t=0,r=0,i=0,o=0,_=0,s=0;for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*u.impulse,r+=b.lin1Y*u.impulse,i+=b.lin1Z*u.impulse):b.flag&2&&(o+=b.ang1X*u.impulse,_+=b.ang1Y*u.impulse,s+=b.ang1Z*u.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=r*a.invDt,this.joint._appliedForceZ=i*a.invDt,this.joint._appliedTorqueX=o*a.invDt,this.joint._appliedTorqueY=_*a.invDt,this.joint._appliedTorqueZ=s*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,_=this._b1._invInertia02,s=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],p=this.massData[X];L.impulse;var g=L.jacobian;p.invMLin1X=g.lin1X*t,p.invMLin1Y=g.lin1Y*t,p.invMLin1Z=g.lin1Z*t,p.invMLin2X=g.lin2X*r,p.invMLin2Y=g.lin2Y*r,p.invMLin2Z=g.lin2Z*r;var N,A,F;N=i*g.ang1X+o*g.ang1Y+_*g.ang1Z,A=s*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAng1X=N,p.invMAng1Y=A,p.invMAng1Z=F;var S,Y,R;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAng2X=S,p.invMAng2Y=Y,p.invMAng2Z=R,p.mass=p.invMLin1X*g.lin1X+p.invMLin1Y*g.lin1Y+p.invMLin1Z*g.lin1Z+(p.invMLin2X*g.lin2X+p.invMLin2Y*g.lin2Y+p.invMLin2Z*g.lin2Z)+(p.invMAng1X*g.ang1X+p.invMAng1Y*g.ang1Y+p.invMAng1Z*g.ang1Z)+(p.invMAng2X*g.ang2X+p.invMAng2Y*g.ang2Y+p.invMAng2Z*g.ang2Z),p.mass!=0&&(p.mass=1/p.mass)}for(var C=0,d=this.info.numRows;C<d;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,r,i,o,_,s,h,v,e,l,u;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,r=this._b1._pseudoVelZ,i=this._b2._pseudoVelX,o=this._b2._pseudoVelY,_=this._b2._pseudoVelZ,s=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,e=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=c.jacobian,V=0;V+=a*y.lin1X+t*y.lin1Y+r*y.lin1Z,V-=i*y.lin2X+o*y.lin2Y+_*y.lin2Z,V+=s*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var z=(c.rhs*x.common.Setting.positionSplitImpulseBaumgarte-V)*M.mass,I=m.impulseP;m.impulseP+=z,m.impulseP<c.minImpulse?m.impulseP=c.minImpulse:m.impulseP>c.maxImpulse&&(m.impulseP=c.maxImpulse),z=m.impulseP-I,a+=M.invMLin1X*z,t+=M.invMLin1Y*z,r+=M.invMLin1Z*z,i+=M.invMLin2X*-z,o+=M.invMLin2Y*-z,_+=M.invMLin2Z*-z,s+=M.invMAng1X*z,h+=M.invMAng1Y*z,v+=M.invMAng1Z*z,e+=M.invMAng2X*-z,l+=M.invMAng2Y*-z,u+=M.invMAng2Z*-z}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=r,this._b2._pseudoVelX=i,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=_,this._b1._angPseudoVelX=s,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=e,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=u}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,_,s,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,_=this._b1._invInertia02,s=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],p=this.massData[X];L.impulse;var g=L.jacobian;p.invMLin1X=g.lin1X*t,p.invMLin1Y=g.lin1Y*t,p.invMLin1Z=g.lin1Z*t,p.invMLin2X=g.lin2X*r,p.invMLin2Y=g.lin2Y*r,p.invMLin2Z=g.lin2Z*r;var N,A,F;N=i*g.ang1X+o*g.ang1Y+_*g.ang1Z,A=s*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAng1X=N,p.invMAng1Y=A,p.invMAng1Z=F;var S,Y,R;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAng2X=S,p.invMAng2Y=Y,p.invMAng2Z=R,p.mass=p.invMLin1X*g.lin1X+p.invMLin1Y*g.lin1Y+p.invMLin1Z*g.lin1Z+(p.invMLin2X*g.lin2X+p.invMLin2Y*g.lin2Y+p.invMLin2Z*g.lin2Z)+(p.invMAng1X*g.ang1X+p.invMAng1Y*g.ang1Y+p.invMAng1Z*g.ang1Z)+(p.invMAng2X*g.ang2X+p.invMAng2Y*g.ang2Y+p.invMAng2Z*g.ang2Z),p.mass!=0&&(p.mass=1/p.mass)}var C,d,Z,$,j,E,G,B,Q,U,J,D;C=0,d=0,Z=0,$=0,j=0,E=0,G=0,B=0,Q=0,U=0,J=0,D=0;for(var H=0,K=this.info.numRows;H<K;){var ra=H++,sa=this.info.rows[ra],W=this.massData[ra],q=sa.impulse,na=sa.jacobian,oa=0;oa+=C*na.lin1X+d*na.lin1Y+Z*na.lin1Z,oa-=$*na.lin2X+j*na.lin2Y+E*na.lin2Z,oa+=G*na.ang1X+B*na.ang1Y+Q*na.ang1Z,oa-=U*na.ang2X+J*na.ang2Y+D*na.ang2Z;var aa=(sa.rhs*x.common.Setting.positionNgsBaumgarte-oa)*W.mass,T=q.impulseP;q.impulseP+=aa,q.impulseP<sa.minImpulse?q.impulseP=sa.minImpulse:q.impulseP>sa.maxImpulse&&(q.impulseP=sa.maxImpulse),aa=q.impulseP-T,C+=W.invMLin1X*aa,d+=W.invMLin1Y*aa,Z+=W.invMLin1Z*aa,$+=W.invMLin2X*-aa,j+=W.invMLin2Y*-aa,E+=W.invMLin2Z*-aa,G+=W.invMAng1X*aa,B+=W.invMAng1Y*aa,Q+=W.invMAng1Z*aa,U+=W.invMAng2X*-aa,J+=W.invMAng2Y*-aa,D+=W.invMAng2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=d,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=$,_a._transform._positionY+=j,_a._transform._positionZ+=E;var w=this._b1,ta=Math.sqrt(G*G+B*B+Q*Q),ia=ta*.5,la,va;if(ia<.5){var xa=ia*ia;la=.5*(1-xa*.16666666666666666+xa*xa*.008333333333333333),va=1-xa*.5+xa*xa*.041666666666666664}else la=Math.sin(ia)/ta,va=Math.cos(ia);var Ma,za,Xa;Ma=G*la,za=B*la,Xa=Q*la;var Za,fa,ba,ea;Za=Ma,fa=za,ba=Xa,ea=va;var ha,pa,ya,da,ma=w._transform._rotation00,Ya=w._transform._rotation11,Qa=w._transform._rotation22,ga=ma+Ya+Qa,ua;ga>0?(ua=Math.sqrt(ga+1),da=.5*ua,ua=.5/ua,ha=(w._transform._rotation21-w._transform._rotation12)*ua,pa=(w._transform._rotation02-w._transform._rotation20)*ua,ya=(w._transform._rotation10-w._transform._rotation01)*ua):ma>Ya?ma>Qa?(ua=Math.sqrt(ma-Ya-Qa+1),ha=.5*ua,ua=.5/ua,pa=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation02+w._transform._rotation20)*ua,da=(w._transform._rotation21-w._transform._rotation12)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,pa=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua):Ya>Qa?(ua=Math.sqrt(Ya-Qa-ma+1),pa=.5*ua,ua=.5/ua,ha=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation02-w._transform._rotation20)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,pa=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua),ha=ea*ha+Za*da+fa*ya-ba*pa,pa=ea*pa-Za*ya+fa*da+ba*ha,ya=ea*ya+Za*pa-fa*ha+ba*da,da=ea*da-Za*ha-fa*pa-ba*ya;var wa=ha*ha+pa*pa+ya*ya+da*da;wa>1e-32&&(wa=1/Math.sqrt(wa)),ha*=wa,pa*=wa,ya*=wa,da*=wa;var ka=ha,Pa=pa,Mt=ya,Ha=da,Ba=2*ka,nt=2*Pa,Ea=2*Mt,Fa=ka*Ba,Aa=Pa*nt,ft=Mt*Ea,Ua=ka*nt,ja=Pa*Ea,bt=ka*Ea,rt=Ha*Ba,$a=Ha*nt,_t=Ha*Ea;w._transform._rotation00=1-Aa-ft,w._transform._rotation01=Ua-_t,w._transform._rotation02=bt+$a,w._transform._rotation10=Ua+_t,w._transform._rotation11=1-Fa-ft,w._transform._rotation12=ja-rt,w._transform._rotation20=bt-$a,w._transform._rotation21=ja+rt,w._transform._rotation22=1-Fa-Aa;var gt,mt,Wa,it,ut,Da,Ta,Na,Vt;gt=w._transform._rotation00*w._invLocalInertia00+w._transform._rotation01*w._invLocalInertia10+w._transform._rotation02*w._invLocalInertia20,mt=w._transform._rotation00*w._invLocalInertia01+w._transform._rotation01*w._invLocalInertia11+w._transform._rotation02*w._invLocalInertia21,Wa=w._transform._rotation00*w._invLocalInertia02+w._transform._rotation01*w._invLocalInertia12+w._transform._rotation02*w._invLocalInertia22,it=w._transform._rotation10*w._invLocalInertia00+w._transform._rotation11*w._invLocalInertia10+w._transform._rotation12*w._invLocalInertia20,ut=w._transform._rotation10*w._invLocalInertia01+w._transform._rotation11*w._invLocalInertia11+w._transform._rotation12*w._invLocalInertia21,Da=w._transform._rotation10*w._invLocalInertia02+w._transform._rotation11*w._invLocalInertia12+w._transform._rotation12*w._invLocalInertia22,Ta=w._transform._rotation20*w._invLocalInertia00+w._transform._rotation21*w._invLocalInertia10+w._transform._rotation22*w._invLocalInertia20,Na=w._transform._rotation20*w._invLocalInertia01+w._transform._rotation21*w._invLocalInertia11+w._transform._rotation22*w._invLocalInertia21,Vt=w._transform._rotation20*w._invLocalInertia02+w._transform._rotation21*w._invLocalInertia12+w._transform._rotation22*w._invLocalInertia22,w._invInertia00=gt,w._invInertia01=mt,w._invInertia02=Wa,w._invInertia10=it,w._invInertia11=ut,w._invInertia12=Da,w._invInertia20=Ta,w._invInertia21=Na,w._invInertia22=Vt;var Pt,et,Xt,Yt,zt,Ia,O,Va,lt;Pt=w._invInertia00*w._transform._rotation00+w._invInertia01*w._transform._rotation01+w._invInertia02*w._transform._rotation02,et=w._invInertia00*w._transform._rotation10+w._invInertia01*w._transform._rotation11+w._invInertia02*w._transform._rotation12,Xt=w._invInertia00*w._transform._rotation20+w._invInertia01*w._transform._rotation21+w._invInertia02*w._transform._rotation22,Yt=w._invInertia10*w._transform._rotation00+w._invInertia11*w._transform._rotation01+w._invInertia12*w._transform._rotation02,zt=w._invInertia10*w._transform._rotation10+w._invInertia11*w._transform._rotation11+w._invInertia12*w._transform._rotation12,Ia=w._invInertia10*w._transform._rotation20+w._invInertia11*w._transform._rotation21+w._invInertia12*w._transform._rotation22,O=w._invInertia20*w._transform._rotation00+w._invInertia21*w._transform._rotation01+w._invInertia22*w._transform._rotation02,Va=w._invInertia20*w._transform._rotation10+w._invInertia21*w._transform._rotation11+w._invInertia22*w._transform._rotation12,lt=w._invInertia20*w._transform._rotation20+w._invInertia21*w._transform._rotation21+w._invInertia22*w._transform._rotation22,w._invInertia00=Pt,w._invInertia01=et,w._invInertia02=Xt,w._invInertia10=Yt,w._invInertia11=zt,w._invInertia12=Ia,w._invInertia20=O,w._invInertia21=Va,w._invInertia22=lt,w._invInertia00*=w._rotFactor.x,w._invInertia01*=w._rotFactor.x,w._invInertia02*=w._rotFactor.x,w._invInertia10*=w._rotFactor.y,w._invInertia11*=w._rotFactor.y,w._invInertia12*=w._rotFactor.y,w._invInertia20*=w._rotFactor.z,w._invInertia21*=w._rotFactor.z,w._invInertia22*=w._rotFactor.z;var P=this._b2,wt=Math.sqrt(U*U+J*J+D*D),Bt=wt*.5,At,yt;if(Bt<.5){var kt=Bt*Bt;At=.5*(1-kt*.16666666666666666+kt*kt*.008333333333333333),yt=1-kt*.5+kt*kt*.041666666666666664}else At=Math.sin(Bt)/wt,yt=Math.cos(Bt);var pt,ht,xt;pt=U*At,ht=J*At,xt=D*At;var Ra,st,Ca,vt;Ra=pt,st=ht,Ca=xt,vt=yt;var qa,at,Oa,tt,ct=P._transform._rotation00,Sa=P._transform._rotation11,Ga=P._transform._rotation22,Ka=ct+Sa+Ga,La;Ka>0?(La=Math.sqrt(Ka+1),tt=.5*La,La=.5/La,qa=(P._transform._rotation21-P._transform._rotation12)*La,at=(P._transform._rotation02-P._transform._rotation20)*La,Oa=(P._transform._rotation10-P._transform._rotation01)*La):ct>Sa?ct>Ga?(La=Math.sqrt(ct-Sa-Ga+1),qa=.5*La,La=.5/La,at=(P._transform._rotation01+P._transform._rotation10)*La,Oa=(P._transform._rotation02+P._transform._rotation20)*La,tt=(P._transform._rotation21-P._transform._rotation12)*La):(La=Math.sqrt(Ga-ct-Sa+1),Oa=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La):Sa>Ga?(La=Math.sqrt(Sa-Ga-ct+1),at=.5*La,La=.5/La,qa=(P._transform._rotation01+P._transform._rotation10)*La,Oa=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation02-P._transform._rotation20)*La):(La=Math.sqrt(Ga-ct-Sa+1),Oa=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La),qa=vt*qa+Ra*tt+st*Oa-Ca*at,at=vt*at-Ra*Oa+st*tt+Ca*qa,Oa=vt*Oa+Ra*at-st*qa+Ca*tt,tt=vt*tt-Ra*qa-st*at-Ca*Oa;var ot=qa*qa+at*at+Oa*Oa+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Oa*=ot,tt*=ot;var It=qa,or=at,gr=Oa,ar=tt,Ct=2*It,_r=2*or,Et=2*gr,St=It*Ct,Gt=or*_r,jr=gr*Et,vr=It*_r,lr=or*Et,tr=It*Et,Or=ar*Ct,Xr=ar*_r,Mr=ar*Et;P._transform._rotation00=1-Gt-jr,P._transform._rotation01=vr-Mr,P._transform._rotation02=tr+Xr,P._transform._rotation10=vr+Mr,P._transform._rotation11=1-St-jr,P._transform._rotation12=lr-Or,P._transform._rotation20=tr-Xr,P._transform._rotation21=lr+Or,P._transform._rotation22=1-St-Gt;var Zt,ir,Wt,nr,$r,Ut,Kr,Ir,mi;Zt=P._transform._rotation00*P._invLocalInertia00+P._transform._rotation01*P._invLocalInertia10+P._transform._rotation02*P._invLocalInertia20,ir=P._transform._rotation00*P._invLocalInertia01+P._transform._rotation01*P._invLocalInertia11+P._transform._rotation02*P._invLocalInertia21,Wt=P._transform._rotation00*P._invLocalInertia02+P._transform._rotation01*P._invLocalInertia12+P._transform._rotation02*P._invLocalInertia22,nr=P._transform._rotation10*P._invLocalInertia00+P._transform._rotation11*P._invLocalInertia10+P._transform._rotation12*P._invLocalInertia20,$r=P._transform._rotation10*P._invLocalInertia01+P._transform._rotation11*P._invLocalInertia11+P._transform._rotation12*P._invLocalInertia21,Ut=P._transform._rotation10*P._invLocalInertia02+P._transform._rotation11*P._invLocalInertia12+P._transform._rotation12*P._invLocalInertia22,Kr=P._transform._rotation20*P._invLocalInertia00+P._transform._rotation21*P._invLocalInertia10+P._transform._rotation22*P._invLocalInertia20,Ir=P._transform._rotation20*P._invLocalInertia01+P._transform._rotation21*P._invLocalInertia11+P._transform._rotation22*P._invLocalInertia21,mi=P._transform._rotation20*P._invLocalInertia02+P._transform._rotation21*P._invLocalInertia12+P._transform._rotation22*P._invLocalInertia22,P._invInertia00=Zt,P._invInertia01=ir,P._invInertia02=Wt,P._invInertia10=nr,P._invInertia11=$r,P._invInertia12=Ut,P._invInertia20=Kr,P._invInertia21=Ir,P._invInertia22=mi;var Wr,Lt,Kt,Tt,br,zr,vi,qt,fr;Wr=P._invInertia00*P._transform._rotation00+P._invInertia01*P._transform._rotation01+P._invInertia02*P._transform._rotation02,Lt=P._invInertia00*P._transform._rotation10+P._invInertia01*P._transform._rotation11+P._invInertia02*P._transform._rotation12,Kt=P._invInertia00*P._transform._rotation20+P._invInertia01*P._transform._rotation21+P._invInertia02*P._transform._rotation22,Tt=P._invInertia10*P._transform._rotation00+P._invInertia11*P._transform._rotation01+P._invInertia12*P._transform._rotation02,br=P._invInertia10*P._transform._rotation10+P._invInertia11*P._transform._rotation11+P._invInertia12*P._transform._rotation12,zr=P._invInertia10*P._transform._rotation20+P._invInertia11*P._transform._rotation21+P._invInertia12*P._transform._rotation22,vi=P._invInertia20*P._transform._rotation00+P._invInertia21*P._transform._rotation01+P._invInertia22*P._transform._rotation02,qt=P._invInertia20*P._transform._rotation10+P._invInertia21*P._transform._rotation11+P._invInertia22*P._transform._rotation12,fr=P._invInertia20*P._transform._rotation20+P._invInertia21*P._transform._rotation21+P._invInertia22*P._transform._rotation22,P._invInertia00=Wr,P._invInertia01=Lt,P._invInertia02=Kt,P._invInertia10=Tt,P._invInertia11=br,P._invInertia12=zr,P._invInertia20=vi,P._invInertia21=qt,P._invInertia22=fr,P._invInertia00*=P._rotFactor.x,P._invInertia01*=P._rotFactor.x,P._invInertia02*=P._rotFactor.x,P._invInertia10*=P._rotFactor.y,P._invInertia11*=P._rotFactor.y,P._invInertia12*=P._rotFactor.y,P._invInertia20*=P._rotFactor.z,P._invInertia21*=P._rotFactor.z,P._invInertia22*=P._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};x.dynamics.rigidbody||(x.dynamics.rigidbody={});x.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new x.common.Mat3}};x.dynamics.rigidbody.RigidBody=class{constructor(a){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var t=a.linearVelocity;this._velX=t.x,this._velY=t.y,this._velZ=t.z;var r=a.angularVelocity;this._angVelX=r.x,this._angVelY=r.y,this._angVelZ=r.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new x.common.Transform,this._transform=new x.common.Transform;var i=a.position;this._ptransform._positionX=i.x,this._ptransform._positionY=i.y,this._ptransform._positionZ=i.z;var o=a.rotation;this._ptransform._rotation00=o.e00,this._ptransform._rotation01=o.e01,this._ptransform._rotation02=o.e02,this._ptransform._rotation10=o.e10,this._ptransform._rotation11=o.e11,this._ptransform._rotation12=o.e12,this._ptransform._rotation20=o.e20,this._ptransform._rotation21=o.e21,this._ptransform._rotation22=o.e22;var _=this._transform,s=this._ptransform;_._positionX=s._positionX,_._positionY=s._positionY,_._positionZ=s._positionZ,_._rotation00=s._rotation00,_._rotation01=s._rotation01,_._rotation02=s._rotation02,_._rotation10=s._rotation10,_._rotation11=s._rotation11,_._rotation12=s._rotation12,_._rotation20=s._rotation20,_._rotation21=s._rotation21,_._rotation22=s._rotation22,this._type=a.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=a.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=a.linearDamping,this._angularDamping=a.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new x.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(a){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var t,r,i,o,_,s;t=this._velX*a,r=this._velY*a,i=this._velZ*a,o=this._angVelX*a,_=this._angVelY*a,s=this._angVelZ*a;var h=t*t+r*r+i*i,v=o*o+_*_+s*s;if(h==0&&v==0)return;if(h>x.common.Setting.maxTranslationPerStep*x.common.Setting.maxTranslationPerStep){var e=x.common.Setting.maxTranslationPerStep/Math.sqrt(h);this._velX*=e,this._velY*=e,this._velZ*=e,t*=e,r*=e,i*=e}if(v>x.common.Setting.maxRotationPerStep*x.common.Setting.maxRotationPerStep){var l=x.common.Setting.maxRotationPerStep/Math.sqrt(v);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,o*=l,_*=l,s*=l}this._transform._positionX+=t,this._transform._positionY+=r,this._transform._positionZ+=i;var u=Math.sqrt(o*o+_*_+s*s),b=u*.5,f,n;if(b<.5){var c=b*b;f=.5*(1-c*.16666666666666666+c*c*.008333333333333333),n=1-c*.5+c*c*.041666666666666664}else f=Math.sin(b)/u,n=Math.cos(b);var M,m,y;M=o*f,m=_*f,y=s*f;var V,z,I,k;V=M,z=m,I=y,k=n;var X,L,p,g,N=this._transform._rotation00,A=this._transform._rotation11,F=this._transform._rotation22,S=N+A+F,Y;S>0?(Y=Math.sqrt(S+1),g=.5*Y,Y=.5/Y,X=(this._transform._rotation21-this._transform._rotation12)*Y,L=(this._transform._rotation02-this._transform._rotation20)*Y,p=(this._transform._rotation10-this._transform._rotation01)*Y):N>A?N>F?(Y=Math.sqrt(N-A-F+1),X=.5*Y,Y=.5/Y,L=(this._transform._rotation01+this._transform._rotation10)*Y,p=(this._transform._rotation02+this._transform._rotation20)*Y,g=(this._transform._rotation21-this._transform._rotation12)*Y):(Y=Math.sqrt(F-N-A+1),p=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y):A>F?(Y=Math.sqrt(A-F-N+1),L=.5*Y,Y=.5/Y,X=(this._transform._rotation01+this._transform._rotation10)*Y,p=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation02-this._transform._rotation20)*Y):(Y=Math.sqrt(F-N-A+1),p=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y),X=k*X+V*g+z*p-I*L,L=k*L-V*p+z*g+I*X,p=k*p+V*L-z*X+I*g,g=k*g-V*X-z*L-I*p;var R=X*X+L*L+p*p+g*g;R>1e-32&&(R=1/Math.sqrt(R)),X*=R,L*=R,p*=R,g*=R;var C=X,d=L,Z=p,$=g,j=2*C,E=2*d,G=2*Z,B=C*j,Q=d*E,U=Z*G,J=C*E,D=d*G,H=C*G,K=$*j,ra=$*E,sa=$*G;this._transform._rotation00=1-Q-U,this._transform._rotation01=J-sa,this._transform._rotation02=H+ra,this._transform._rotation10=J+sa,this._transform._rotation11=1-B-U,this._transform._rotation12=D-K,this._transform._rotation20=H-ra,this._transform._rotation21=D+K,this._transform._rotation22=1-B-Q;var W,q,na,oa,aa,T,ca,_a,w;W=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,q=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,na=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,oa=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,aa=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,ca=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,w=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=W,this._invInertia01=q,this._invInertia02=na,this._invInertia10=oa,this._invInertia11=aa,this._invInertia12=T,this._invInertia20=ca,this._invInertia21=_a,this._invInertia22=w;var ta,ia,la,va,xa,Ma,za,Xa,Za;ta=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ia=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,la=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,va=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,xa=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Ma=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,za=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Za=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ta,this._invInertia01=ia,this._invInertia02=la,this._invInertia10=va,this._invInertia11=xa,this._invInertia12=Ma,this._invInertia20=za,this._invInertia21=Xa,this._invInertia22=Za,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){var a=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,t=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(!(a==0&&t==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var r,i,o,_,s,h;r=this._pseudoVelX,i=this._pseudoVelY,o=this._pseudoVelZ,_=this._angPseudoVelX,s=this._angPseudoVelY,h=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=r,this._transform._positionY+=i,this._transform._positionZ+=o;var v=Math.sqrt(_*_+s*s+h*h),e=v*.5,l,u;if(e<.5){var b=e*e;l=.5*(1-b*.16666666666666666+b*b*.008333333333333333),u=1-b*.5+b*b*.041666666666666664}else l=Math.sin(e)/v,u=Math.cos(e);var f,n,c;f=_*l,n=s*l,c=h*l;var M,m,y,V;M=f,m=n,y=c,V=u;var z,I,k,X,L=this._transform._rotation00,p=this._transform._rotation11,g=this._transform._rotation22,N=L+p+g,A;N>0?(A=Math.sqrt(N+1),X=.5*A,A=.5/A,z=(this._transform._rotation21-this._transform._rotation12)*A,I=(this._transform._rotation02-this._transform._rotation20)*A,k=(this._transform._rotation10-this._transform._rotation01)*A):L>p?L>g?(A=Math.sqrt(L-p-g+1),z=.5*A,A=.5/A,I=(this._transform._rotation01+this._transform._rotation10)*A,k=(this._transform._rotation02+this._transform._rotation20)*A,X=(this._transform._rotation21-this._transform._rotation12)*A):(A=Math.sqrt(g-L-p+1),k=.5*A,A=.5/A,z=(this._transform._rotation02+this._transform._rotation20)*A,I=(this._transform._rotation12+this._transform._rotation21)*A,X=(this._transform._rotation10-this._transform._rotation01)*A):p>g?(A=Math.sqrt(p-g-L+1),I=.5*A,A=.5/A,z=(this._transform._rotation01+this._transform._rotation10)*A,k=(this._transform._rotation12+this._transform._rotation21)*A,X=(this._transform._rotation02-this._transform._rotation20)*A):(A=Math.sqrt(g-L-p+1),k=.5*A,A=.5/A,z=(this._transform._rotation02+this._transform._rotation20)*A,I=(this._transform._rotation12+this._transform._rotation21)*A,X=(this._transform._rotation10-this._transform._rotation01)*A),z=V*z+M*X+m*k-y*I,I=V*I-M*k+m*X+y*z,k=V*k+M*I-m*z+y*X,X=V*X-M*z-m*I-y*k;var F=z*z+I*I+k*k+X*X;F>1e-32&&(F=1/Math.sqrt(F)),z*=F,I*=F,k*=F,X*=F;var S=z,Y=I,R=k,C=X,d=2*S,Z=2*Y,$=2*R,j=S*d,E=Y*Z,G=R*$,B=S*Z,Q=Y*$,U=S*$,J=C*d,D=C*Z,H=C*$;this._transform._rotation00=1-E-G,this._transform._rotation01=B-H,this._transform._rotation02=U+D,this._transform._rotation10=B+H,this._transform._rotation11=1-j-G,this._transform._rotation12=Q-J,this._transform._rotation20=U-D,this._transform._rotation21=Q+J,this._transform._rotation22=1-j-E;var K,ra,sa,W,q,na,oa,aa,T;K=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ra=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,sa=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,W=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,q=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,na=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,oa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,aa=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,T=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=K,this._invInertia01=ra,this._invInertia02=sa,this._invInertia10=W,this._invInertia11=q,this._invInertia12=na,this._invInertia20=oa,this._invInertia21=aa,this._invInertia22=T;var ca,_a,w,ta,ia,la,va,xa,Ma;ca=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,_a=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ta=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ia=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,la=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,va=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Ma=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ca,this._invInertia01=_a,this._invInertia02=w,this._invInertia10=ta,this._invInertia11=ia,this._invInertia12=la,this._invInertia20=va,this._invInertia21=xa,this._invInertia22=Ma,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){var a,t,r,i,o,_,s,h,v;a=0,t=0,r=0,i=0,o=0,_=0,s=0,h=0,v=0;for(var e=0,l=this._shapeList;l!=null;){var u=l._next,b=l._geom;b._updateMass();var f=l._density*b._volume,n,c,M,m,y,V,z,I,k,X,L,p,g,N,A,F,S,Y;X=l._localTransform._rotation00*b._inertiaCoeff00+l._localTransform._rotation01*b._inertiaCoeff10+l._localTransform._rotation02*b._inertiaCoeff20,L=l._localTransform._rotation00*b._inertiaCoeff01+l._localTransform._rotation01*b._inertiaCoeff11+l._localTransform._rotation02*b._inertiaCoeff21,p=l._localTransform._rotation00*b._inertiaCoeff02+l._localTransform._rotation01*b._inertiaCoeff12+l._localTransform._rotation02*b._inertiaCoeff22,g=l._localTransform._rotation10*b._inertiaCoeff00+l._localTransform._rotation11*b._inertiaCoeff10+l._localTransform._rotation12*b._inertiaCoeff20,N=l._localTransform._rotation10*b._inertiaCoeff01+l._localTransform._rotation11*b._inertiaCoeff11+l._localTransform._rotation12*b._inertiaCoeff21,A=l._localTransform._rotation10*b._inertiaCoeff02+l._localTransform._rotation11*b._inertiaCoeff12+l._localTransform._rotation12*b._inertiaCoeff22,F=l._localTransform._rotation20*b._inertiaCoeff00+l._localTransform._rotation21*b._inertiaCoeff10+l._localTransform._rotation22*b._inertiaCoeff20,S=l._localTransform._rotation20*b._inertiaCoeff01+l._localTransform._rotation21*b._inertiaCoeff11+l._localTransform._rotation22*b._inertiaCoeff21,Y=l._localTransform._rotation20*b._inertiaCoeff02+l._localTransform._rotation21*b._inertiaCoeff12+l._localTransform._rotation22*b._inertiaCoeff22,n=X,c=L,M=p,m=g,y=N,V=A,z=F,I=S,k=Y;var R,C,d,Z,$,j,E,G,B;R=n*l._localTransform._rotation00+c*l._localTransform._rotation01+M*l._localTransform._rotation02,C=n*l._localTransform._rotation10+c*l._localTransform._rotation11+M*l._localTransform._rotation12,d=n*l._localTransform._rotation20+c*l._localTransform._rotation21+M*l._localTransform._rotation22,Z=m*l._localTransform._rotation00+y*l._localTransform._rotation01+V*l._localTransform._rotation02,$=m*l._localTransform._rotation10+y*l._localTransform._rotation11+V*l._localTransform._rotation12,j=m*l._localTransform._rotation20+y*l._localTransform._rotation21+V*l._localTransform._rotation22,E=z*l._localTransform._rotation00+I*l._localTransform._rotation01+k*l._localTransform._rotation02,G=z*l._localTransform._rotation10+I*l._localTransform._rotation11+k*l._localTransform._rotation12,B=z*l._localTransform._rotation20+I*l._localTransform._rotation21+k*l._localTransform._rotation22,n=R,c=C,M=d,m=Z,y=$,V=j,z=E,I=G,k=B,n*=f,c*=f,M*=f,m*=f,y*=f,V*=f,z*=f,I*=f,k*=f;var Q,U,J,D,H,K,ra,sa,W,q=l._localTransform._positionX*l._localTransform._positionX,na=l._localTransform._positionY*l._localTransform._positionY,oa=l._localTransform._positionZ*l._localTransform._positionZ,aa=-l._localTransform._positionX*l._localTransform._positionY,T=-l._localTransform._positionY*l._localTransform._positionZ,ca=-l._localTransform._positionZ*l._localTransform._positionX;Q=na+oa,U=aa,J=ca,D=aa,H=q+oa,K=T,ra=ca,sa=T,W=q+na,n+=Q*f,c+=U*f,M+=J*f,m+=D*f,y+=H*f,V+=K*f,z+=ra*f,I+=sa*f,k+=W*f,e+=f,a+=n,t+=c,r+=M,i+=m,o+=y,_+=V,s+=z,h+=I,v+=k,l=u}this._mass=e,this._localInertia00=a,this._localInertia01=t,this._localInertia02=r,this._localInertia10=i,this._localInertia11=o,this._localInertia12=_,this._localInertia20=s,this._localInertia21=h,this._localInertia22=v;var _a=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,w=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ta=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,ia=this._localInertia00*_a-this._localInertia01*w+this._localInertia02*ta;if(this._mass>0&&ia>0&&this._type==0){this._invMass=1/this._mass;var la=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,va=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,xa=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,Ma=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,za=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,Xa=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,Za=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,fa=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,ba=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,ea=this._localInertia00*la-this._localInertia01*va+this._localInertia02*xa;(ea<-1e-32||ea>1e-32)&&(ea=1/ea),this._invLocalInertia00=la*ea,this._invLocalInertia01=-Ma*ea,this._invLocalInertia02=Za*ea,this._invLocalInertia10=-va*ea,this._invLocalInertia11=za*ea,this._invLocalInertia12=-fa*ea,this._invLocalInertia20=xa*ea,this._invLocalInertia21=-Xa*ea,this._invLocalInertia22=ba*ea,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var ha,pa,ya,da,ma,Ya,Qa,ga,ua;ha=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,pa=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,ya=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,da=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,ma=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Ya=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Qa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,ga=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,ua=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=ha,this._invInertia01=pa,this._invInertia02=ya,this._invInertia10=da,this._invInertia11=ma,this._invInertia12=Ya,this._invInertia20=Qa,this._invInertia21=ga,this._invInertia22=ua;var wa,ka,Pa,Mt,Ha,Ba,nt,Ea,Fa;wa=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ka=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Pa=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Mt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Ha=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Ba=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,nt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Ea=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Fa=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=wa,this._invInertia01=ka,this._invInertia02=Pa,this._invInertia10=Mt,this._invInertia11=Ha,this._invInertia12=Ba,this._invInertia20=nt,this._invInertia21=Ea,this._invInertia22=Fa,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){var a=new x.common.Vec3,t=a;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,a}getPositionTo(a){var t=a;t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(a){var t=a;this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;var r=this._ptransform,i=this._transform;r._positionX=i._positionX,r._positionY=i._positionY,r._positionZ=i._positionZ,r._rotation00=i._rotation00,r._rotation01=i._rotation01,r._rotation02=i._rotation02,r._rotation10=i._rotation10,r._rotation11=i._rotation11,r._rotation12=i._rotation12,r._rotation20=i._rotation20,r._rotation21=i._rotation21,r._rotation22=i._rotation22;for(var o=this._shapeList;o!=null;){var _=o._next,s=o._ptransform,h=o._localTransform,v=this._ptransform,e,l,u,b,f,n,c,M,m;e=v._rotation00*h._rotation00+v._rotation01*h._rotation10+v._rotation02*h._rotation20,l=v._rotation00*h._rotation01+v._rotation01*h._rotation11+v._rotation02*h._rotation21,u=v._rotation00*h._rotation02+v._rotation01*h._rotation12+v._rotation02*h._rotation22,b=v._rotation10*h._rotation00+v._rotation11*h._rotation10+v._rotation12*h._rotation20,f=v._rotation10*h._rotation01+v._rotation11*h._rotation11+v._rotation12*h._rotation21,n=v._rotation10*h._rotation02+v._rotation11*h._rotation12+v._rotation12*h._rotation22,c=v._rotation20*h._rotation00+v._rotation21*h._rotation10+v._rotation22*h._rotation20,M=v._rotation20*h._rotation01+v._rotation21*h._rotation11+v._rotation22*h._rotation21,m=v._rotation20*h._rotation02+v._rotation21*h._rotation12+v._rotation22*h._rotation22,s._rotation00=e,s._rotation01=l,s._rotation02=u,s._rotation10=b,s._rotation11=f,s._rotation12=n,s._rotation20=c,s._rotation21=M,s._rotation22=m;var y,V,z;y=v._rotation00*h._positionX+v._rotation01*h._positionY+v._rotation02*h._positionZ,V=v._rotation10*h._positionX+v._rotation11*h._positionY+v._rotation12*h._positionZ,z=v._rotation20*h._positionX+v._rotation21*h._positionY+v._rotation22*h._positionZ,s._positionX=y,s._positionY=V,s._positionZ=z,s._positionX+=v._positionX,s._positionY+=v._positionY,s._positionZ+=v._positionZ;var I=o._transform,k=o._localTransform,X=this._transform,L,p,g,N,A,F,S,Y,R;L=X._rotation00*k._rotation00+X._rotation01*k._rotation10+X._rotation02*k._rotation20,p=X._rotation00*k._rotation01+X._rotation01*k._rotation11+X._rotation02*k._rotation21,g=X._rotation00*k._rotation02+X._rotation01*k._rotation12+X._rotation02*k._rotation22,N=X._rotation10*k._rotation00+X._rotation11*k._rotation10+X._rotation12*k._rotation20,A=X._rotation10*k._rotation01+X._rotation11*k._rotation11+X._rotation12*k._rotation21,F=X._rotation10*k._rotation02+X._rotation11*k._rotation12+X._rotation12*k._rotation22,S=X._rotation20*k._rotation00+X._rotation21*k._rotation10+X._rotation22*k._rotation20,Y=X._rotation20*k._rotation01+X._rotation21*k._rotation11+X._rotation22*k._rotation21,R=X._rotation20*k._rotation02+X._rotation21*k._rotation12+X._rotation22*k._rotation22,I._rotation00=L,I._rotation01=p,I._rotation02=g,I._rotation10=N,I._rotation11=A,I._rotation12=F,I._rotation20=S,I._rotation21=Y,I._rotation22=R;var C,d,Z;C=X._rotation00*k._positionX+X._rotation01*k._positionY+X._rotation02*k._positionZ,d=X._rotation10*k._positionX+X._rotation11*k._positionY+X._rotation12*k._positionZ,Z=X._rotation20*k._positionX+X._rotation21*k._positionY+X._rotation22*k._positionZ,I._positionX=C,I._positionY=d,I._positionZ=Z,I._positionX+=X._positionX,I._positionY+=X._positionY,I._positionZ+=X._positionZ;var $,j,E,G,B,Q;if(o._geom._computeAabb(o._aabb,o._ptransform),$=o._aabb._minX,j=o._aabb._minY,E=o._aabb._minZ,G=o._aabb._maxX,B=o._aabb._maxY,Q=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=$<o._aabb._minX?$:o._aabb._minX,o._aabb._minY=j<o._aabb._minY?j:o._aabb._minY,o._aabb._minZ=E<o._aabb._minZ?E:o._aabb._minZ,o._aabb._maxX=G>o._aabb._maxX?G:o._aabb._maxX,o._aabb._maxY=B>o._aabb._maxY?B:o._aabb._maxY,o._aabb._maxZ=Q>o._aabb._maxZ?Q:o._aabb._maxZ,o._proxy!=null){var U,J,D;U=o._transform._positionX-o._ptransform._positionX,J=o._transform._positionY-o._ptransform._positionY,D=o._transform._positionZ-o._ptransform._positionZ;var H=o.displacement;H.x=U,H.y=J,H.z=D,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=_}this._sleeping=!1,this._sleepTime=0}translate(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._transform._positionX+=t,this._transform._positionY+=r,this._transform._positionZ+=i;var _=this._ptransform,s=this._transform;_._positionX=s._positionX,_._positionY=s._positionY,_._positionZ=s._positionZ,_._rotation00=s._rotation00,_._rotation01=s._rotation01,_._rotation02=s._rotation02,_._rotation10=s._rotation10,_._rotation11=s._rotation11,_._rotation12=s._rotation12,_._rotation20=s._rotation20,_._rotation21=s._rotation21,_._rotation22=s._rotation22;for(var h=this._shapeList;h!=null;){var v=h._next,e=h._ptransform,l=h._localTransform,u=this._ptransform,b,f,n,c,M,m,y,V,z;b=u._rotation00*l._rotation00+u._rotation01*l._rotation10+u._rotation02*l._rotation20,f=u._rotation00*l._rotation01+u._rotation01*l._rotation11+u._rotation02*l._rotation21,n=u._rotation00*l._rotation02+u._rotation01*l._rotation12+u._rotation02*l._rotation22,c=u._rotation10*l._rotation00+u._rotation11*l._rotation10+u._rotation12*l._rotation20,M=u._rotation10*l._rotation01+u._rotation11*l._rotation11+u._rotation12*l._rotation21,m=u._rotation10*l._rotation02+u._rotation11*l._rotation12+u._rotation12*l._rotation22,y=u._rotation20*l._rotation00+u._rotation21*l._rotation10+u._rotation22*l._rotation20,V=u._rotation20*l._rotation01+u._rotation21*l._rotation11+u._rotation22*l._rotation21,z=u._rotation20*l._rotation02+u._rotation21*l._rotation12+u._rotation22*l._rotation22,e._rotation00=b,e._rotation01=f,e._rotation02=n,e._rotation10=c,e._rotation11=M,e._rotation12=m,e._rotation20=y,e._rotation21=V,e._rotation22=z;var I,k,X;I=u._rotation00*l._positionX+u._rotation01*l._positionY+u._rotation02*l._positionZ,k=u._rotation10*l._positionX+u._rotation11*l._positionY+u._rotation12*l._positionZ,X=u._rotation20*l._positionX+u._rotation21*l._positionY+u._rotation22*l._positionZ,e._positionX=I,e._positionY=k,e._positionZ=X,e._positionX+=u._positionX,e._positionY+=u._positionY,e._positionZ+=u._positionZ;var L=h._transform,p=h._localTransform,g=this._transform,N,A,F,S,Y,R,C,d,Z;N=g._rotation00*p._rotation00+g._rotation01*p._rotation10+g._rotation02*p._rotation20,A=g._rotation00*p._rotation01+g._rotation01*p._rotation11+g._rotation02*p._rotation21,F=g._rotation00*p._rotation02+g._rotation01*p._rotation12+g._rotation02*p._rotation22,S=g._rotation10*p._rotation00+g._rotation11*p._rotation10+g._rotation12*p._rotation20,Y=g._rotation10*p._rotation01+g._rotation11*p._rotation11+g._rotation12*p._rotation21,R=g._rotation10*p._rotation02+g._rotation11*p._rotation12+g._rotation12*p._rotation22,C=g._rotation20*p._rotation00+g._rotation21*p._rotation10+g._rotation22*p._rotation20,d=g._rotation20*p._rotation01+g._rotation21*p._rotation11+g._rotation22*p._rotation21,Z=g._rotation20*p._rotation02+g._rotation21*p._rotation12+g._rotation22*p._rotation22,L._rotation00=N,L._rotation01=A,L._rotation02=F,L._rotation10=S,L._rotation11=Y,L._rotation12=R,L._rotation20=C,L._rotation21=d,L._rotation22=Z;var $,j,E;$=g._rotation00*p._positionX+g._rotation01*p._positionY+g._rotation02*p._positionZ,j=g._rotation10*p._positionX+g._rotation11*p._positionY+g._rotation12*p._positionZ,E=g._rotation20*p._positionX+g._rotation21*p._positionY+g._rotation22*p._positionZ,L._positionX=$,L._positionY=j,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var G,B,Q,U,J,D;if(h._geom._computeAabb(h._aabb,h._ptransform),G=h._aabb._minX,B=h._aabb._minY,Q=h._aabb._minZ,U=h._aabb._maxX,J=h._aabb._maxY,D=h._aabb._maxZ,h._geom._computeAabb(h._aabb,h._transform),h._aabb._minX=G<h._aabb._minX?G:h._aabb._minX,h._aabb._minY=B<h._aabb._minY?B:h._aabb._minY,h._aabb._minZ=Q<h._aabb._minZ?Q:h._aabb._minZ,h._aabb._maxX=U>h._aabb._maxX?U:h._aabb._maxX,h._aabb._maxY=J>h._aabb._maxY?J:h._aabb._maxY,h._aabb._maxZ=D>h._aabb._maxZ?D:h._aabb._maxZ,h._proxy!=null){var H,K,ra;H=h._transform._positionX-h._ptransform._positionX,K=h._transform._positionY-h._ptransform._positionY,ra=h._transform._positionZ-h._ptransform._positionZ;var sa=h.displacement;sa.x=H,sa.y=K,sa.z=ra,h._rigidBody._world._broadPhase.moveProxy(h._proxy,h._aabb,h.displacement)}h=v}this._sleeping=!1,this._sleepTime=0}getRotation(){var a=new x.common.Mat3,t=a;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,a}getRotationTo(a){var t=a;t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(a){var t=a;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;var r,i,o,_,s,h,v,e,l;r=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=r,this._invInertia01=i,this._invInertia02=o,this._invInertia10=_,this._invInertia11=s,this._invInertia12=h,this._invInertia20=v,this._invInertia21=e,this._invInertia22=l;var u,b,f,n,c,M,m,y,V;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,M=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,m=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=M,this._invInertia20=m,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var z=this._ptransform,I=this._transform;z._positionX=I._positionX,z._positionY=I._positionY,z._positionZ=I._positionZ,z._rotation00=I._rotation00,z._rotation01=I._rotation01,z._rotation02=I._rotation02,z._rotation10=I._rotation10,z._rotation11=I._rotation11,z._rotation12=I._rotation12,z._rotation20=I._rotation20,z._rotation21=I._rotation21,z._rotation22=I._rotation22;for(var k=this._shapeList;k!=null;){var X=k._next,L=k._ptransform,p=k._localTransform,g=this._ptransform,N,A,F,S,Y,R,C,d,Z;N=g._rotation00*p._rotation00+g._rotation01*p._rotation10+g._rotation02*p._rotation20,A=g._rotation00*p._rotation01+g._rotation01*p._rotation11+g._rotation02*p._rotation21,F=g._rotation00*p._rotation02+g._rotation01*p._rotation12+g._rotation02*p._rotation22,S=g._rotation10*p._rotation00+g._rotation11*p._rotation10+g._rotation12*p._rotation20,Y=g._rotation10*p._rotation01+g._rotation11*p._rotation11+g._rotation12*p._rotation21,R=g._rotation10*p._rotation02+g._rotation11*p._rotation12+g._rotation12*p._rotation22,C=g._rotation20*p._rotation00+g._rotation21*p._rotation10+g._rotation22*p._rotation20,d=g._rotation20*p._rotation01+g._rotation21*p._rotation11+g._rotation22*p._rotation21,Z=g._rotation20*p._rotation02+g._rotation21*p._rotation12+g._rotation22*p._rotation22,L._rotation00=N,L._rotation01=A,L._rotation02=F,L._rotation10=S,L._rotation11=Y,L._rotation12=R,L._rotation20=C,L._rotation21=d,L._rotation22=Z;var $,j,E;$=g._rotation00*p._positionX+g._rotation01*p._positionY+g._rotation02*p._positionZ,j=g._rotation10*p._positionX+g._rotation11*p._positionY+g._rotation12*p._positionZ,E=g._rotation20*p._positionX+g._rotation21*p._positionY+g._rotation22*p._positionZ,L._positionX=$,L._positionY=j,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var G=k._transform,B=k._localTransform,Q=this._transform,U,J,D,H,K,ra,sa,W,q;U=Q._rotation00*B._rotation00+Q._rotation01*B._rotation10+Q._rotation02*B._rotation20,J=Q._rotation00*B._rotation01+Q._rotation01*B._rotation11+Q._rotation02*B._rotation21,D=Q._rotation00*B._rotation02+Q._rotation01*B._rotation12+Q._rotation02*B._rotation22,H=Q._rotation10*B._rotation00+Q._rotation11*B._rotation10+Q._rotation12*B._rotation20,K=Q._rotation10*B._rotation01+Q._rotation11*B._rotation11+Q._rotation12*B._rotation21,ra=Q._rotation10*B._rotation02+Q._rotation11*B._rotation12+Q._rotation12*B._rotation22,sa=Q._rotation20*B._rotation00+Q._rotation21*B._rotation10+Q._rotation22*B._rotation20,W=Q._rotation20*B._rotation01+Q._rotation21*B._rotation11+Q._rotation22*B._rotation21,q=Q._rotation20*B._rotation02+Q._rotation21*B._rotation12+Q._rotation22*B._rotation22,G._rotation00=U,G._rotation01=J,G._rotation02=D,G._rotation10=H,G._rotation11=K,G._rotation12=ra,G._rotation20=sa,G._rotation21=W,G._rotation22=q;var na,oa,aa;na=Q._rotation00*B._positionX+Q._rotation01*B._positionY+Q._rotation02*B._positionZ,oa=Q._rotation10*B._positionX+Q._rotation11*B._positionY+Q._rotation12*B._positionZ,aa=Q._rotation20*B._positionX+Q._rotation21*B._positionY+Q._rotation22*B._positionZ,G._positionX=na,G._positionY=oa,G._positionZ=aa,G._positionX+=Q._positionX,G._positionY+=Q._positionY,G._positionZ+=Q._positionZ;var T,ca,_a,w,ta,ia;if(k._geom._computeAabb(k._aabb,k._ptransform),T=k._aabb._minX,ca=k._aabb._minY,_a=k._aabb._minZ,w=k._aabb._maxX,ta=k._aabb._maxY,ia=k._aabb._maxZ,k._geom._computeAabb(k._aabb,k._transform),k._aabb._minX=T<k._aabb._minX?T:k._aabb._minX,k._aabb._minY=ca<k._aabb._minY?ca:k._aabb._minY,k._aabb._minZ=_a<k._aabb._minZ?_a:k._aabb._minZ,k._aabb._maxX=w>k._aabb._maxX?w:k._aabb._maxX,k._aabb._maxY=ta>k._aabb._maxY?ta:k._aabb._maxY,k._aabb._maxZ=ia>k._aabb._maxZ?ia:k._aabb._maxZ,k._proxy!=null){var la,va,xa;la=k._transform._positionX-k._ptransform._positionX,va=k._transform._positionY-k._ptransform._positionY,xa=k._transform._positionZ-k._ptransform._positionZ;var Ma=k.displacement;Ma.x=la,Ma.y=va,Ma.z=xa,k._rigidBody._world._broadPhase.moveProxy(k._proxy,k._aabb,k.displacement)}k=X}this._sleeping=!1,this._sleepTime=0}setRotationXyz(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var _=Math.sin(t),s=Math.sin(r),h=Math.sin(i),v=Math.cos(t),e=Math.cos(r),l=Math.cos(i);this._transform._rotation00=e*l,this._transform._rotation01=-e*h,this._transform._rotation02=s,this._transform._rotation10=v*h+l*_*s,this._transform._rotation11=v*l-_*s*h,this._transform._rotation12=-e*_,this._transform._rotation20=_*h-v*l*s,this._transform._rotation21=l*_+v*s*h,this._transform._rotation22=v*e;var u,b,f,n,c,M,m,y,V;u=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,b=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,c=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,M=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,m=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,y=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=M,this._invInertia20=m,this._invInertia21=y,this._invInertia22=V;var z,I,k,X,L,p,g,N,A;z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,I=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,k=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,X=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,L=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,N=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,A=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=z,this._invInertia01=I,this._invInertia02=k,this._invInertia10=X,this._invInertia11=L,this._invInertia12=p,this._invInertia20=g,this._invInertia21=N,this._invInertia22=A,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var F=this._ptransform,S=this._transform;F._positionX=S._positionX,F._positionY=S._positionY,F._positionZ=S._positionZ,F._rotation00=S._rotation00,F._rotation01=S._rotation01,F._rotation02=S._rotation02,F._rotation10=S._rotation10,F._rotation11=S._rotation11,F._rotation12=S._rotation12,F._rotation20=S._rotation20,F._rotation21=S._rotation21,F._rotation22=S._rotation22;for(var Y=this._shapeList;Y!=null;){var R=Y._next,C=Y._ptransform,d=Y._localTransform,Z=this._ptransform,$,j,E,G,B,Q,U,J,D;$=Z._rotation00*d._rotation00+Z._rotation01*d._rotation10+Z._rotation02*d._rotation20,j=Z._rotation00*d._rotation01+Z._rotation01*d._rotation11+Z._rotation02*d._rotation21,E=Z._rotation00*d._rotation02+Z._rotation01*d._rotation12+Z._rotation02*d._rotation22,G=Z._rotation10*d._rotation00+Z._rotation11*d._rotation10+Z._rotation12*d._rotation20,B=Z._rotation10*d._rotation01+Z._rotation11*d._rotation11+Z._rotation12*d._rotation21,Q=Z._rotation10*d._rotation02+Z._rotation11*d._rotation12+Z._rotation12*d._rotation22,U=Z._rotation20*d._rotation00+Z._rotation21*d._rotation10+Z._rotation22*d._rotation20,J=Z._rotation20*d._rotation01+Z._rotation21*d._rotation11+Z._rotation22*d._rotation21,D=Z._rotation20*d._rotation02+Z._rotation21*d._rotation12+Z._rotation22*d._rotation22,C._rotation00=$,C._rotation01=j,C._rotation02=E,C._rotation10=G,C._rotation11=B,C._rotation12=Q,C._rotation20=U,C._rotation21=J,C._rotation22=D;var H,K,ra;H=Z._rotation00*d._positionX+Z._rotation01*d._positionY+Z._rotation02*d._positionZ,K=Z._rotation10*d._positionX+Z._rotation11*d._positionY+Z._rotation12*d._positionZ,ra=Z._rotation20*d._positionX+Z._rotation21*d._positionY+Z._rotation22*d._positionZ,C._positionX=H,C._positionY=K,C._positionZ=ra,C._positionX+=Z._positionX,C._positionY+=Z._positionY,C._positionZ+=Z._positionZ;var sa=Y._transform,W=Y._localTransform,q=this._transform,na,oa,aa,T,ca,_a,w,ta,ia;na=q._rotation00*W._rotation00+q._rotation01*W._rotation10+q._rotation02*W._rotation20,oa=q._rotation00*W._rotation01+q._rotation01*W._rotation11+q._rotation02*W._rotation21,aa=q._rotation00*W._rotation02+q._rotation01*W._rotation12+q._rotation02*W._rotation22,T=q._rotation10*W._rotation00+q._rotation11*W._rotation10+q._rotation12*W._rotation20,ca=q._rotation10*W._rotation01+q._rotation11*W._rotation11+q._rotation12*W._rotation21,_a=q._rotation10*W._rotation02+q._rotation11*W._rotation12+q._rotation12*W._rotation22,w=q._rotation20*W._rotation00+q._rotation21*W._rotation10+q._rotation22*W._rotation20,ta=q._rotation20*W._rotation01+q._rotation21*W._rotation11+q._rotation22*W._rotation21,ia=q._rotation20*W._rotation02+q._rotation21*W._rotation12+q._rotation22*W._rotation22,sa._rotation00=na,sa._rotation01=oa,sa._rotation02=aa,sa._rotation10=T,sa._rotation11=ca,sa._rotation12=_a,sa._rotation20=w,sa._rotation21=ta,sa._rotation22=ia;var la,va,xa;la=q._rotation00*W._positionX+q._rotation01*W._positionY+q._rotation02*W._positionZ,va=q._rotation10*W._positionX+q._rotation11*W._positionY+q._rotation12*W._positionZ,xa=q._rotation20*W._positionX+q._rotation21*W._positionY+q._rotation22*W._positionZ,sa._positionX=la,sa._positionY=va,sa._positionZ=xa,sa._positionX+=q._positionX,sa._positionY+=q._positionY,sa._positionZ+=q._positionZ;var Ma,za,Xa,Za,fa,ba;if(Y._geom._computeAabb(Y._aabb,Y._ptransform),Ma=Y._aabb._minX,za=Y._aabb._minY,Xa=Y._aabb._minZ,Za=Y._aabb._maxX,fa=Y._aabb._maxY,ba=Y._aabb._maxZ,Y._geom._computeAabb(Y._aabb,Y._transform),Y._aabb._minX=Ma<Y._aabb._minX?Ma:Y._aabb._minX,Y._aabb._minY=za<Y._aabb._minY?za:Y._aabb._minY,Y._aabb._minZ=Xa<Y._aabb._minZ?Xa:Y._aabb._minZ,Y._aabb._maxX=Za>Y._aabb._maxX?Za:Y._aabb._maxX,Y._aabb._maxY=fa>Y._aabb._maxY?fa:Y._aabb._maxY,Y._aabb._maxZ=ba>Y._aabb._maxZ?ba:Y._aabb._maxZ,Y._proxy!=null){var ea,ha,pa;ea=Y._transform._positionX-Y._ptransform._positionX,ha=Y._transform._positionY-Y._ptransform._positionY,pa=Y._transform._positionZ-Y._ptransform._positionZ;var ya=Y.displacement;ya.x=ea,ya.y=ha,ya.z=pa,Y._rigidBody._world._broadPhase.moveProxy(Y._proxy,Y._aabb,Y.displacement)}Y=R}this._sleeping=!1,this._sleepTime=0}rotate(a){var t,r,i,o,_,s,h,v,e,l=a;t=l.e00,r=l.e01,i=l.e02,o=l.e10,_=l.e11,s=l.e12,h=l.e20,v=l.e21,e=l.e22;var u,b,f,n,c,M,m,y,V;u=t*this._transform._rotation00+r*this._transform._rotation10+i*this._transform._rotation20,b=t*this._transform._rotation01+r*this._transform._rotation11+i*this._transform._rotation21,f=t*this._transform._rotation02+r*this._transform._rotation12+i*this._transform._rotation22,n=o*this._transform._rotation00+_*this._transform._rotation10+s*this._transform._rotation20,c=o*this._transform._rotation01+_*this._transform._rotation11+s*this._transform._rotation21,M=o*this._transform._rotation02+_*this._transform._rotation12+s*this._transform._rotation22,m=h*this._transform._rotation00+v*this._transform._rotation10+e*this._transform._rotation20,y=h*this._transform._rotation01+v*this._transform._rotation11+e*this._transform._rotation21,V=h*this._transform._rotation02+v*this._transform._rotation12+e*this._transform._rotation22,this._transform._rotation00=u,this._transform._rotation01=b,this._transform._rotation02=f,this._transform._rotation10=n,this._transform._rotation11=c,this._transform._rotation12=M,this._transform._rotation20=m,this._transform._rotation21=y,this._transform._rotation22=V;var z,I,k,X,L,p,g,N,A;z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,k=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,L=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,g=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,N=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=z,this._invInertia01=I,this._invInertia02=k,this._invInertia10=X,this._invInertia11=L,this._invInertia12=p,this._invInertia20=g,this._invInertia21=N,this._invInertia22=A;var F,S,Y,R,C,d,Z,$,j;F=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,S=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,C=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,$=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,j=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=F,this._invInertia01=S,this._invInertia02=Y,this._invInertia10=R,this._invInertia11=C,this._invInertia12=d,this._invInertia20=Z,this._invInertia21=$,this._invInertia22=j,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var E=this._ptransform,G=this._transform;E._positionX=G._positionX,E._positionY=G._positionY,E._positionZ=G._positionZ,E._rotation00=G._rotation00,E._rotation01=G._rotation01,E._rotation02=G._rotation02,E._rotation10=G._rotation10,E._rotation11=G._rotation11,E._rotation12=G._rotation12,E._rotation20=G._rotation20,E._rotation21=G._rotation21,E._rotation22=G._rotation22;for(var B=this._shapeList;B!=null;){var Q=B._next,U=B._ptransform,J=B._localTransform,D=this._ptransform,H,K,ra,sa,W,q,na,oa,aa;H=D._rotation00*J._rotation00+D._rotation01*J._rotation10+D._rotation02*J._rotation20,K=D._rotation00*J._rotation01+D._rotation01*J._rotation11+D._rotation02*J._rotation21,ra=D._rotation00*J._rotation02+D._rotation01*J._rotation12+D._rotation02*J._rotation22,sa=D._rotation10*J._rotation00+D._rotation11*J._rotation10+D._rotation12*J._rotation20,W=D._rotation10*J._rotation01+D._rotation11*J._rotation11+D._rotation12*J._rotation21,q=D._rotation10*J._rotation02+D._rotation11*J._rotation12+D._rotation12*J._rotation22,na=D._rotation20*J._rotation00+D._rotation21*J._rotation10+D._rotation22*J._rotation20,oa=D._rotation20*J._rotation01+D._rotation21*J._rotation11+D._rotation22*J._rotation21,aa=D._rotation20*J._rotation02+D._rotation21*J._rotation12+D._rotation22*J._rotation22,U._rotation00=H,U._rotation01=K,U._rotation02=ra,U._rotation10=sa,U._rotation11=W,U._rotation12=q,U._rotation20=na,U._rotation21=oa,U._rotation22=aa;var T,ca,_a;T=D._rotation00*J._positionX+D._rotation01*J._positionY+D._rotation02*J._positionZ,ca=D._rotation10*J._positionX+D._rotation11*J._positionY+D._rotation12*J._positionZ,_a=D._rotation20*J._positionX+D._rotation21*J._positionY+D._rotation22*J._positionZ,U._positionX=T,U._positionY=ca,U._positionZ=_a,U._positionX+=D._positionX,U._positionY+=D._positionY,U._positionZ+=D._positionZ;var w=B._transform,ta=B._localTransform,ia=this._transform,la,va,xa,Ma,za,Xa,Za,fa,ba;la=ia._rotation00*ta._rotation00+ia._rotation01*ta._rotation10+ia._rotation02*ta._rotation20,va=ia._rotation00*ta._rotation01+ia._rotation01*ta._rotation11+ia._rotation02*ta._rotation21,xa=ia._rotation00*ta._rotation02+ia._rotation01*ta._rotation12+ia._rotation02*ta._rotation22,Ma=ia._rotation10*ta._rotation00+ia._rotation11*ta._rotation10+ia._rotation12*ta._rotation20,za=ia._rotation10*ta._rotation01+ia._rotation11*ta._rotation11+ia._rotation12*ta._rotation21,Xa=ia._rotation10*ta._rotation02+ia._rotation11*ta._rotation12+ia._rotation12*ta._rotation22,Za=ia._rotation20*ta._rotation00+ia._rotation21*ta._rotation10+ia._rotation22*ta._rotation20,fa=ia._rotation20*ta._rotation01+ia._rotation21*ta._rotation11+ia._rotation22*ta._rotation21,ba=ia._rotation20*ta._rotation02+ia._rotation21*ta._rotation12+ia._rotation22*ta._rotation22,w._rotation00=la,w._rotation01=va,w._rotation02=xa,w._rotation10=Ma,w._rotation11=za,w._rotation12=Xa,w._rotation20=Za,w._rotation21=fa,w._rotation22=ba;var ea,ha,pa;ea=ia._rotation00*ta._positionX+ia._rotation01*ta._positionY+ia._rotation02*ta._positionZ,ha=ia._rotation10*ta._positionX+ia._rotation11*ta._positionY+ia._rotation12*ta._positionZ,pa=ia._rotation20*ta._positionX+ia._rotation21*ta._positionY+ia._rotation22*ta._positionZ,w._positionX=ea,w._positionY=ha,w._positionZ=pa,w._positionX+=ia._positionX,w._positionY+=ia._positionY,w._positionZ+=ia._positionZ;var ya,da,ma,Ya,Qa,ga;if(B._geom._computeAabb(B._aabb,B._ptransform),ya=B._aabb._minX,da=B._aabb._minY,ma=B._aabb._minZ,Ya=B._aabb._maxX,Qa=B._aabb._maxY,ga=B._aabb._maxZ,B._geom._computeAabb(B._aabb,B._transform),B._aabb._minX=ya<B._aabb._minX?ya:B._aabb._minX,B._aabb._minY=da<B._aabb._minY?da:B._aabb._minY,B._aabb._minZ=ma<B._aabb._minZ?ma:B._aabb._minZ,B._aabb._maxX=Ya>B._aabb._maxX?Ya:B._aabb._maxX,B._aabb._maxY=Qa>B._aabb._maxY?Qa:B._aabb._maxY,B._aabb._maxZ=ga>B._aabb._maxZ?ga:B._aabb._maxZ,B._proxy!=null){var ua,wa,ka;ua=B._transform._positionX-B._ptransform._positionX,wa=B._transform._positionY-B._ptransform._positionY,ka=B._transform._positionZ-B._ptransform._positionZ;var Pa=B.displacement;Pa.x=ua,Pa.y=wa,Pa.z=ka,B._rigidBody._world._broadPhase.moveProxy(B._proxy,B._aabb,B.displacement)}B=Q}this._sleeping=!1,this._sleepTime=0}rotateXyz(a){var t,r,i,o,_,s,h,v,e,l,u,b,f=a;t=f.x,r=f.y,i=f.z;var n=Math.sin(t),c=Math.sin(r),M=Math.sin(i),m=Math.cos(t),y=Math.cos(r),V=Math.cos(i);o=y*V,_=-y*M,s=c,h=m*M+V*n*c,v=m*V-n*c*M,e=-y*n,l=n*M-m*V*c,u=V*n+m*c*M,b=m*y;var z,I,k,X,L,p,g,N,A;z=o*this._transform._rotation00+_*this._transform._rotation10+s*this._transform._rotation20,I=o*this._transform._rotation01+_*this._transform._rotation11+s*this._transform._rotation21,k=o*this._transform._rotation02+_*this._transform._rotation12+s*this._transform._rotation22,X=h*this._transform._rotation00+v*this._transform._rotation10+e*this._transform._rotation20,L=h*this._transform._rotation01+v*this._transform._rotation11+e*this._transform._rotation21,p=h*this._transform._rotation02+v*this._transform._rotation12+e*this._transform._rotation22,g=l*this._transform._rotation00+u*this._transform._rotation10+b*this._transform._rotation20,N=l*this._transform._rotation01+u*this._transform._rotation11+b*this._transform._rotation21,A=l*this._transform._rotation02+u*this._transform._rotation12+b*this._transform._rotation22,this._transform._rotation00=z,this._transform._rotation01=I,this._transform._rotation02=k,this._transform._rotation10=X,this._transform._rotation11=L,this._transform._rotation12=p,this._transform._rotation20=g,this._transform._rotation21=N,this._transform._rotation22=A;var F,S,Y,R,C,d,Z,$,j;F=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,S=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,R=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,C=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,d=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,$=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,j=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=F,this._invInertia01=S,this._invInertia02=Y,this._invInertia10=R,this._invInertia11=C,this._invInertia12=d,this._invInertia20=Z,this._invInertia21=$,this._invInertia22=j;var E,G,B,Q,U,J,D,H,K;E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,G=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,U=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,J=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,H=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,K=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=G,this._invInertia02=B,this._invInertia10=Q,this._invInertia11=U,this._invInertia12=J,this._invInertia20=D,this._invInertia21=H,this._invInertia22=K,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var ra=this._ptransform,sa=this._transform;ra._positionX=sa._positionX,ra._positionY=sa._positionY,ra._positionZ=sa._positionZ,ra._rotation00=sa._rotation00,ra._rotation01=sa._rotation01,ra._rotation02=sa._rotation02,ra._rotation10=sa._rotation10,ra._rotation11=sa._rotation11,ra._rotation12=sa._rotation12,ra._rotation20=sa._rotation20,ra._rotation21=sa._rotation21,ra._rotation22=sa._rotation22;for(var W=this._shapeList;W!=null;){var q=W._next,na=W._ptransform,oa=W._localTransform,aa=this._ptransform,T,ca,_a,w,ta,ia,la,va,xa;T=aa._rotation00*oa._rotation00+aa._rotation01*oa._rotation10+aa._rotation02*oa._rotation20,ca=aa._rotation00*oa._rotation01+aa._rotation01*oa._rotation11+aa._rotation02*oa._rotation21,_a=aa._rotation00*oa._rotation02+aa._rotation01*oa._rotation12+aa._rotation02*oa._rotation22,w=aa._rotation10*oa._rotation00+aa._rotation11*oa._rotation10+aa._rotation12*oa._rotation20,ta=aa._rotation10*oa._rotation01+aa._rotation11*oa._rotation11+aa._rotation12*oa._rotation21,ia=aa._rotation10*oa._rotation02+aa._rotation11*oa._rotation12+aa._rotation12*oa._rotation22,la=aa._rotation20*oa._rotation00+aa._rotation21*oa._rotation10+aa._rotation22*oa._rotation20,va=aa._rotation20*oa._rotation01+aa._rotation21*oa._rotation11+aa._rotation22*oa._rotation21,xa=aa._rotation20*oa._rotation02+aa._rotation21*oa._rotation12+aa._rotation22*oa._rotation22,na._rotation00=T,na._rotation01=ca,na._rotation02=_a,na._rotation10=w,na._rotation11=ta,na._rotation12=ia,na._rotation20=la,na._rotation21=va,na._rotation22=xa;var Ma,za,Xa;Ma=aa._rotation00*oa._positionX+aa._rotation01*oa._positionY+aa._rotation02*oa._positionZ,za=aa._rotation10*oa._positionX+aa._rotation11*oa._positionY+aa._rotation12*oa._positionZ,Xa=aa._rotation20*oa._positionX+aa._rotation21*oa._positionY+aa._rotation22*oa._positionZ,na._positionX=Ma,na._positionY=za,na._positionZ=Xa,na._positionX+=aa._positionX,na._positionY+=aa._positionY,na._positionZ+=aa._positionZ;var Za=W._transform,fa=W._localTransform,ba=this._transform,ea,ha,pa,ya,da,ma,Ya,Qa,ga;ea=ba._rotation00*fa._rotation00+ba._rotation01*fa._rotation10+ba._rotation02*fa._rotation20,ha=ba._rotation00*fa._rotation01+ba._rotation01*fa._rotation11+ba._rotation02*fa._rotation21,pa=ba._rotation00*fa._rotation02+ba._rotation01*fa._rotation12+ba._rotation02*fa._rotation22,ya=ba._rotation10*fa._rotation00+ba._rotation11*fa._rotation10+ba._rotation12*fa._rotation20,da=ba._rotation10*fa._rotation01+ba._rotation11*fa._rotation11+ba._rotation12*fa._rotation21,ma=ba._rotation10*fa._rotation02+ba._rotation11*fa._rotation12+ba._rotation12*fa._rotation22,Ya=ba._rotation20*fa._rotation00+ba._rotation21*fa._rotation10+ba._rotation22*fa._rotation20,Qa=ba._rotation20*fa._rotation01+ba._rotation21*fa._rotation11+ba._rotation22*fa._rotation21,ga=ba._rotation20*fa._rotation02+ba._rotation21*fa._rotation12+ba._rotation22*fa._rotation22,Za._rotation00=ea,Za._rotation01=ha,Za._rotation02=pa,Za._rotation10=ya,Za._rotation11=da,Za._rotation12=ma,Za._rotation20=Ya,Za._rotation21=Qa,Za._rotation22=ga;var ua,wa,ka;ua=ba._rotation00*fa._positionX+ba._rotation01*fa._positionY+ba._rotation02*fa._positionZ,wa=ba._rotation10*fa._positionX+ba._rotation11*fa._positionY+ba._rotation12*fa._positionZ,ka=ba._rotation20*fa._positionX+ba._rotation21*fa._positionY+ba._rotation22*fa._positionZ,Za._positionX=ua,Za._positionY=wa,Za._positionZ=ka,Za._positionX+=ba._positionX,Za._positionY+=ba._positionY,Za._positionZ+=ba._positionZ;var Pa,Mt,Ha,Ba,nt,Ea;if(W._geom._computeAabb(W._aabb,W._ptransform),Pa=W._aabb._minX,Mt=W._aabb._minY,Ha=W._aabb._minZ,Ba=W._aabb._maxX,nt=W._aabb._maxY,Ea=W._aabb._maxZ,W._geom._computeAabb(W._aabb,W._transform),W._aabb._minX=Pa<W._aabb._minX?Pa:W._aabb._minX,W._aabb._minY=Mt<W._aabb._minY?Mt:W._aabb._minY,W._aabb._minZ=Ha<W._aabb._minZ?Ha:W._aabb._minZ,W._aabb._maxX=Ba>W._aabb._maxX?Ba:W._aabb._maxX,W._aabb._maxY=nt>W._aabb._maxY?nt:W._aabb._maxY,W._aabb._maxZ=Ea>W._aabb._maxZ?Ea:W._aabb._maxZ,W._proxy!=null){var Fa,Aa,ft;Fa=W._transform._positionX-W._ptransform._positionX,Aa=W._transform._positionY-W._ptransform._positionY,ft=W._transform._positionZ-W._ptransform._positionZ;var Ua=W.displacement;Ua.x=Fa,Ua.y=Aa,Ua.z=ft,W._rigidBody._world._broadPhase.moveProxy(W._proxy,W._aabb,W.displacement)}W=q}this._sleeping=!1,this._sleepTime=0}getOrientation(){var a=new x.common.Quat,t,r,i,o,_=this._transform._rotation00,s=this._transform._rotation11,h=this._transform._rotation22,v=_+s+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._transform._rotation21-this._transform._rotation12)*e,r=(this._transform._rotation02-this._transform._rotation20)*e,i=(this._transform._rotation10-this._transform._rotation01)*e):_>s?_>h?(e=Math.sqrt(_-s-h+1),t=.5*e,e=.5/e,r=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation02+this._transform._rotation20)*e,o=(this._transform._rotation21-this._transform._rotation12)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e):s>h?(e=Math.sqrt(s-h-_+1),r=.5*e,e=.5/e,t=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation02-this._transform._rotation20)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e);var l=a;return l.x=t,l.y=r,l.z=i,l.w=o,a}getOrientationTo(a){var t,r,i,o,_=this._transform._rotation00,s=this._transform._rotation11,h=this._transform._rotation22,v=_+s+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._transform._rotation21-this._transform._rotation12)*e,r=(this._transform._rotation02-this._transform._rotation20)*e,i=(this._transform._rotation10-this._transform._rotation01)*e):_>s?_>h?(e=Math.sqrt(_-s-h+1),t=.5*e,e=.5/e,r=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation02+this._transform._rotation20)*e,o=(this._transform._rotation21-this._transform._rotation12)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e):s>h?(e=Math.sqrt(s-h-_+1),r=.5*e,e=.5/e,t=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation02-this._transform._rotation20)*e):(e=Math.sqrt(h-_-s+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e);var l=a;l.x=t,l.y=r,l.z=i,l.w=o}setOrientation(a){var t,r,i,o,_=a;t=_.x,r=_.y,i=_.z,o=_.w;var s=t,h=r,v=i,e=o,l=2*s,u=2*h,b=2*v,f=s*l,n=h*u,c=v*b,M=s*u,m=h*b,y=s*b,V=e*l,z=e*u,I=e*b;this._transform._rotation00=1-n-c,this._transform._rotation01=M-I,this._transform._rotation02=y+z,this._transform._rotation10=M+I,this._transform._rotation11=1-f-c,this._transform._rotation12=m-V,this._transform._rotation20=y-z,this._transform._rotation21=m+V,this._transform._rotation22=1-f-n;var k,X,L,p,g,N,A,F,S;k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,p=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,g=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,N=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,A=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,F=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=X,this._invInertia02=L,this._invInertia10=p,this._invInertia11=g,this._invInertia12=N,this._invInertia20=A,this._invInertia21=F,this._invInertia22=S;var Y,R,C,d,Z,$,j,E,G;Y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,R=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,C=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Z=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,$=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,j=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,E=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,G=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Y,this._invInertia01=R,this._invInertia02=C,this._invInertia10=d,this._invInertia11=Z,this._invInertia12=$,this._invInertia20=j,this._invInertia21=E,this._invInertia22=G,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var B=this._ptransform,Q=this._transform;B._positionX=Q._positionX,B._positionY=Q._positionY,B._positionZ=Q._positionZ,B._rotation00=Q._rotation00,B._rotation01=Q._rotation01,B._rotation02=Q._rotation02,B._rotation10=Q._rotation10,B._rotation11=Q._rotation11,B._rotation12=Q._rotation12,B._rotation20=Q._rotation20,B._rotation21=Q._rotation21,B._rotation22=Q._rotation22;for(var U=this._shapeList;U!=null;){var J=U._next,D=U._ptransform,H=U._localTransform,K=this._ptransform,ra,sa,W,q,na,oa,aa,T,ca;ra=K._rotation00*H._rotation00+K._rotation01*H._rotation10+K._rotation02*H._rotation20,sa=K._rotation00*H._rotation01+K._rotation01*H._rotation11+K._rotation02*H._rotation21,W=K._rotation00*H._rotation02+K._rotation01*H._rotation12+K._rotation02*H._rotation22,q=K._rotation10*H._rotation00+K._rotation11*H._rotation10+K._rotation12*H._rotation20,na=K._rotation10*H._rotation01+K._rotation11*H._rotation11+K._rotation12*H._rotation21,oa=K._rotation10*H._rotation02+K._rotation11*H._rotation12+K._rotation12*H._rotation22,aa=K._rotation20*H._rotation00+K._rotation21*H._rotation10+K._rotation22*H._rotation20,T=K._rotation20*H._rotation01+K._rotation21*H._rotation11+K._rotation22*H._rotation21,ca=K._rotation20*H._rotation02+K._rotation21*H._rotation12+K._rotation22*H._rotation22,D._rotation00=ra,D._rotation01=sa,D._rotation02=W,D._rotation10=q,D._rotation11=na,D._rotation12=oa,D._rotation20=aa,D._rotation21=T,D._rotation22=ca;var _a,w,ta;_a=K._rotation00*H._positionX+K._rotation01*H._positionY+K._rotation02*H._positionZ,w=K._rotation10*H._positionX+K._rotation11*H._positionY+K._rotation12*H._positionZ,ta=K._rotation20*H._positionX+K._rotation21*H._positionY+K._rotation22*H._positionZ,D._positionX=_a,D._positionY=w,D._positionZ=ta,D._positionX+=K._positionX,D._positionY+=K._positionY,D._positionZ+=K._positionZ;var ia=U._transform,la=U._localTransform,va=this._transform,xa,Ma,za,Xa,Za,fa,ba,ea,ha;xa=va._rotation00*la._rotation00+va._rotation01*la._rotation10+va._rotation02*la._rotation20,Ma=va._rotation00*la._rotation01+va._rotation01*la._rotation11+va._rotation02*la._rotation21,za=va._rotation00*la._rotation02+va._rotation01*la._rotation12+va._rotation02*la._rotation22,Xa=va._rotation10*la._rotation00+va._rotation11*la._rotation10+va._rotation12*la._rotation20,Za=va._rotation10*la._rotation01+va._rotation11*la._rotation11+va._rotation12*la._rotation21,fa=va._rotation10*la._rotation02+va._rotation11*la._rotation12+va._rotation12*la._rotation22,ba=va._rotation20*la._rotation00+va._rotation21*la._rotation10+va._rotation22*la._rotation20,ea=va._rotation20*la._rotation01+va._rotation21*la._rotation11+va._rotation22*la._rotation21,ha=va._rotation20*la._rotation02+va._rotation21*la._rotation12+va._rotation22*la._rotation22,ia._rotation00=xa,ia._rotation01=Ma,ia._rotation02=za,ia._rotation10=Xa,ia._rotation11=Za,ia._rotation12=fa,ia._rotation20=ba,ia._rotation21=ea,ia._rotation22=ha;var pa,ya,da;pa=va._rotation00*la._positionX+va._rotation01*la._positionY+va._rotation02*la._positionZ,ya=va._rotation10*la._positionX+va._rotation11*la._positionY+va._rotation12*la._positionZ,da=va._rotation20*la._positionX+va._rotation21*la._positionY+va._rotation22*la._positionZ,ia._positionX=pa,ia._positionY=ya,ia._positionZ=da,ia._positionX+=va._positionX,ia._positionY+=va._positionY,ia._positionZ+=va._positionZ;var ma,Ya,Qa,ga,ua,wa;if(U._geom._computeAabb(U._aabb,U._ptransform),ma=U._aabb._minX,Ya=U._aabb._minY,Qa=U._aabb._minZ,ga=U._aabb._maxX,ua=U._aabb._maxY,wa=U._aabb._maxZ,U._geom._computeAabb(U._aabb,U._transform),U._aabb._minX=ma<U._aabb._minX?ma:U._aabb._minX,U._aabb._minY=Ya<U._aabb._minY?Ya:U._aabb._minY,U._aabb._minZ=Qa<U._aabb._minZ?Qa:U._aabb._minZ,U._aabb._maxX=ga>U._aabb._maxX?ga:U._aabb._maxX,U._aabb._maxY=ua>U._aabb._maxY?ua:U._aabb._maxY,U._aabb._maxZ=wa>U._aabb._maxZ?wa:U._aabb._maxZ,U._proxy!=null){var ka,Pa,Mt;ka=U._transform._positionX-U._ptransform._positionX,Pa=U._transform._positionY-U._ptransform._positionY,Mt=U._transform._positionZ-U._ptransform._positionZ;var Ha=U.displacement;Ha.x=ka,Ha.y=Pa,Ha.z=Mt,U._rigidBody._world._broadPhase.moveProxy(U._proxy,U._aabb,U.displacement)}U=J}this._sleeping=!1,this._sleepTime=0}getTransform(){var a=this._transform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setTransform(a){this._transform._positionX=a._positionX,this._transform._positionY=a._positionY,this._transform._positionZ=a._positionZ,this._transform._rotation00=a._rotation00,this._transform._rotation01=a._rotation01,this._transform._rotation02=a._rotation02,this._transform._rotation10=a._rotation10,this._transform._rotation11=a._rotation11,this._transform._rotation12=a._rotation12,this._transform._rotation20=a._rotation20,this._transform._rotation21=a._rotation21,this._transform._rotation22=a._rotation22;var t,r,i,o,_,s,h,v,e;t=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,i=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,s=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,e=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=t,this._invInertia01=r,this._invInertia02=i,this._invInertia10=o,this._invInertia11=_,this._invInertia12=s,this._invInertia20=h,this._invInertia21=v,this._invInertia22=e;var l,u,b,f,n,c,M,m,y;l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,u=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,b=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,n=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,c=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,M=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,m=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=u,this._invInertia02=b,this._invInertia10=f,this._invInertia11=n,this._invInertia12=c,this._invInertia20=M,this._invInertia21=m,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var V=this._ptransform,z=this._transform;V._positionX=z._positionX,V._positionY=z._positionY,V._positionZ=z._positionZ,V._rotation00=z._rotation00,V._rotation01=z._rotation01,V._rotation02=z._rotation02,V._rotation10=z._rotation10,V._rotation11=z._rotation11,V._rotation12=z._rotation12,V._rotation20=z._rotation20,V._rotation21=z._rotation21,V._rotation22=z._rotation22;for(var I=this._shapeList;I!=null;){var k=I._next,X=I._ptransform,L=I._localTransform,p=this._ptransform,g,N,A,F,S,Y,R,C,d;g=p._rotation00*L._rotation00+p._rotation01*L._rotation10+p._rotation02*L._rotation20,N=p._rotation00*L._rotation01+p._rotation01*L._rotation11+p._rotation02*L._rotation21,A=p._rotation00*L._rotation02+p._rotation01*L._rotation12+p._rotation02*L._rotation22,F=p._rotation10*L._rotation00+p._rotation11*L._rotation10+p._rotation12*L._rotation20,S=p._rotation10*L._rotation01+p._rotation11*L._rotation11+p._rotation12*L._rotation21,Y=p._rotation10*L._rotation02+p._rotation11*L._rotation12+p._rotation12*L._rotation22,R=p._rotation20*L._rotation00+p._rotation21*L._rotation10+p._rotation22*L._rotation20,C=p._rotation20*L._rotation01+p._rotation21*L._rotation11+p._rotation22*L._rotation21,d=p._rotation20*L._rotation02+p._rotation21*L._rotation12+p._rotation22*L._rotation22,X._rotation00=g,X._rotation01=N,X._rotation02=A,X._rotation10=F,X._rotation11=S,X._rotation12=Y,X._rotation20=R,X._rotation21=C,X._rotation22=d;var Z,$,j;Z=p._rotation00*L._positionX+p._rotation01*L._positionY+p._rotation02*L._positionZ,$=p._rotation10*L._positionX+p._rotation11*L._positionY+p._rotation12*L._positionZ,j=p._rotation20*L._positionX+p._rotation21*L._positionY+p._rotation22*L._positionZ,X._positionX=Z,X._positionY=$,X._positionZ=j,X._positionX+=p._positionX,X._positionY+=p._positionY,X._positionZ+=p._positionZ;var E=I._transform,G=I._localTransform,B=this._transform,Q,U,J,D,H,K,ra,sa,W;Q=B._rotation00*G._rotation00+B._rotation01*G._rotation10+B._rotation02*G._rotation20,U=B._rotation00*G._rotation01+B._rotation01*G._rotation11+B._rotation02*G._rotation21,J=B._rotation00*G._rotation02+B._rotation01*G._rotation12+B._rotation02*G._rotation22,D=B._rotation10*G._rotation00+B._rotation11*G._rotation10+B._rotation12*G._rotation20,H=B._rotation10*G._rotation01+B._rotation11*G._rotation11+B._rotation12*G._rotation21,K=B._rotation10*G._rotation02+B._rotation11*G._rotation12+B._rotation12*G._rotation22,ra=B._rotation20*G._rotation00+B._rotation21*G._rotation10+B._rotation22*G._rotation20,sa=B._rotation20*G._rotation01+B._rotation21*G._rotation11+B._rotation22*G._rotation21,W=B._rotation20*G._rotation02+B._rotation21*G._rotation12+B._rotation22*G._rotation22,E._rotation00=Q,E._rotation01=U,E._rotation02=J,E._rotation10=D,E._rotation11=H,E._rotation12=K,E._rotation20=ra,E._rotation21=sa,E._rotation22=W;var q,na,oa;q=B._rotation00*G._positionX+B._rotation01*G._positionY+B._rotation02*G._positionZ,na=B._rotation10*G._positionX+B._rotation11*G._positionY+B._rotation12*G._positionZ,oa=B._rotation20*G._positionX+B._rotation21*G._positionY+B._rotation22*G._positionZ,E._positionX=q,E._positionY=na,E._positionZ=oa,E._positionX+=B._positionX,E._positionY+=B._positionY,E._positionZ+=B._positionZ;var aa,T,ca,_a,w,ta;if(I._geom._computeAabb(I._aabb,I._ptransform),aa=I._aabb._minX,T=I._aabb._minY,ca=I._aabb._minZ,_a=I._aabb._maxX,w=I._aabb._maxY,ta=I._aabb._maxZ,I._geom._computeAabb(I._aabb,I._transform),I._aabb._minX=aa<I._aabb._minX?aa:I._aabb._minX,I._aabb._minY=T<I._aabb._minY?T:I._aabb._minY,I._aabb._minZ=ca<I._aabb._minZ?ca:I._aabb._minZ,I._aabb._maxX=_a>I._aabb._maxX?_a:I._aabb._maxX,I._aabb._maxY=w>I._aabb._maxY?w:I._aabb._maxY,I._aabb._maxZ=ta>I._aabb._maxZ?ta:I._aabb._maxZ,I._proxy!=null){var ia,la,va;ia=I._transform._positionX-I._ptransform._positionX,la=I._transform._positionY-I._ptransform._positionY,va=I._transform._positionZ-I._ptransform._positionZ;var xa=I.displacement;xa.x=ia,xa.y=la,xa.z=va,I._rigidBody._world._broadPhase.moveProxy(I._proxy,I._aabb,I.displacement)}I=k}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){var a=new x.common.Mat3,t=a;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getLocalInertiaTo(a){var t=a;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){var a=new x.dynamics.rigidbody.MassData;a.mass=this._mass;var t=a.localInertia;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getMassDataTo(a){a.mass=this._mass;var t=a.localInertia;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}setMassData(a){this._mass=a.mass;var t=a.localInertia;this._localInertia00=t.e00,this._localInertia01=t.e01,this._localInertia02=t.e02,this._localInertia10=t.e10,this._localInertia11=t.e11,this._localInertia12=t.e12,this._localInertia20=t.e20,this._localInertia21=t.e21,this._localInertia22=t.e22;var r=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,o=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,_=this._localInertia00*r-this._localInertia01*i+this._localInertia02*o;if(this._mass>0&&_>0&&this._type==0){this._invMass=1/this._mass;var s=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,h=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,v=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,e=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,l=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,u=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,b=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,f=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,n=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,c=this._localInertia00*s-this._localInertia01*h+this._localInertia02*v;(c<-1e-32||c>1e-32)&&(c=1/c),this._invLocalInertia00=s*c,this._invLocalInertia01=-e*c,this._invLocalInertia02=b*c,this._invLocalInertia10=-h*c,this._invLocalInertia11=l*c,this._invLocalInertia12=-f*c,this._invLocalInertia20=v*c,this._invLocalInertia21=-u*c,this._invLocalInertia22=n*c,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var M,m,y,V,z,I,k,X,L;M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,m=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,V=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,k=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,X=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=M,this._invInertia01=m,this._invInertia02=y,this._invInertia10=V,this._invInertia11=z,this._invInertia12=I,this._invInertia20=k,this._invInertia21=X,this._invInertia22=L;var p,g,N,A,F,S,Y,R,C;p=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,N=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,A=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,S=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=p,this._invInertia01=g,this._invInertia02=N,this._invInertia10=A,this._invInertia11=F,this._invInertia12=S,this._invInertia20=Y,this._invInertia21=R,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){var a=this._rotFactor;return new x.common.Vec3(a.x,a.y,a.z)}setRotationFactor(a){var t=this._rotFactor;t.x=a.x,t.y=a.y,t.z=a.z;var r,i,o,_,s,h,v,e,l;r=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=r,this._invInertia01=i,this._invInertia02=o,this._invInertia10=_,this._invInertia11=s,this._invInertia12=h,this._invInertia20=v,this._invInertia21=e,this._invInertia22=l;var u,b,f,n,c,M,m,y,V;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,M=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,m=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=M,this._invInertia20=m,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){var a=new x.common.Vec3,t=a;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,a}getLinearVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(a){if(this._type==1)this._velX=0,this._velY=0,this._velZ=0;else{var t=a;this._velX=t.x,this._velY=t.y,this._velZ=t.z}this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){var a=new x.common.Vec3,t=a;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,a}getAngularVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(a){if(this._type==1)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var t=a;this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z}this._sleeping=!1,this._sleepTime=0}addLinearVelocity(a){if(this._type!=1){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._velX+=t,this._velY+=r,this._velZ+=i}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(a){if(this._type!=1){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._angVelX+=t,this._angVelY+=r,this._angVelZ+=i}this._sleeping=!1,this._sleepTime=0}applyImpulse(a,t){var r,i,o,_=a;r=_.x,i=_.y,o=_.z,this._velX+=r*this._invMass,this._velY+=i*this._invMass,this._velZ+=o*this._invMass;var s,h,v,e,l,u,b=t;e=b.x,l=b.y,u=b.z,e-=this._transform._positionX,l-=this._transform._positionY,u-=this._transform._positionZ,s=l*o-u*i,h=u*r-e*o,v=e*i-l*r;var f,n,c;f=this._invInertia00*s+this._invInertia01*h+this._invInertia02*v,n=this._invInertia10*s+this._invInertia11*h+this._invInertia12*v,c=this._invInertia20*s+this._invInertia21*h+this._invInertia22*v,s=f,h=n,v=c,this._angVelX+=s,this._angVelY+=h,this._angVelZ+=v,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._velX+=t*this._invMass,this._velY+=r*this._invMass,this._velZ+=i*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var _,s,h;_=this._invInertia00*t+this._invInertia01*r+this._invInertia02*i,s=this._invInertia10*t+this._invInertia11*r+this._invInertia12*i,h=this._invInertia20*t+this._invInertia21*r+this._invInertia22*i,t=_,r=s,i=h,this._angVelX+=t,this._angVelY+=r,this._angVelZ+=i,this._sleeping=!1,this._sleepTime=0}applyForce(a,t){var r,i,o,_=a;r=_.x,i=_.y,o=_.z,this._forceX+=r,this._forceY+=i,this._forceZ+=o;var s,h,v,e,l,u,b=t;e=b.x,l=b.y,u=b.z,e-=this._transform._positionX,l-=this._transform._positionY,u-=this._transform._positionZ,s=l*o-u*i,h=u*r-e*o,v=e*i-l*r,this._torqueX+=s,this._torqueY+=h,this._torqueZ+=v,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._forceX+=t,this._forceY+=r,this._forceZ+=i,this._sleeping=!1,this._sleepTime=0}applyTorque(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._torqueX+=t,this._torqueY+=r,this._torqueZ+=i,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){var a=new x.common.Vec3,t=a;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,a}getLinearContactImpulseTo(a){var t=a;t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){var a=new x.common.Vec3,t=a;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,a}getAngularContactImpulseTo(a){var t=a;t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(a){this._gravityScale=a,this._sleeping=!1,this._sleepTime=0}getLocalPoint(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,t-=this._transform._positionX,r-=this._transform._positionY,i-=this._transform._positionZ;var _,s,h;_=this._transform._rotation00*t+this._transform._rotation10*r+this._transform._rotation20*i,s=this._transform._rotation01*t+this._transform._rotation11*r+this._transform._rotation21*i,h=this._transform._rotation02*t+this._transform._rotation12*r+this._transform._rotation22*i,t=_,r=s,i=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getLocalPointTo(a,t){var r,i,o,_=a;r=_.x,i=_.y,o=_.z,r-=this._transform._positionX,i-=this._transform._positionY,o-=this._transform._positionZ;var s,h,v;s=this._transform._rotation00*r+this._transform._rotation10*i+this._transform._rotation20*o,h=this._transform._rotation01*r+this._transform._rotation11*i+this._transform._rotation21*o,v=this._transform._rotation02*r+this._transform._rotation12*i+this._transform._rotation22*o,r=s,i=h,o=v;var e=t;e.x=r,e.y=i,e.z=o}getLocalVector(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var _,s,h;_=this._transform._rotation00*t+this._transform._rotation10*r+this._transform._rotation20*i,s=this._transform._rotation01*t+this._transform._rotation11*r+this._transform._rotation21*i,h=this._transform._rotation02*t+this._transform._rotation12*r+this._transform._rotation22*i,t=_,r=s,i=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getLocalVectorTo(a,t){var r,i,o,_=a;r=_.x,i=_.y,o=_.z;var s,h,v;s=this._transform._rotation00*r+this._transform._rotation10*i+this._transform._rotation20*o,h=this._transform._rotation01*r+this._transform._rotation11*i+this._transform._rotation21*o,v=this._transform._rotation02*r+this._transform._rotation12*i+this._transform._rotation22*o,r=s,i=h,o=v;var e=t;e.x=r,e.y=i,e.z=o}getWorldPoint(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var _,s,h;_=this._transform._rotation00*t+this._transform._rotation01*r+this._transform._rotation02*i,s=this._transform._rotation10*t+this._transform._rotation11*r+this._transform._rotation12*i,h=this._transform._rotation20*t+this._transform._rotation21*r+this._transform._rotation22*i,t=_,r=s,i=h,t+=this._transform._positionX,r+=this._transform._positionY,i+=this._transform._positionZ;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getWorldPointTo(a,t){var r,i,o,_=a;r=_.x,i=_.y,o=_.z;var s,h,v;s=this._transform._rotation00*r+this._transform._rotation01*i+this._transform._rotation02*o,h=this._transform._rotation10*r+this._transform._rotation11*i+this._transform._rotation12*o,v=this._transform._rotation20*r+this._transform._rotation21*i+this._transform._rotation22*o,r=s,i=h,o=v,r+=this._transform._positionX,i+=this._transform._positionY,o+=this._transform._positionZ;var e=t;e.x=r,e.y=i,e.z=o}getWorldVector(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var _,s,h;_=this._transform._rotation00*t+this._transform._rotation01*r+this._transform._rotation02*i,s=this._transform._rotation10*t+this._transform._rotation11*r+this._transform._rotation12*i,h=this._transform._rotation20*t+this._transform._rotation21*r+this._transform._rotation22*i,t=_,r=s,i=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getWorldVectorTo(a,t){var r,i,o,_=a;r=_.x,i=_.y,o=_.z;var s,h,v;s=this._transform._rotation00*r+this._transform._rotation01*i+this._transform._rotation02*o,h=this._transform._rotation10*r+this._transform._rotation11*i+this._transform._rotation12*o,v=this._transform._rotation20*r+this._transform._rotation21*i+this._transform._rotation22*o,r=s,i=h,o=v;var e=t;e.x=r,e.y=i,e.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(a){if(this._shapeList==null?(this._shapeList=a,this._shapeListLast=a):(this._shapeListLast._next=a,a._prev=this._shapeListLast,this._shapeListLast=a),this._numShapes++,a._rigidBody=this,this._world!=null){var t=this._world;a._proxy=t._broadPhase.createProxy(a,a._aabb),a._id=t._shapeIdCount++,t._numShapes++}this.updateMass();for(var r=this._shapeList;r!=null;){var i=r._next,o=r._ptransform,_=r._localTransform,s=this._ptransform,h,v,e,l,u,b,f,n,c;h=s._rotation00*_._rotation00+s._rotation01*_._rotation10+s._rotation02*_._rotation20,v=s._rotation00*_._rotation01+s._rotation01*_._rotation11+s._rotation02*_._rotation21,e=s._rotation00*_._rotation02+s._rotation01*_._rotation12+s._rotation02*_._rotation22,l=s._rotation10*_._rotation00+s._rotation11*_._rotation10+s._rotation12*_._rotation20,u=s._rotation10*_._rotation01+s._rotation11*_._rotation11+s._rotation12*_._rotation21,b=s._rotation10*_._rotation02+s._rotation11*_._rotation12+s._rotation12*_._rotation22,f=s._rotation20*_._rotation00+s._rotation21*_._rotation10+s._rotation22*_._rotation20,n=s._rotation20*_._rotation01+s._rotation21*_._rotation11+s._rotation22*_._rotation21,c=s._rotation20*_._rotation02+s._rotation21*_._rotation12+s._rotation22*_._rotation22,o._rotation00=h,o._rotation01=v,o._rotation02=e,o._rotation10=l,o._rotation11=u,o._rotation12=b,o._rotation20=f,o._rotation21=n,o._rotation22=c;var M,m,y;M=s._rotation00*_._positionX+s._rotation01*_._positionY+s._rotation02*_._positionZ,m=s._rotation10*_._positionX+s._rotation11*_._positionY+s._rotation12*_._positionZ,y=s._rotation20*_._positionX+s._rotation21*_._positionY+s._rotation22*_._positionZ,o._positionX=M,o._positionY=m,o._positionZ=y,o._positionX+=s._positionX,o._positionY+=s._positionY,o._positionZ+=s._positionZ;var V=r._transform,z=r._localTransform,I=this._transform,k,X,L,p,g,N,A,F,S;k=I._rotation00*z._rotation00+I._rotation01*z._rotation10+I._rotation02*z._rotation20,X=I._rotation00*z._rotation01+I._rotation01*z._rotation11+I._rotation02*z._rotation21,L=I._rotation00*z._rotation02+I._rotation01*z._rotation12+I._rotation02*z._rotation22,p=I._rotation10*z._rotation00+I._rotation11*z._rotation10+I._rotation12*z._rotation20,g=I._rotation10*z._rotation01+I._rotation11*z._rotation11+I._rotation12*z._rotation21,N=I._rotation10*z._rotation02+I._rotation11*z._rotation12+I._rotation12*z._rotation22,A=I._rotation20*z._rotation00+I._rotation21*z._rotation10+I._rotation22*z._rotation20,F=I._rotation20*z._rotation01+I._rotation21*z._rotation11+I._rotation22*z._rotation21,S=I._rotation20*z._rotation02+I._rotation21*z._rotation12+I._rotation22*z._rotation22,V._rotation00=k,V._rotation01=X,V._rotation02=L,V._rotation10=p,V._rotation11=g,V._rotation12=N,V._rotation20=A,V._rotation21=F,V._rotation22=S;var Y,R,C;Y=I._rotation00*z._positionX+I._rotation01*z._positionY+I._rotation02*z._positionZ,R=I._rotation10*z._positionX+I._rotation11*z._positionY+I._rotation12*z._positionZ,C=I._rotation20*z._positionX+I._rotation21*z._positionY+I._rotation22*z._positionZ,V._positionX=Y,V._positionY=R,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var d,Z,$,j,E,G;if(r._geom._computeAabb(r._aabb,r._ptransform),d=r._aabb._minX,Z=r._aabb._minY,$=r._aabb._minZ,j=r._aabb._maxX,E=r._aabb._maxY,G=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=d<r._aabb._minX?d:r._aabb._minX,r._aabb._minY=Z<r._aabb._minY?Z:r._aabb._minY,r._aabb._minZ=$<r._aabb._minZ?$:r._aabb._minZ,r._aabb._maxX=j>r._aabb._maxX?j:r._aabb._maxX,r._aabb._maxY=E>r._aabb._maxY?E:r._aabb._maxY,r._aabb._maxZ=G>r._aabb._maxZ?G:r._aabb._maxZ,r._proxy!=null){var B,Q,U;B=r._transform._positionX-r._ptransform._positionX,Q=r._transform._positionY-r._ptransform._positionY,U=r._transform._positionZ-r._ptransform._positionZ;var J=r.displacement;J.x=B,J.y=Q,J.z=U,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=i}}removeShape(a){var t=a._prev,r=a._next;if(t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._shapeList&&(this._shapeList=this._shapeList._next),a==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),a._next=null,a._prev=null,this._numShapes--,a._rigidBody=null,this._world!=null){var i=this._world;i._broadPhase.destroyProxy(a._proxy),a._proxy=null,a._id=-1;for(var o=a._rigidBody._contactLinkList;o!=null;){var _=o._next,s=o._contact;if(s._s1==a||s._s2==a){var h=o._other;h._sleeping=!1,h._sleepTime=0;var v=i._contactManager,e=s._prev,l=s._next;if(e!=null&&(e._next=l),l!=null&&(l._prev=e),s==v._contactList&&(v._contactList=v._contactList._next),s==v._contactListLast&&(v._contactListLast=v._contactListLast._prev),s._next=null,s._prev=null,s._touching){var u=s._s1._contactCallback,b=s._s2._contactCallback;u==b&&(b=null),u!=null&&u.endContact(s),b!=null&&b.endContact(s)}var f=s._link1._prev,n=s._link1._next;f!=null&&(f._next=n),n!=null&&(n._prev=f),s._link1==s._b1._contactLinkList&&(s._b1._contactLinkList=s._b1._contactLinkList._next),s._link1==s._b1._contactLinkListLast&&(s._b1._contactLinkListLast=s._b1._contactLinkListLast._prev),s._link1._next=null,s._link1._prev=null;var c=s._link2._prev,M=s._link2._next;c!=null&&(c._next=M),M!=null&&(M._prev=c),s._link2==s._b2._contactLinkList&&(s._b2._contactLinkList=s._b2._contactLinkList._next),s._link2==s._b2._contactLinkListLast&&(s._b2._contactLinkListLast=s._b2._contactLinkListLast._prev),s._link2._next=null,s._link2._prev=null,s._b1._numContactLinks--,s._b2._numContactLinks--,s._link1._other=null,s._link2._other=null,s._link1._contact=null,s._link2._contact=null,s._s1=null,s._s2=null,s._b1=null,s._b2=null,s._touching=!1,s._cachedDetectorData._clear(),s._manifold._clear(),s._detector=null;var m=s._contactConstraint;m._s1=null,m._s2=null,m._b1=null,m._b2=null,m._tf1=null,m._tf2=null,s._next=v._contactPool,v._contactPool=s,v._numContacts--}o=_}i._numShapes--}this.updateMass();for(var y=this._shapeList;y!=null;){var V=y._next,z=y._ptransform,I=y._localTransform,k=this._ptransform,X,L,p,g,N,A,F,S,Y;X=k._rotation00*I._rotation00+k._rotation01*I._rotation10+k._rotation02*I._rotation20,L=k._rotation00*I._rotation01+k._rotation01*I._rotation11+k._rotation02*I._rotation21,p=k._rotation00*I._rotation02+k._rotation01*I._rotation12+k._rotation02*I._rotation22,g=k._rotation10*I._rotation00+k._rotation11*I._rotation10+k._rotation12*I._rotation20,N=k._rotation10*I._rotation01+k._rotation11*I._rotation11+k._rotation12*I._rotation21,A=k._rotation10*I._rotation02+k._rotation11*I._rotation12+k._rotation12*I._rotation22,F=k._rotation20*I._rotation00+k._rotation21*I._rotation10+k._rotation22*I._rotation20,S=k._rotation20*I._rotation01+k._rotation21*I._rotation11+k._rotation22*I._rotation21,Y=k._rotation20*I._rotation02+k._rotation21*I._rotation12+k._rotation22*I._rotation22,z._rotation00=X,z._rotation01=L,z._rotation02=p,z._rotation10=g,z._rotation11=N,z._rotation12=A,z._rotation20=F,z._rotation21=S,z._rotation22=Y;var R,C,d;R=k._rotation00*I._positionX+k._rotation01*I._positionY+k._rotation02*I._positionZ,C=k._rotation10*I._positionX+k._rotation11*I._positionY+k._rotation12*I._positionZ,d=k._rotation20*I._positionX+k._rotation21*I._positionY+k._rotation22*I._positionZ,z._positionX=R,z._positionY=C,z._positionZ=d,z._positionX+=k._positionX,z._positionY+=k._positionY,z._positionZ+=k._positionZ;var Z=y._transform,$=y._localTransform,j=this._transform,E,G,B,Q,U,J,D,H,K;E=j._rotation00*$._rotation00+j._rotation01*$._rotation10+j._rotation02*$._rotation20,G=j._rotation00*$._rotation01+j._rotation01*$._rotation11+j._rotation02*$._rotation21,B=j._rotation00*$._rotation02+j._rotation01*$._rotation12+j._rotation02*$._rotation22,Q=j._rotation10*$._rotation00+j._rotation11*$._rotation10+j._rotation12*$._rotation20,U=j._rotation10*$._rotation01+j._rotation11*$._rotation11+j._rotation12*$._rotation21,J=j._rotation10*$._rotation02+j._rotation11*$._rotation12+j._rotation12*$._rotation22,D=j._rotation20*$._rotation00+j._rotation21*$._rotation10+j._rotation22*$._rotation20,H=j._rotation20*$._rotation01+j._rotation21*$._rotation11+j._rotation22*$._rotation21,K=j._rotation20*$._rotation02+j._rotation21*$._rotation12+j._rotation22*$._rotation22,Z._rotation00=E,Z._rotation01=G,Z._rotation02=B,Z._rotation10=Q,Z._rotation11=U,Z._rotation12=J,Z._rotation20=D,Z._rotation21=H,Z._rotation22=K;var ra,sa,W;ra=j._rotation00*$._positionX+j._rotation01*$._positionY+j._rotation02*$._positionZ,sa=j._rotation10*$._positionX+j._rotation11*$._positionY+j._rotation12*$._positionZ,W=j._rotation20*$._positionX+j._rotation21*$._positionY+j._rotation22*$._positionZ,Z._positionX=ra,Z._positionY=sa,Z._positionZ=W,Z._positionX+=j._positionX,Z._positionY+=j._positionY,Z._positionZ+=j._positionZ;var q,na,oa,aa,T,ca;if(y._geom._computeAabb(y._aabb,y._ptransform),q=y._aabb._minX,na=y._aabb._minY,oa=y._aabb._minZ,aa=y._aabb._maxX,T=y._aabb._maxY,ca=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=q<y._aabb._minX?q:y._aabb._minX,y._aabb._minY=na<y._aabb._minY?na:y._aabb._minY,y._aabb._minZ=oa<y._aabb._minZ?oa:y._aabb._minZ,y._aabb._maxX=aa>y._aabb._maxX?aa:y._aabb._maxX,y._aabb._maxY=T>y._aabb._maxY?T:y._aabb._maxY,y._aabb._maxZ=ca>y._aabb._maxZ?ca:y._aabb._maxZ,y._proxy!=null){var _a,w,ta;_a=y._transform._positionX-y._ptransform._positionX,w=y._transform._positionY-y._ptransform._positionY,ta=y._transform._positionZ-y._ptransform._positionZ;var ia=y.displacement;ia.x=_a,ia.y=w,ia.z=ta,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=V}}getType(){return this._type}setType(a){this._type=a,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(a){this._autoSleep=a,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(a){this._linearDamping=a}getAngularDamping(){return this._angularDamping}setAngularDamping(a){this._angularDamping=a}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new x.common.Vec3,this.rotation=new x.common.Mat3,this.linearVelocity=new x.common.Vec3,this.angularVelocity=new x.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};x.dynamics.rigidbody.RigidBodyType=class{};x.dynamics.rigidbody.Shape=class{constructor(a){this._id=-1,this._localTransform=new x.common.Transform,this._ptransform=new x.common.Transform,this._transform=new x.common.Transform;var t=a.position;this._localTransform._positionX=t.x,this._localTransform._positionY=t.y,this._localTransform._positionZ=t.z;var r=a.rotation;this._localTransform._rotation00=r.e00,this._localTransform._rotation01=r.e01,this._localTransform._rotation02=r.e02,this._localTransform._rotation10=r.e10,this._localTransform._rotation11=r.e11,this._localTransform._rotation12=r.e12,this._localTransform._rotation20=r.e20,this._localTransform._rotation21=r.e21,this._localTransform._rotation22=r.e22;var i=this._ptransform,o=this._localTransform;i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22;var _=this._transform,s=this._localTransform;_._positionX=s._positionX,_._positionY=s._positionY,_._positionZ=s._positionZ,_._rotation00=s._rotation00,_._rotation01=s._rotation01,_._rotation02=s._rotation02,_._rotation10=s._rotation10,_._rotation11=s._rotation11,_._rotation12=s._rotation12,_._rotation20=s._rotation20,_._rotation21=s._rotation21,_._rotation22=s._rotation22,this._restitution=a.restitution,this._friction=a.friction,this._density=a.density,this._geom=a.geometry,this._collisionGroup=a.collisionGroup,this._collisionMask=a.collisionMask,this._contactCallback=a.contactCallback,this._aabb=new x.collision.geometry.Aabb,this._proxy=null,this.displacement=new x.common.Vec3}getFriction(){return this._friction}setFriction(a){this._friction=a}getRestitution(){return this._restitution}setRestitution(a){this._restitution=a}getLocalTransform(){var a=this._localTransform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getLocalTransformTo(a){var t=this._localTransform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}getTransform(){var a=this._transform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setLocalTransform(a){var t=this._localTransform;if(t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,this._rigidBody!=null){var r=this._rigidBody;r.updateMass();for(var i=r._shapeList;i!=null;){var o=i._next,_=i._ptransform,s=i._localTransform,h=r._ptransform,v,e,l,u,b,f,n,c,M;v=h._rotation00*s._rotation00+h._rotation01*s._rotation10+h._rotation02*s._rotation20,e=h._rotation00*s._rotation01+h._rotation01*s._rotation11+h._rotation02*s._rotation21,l=h._rotation00*s._rotation02+h._rotation01*s._rotation12+h._rotation02*s._rotation22,u=h._rotation10*s._rotation00+h._rotation11*s._rotation10+h._rotation12*s._rotation20,b=h._rotation10*s._rotation01+h._rotation11*s._rotation11+h._rotation12*s._rotation21,f=h._rotation10*s._rotation02+h._rotation11*s._rotation12+h._rotation12*s._rotation22,n=h._rotation20*s._rotation00+h._rotation21*s._rotation10+h._rotation22*s._rotation20,c=h._rotation20*s._rotation01+h._rotation21*s._rotation11+h._rotation22*s._rotation21,M=h._rotation20*s._rotation02+h._rotation21*s._rotation12+h._rotation22*s._rotation22,_._rotation00=v,_._rotation01=e,_._rotation02=l,_._rotation10=u,_._rotation11=b,_._rotation12=f,_._rotation20=n,_._rotation21=c,_._rotation22=M;var m,y,V;m=h._rotation00*s._positionX+h._rotation01*s._positionY+h._rotation02*s._positionZ,y=h._rotation10*s._positionX+h._rotation11*s._positionY+h._rotation12*s._positionZ,V=h._rotation20*s._positionX+h._rotation21*s._positionY+h._rotation22*s._positionZ,_._positionX=m,_._positionY=y,_._positionZ=V,_._positionX+=h._positionX,_._positionY+=h._positionY,_._positionZ+=h._positionZ;var z=i._transform,I=i._localTransform,k=r._transform,X,L,p,g,N,A,F,S,Y;X=k._rotation00*I._rotation00+k._rotation01*I._rotation10+k._rotation02*I._rotation20,L=k._rotation00*I._rotation01+k._rotation01*I._rotation11+k._rotation02*I._rotation21,p=k._rotation00*I._rotation02+k._rotation01*I._rotation12+k._rotation02*I._rotation22,g=k._rotation10*I._rotation00+k._rotation11*I._rotation10+k._rotation12*I._rotation20,N=k._rotation10*I._rotation01+k._rotation11*I._rotation11+k._rotation12*I._rotation21,A=k._rotation10*I._rotation02+k._rotation11*I._rotation12+k._rotation12*I._rotation22,F=k._rotation20*I._rotation00+k._rotation21*I._rotation10+k._rotation22*I._rotation20,S=k._rotation20*I._rotation01+k._rotation21*I._rotation11+k._rotation22*I._rotation21,Y=k._rotation20*I._rotation02+k._rotation21*I._rotation12+k._rotation22*I._rotation22,z._rotation00=X,z._rotation01=L,z._rotation02=p,z._rotation10=g,z._rotation11=N,z._rotation12=A,z._rotation20=F,z._rotation21=S,z._rotation22=Y;var R,C,d;R=k._rotation00*I._positionX+k._rotation01*I._positionY+k._rotation02*I._positionZ,C=k._rotation10*I._positionX+k._rotation11*I._positionY+k._rotation12*I._positionZ,d=k._rotation20*I._positionX+k._rotation21*I._positionY+k._rotation22*I._positionZ,z._positionX=R,z._positionY=C,z._positionZ=d,z._positionX+=k._positionX,z._positionY+=k._positionY,z._positionZ+=k._positionZ;var Z,$,j,E,G,B;if(i._geom._computeAabb(i._aabb,i._ptransform),Z=i._aabb._minX,$=i._aabb._minY,j=i._aabb._minZ,E=i._aabb._maxX,G=i._aabb._maxY,B=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=Z<i._aabb._minX?Z:i._aabb._minX,i._aabb._minY=$<i._aabb._minY?$:i._aabb._minY,i._aabb._minZ=j<i._aabb._minZ?j:i._aabb._minZ,i._aabb._maxX=E>i._aabb._maxX?E:i._aabb._maxX,i._aabb._maxY=G>i._aabb._maxY?G:i._aabb._maxY,i._aabb._maxZ=B>i._aabb._maxZ?B:i._aabb._maxZ,i._proxy!=null){var Q,U,J;Q=i._transform._positionX-i._ptransform._positionX,U=i._transform._positionY-i._ptransform._positionY,J=i._transform._positionZ-i._ptransform._positionZ;var D=i.displacement;D.x=Q,D.y=U,D.z=J,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=o}}}getDensity(){return this._density}setDensity(a){if(this._density=a,this._rigidBody!=null){var t=this._rigidBody;t.updateMass();for(var r=t._shapeList;r!=null;){var i=r._next,o=r._ptransform,_=r._localTransform,s=t._ptransform,h,v,e,l,u,b,f,n,c;h=s._rotation00*_._rotation00+s._rotation01*_._rotation10+s._rotation02*_._rotation20,v=s._rotation00*_._rotation01+s._rotation01*_._rotation11+s._rotation02*_._rotation21,e=s._rotation00*_._rotation02+s._rotation01*_._rotation12+s._rotation02*_._rotation22,l=s._rotation10*_._rotation00+s._rotation11*_._rotation10+s._rotation12*_._rotation20,u=s._rotation10*_._rotation01+s._rotation11*_._rotation11+s._rotation12*_._rotation21,b=s._rotation10*_._rotation02+s._rotation11*_._rotation12+s._rotation12*_._rotation22,f=s._rotation20*_._rotation00+s._rotation21*_._rotation10+s._rotation22*_._rotation20,n=s._rotation20*_._rotation01+s._rotation21*_._rotation11+s._rotation22*_._rotation21,c=s._rotation20*_._rotation02+s._rotation21*_._rotation12+s._rotation22*_._rotation22,o._rotation00=h,o._rotation01=v,o._rotation02=e,o._rotation10=l,o._rotation11=u,o._rotation12=b,o._rotation20=f,o._rotation21=n,o._rotation22=c;var M,m,y;M=s._rotation00*_._positionX+s._rotation01*_._positionY+s._rotation02*_._positionZ,m=s._rotation10*_._positionX+s._rotation11*_._positionY+s._rotation12*_._positionZ,y=s._rotation20*_._positionX+s._rotation21*_._positionY+s._rotation22*_._positionZ,o._positionX=M,o._positionY=m,o._positionZ=y,o._positionX+=s._positionX,o._positionY+=s._positionY,o._positionZ+=s._positionZ;var V=r._transform,z=r._localTransform,I=t._transform,k,X,L,p,g,N,A,F,S;k=I._rotation00*z._rotation00+I._rotation01*z._rotation10+I._rotation02*z._rotation20,X=I._rotation00*z._rotation01+I._rotation01*z._rotation11+I._rotation02*z._rotation21,L=I._rotation00*z._rotation02+I._rotation01*z._rotation12+I._rotation02*z._rotation22,p=I._rotation10*z._rotation00+I._rotation11*z._rotation10+I._rotation12*z._rotation20,g=I._rotation10*z._rotation01+I._rotation11*z._rotation11+I._rotation12*z._rotation21,N=I._rotation10*z._rotation02+I._rotation11*z._rotation12+I._rotation12*z._rotation22,A=I._rotation20*z._rotation00+I._rotation21*z._rotation10+I._rotation22*z._rotation20,F=I._rotation20*z._rotation01+I._rotation21*z._rotation11+I._rotation22*z._rotation21,S=I._rotation20*z._rotation02+I._rotation21*z._rotation12+I._rotation22*z._rotation22,V._rotation00=k,V._rotation01=X,V._rotation02=L,V._rotation10=p,V._rotation11=g,V._rotation12=N,V._rotation20=A,V._rotation21=F,V._rotation22=S;var Y,R,C;Y=I._rotation00*z._positionX+I._rotation01*z._positionY+I._rotation02*z._positionZ,R=I._rotation10*z._positionX+I._rotation11*z._positionY+I._rotation12*z._positionZ,C=I._rotation20*z._positionX+I._rotation21*z._positionY+I._rotation22*z._positionZ,V._positionX=Y,V._positionY=R,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var d,Z,$,j,E,G;if(r._geom._computeAabb(r._aabb,r._ptransform),d=r._aabb._minX,Z=r._aabb._minY,$=r._aabb._minZ,j=r._aabb._maxX,E=r._aabb._maxY,G=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=d<r._aabb._minX?d:r._aabb._minX,r._aabb._minY=Z<r._aabb._minY?Z:r._aabb._minY,r._aabb._minZ=$<r._aabb._minZ?$:r._aabb._minZ,r._aabb._maxX=j>r._aabb._maxX?j:r._aabb._maxX,r._aabb._maxY=E>r._aabb._maxY?E:r._aabb._maxY,r._aabb._maxZ=G>r._aabb._maxZ?G:r._aabb._maxZ,r._proxy!=null){var B,Q,U;B=r._transform._positionX-r._ptransform._positionX,Q=r._transform._positionY-r._ptransform._positionY,U=r._transform._positionZ-r._ptransform._positionZ;var J=r.displacement;J.x=B,J.y=Q,J.z=U,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=i}}}getAabb(){return this._aabb.clone()}getAabbTo(a){a.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(a){this._collisionGroup=a}getCollisionMask(){return this._collisionMask}setCollisionMask(a){this._collisionMask=a}getContactCallback(){return this._contactCallback}setContactCallback(a){this._contactCallback=a}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new x.common.Vec3,this.rotation=new x.common.Mat3,this.friction=x.common.Setting.defaultFriction,this.restitution=x.common.Setting.defaultRestitution,this.density=x.common.Setting.defaultDensity,this.collisionGroup=x.common.Setting.defaultCollisionGroup,this.collisionMask=x.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};x.m||(x.m={});x.m.M=class{};x.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;x.collision.broadphase.BroadPhaseType._BVH=2;x.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;x.collision.broadphase.BroadPhaseType.BVH=2;x.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;x.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;x.collision.geometry.GeometryType._SPHERE=0;x.collision.geometry.GeometryType._BOX=1;x.collision.geometry.GeometryType._CYLINDER=2;x.collision.geometry.GeometryType._CONE=3;x.collision.geometry.GeometryType._CAPSULE=4;x.collision.geometry.GeometryType._CONVEX_HULL=5;x.collision.geometry.GeometryType._CONVEX_MIN=0;x.collision.geometry.GeometryType._CONVEX_MAX=5;x.collision.geometry.GeometryType.SPHERE=0;x.collision.geometry.GeometryType.BOX=1;x.collision.geometry.GeometryType.CYLINDER=2;x.collision.geometry.GeometryType.CONE=3;x.collision.geometry.GeometryType.CAPSULE=4;x.collision.geometry.GeometryType.CONVEX_HULL=5;x.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;x.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;x.common.Vec3.numCreations=0;x.common.Setting.defaultFriction=.2;x.common.Setting.defaultRestitution=.2;x.common.Setting.defaultDensity=1;x.common.Setting.defaultCollisionGroup=1;x.common.Setting.defaultCollisionMask=1;x.common.Setting.maxTranslationPerStep=20;x.common.Setting.maxRotationPerStep=3.14159265358979;x.common.Setting.bvhProxyPadding=.1;x.common.Setting.bvhIncrementalCollisionThreshold=.45;x.common.Setting.defaultGJKMargin=.05;x.common.Setting.enableGJKCaching=!0;x.common.Setting.maxEPAVertices=128;x.common.Setting.maxEPAPolyhedronFaces=128;x.common.Setting.contactEnableBounceThreshold=.5;x.common.Setting.velocityBaumgarte=.2;x.common.Setting.positionSplitImpulseBaumgarte=.4;x.common.Setting.positionNgsBaumgarte=1;x.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;x.common.Setting.defaultContactPositionCorrectionAlgorithm=0;x.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;x.common.Setting.contactPersistenceThreshold=.05;x.common.Setting.maxManifoldPoints=4;x.common.Setting.defaultJointConstraintSolverType=0;x.common.Setting.defaultJointPositionCorrectionAlgorithm=0;x.common.Setting.jointWarmStartingFactorForBaungarte=.8;x.common.Setting.jointWarmStartingFactor=.95;x.common.Setting.minSpringDamperDampingRatio=1e-6;x.common.Setting.minRagdollMaxSwingAngle=1e-6;x.common.Setting.maxJacobianRows=6;x.common.Setting.directMlcpSolverEps=1e-9;x.common.Setting.islandInitialRigidBodyArraySize=128;x.common.Setting.islandInitialConstraintArraySize=128;x.common.Setting.sleepingVelocityThreshold=.2;x.common.Setting.sleepingAngularVelocityThreshold=.5;x.common.Setting.sleepingTimeThreshold=1;x.common.Setting.disableSleeping=!1;x.common.Setting.linearSlop=.005;x.common.Setting.angularSlop=.017453292519943278;x.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new x.collision.narrowphase.detector.gjkepa.GjkEpa;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;x.common.Mat3.numCreations=0;x.common.Mat4.numCreations=0;x.common.MathUtil.POSITIVE_INFINITY=1/0;x.common.MathUtil.NEGATIVE_INFINITY=-1/0;x.common.MathUtil.PI=3.14159265358979;x.common.MathUtil.TWO_PI=6.28318530717958;x.common.MathUtil.HALF_PI=1.570796326794895;x.common.MathUtil.TO_RADIANS=.017453292519943278;x.common.MathUtil.TO_DEGREES=57.29577951308238;x.common.Quat.numCreations=0;x.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;x.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;x.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;x.dynamics.common.Performance.broadPhaseCollisionTime=0;x.dynamics.common.Performance.narrowPhaseCollisionTime=0;x.dynamics.common.Performance.dynamicsTime=0;x.dynamics.common.Performance.totalTime=0;x.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;x.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;x.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;x.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;x.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;x.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;x.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;x.dynamics.constraint.joint.JointType._SPHERICAL=0;x.dynamics.constraint.joint.JointType._REVOLUTE=1;x.dynamics.constraint.joint.JointType._CYLINDRICAL=2;x.dynamics.constraint.joint.JointType._PRISMATIC=3;x.dynamics.constraint.joint.JointType._UNIVERSAL=4;x.dynamics.constraint.joint.JointType._RAGDOLL=5;x.dynamics.constraint.joint.JointType._GENERIC=6;x.dynamics.constraint.joint.JointType.SPHERICAL=0;x.dynamics.constraint.joint.JointType.REVOLUTE=1;x.dynamics.constraint.joint.JointType.CYLINDRICAL=2;x.dynamics.constraint.joint.JointType.PRISMATIC=3;x.dynamics.constraint.joint.JointType.UNIVERSAL=4;x.dynamics.constraint.joint.JointType.RAGDOLL=5;x.dynamics.constraint.joint.JointType.GENERIC=6;x.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;x.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;x.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;x.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;x.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;x.dynamics.rigidbody.RigidBodyType._STATIC=1;x.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;x.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;x.dynamics.rigidbody.RigidBodyType.STATIC=1;x.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;x.dynamics.World;x.dynamics.rigidbody.RigidBodyType;x.dynamics.rigidbody.RigidBodyConfig;x.dynamics.rigidbody.RigidBody;x.dynamics.rigidbody.ShapeConfig;x.dynamics.rigidbody.Shape;x.dynamics.constraint.joint.SphericalJointConfig;x.dynamics.constraint.joint.SphericalJoint;x.dynamics.constraint.joint.RevoluteJointConfig;x.dynamics.constraint.joint.RevoluteJoint;x.dynamics.constraint.joint.CylindricalJointConfig;x.dynamics.constraint.joint.CylindricalJoint;x.dynamics.constraint.joint.PrismaticJointConfig;x.dynamics.constraint.joint.PrismaticJoint;x.dynamics.constraint.joint.UniversalJointConfig;x.dynamics.constraint.joint.UniversalJoint;x.dynamics.constraint.joint.RagdollJointConfig;x.dynamics.constraint.joint.RagdollJoint;x.dynamics.constraint.joint.GenericJointConfig;x.dynamics.constraint.joint.GenericJoint;x.dynamics.constraint.joint.JointConfig;x.dynamics.constraint.joint.Joint;x.dynamics.constraint.joint.SpringDamper;x.dynamics.constraint.joint.TranslationalLimitMotor;x.dynamics.constraint.joint.RotationalLimitMotor;x.common.Vec3;x.common.Quat;x.common.Mat3;x.common.MathUtil;x.common.Transform;const wm=x.common.Setting;x.collision.geometry.BoxGeometry;x.collision.geometry.SphereGeometry;x.collision.geometry.ConeGeometry;x.collision.geometry.CylinderGeometry;x.collision.geometry.CapsuleGeometry;x.collision.geometry.ConvexHullGeometry;x.collision.geometry.Geometry;x.dynamics.callback.RayCastClosest;x.dynamics.callback.ContactCallback;wm.defaultGJKMargin=1e-4;x.dynamics.World;x.dynamics.rigidbody.RigidBodyType;x.dynamics.rigidbody.RigidBodyConfig;x.dynamics.rigidbody.RigidBody;x.dynamics.rigidbody.ShapeConfig;x.dynamics.rigidbody.Shape;x.dynamics.constraint.joint.SphericalJointConfig;x.dynamics.constraint.joint.SphericalJoint;x.dynamics.constraint.joint.RevoluteJointConfig;x.dynamics.constraint.joint.RevoluteJoint;x.dynamics.constraint.joint.CylindricalJointConfig;x.dynamics.constraint.joint.CylindricalJoint;x.dynamics.constraint.joint.PrismaticJointConfig;x.dynamics.constraint.joint.PrismaticJoint;x.dynamics.constraint.joint.UniversalJointConfig;x.dynamics.constraint.joint.UniversalJoint;x.dynamics.constraint.joint.RagdollJointConfig;x.dynamics.constraint.joint.RagdollJoint;x.dynamics.constraint.joint.GenericJointConfig;x.dynamics.constraint.joint.GenericJoint;x.dynamics.constraint.joint.Joint;x.common.Vec3;x.common.Quat;const Xm=x.common.Setting;x.collision.geometry.BoxGeometry;x.collision.geometry.SphereGeometry;x.collision.geometry.ConeGeometry;x.collision.geometry.CylinderGeometry;x.collision.geometry.CapsuleGeometry;x.collision.geometry.ConvexHullGeometry;x.dynamics.callback.ContactCallback;Xm.defaultGJKMargin=1e-4;const Lm=["object"],Ym=["object"],Zm=If({__name:"reflectorShaderMesh",props:{reflectivity:{default:.2},mirror:{default:.1},mixStrength:{default:9},showGridHelper:{type:Boolean,default:!0},color:{default:"#ffffff"}},async setup(Ja){let a,t;const r=Ja,{scene:i}=$z(),o=([a,t]=Kz(()=>qz(["./plugins/floor/image/concrete_wet_floor_basecolor.jpg","./plugins/floor/image/concrete_wet_floor_normal.jpg"])),a=await a,t(),a);o[0].wrapS=kc,o[0].wrapT=kc,o[1].wrapS=kc,o[1].wrapT=kc;const _=new km,s=new Vm({reflectivity:r.reflectivity,mirror:r.mirror,mixStrength:r.mixStrength,color:new mc(r.color),map:o[0],normalMap:o[1],normalScale:new wc(5,5),fog:i.fog,dithering:!0});s.uniforms.tReflect=_.renderTargetUniform,s.uniforms.uMatrix=_.textureMatrixUniform;const h=new am(10,10),v=new gf(h,s);v.position.y=-.01,v.rotation.x=-Math.PI/2,v.add(_),v.onBeforeRender=(l,u,b)=>{_.update(l,u,b)};const e=new tm(9.5,10);return rm(()=>{r.reflectivity&&(s.uniforms.uReflectivity.value=r.reflectivity),r.mirror&&(s.uniforms.uMirror.value=r.mirror),r.mixStrength&&(s.uniforms.uMixStrength.value=r.mixStrength),r.color&&(s.uniforms.uColor.value=new mc(r.color))}),im(()=>r.showGridHelper,l=>{e.visible=l}),(l,u)=>(vb(),om(nm,null,[sc("primitive",{object:pc(v)},null,8,Lm),sc("primitive",{object:pc(e)},null,8,Ym)],64))}}),dm=sc("TresPerspectiveCamera",{position:[15,15,15],fov:45,near:.1,far:1e4,"look-at":[0,0,0]},null,-1),Bm=sc("TresAmbientLight",{intensity:10},null,-1),Am=sc("TresMesh",{position:[0,2,-4]},[sc("TresBoxGeometry",{args:[1,1,1]}),sc("TresMeshNormalMaterial")],-1),qy=If({__name:"reflectorShader",setup(Ja){const a=em({reflectivity:.29,mirror:1,mixStrength:26,showGridHelper:!0}),t=new sm({title:"镜面参数",expanded:!0});return t.addBinding(a,"reflectivity",{label:"反射率",min:.01,max:1,step:.01}),t.addBinding(a,"mirror",{label:"镜面化",min:0,max:1,step:.01}),t.addBinding(a,"mixStrength",{label:"混合",min:0,max:100,step:1}),t.addBinding(a,"showGridHelper",{label:"显示网格"}),(r,i)=>(vb(),Mf(pc(_m),{clearColor:"#201919","window-size":""},{default:zf(()=>[dm,sb(pc(vm),{enableDamping:""}),Bm,sb(pc(lm),{args:[1,1,1],color:"orange",position:[3,1,0]}),Am,(vb(),Mf(hm,null,{default:zf(()=>[sb(Zm,cm(bm(a)),null,16)]),_:1}))]),_:1}))}});export{qy as default};
