var C=Object.defineProperty;var B=(o,e,r)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r;var s=(o,e,r)=>(B(o,typeof e!="symbol"?e+"":e,r),r);import{b5 as _,b6 as l,$ as b,a0 as x,k as I,ak as Z,a5 as S,a4 as L,o as p,c as j,a as y,a7 as M,K as m,ab as R,W,E as U,a2 as A,a3 as D,v as k,D as w,a8 as E,ag as $}from"./vendor.UXgcsyzV1709520134781.js";import{U as d,b as F,M as G,P as N,a as O,T as Q}from"./TerrainMeshProvider.LyKtQv_m1709520134781.js";function V(o){return new Worker("/icegl-three-vue-tres/static/MartiniWorker-8mf_OiU3.js",{name:o==null?void 0:o.name})}class Y{constructor(){s(this,"maxZoom",12);s(this,"coordType",d);s(this,"utmZone",50);s(this,"_worker");s(this,"_useWorker",!0);s(this,"source","https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp")}set useWorker(e){var r;this._useWorker=e,this._useWorker||((r=this._worker)==null||r.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(e){return this._useWorker?this.getInWorkerThread(e):this.getInMainThread()}async getInMainThread(){return new _}async getInWorkerThread(e){this._worker||(this._worker=new F(V));const r={tileNo:e,id:this.getId(e),url:this.getUrl(e),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},t=await this._worker.postMessage(r),a=new _;return a.setAttribute("position",new l(t.positions,3)),a.setAttribute("uv",new l(t.uv,2)),a.setIndex(new l(t.triangles,1)),a}async abort(e){var r;this._useWorker&&((r=this._worker)==null||r.postMessage({id:this.getId(e),abort:!0}))}async dispose(e,r){var t;r.dispose(),this._useWorker&&((t=this._worker)==null||t.postMessage({id:this.getId(e),dispose:!0}))}getId(e){return e.join("-")}getUrl(e){const[r,t,a]=e;return this.source.replace("[x]",r+"").replace("[y]",t+"").replace("[z]",a+"")}}const K=["object"],q=b({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20}},setup(o){const e=o,r=x({enableDamping:!0,dampingFactor:.05}),t=I(),{camera:a,renderer:f,scene:T}=Z(),P=new N;P.coordType=d;const u=new Y;u.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",u.coordType=d;const n=new O;n.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",n.showTileNo=!1,n.useWorker=!0;const c=new Q(u,n);c.showBoundingBox=!1,c.wireframe=!1;const i=new G;i.provider=c,i.bbox=e.bbox,i.maxZoom=e.maxZoom;let h=!1,v=!1;S(()=>{a.value&&!h&&(h=!0,i.camera=a.value),t.value&&!v&&(v=!0,t.value.value.target.x=a.value.position.x,t.value.value.target.y=a.value.position.y,t.value.value.target.z=0)});const{onLoop:z}=L();return z(()=>{if(f.value){const g=Math.abs(a.value.position.z)*50;a.value.far=g+5e3,a.value.updateProjectionMatrix(),t.value&&(t.value.value.target.z=0),i.update(),f.value.render(T.value,a.value)}}),(g,J)=>(p(),j(U,null,[y(m(R),M(r,{ref_key:"orbitControlRef",ref:t}),null,16),W("primitive",{object:m(i)},null,8,K)],64))}}),H=["look-at"],te=b({__name:"tileMap",setup(o){const e=x({clearColor:"#201919",logarithmicDepthBuffer:!0,antialias:!0,disableRender:!0,outputColorSpace:A,toneMapping:D}),r=[958792.6688235556,2771848203330192e-9,1241.0896440063382];return(t,a)=>(p(),k(m(E),M(e,{"window-size":""}),{default:w(()=>[W("TresPerspectiveCamera",{position:r,fov:60,near:1,far:1e8,"look-at":[r[0],r[1],0],up:[0,0,1]},null,8,H),(p(),k($,null,{default:w(()=>[y(q,{bbox:[104.955976,20.149765,120.998419,30.528687]})]),_:1}))]),_:1},16))}});export{te as default};
