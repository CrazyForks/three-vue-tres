var xe=Object.defineProperty,Pe=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var ft=(i,o,n)=>o in i?xe(i,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[o]=n,It=(i,o)=>{for(var n in o||(o={}))ve.call(o,n)&&ft(i,n,o[n]);if(At)for(var n of At(o))Oe.call(o,n)&&ft(i,n,o[n]);return i},Nt=(i,o)=>Pe(i,Ee(o));var u=(i,o,n)=>(ft(i,typeof o!="symbol"?o+"":o,n),n);import{bs as Ce,b2 as je,aT as Se,cK as ke,b3 as C,cL as V,cM as Q,bh as Ft,cu as Bt,aH as N,ct as Gt,bp as _e,aw as Mt,cN as Re,be as K,au as lt,bP as De,bt as Le,av as Ae,a3 as Ie,bO as Ne,bL as Fe,cO as Be,a0 as We,k as Ue,w as Ye,o as ze,c as Xe,t as Wt,cP as He,_ as Ze}from"./vendor.fZWouSnL1712126651134.js";import{c as Ke,d as qe,a as Ge}from"./ExtensionUtilities.Bv-hK4Yd1712126651134.js";import{C as Ve}from"./vanilla.MD--V1Gz1712126651134.js";const Ut={type:"change"},gt={type:"start"},Yt={type:"end"},ht=new Ce,zt=new je,Qe=Math.cos(70*Se.DEG2RAD);class Co extends ke{constructor(o,n){super(),this.object=o,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.cursor=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:V.ROTATE,MIDDLE:V.DOLLY,RIGHT:V.PAN},this.touches={ONE:Q.ROTATE,TWO:Q.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",mt),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",mt),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(Ut),t.update(),r=a.NONE},this.update=function(){const e=new C,s=new Ft().setFromUnitVectors(o.up,new C(0,1,0)),d=s.clone().invert(),f=new C,S=new Ft,Z=new C,I=2*Math.PI;return function(we=null){const Lt=t.object.position;e.copy(Lt).sub(t.target),e.applyQuaternion(s),c.setFromVector3(e),t.autoRotate&&r===a.NONE&&A(X(we)),t.enableDamping?(c.theta+=l.theta*t.dampingFactor,c.phi+=l.phi*t.dampingFactor):(c.theta+=l.theta,c.phi+=l.phi);let U=t.minAzimuthAngle,Y=t.maxAzimuthAngle;isFinite(U)&&isFinite(Y)&&(U<-Math.PI?U+=I:U>Math.PI&&(U-=I),Y<-Math.PI?Y+=I:Y>Math.PI&&(Y-=I),U<=Y?c.theta=Math.max(U,Math.min(Y,c.theta)):c.theta=c.theta>(U+Y)/2?Math.max(U,c.theta):Math.min(Y,c.theta)),c.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,c.phi)),c.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(m,t.dampingFactor):t.target.add(m),t.target.sub(t.cursor),t.target.clampLength(t.minTargetRadius,t.maxTargetRadius),t.target.add(t.cursor),t.zoomToCursor&&L||t.object.isOrthographicCamera?c.radius=P(c.radius):c.radius=P(c.radius*p),e.setFromSpherical(c),e.applyQuaternion(d),Lt.copy(t.target).add(e),t.object.lookAt(t.target),t.enableDamping===!0?(l.theta*=1-t.dampingFactor,l.phi*=1-t.dampingFactor,m.multiplyScalar(1-t.dampingFactor)):(l.set(0,0,0),m.set(0,0,0));let st=!1;if(t.zoomToCursor&&L){let et=null;if(t.object.isPerspectiveCamera){const ot=e.length();et=P(ot*p);const ct=ot-et;t.object.position.addScaledVector(R,ct),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const ot=new C(j.x,j.y,0);ot.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix(),st=!0;const ct=new C(j.x,j.y,0);ct.unproject(t.object),t.object.position.sub(ct).add(ot),t.object.updateMatrixWorld(),et=e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;et!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(et).add(t.object.position):(ht.origin.copy(t.object.position),ht.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(ht.direction))<Qe?o.lookAt(t.target):(zt.setFromNormalAndCoplanarPoint(t.object.up,t.target),ht.intersectPlane(zt,t.target))))}else t.object.isOrthographicCamera&&(st=p!==1,st&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix()));return p=1,L=!1,st||f.distanceToSquared(t.object.position)>h||8*(1-S.dot(t.object.quaternion))>h||Z.distanceToSquared(t.target)>0?(t.dispatchEvent(Ut),f.copy(t.object.position),S.copy(t.object.quaternion),Z.copy(t.target),!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",Rt),t.domElement.removeEventListener("pointerdown",jt),t.domElement.removeEventListener("pointercancel",tt),t.domElement.removeEventListener("wheel",St),t.domElement.removeEventListener("pointermove",pt),t.domElement.removeEventListener("pointerup",tt),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",mt),t._domElementKeyEvents=null)};const t=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=a.NONE;const h=1e-6,c=new Bt,l=new Bt;let p=1;const m=new C,b=new N,g=new N,v=new N,E=new N,T=new N,x=new N,y=new N,k=new N,_=new N,R=new C,j=new N;let L=!1;const M=[],D={};let z=!1;function X(e){return e!==null?2*Math.PI/60*t.autoRotateSpeed*e:2*Math.PI/60/60*t.autoRotateSpeed}function B(e){const s=Math.abs(e*.01);return Math.pow(.95,t.zoomSpeed*s)}function A(e){l.theta-=e}function w(e){l.phi-=e}const H=function(){const e=new C;return function(d,f){e.setFromMatrixColumn(f,0),e.multiplyScalar(-d),m.add(e)}}(),O=function(){const e=new C;return function(d,f){t.screenSpacePanning===!0?e.setFromMatrixColumn(f,1):(e.setFromMatrixColumn(f,0),e.crossVectors(t.object.up,e)),e.multiplyScalar(d),m.add(e)}}(),W=function(){const e=new C;return function(d,f){const S=t.domElement;if(t.object.isPerspectiveCamera){const Z=t.object.position;e.copy(Z).sub(t.target);let I=e.length();I*=Math.tan(t.object.fov/2*Math.PI/180),H(2*d*I/S.clientHeight,t.object.matrix),O(2*f*I/S.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(H(d*(t.object.right-t.object.left)/t.object.zoom/S.clientWidth,t.object.matrix),O(f*(t.object.top-t.object.bottom)/t.object.zoom/S.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function $(e){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?p/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function it(e){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?p*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function rt(e,s){if(!t.zoomToCursor)return;L=!0;const d=t.domElement.getBoundingClientRect(),f=e-d.left,S=s-d.top,Z=d.width,I=d.height;j.x=f/Z*2-1,j.y=-(S/I)*2+1,R.set(j.x,j.y,1).unproject(t.object).sub(t.object.position).normalize()}function P(e){return Math.max(t.minDistance,Math.min(t.maxDistance,e))}function q(e){b.set(e.clientX,e.clientY)}function ae(e){rt(e.clientX,e.clientX),y.set(e.clientX,e.clientY)}function wt(e){E.set(e.clientX,e.clientY)}function ie(e){g.set(e.clientX,e.clientY),v.subVectors(g,b).multiplyScalar(t.rotateSpeed);const s=t.domElement;A(2*Math.PI*v.x/s.clientHeight),w(2*Math.PI*v.y/s.clientHeight),b.copy(g),t.update()}function re(e){k.set(e.clientX,e.clientY),_.subVectors(k,y),_.y>0?$(B(_.y)):_.y<0&&it(B(_.y)),y.copy(k),t.update()}function se(e){T.set(e.clientX,e.clientY),x.subVectors(T,E).multiplyScalar(t.panSpeed),W(x.x,x.y),E.copy(T),t.update()}function ce(e){rt(e.clientX,e.clientY),e.deltaY<0?it(B(e.deltaY)):e.deltaY>0&&$(B(e.deltaY)),t.update()}function le(e){let s=!1;switch(e.code){case t.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?w(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):W(0,t.keyPanSpeed),s=!0;break;case t.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?w(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):W(0,-t.keyPanSpeed),s=!0;break;case t.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?A(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):W(t.keyPanSpeed,0),s=!0;break;case t.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?A(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):W(-t.keyPanSpeed,0),s=!0;break}s&&(e.preventDefault(),t.update())}function xt(e){if(M.length===1)b.set(e.pageX,e.pageY);else{const s=G(e),d=.5*(e.pageX+s.x),f=.5*(e.pageY+s.y);b.set(d,f)}}function Pt(e){if(M.length===1)E.set(e.pageX,e.pageY);else{const s=G(e),d=.5*(e.pageX+s.x),f=.5*(e.pageY+s.y);E.set(d,f)}}function Et(e){const s=G(e),d=e.pageX-s.x,f=e.pageY-s.y,S=Math.sqrt(d*d+f*f);y.set(0,S)}function he(e){t.enableZoom&&Et(e),t.enablePan&&Pt(e)}function ue(e){t.enableZoom&&Et(e),t.enableRotate&&xt(e)}function vt(e){if(M.length==1)g.set(e.pageX,e.pageY);else{const d=G(e),f=.5*(e.pageX+d.x),S=.5*(e.pageY+d.y);g.set(f,S)}v.subVectors(g,b).multiplyScalar(t.rotateSpeed);const s=t.domElement;A(2*Math.PI*v.x/s.clientHeight),w(2*Math.PI*v.y/s.clientHeight),b.copy(g)}function Ot(e){if(M.length===1)T.set(e.pageX,e.pageY);else{const s=G(e),d=.5*(e.pageX+s.x),f=.5*(e.pageY+s.y);T.set(d,f)}x.subVectors(T,E).multiplyScalar(t.panSpeed),W(x.x,x.y),E.copy(T)}function Ct(e){const s=G(e),d=e.pageX-s.x,f=e.pageY-s.y,S=Math.sqrt(d*d+f*f);k.set(0,S),_.set(0,Math.pow(k.y/y.y,t.zoomSpeed)),$(_.y),y.copy(k);const Z=(e.pageX+s.x)*.5,I=(e.pageY+s.y)*.5;rt(Z,I)}function de(e){t.enableZoom&&Ct(e),t.enablePan&&Ot(e)}function pe(e){t.enableZoom&&Ct(e),t.enableRotate&&vt(e)}function jt(e){t.enabled!==!1&&(M.length===0&&(t.domElement.setPointerCapture(e.pointerId),t.domElement.addEventListener("pointermove",pt),t.domElement.addEventListener("pointerup",tt)),Me(e),e.pointerType==="touch"?_t(e):me(e))}function pt(e){t.enabled!==!1&&(e.pointerType==="touch"?ye(e):fe(e))}function tt(e){switch(Te(e),M.length){case 0:t.domElement.releasePointerCapture(e.pointerId),t.domElement.removeEventListener("pointermove",pt),t.domElement.removeEventListener("pointerup",tt),t.dispatchEvent(Yt),r=a.NONE;break;case 1:const s=M[0],d=D[s];_t({pointerId:s,pageX:d.x,pageY:d.y});break}}function me(e){let s;switch(e.button){case 0:s=t.mouseButtons.LEFT;break;case 1:s=t.mouseButtons.MIDDLE;break;case 2:s=t.mouseButtons.RIGHT;break;default:s=-1}switch(s){case V.DOLLY:if(t.enableZoom===!1)return;ae(e),r=a.DOLLY;break;case V.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(t.enablePan===!1)return;wt(e),r=a.PAN}else{if(t.enableRotate===!1)return;q(e),r=a.ROTATE}break;case V.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(t.enableRotate===!1)return;q(e),r=a.ROTATE}else{if(t.enablePan===!1)return;wt(e),r=a.PAN}break;default:r=a.NONE}r!==a.NONE&&t.dispatchEvent(gt)}function fe(e){switch(r){case a.ROTATE:if(t.enableRotate===!1)return;ie(e);break;case a.DOLLY:if(t.enableZoom===!1)return;re(e);break;case a.PAN:if(t.enablePan===!1)return;se(e);break}}function St(e){t.enabled===!1||t.enableZoom===!1||r!==a.NONE||(e.preventDefault(),t.dispatchEvent(gt),ce(ge(e)),t.dispatchEvent(Yt))}function ge(e){const s=e.deltaMode,d={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(s){case 1:d.deltaY*=16;break;case 2:d.deltaY*=100;break}return e.ctrlKey&&!z&&(d.deltaY*=10),d}function be(e){e.key==="Control"&&(z=!0,t.domElement.getRootNode().addEventListener("keyup",kt,{passive:!0,capture:!0}))}function kt(e){e.key==="Control"&&(z=!1,t.domElement.getRootNode().removeEventListener("keyup",kt,{passive:!0,capture:!0}))}function mt(e){t.enabled===!1||t.enablePan===!1||le(e)}function _t(e){switch(Dt(e),M.length){case 1:switch(t.touches.ONE){case Q.ROTATE:if(t.enableRotate===!1)return;xt(e),r=a.TOUCH_ROTATE;break;case Q.PAN:if(t.enablePan===!1)return;Pt(e),r=a.TOUCH_PAN;break;default:r=a.NONE}break;case 2:switch(t.touches.TWO){case Q.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;he(e),r=a.TOUCH_DOLLY_PAN;break;case Q.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;ue(e),r=a.TOUCH_DOLLY_ROTATE;break;default:r=a.NONE}break;default:r=a.NONE}r!==a.NONE&&t.dispatchEvent(gt)}function ye(e){switch(Dt(e),r){case a.TOUCH_ROTATE:if(t.enableRotate===!1)return;vt(e),t.update();break;case a.TOUCH_PAN:if(t.enablePan===!1)return;Ot(e),t.update();break;case a.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;de(e),t.update();break;case a.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;pe(e),t.update();break;default:r=a.NONE}}function Rt(e){t.enabled!==!1&&e.preventDefault()}function Me(e){M.push(e.pointerId)}function Te(e){delete D[e.pointerId];for(let s=0;s<M.length;s++)if(M[s]==e.pointerId){M.splice(s,1);return}}function Dt(e){let s=D[e.pointerId];s===void 0&&(s=new N,D[e.pointerId]=s),s.set(e.pageX,e.pageY)}function G(e){const s=e.pointerId===M[0]?M[1]:M[0];return D[s]}t.domElement.addEventListener("contextmenu",Rt),t.domElement.addEventListener("pointerdown",jt),t.domElement.addEventListener("pointercancel",tt),t.domElement.addEventListener("wheel",St,{passive:!1}),t.domElement.getRootNode().addEventListener("keydown",be,{passive:!0,capture:!0}),this.update()}}var Je=Math.PI/180,$e=180/Math.PI;function Vt(i){var o=Xt(i[0]+1,i[2]),n=Xt(i[0],i[2]),t=Ht(i[1]+1,i[2]),a=Ht(i[1],i[2]);return[n,t,o,a]}function to(i){var o=Vt(i),n={type:"Polygon",coordinates:[[[o[0],o[3]],[o[0],o[1]],[o[2],o[1]],[o[2],o[3]],[o[0],o[3]]]]};return n}function Xt(i,o){return i/Math.pow(2,o)*360-180}function Ht(i,o){var n=Math.PI-2*Math.PI*i/Math.pow(2,o);return $e*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function bt(i,o,n){var t=oe(i,o,n);return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t}function Qt(i){return[[i[0]*2,i[1]*2,i[2]+1],[i[0]*2+1,i[1]*2,i[2]+1],[i[0]*2+1,i[1]*2+1,i[2]+1],[i[0]*2,i[1]*2+1,i[2]+1]]}function Jt(i){return[i[0]>>1,i[1]>>1,i[2]-1]}function $t(i){return Qt(Jt(i))}function eo(i,o){for(var n=$t(i),t=0;t<n.length;t++)if(!te(o,n[t]))return!1;return!0}function te(i,o){for(var n=0;n<i.length;n++)if(ee(i[n],o))return!0;return!1}function ee(i,o){return i[0]===o[0]&&i[1]===o[1]&&i[2]===o[2]}function oo(i){for(var o="",n=i[2];n>0;n--){var t=0,a=1<<n-1;i[0]&a&&t++,i[1]&a&&(t+=2),o+=t.toString()}return o}function no(i){for(var o=0,n=0,t=i.length,a=t;a>0;a--){var r=1<<a-1,h=+i[t-a];h===1&&(o|=r),h===2&&(n|=r),h===3&&(o|=r,n|=r)}return[o,n,t]}function ao(i){var o=bt(i[0],i[1],32),n=bt(i[2],i[3],32),t=[o[0],o[1],n[0],n[1]],a=io(t);if(a===0)return[0,0,0];var r=t[0]>>>32-a,h=t[1]>>>32-a;return[r,h,a]}function io(i){for(var o=28,n=0;n<o;n++){var t=1<<32-(n+1);if((i[0]&t)!==(i[2]&t)||(i[1]&t)!==(i[3]&t))return n}return o}function oe(i,o,n){var t=Math.sin(o*Je),a=Math.pow(2,n),r=a*(i/360+.5),h=a*(.5-.25*Math.log((1+t)/(1-t))/Math.PI);return r=r%a,r<0&&(r=r+a),[r,h,n]}var ut={tileToGeoJSON:to,tileToBBOX:Vt,getChildren:Qt,getParent:Jt,getSiblings:$t,hasTile:te,hasSiblings:eo,tilesEqual:ee,tileToQuadkey:oo,quadkeyToTile:no,pointToTile:bt,bboxToTile:ao,pointToTileFraction:oe};class Tt extends Gt{constructor(){super();u(this,"map");u(this,"tileNo");u(this,"isDisposed",!1);u(this,"isReady",!1);u(this,"parentTile");u(this,"childrenTiles",[]);u(this,"boundingBoxWorld",new _e);u(this,"content")}init(n,t,a){this.tileNo=n,Object.freeze(this.tileNo),this.map=t,this.parentTile=a,this.visible=!1,this.renderOrder=n[2],this.ready()}async ready(){if(this.content=await this.map.provider.getTile(this.tileNo),!this.isDisposed){if(this.add(this.content),this.boundingBoxWorld.setFromObject(this.content).applyMatrix4(this.matrixWorld.makeRotationX(-Math.PI/2)),this.map.add(this),this.visible=!0,this.isReady=!0,this.parentTile){const n=this.parentTile.childrenTiles;let t=0;for(let a=0;a<n.length;a++)n[a].isReady&&t++;t===4&&(this.parentTile.visible=!1)}this.update()}}update(){if(!this.isReady||this.isDisposed)return;const{cameraFrustum:n,cameraWorldPosition:t}=this.map;if(!n.intersectsBox(this.boundingBoxWorld)){this.simplify();return}this.content instanceof Mt&&this.map.provider.filter&&(this.content.material.uniforms.t_Matrix.value=this.map.provider.getTranMatrix());let a=this.boundingBoxWorld.distanceToPoint(t);const r=this.tileNo[2];a/=Math.pow(2,this.map.provider.maxZoom-r),a<60&&this.subdivide(),a>80&&this.simplify(),this.childrenTiles.sort((c,l)=>c.boundingBoxWorld.distanceToPoint(t)-l.boundingBoxWorld.distanceToPoint(t)).forEach(c=>c.update())}subdivide(){const{isReady:n,tileNo:t,map:a,childrenTiles:r}=this,h=t[2];if(!n||r.length>0||h>=a.maxZoom)return;ut.getChildren(t).forEach(l=>{const p=new Tt;p.init(l,a,this),r.push(p)})}simplify(){this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.visible=!0}dispose(){this.map.remove(this),this.map.provider.abort(this.tileNo),this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.parentTile=void 0,this.content&&(this.map.provider.dispose(this.tileNo,this.content),this.content=void 0),this.isDisposed=!0}}let jo=class extends Gt{constructor(){super();u(this,"provider");u(this,"bbox",[74.390592,6.900905,134.071423,54.318199]);u(this,"maxZoom",20);u(this,"rootForward",0);u(this,"camera");u(this,"cameraFrustum",new Re);u(this,"cameraWorldPosition",new C);u(this,"cameraProjectionMatrix",new K);u(this,"lastCameraProjectionMatrix",new K);u(this,"lastCameraWorldPosition",new C);u(this,"rootTiles",[]);u(this,"lastUpdateTime",0);lt.prototype.computeBoundsTree||(lt.prototype.computeBoundsTree=Ke),lt.prototype.disposeBoundsTree||(lt.prototype.disposeBoundsTree=qe),Mt.prototype.raycast=Ge}initRootTiles(){this.rootForward>3&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=3),this.rootForward<0&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=0);const n=[];let t=[ut.bboxToTile(this.bbox)],a=this.rootForward;for(;a>0;){const r=[...t];t=[],r.forEach(h=>{const c=ut.getChildren(h);t.push(...c)}),a--}n.push(...t),n.forEach(r=>{const h=new Tt;h.init(r,this),this.rootTiles.push(h)})}update(){if(!this.visible||!this.camera)return;const n=Date.now();if(!(n-this.lastUpdateTime<300)){if(this.rootTiles.length===0){this.initRootTiles();return}this.camera.getWorldPosition(this.cameraWorldPosition),this.cameraProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),!(this.cameraWorldPosition.equals(this.lastCameraWorldPosition)&&this.cameraProjectionMatrix.equals(this.lastCameraProjectionMatrix))&&(this.cameraFrustum.setFromProjectionMatrix(this.cameraProjectionMatrix),this.rootTiles.forEach(t=>t.update()),this.lastCameraProjectionMatrix.copy(this.cameraProjectionMatrix),this.lastCameraWorldPosition.copy(this.cameraWorldPosition),this.lastUpdateTime=n)}}dispose(){throw new Error("[Map.dispose] Method not implemented.")}regenerate(){throw new Error("[Map.regenerate] Method not implemented.")}};const J=class J{constructor(){u(this,"_controller",new AbortController);u(this,"listeners",new Set)}fetch(o,n={}){J.pendings.has(o)||(J.pendings.set(o,this),fetch(o,Nt(It({},n),{signal:this._controller.signal})).then(t=>{this.listeners.forEach(a=>a.resolve(t.clone()))}).catch(t=>{this.listeners.forEach(a=>a.reject(t))}).finally(()=>{J.pendings.delete(o)}))}abort(){this._controller.abort()}};u(J,"pendings",new Map);let at=J;class ro{constructor(o,n){u(this,"resolve");u(this,"reject");u(this,"promise");this.url=o,this.init=n,this.promise=new Promise((t,a)=>{this.resolve=t,this.reject=a})}ready(){let o=at.pendings.get(this.url);return o||(o=new at,o.fetch(this.url,this.init)),o.listeners.add(this),this.promise}abort(){this.reject("User abort.");const o=at.pendings.get(this.url);o&&(o.listeners.delete(this),o.listeners.size===0&&o.abort())}}let nt;async function so(i,o,n=!1){const a=await(await o.ready()).blob(),r=await createImageBitmap(a,n?void 0:{imageOrientation:"flipY"});if(!n)return r;nt||(nt=new OffscreenCanvas(256,256));const h=nt.getContext("2d");if(!h)throw new Error('Offscreencanvas.getContext("2d") error!');const{width:c,height:l}=nt;return h.drawImage(r,0,0),h.rect(0,0,c,l),h.strokeStyle="#00FFFF",h.font="20px Arial",h.stroke(),h.fillStyle="#FF4444",h.fillText("".concat(i[0]),10,30),h.fillStyle="#44FF44",h.fillText("".concat(i[1]),10,55),h.fillStyle="#66AAFF",h.fillText("".concat(i[2]),10,80),await createImageBitmap(nt,{imageOrientation:"flipY"})}class co{constructor(o){u(this,"worker");u(this,"terminated",!0);u(this,"map",new Map);this.worker=new o,this.worker.onmessage=this.onMessage.bind(this),this.terminated=!1}async postMessage(o){if(!this.terminated)return this.worker.postMessage(o),new Promise((n,t)=>{this.map.set(o.id,n)})}onMessage(o){const{id:n,error:t}=o.data,a=this.map.get(n);a&&!t&&a(o.data),this.map.delete(n)}terminate(){this.worker.onmessage=null,this.worker.terminate(),this.terminated=!0,this.map.clear()}}function lo(i){return new Worker(""+new URL("../static/MapWorker-P8uJfnMJ.js",import.meta.url).href,{name:i==null?void 0:i.name})}class ko{constructor(){u(this,"maxZoom",20);u(this,"source","https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s&x=[x]&y=[y]&z=[z]");u(this,"showTileNo",!1);u(this,"_useWorker",!1);u(this,"_worker");u(this,"fetching",new Map)}set useWorker(o){var n;this._useWorker=o,this._useWorker||((n=this._worker)==null||n.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(o){const n=this.getUrl(o),t=new De;if(this._useWorker){this._worker||(this._worker=new co(lo));const a=this.getId(o),r=await this._worker.postMessage({id:a,tileNo:o,url:n,debug:this.showTileNo});t.image=r.bitmap}else{const a=new ro(n,{cache:"force-cache",mode:"cors"});this.fetching.set(o,a);try{t.image=await so(o,a,this.showTileNo)}finally{this.fetching.delete(o)}}return t.needsUpdate=!0,t.anisotropy=4,t}abort(o){var n;if(this._useWorker)(n=this._worker)==null||n.postMessage({id:this.getId(o),abort:!0});else{const t=this.fetching.get(o);t&&t.abort(),this.fetching.delete(o)}}dispose(o,n){n.dispose()}getId(o){return o.join("-")}getUrl(o){const[n,t,a]=o;return this.source.indexOf("[x]")===-1?this.source.replace("{x}",n+"").replace("{y}",t+"").replace("{z}",a+""):this.source.replace("[x]",n+"").replace("[y]",t+"").replace("[z]",a+"")}}const yt="utm",ho="merc",dt=6378137,Zt=Math.PI/180;function Kt(i,o){const n=dt*i*Zt,t=dt*Math.log(Math.tan(Math.PI*.25+o*Zt*.5));return[n,t]}function uo(i,o){let n=i/(dt*Math.PI)*180,t=o/(dt*Math.PI)*180;return t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2),[n,t]}function F(i){return i*Math.PI/180}function qt(i){return i*180/Math.PI}const ne={a:6378137,b:6356752314245e-6,f:1/298.257223563},po="CDEFGHJKLMNPQRSTUVWXX",mo=5e5,fo=1e7;function go(i,o,n){if(!(-80<=o&&o<=84))throw new RangeError("latitude ‘".concat(o,"’ outside UTM limits"));let t=n||Math.floor((i+180)/6)+1,a=F((t-1)*6-180+3);const r=po.charAt(Math.floor(o/8+10));t===31&&r==="V"&&i>=3?(t++,a+=F(6)):t===32&&r==="X"&&i<9?(t--,a-=F(6)):t===32&&r==="X"&&i>=9?(t++,a+=F(6)):t===34&&r==="X"&&i<21?(t--,a-=F(6)):t===34&&r==="X"&&i>=21?(t++,a+=F(6)):t===36&&r==="X"&&i<33?(t--,a-=F(6)):t===36&&r==="X"&&i>=33&&(t++,a+=F(6));const h=F(o),c=F(i)-a,{a:l,f:p}=ne,m=.9996,b=Math.sqrt(p*(2-p)),g=p/(2-p),v=g*g,E=g*v,T=g*E,x=g*T,y=g*x,k=Math.cos(c),_=Math.sin(c),R=Math.tan(h),j=Math.sinh(b*Math.atanh(b*R/Math.sqrt(1+R*R))),L=R*Math.sqrt(1+j*j)-j*Math.sqrt(1+R*R),M=Math.atan2(L,k),D=Math.asinh(_/Math.sqrt(L*L+k*k)),z=l/(1+g)*(1+1/4*v+1/64*T+1/256*y),X=[null,1/2*g-2/3*v+5/16*E+41/180*T-127/288*x+7891/37800*y,13/48*v-3/5*E+557/1440*T+281/630*x-1983433/1935360*y,61/240*E-103/140*T+15061/26880*x+167603/181440*y,49561/161280*T-179/168*x+6601661/7257600*y,34729/80640*x-3418889/1995840*y,212378941/319334400*y];let B=M;for(let O=1;O<=6;O++)B+=X[O]*Math.sin(2*O*M)*Math.cosh(2*O*D);let A=D;for(let O=1;O<=6;O++)A+=X[O]*Math.cos(2*O*M)*Math.sinh(2*O*D);let w=m*z*A,H=m*z*B;return w=w+mo,H<0&&(H=H+fo),[w,H]}function bo(i,o,n){const a=n||50,r=5e5,{a:h,f:c}=ne,l=.9996,p=i-r,m=o,b=Math.sqrt(c*(2-c)),g=c/(2-c),v=g*g,E=g*v,T=g*E,x=g*T,y=g*x,k=h/(1+g)*(1+1/4*v+1/64*T+1/256*y),_=p/(l*k),R=m/(l*k),j=[null,1/2*g-2/3*v+37/96*E-1/360*T-81/512*x+96199/604800*y,1/48*v+1/15*E-437/1440*T+46/105*x-1118711/3870720*y,17/480*E-37/840*T-209/4480*x+5569/90720*y,4397/161280*T-11/504*x-830251/7257600*y,4583/161280*x-108847/3991680*y,20648693/638668800*y];let L=R;for(let P=1;P<=6;P++)L-=j[P]*Math.sin(2*P*R)*Math.cosh(2*P*_);let M=_;for(let P=1;P<=6;P++)M-=j[P]*Math.cos(2*P*R)*Math.sinh(2*P*_);const D=Math.sinh(M),z=Math.sin(L),X=Math.cos(L),B=z/Math.sqrt(D*D+X*X);let A=null,w=B;do{const P=Math.sinh(b*Math.atanh(b*w/Math.sqrt(1+w*w))),q=w*Math.sqrt(1+P*P)-P*Math.sqrt(1+w*w);A=(B-q)/Math.sqrt(1+q*q)*(1+(1-b*b)*w*w)/((1-b*b)*Math.sqrt(1+w*w)),w+=A}while(Math.abs(A)>1e-12);const O=Math.atan(w);let W=Math.atan2(D,X);const $=F((a-1)*6-180+3);W+=$;const it=Number(qt(O).toFixed(14));return[Number(qt(W).toFixed(14)),it]}class _o{constructor(){u(this,"utmZone",50);u(this,"coordType",yt);u(this,"maxZoom",20)}async getTile(o){const n=new Le,t=ut.tileToBBOX(o),a=this.convertCoordinate(t[0],t[3]),r=this.convertCoordinate(t[2],t[3]),h=this.convertCoordinate(t[0],t[1]),c=this.convertCoordinate(t[2],t[1]),l=new Float32Array([a[0],a[1],0,r[0],r[1],0,h[0],h[1],0,c[0],c[1],0]);return n.setAttribute("position",new Ae(l,3)),n}abort(o){}dispose(o,n){n.dispose()}convertCoordinate(o,n){switch(this.coordType){case yt:return go(o,n,this.utmZone);case ho:return Kt(o,n);default:return Kt(o,n)}}}class yo extends Mt{constructor(n){super(n);u(this,"center",new C)}}class Ro{constructor(o,n){u(this,"maxZoom",20);u(this,"showBoundingBox",!1);u(this,"wireframe",!1);u(this,"flatShading",!1);u(this,"useStandardMaterial",!1);u(this,"filter",null);this.geometryProvider=o,this.textureProvider=n}getTranMatrix(){var n,t,a,r,h;let o=new K;if((n=this.filter)!=null&&n.opposite){let c=new K;c.set(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),o.multiply(c)}if((t=this.filter)!=null&&t.monochrome){let c=new K;const l=this.filter.monochrome.r,p=this.filter.monochrome.g,m=this.filter.monochrome.b;c.set(l,p,m,0,l,p,m,0,l,p,m,0,0,0,0,1),o.multiply(c)}if((a=this.filter)!=null&&a.genBright){let c=new K;const l=this.filter.genBright;c.set(l,0,0,0,0,l,0,0,0,0,l,0,0,0,0,1),o.multiply(c)}if((r=this.filter)!=null&&r.genContrast){let c=new K;const l=this.filter.genContrast,p=.5*(1-l);c.set(l,0,0,0,0,l,0,0,0,0,l,0,p,p,p,1),o.multiply(c)}if((h=this.filter)!=null&&h.genSaturate){let c=new K;const l=this.filter.genSaturate,p=.3*(1-l),m=.6*(1-l),b=.1*(1-l);c.set(p+l,p,p,0,m,m+l,m,0,b,b,b+l,0,0,0,0,1),o.multiply(c)}return o}async getTile(o){const n=[this.geometryProvider.getTile(o),this.textureProvider.getTile(o)],t=await Promise.all(n),a=t[0],r=t[1];r.colorSpace=Ie;const{wireframe:h,flatShading:c}=this;let l=null;const p=o[0]+o[1]+o[2];l=this.useStandardMaterial?new Ne({map:r,wireframe:h,flatShading:c}):new Fe({map:r,wireframe:h}),this.filter&&(l=new Ve({baseMaterial:l,vertexShader:"\n                varying vec2 vUv;    //顶点纹理坐标\n                void main () {\n                    vUv = uv;\n                    // gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 ); 着色器会抖动\n                    // gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                    csm_Position = position * vec3(1.0);\n                }\n                ",fragmentShader:"\n                uniform sampler2D e_Texture;     //纹理图像\n                varying vec2 vUv;               //片元纹理坐标\n                uniform mat4 t_Matrix;     //接收变换矩阵\n                void main () {\n                    // gl_FragColor = texture2D( e_Texture, vUv );\n\n                    // vec4 textureColor = texture2D( e_Texture, vUv );\n                    // //计算加权平均值\n                    // float w_a = textureColor.r * 0.3 + textureColor.g * 0.6 + textureColor.b * 0.1;\n                    // gl_FragColor = vec4(w_a, w_a, w_a, 1.0);\n\n                    vec4 textureColor = texture2D( e_Texture, vUv );\n                    //变换矩阵乘以 vec4(R,G,B,1)    --->vec4(R,G,B,1) 是齐次坐标，原本是n维的向量用一个n+1维向量来表示\n                    //vec4(R,G,B,1)第四个分量不是透明度\n                    vec4 transColor =  vec4(textureColor.r, textureColor.g, textureColor.b, 1.0)*t_Matrix; \n                    //设置透明度\n                    transColor.a = 1.0;\n                    csm_FragColor = transColor;\n\n                    // if(vUv.x==0.0 || vUv.x==1.0 || vUv.y==0.0 || vUv.y==1.0){\n                    //     gl_FragColor.a = 0.0;\n                    // }\n                }",silent:!0,flatShading:c,uniforms:{e_Texture:{value:r},t_Matrix:{value:this.getTranMatrix()}}}));const m=new yo;if(m.renderOrder=p,a.computeBoundingBox(),a.boundingBox.getCenter(m.center),a.center(),a.computeBoundingSphere(),a.computeBoundsTree(),m.position.copy(m.center),m.geometry=a,m.material=l,this.showBoundingBox){const b=new Be(a.boundingBox);m.add(b)}return m}abort(o){this.geometryProvider.abort(o),this.textureProvider.abort(o)}dispose(o,n){const t=n.geometry,a=n.material;t&&this.geometryProvider.dispose(o,t),a&&a.map&&this.textureProvider.dispose(o,a.map),a==null||a.dispose()}}const Mo={class:"lonLatDiv"},To=We({__name:"raycasterEvent",props:{tileMapRef:{}},setup(i){const o=i,n=Ue([0,0]);return Ye(()=>o.tileMapRef,(t,a)=>{if(!a&&t){let c=function(l){h.x=l.clientX/window.innerWidth*2-1,h.y=-(l.clientY/window.innerHeight)*2+1,r.setFromCamera(h,t.camera);var p=r.intersectObjects(t.map.children);if(p.length>0){var m=p[0];t.map.provider.geometryProvider.coordType===yt?n.value=bo(m.point.x,-m.point.z):n.value=uo(m.point.x,-m.point.z),n.value[0]=n.value[0].toFixed(4),n.value[1]=n.value[1].toFixed(4)}};console.log("raycasterEvent:",t);var r=new He,h=new N;document.addEventListener("mousemove",c,!1)}}),(t,a)=>(ze(),Xe("div",Mo," lon:"+Wt(n.value[0])+" lat:"+Wt(n.value[1]),1))}}),Do=Ze(To,[["__scopeId","data-v-462a60f8"]]);export{jo as M,Co as O,_o as P,Ro as T,yt as U,ko as a,co as b,ho as c,Kt as d,go as l,Do as r};
