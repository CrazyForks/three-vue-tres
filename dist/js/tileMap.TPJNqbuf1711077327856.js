var S=Object.defineProperty;var P=(i,t,e)=>t in i?S(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var m=(i,t,e)=>(P(i,typeof t!="symbol"?t+"":t,e),e);import{au as M,av as g,a0 as B,ak as z,az as f,be as I,b3 as _,a5 as R,w as k,o as b,c as W,K as Z,a8 as L,ac as U,a1 as x,aq as E,a3 as j,a4 as A,r as D,a as w,D as v,a7 as y,E as O,v as F,ag as G}from"./vendor.Wnhd-Ix51711077327856.js";import{U as Q,b as V,c as C,M as Y,P as q,a as H,T as K,O as N,d as $,r as J}from"./raycasterEvent.Qeyf-NgC1711077327856.js";import"./ExtensionUtilities.WLb2t7yM1711077327856.js";function X(i){return new Worker(""+new URL("../static/MartiniWorker-8mf_OiU3.js",import.meta.url).href,{name:i==null?void 0:i.name})}class ee{constructor(){m(this,"maxZoom",12);m(this,"coordType",Q);m(this,"utmZone",50);m(this,"_worker");m(this,"_useWorker",!0);m(this,"source","https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp")}set useWorker(t){var e;this._useWorker=t,this._useWorker||((e=this._worker)==null||e.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(t){return this._useWorker?this.getInWorkerThread(t):this.getInMainThread()}async getInMainThread(){return new M}async getInWorkerThread(t){this._worker||(this._worker=new V(X));const e={tileNo:t,id:this.getId(t),url:this.getUrl(t),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},r=await this._worker.postMessage(e),a=new M;return a.setAttribute("position",new g(r.positions,3)),a.setAttribute("uv",new g(r.uv,2)),a.setIndex(new g(r.triangles,1)),a}async abort(t){var e;this._useWorker&&((e=this._worker)==null||e.postMessage({id:this.getId(t),abort:!0}))}async dispose(t,e){var r;e.dispose(),this._useWorker&&((r=this._worker)==null||r.postMessage({id:this.getId(t),dispose:!0}))}getId(t){return t.join("-")}getUrl(t){const[e,r,a]=t;return this.source.replace("[x]",e+"").replace("[y]",r+"").replace("[z]",a+"")}}const te=["object","rotation"],oe=B({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{}},setup(i,{expose:t}){const e=i,{renderer:r,scene:a}=z(),c=new q;c.coordType=C;const u=new ee;u.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",u.coordType=C;const h=new H;h.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",h.showTileNo=!1,h.useWorker=!0;const n=new K(u,h);if(n.showBoundingBox=!1,n.wireframe=!1,n.flatShading=!1,n.useStandardMaterial=!1,n.filter={opposite:e.opposite,monochrome:e.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:e.genBright,genContrast:e.genContrast,genSaturation:e.genSaturation},e.monochrome){let s=new f(e.monochrome);n.filter.monochrome={r:s.r,g:s.g,b:s.b}}const l=new Y;l.provider=n,l.bbox=e.bbox,l.maxZoom=e.maxZoom;const o=new I(60,window.innerWidth/window.innerHeight,1,1e7*10);o.up=new _(0,1,0),o.position.set(e.mapCenter[0],e.mapCenter[2],-e.mapCenter[1]),o.lookAt(new _(o.position.x,0,o.position.z-2e3)),l.camera=o;let p=null;R(()=>{if(r.value&&(p=new N(o,r.value.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.minDistance=600,p.position0.set(o.position.x,o.position.y,o.position.z),p.target.set(o.position.x,0,o.position.z-2e3)),e.genBright&&(n.filter.genBright=e.genBright),e.genContrast&&(n.filter.genContrast=e.genContrast),e.genSaturation&&(n.filter.genSaturation=e.genSaturation),e.isMonochrome&&e.monochrome){let s=new f(e.monochrome);n.filter.monochrome={r:s.r,g:s.g,b:s.b}}}),k(()=>e.opposite,s=>{n.filter.opposite=s}),k(()=>e.isMonochrome,s=>{let d=new f(e.monochrome);n.filter.monochrome=s?{r:d.r,g:d.g,b:d.b}:null});const{onLoop:T}=L();return T(()=>{if(r.value){p&&p.update(),l.update();const s=Math.abs(o.position.y)*50;o.far=s+5e3,o.updateProjectionMatrix(),p.target.y=0,r.value.render(a.value,o)}}),t({camera:o,map:l}),(s,d)=>(b(),W("primitive",{object:Z(l),rotation:[-Math.PI/2,0,0]},null,8,te))}}),ie=B({__name:"tileMap",setup(i){const t=$(118.779958,32.017136),e=[t[0],t[1],5e3],r=U(),a=x({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:e}),c=new E({title:"参数"});c.addBinding(a,"opposite",{label:"反色"}),c.addBinding(a,"genBright",{label:"高亮",min:.1,max:3,step:.1}),c.addBinding(a,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),c.addBinding(a,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),c.addBinding(a,"isMonochrome",{label:"单色滤镜"}),c.addBinding(a,"monochrome",{label:"滤镜颜色"});const u=x({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,disableRender:!0,outputColorSpace:j,toneMapping:A,precision:"highp"});return(h,n)=>{const l=D("TresCanvas");return b(),W(O,null,[w(l,y(u,{"window-size":""}),{default:v(()=>[(b(),F(G,null,{default:v(()=>[w(oe,y(a,{ref_key:"tileMapMeshRef",ref:r,bbox:[104.955976,20.149765,120.998419,30.528687]}),null,16)]),_:1}))]),_:1},16),w(J,{tileMapRef:r.value},null,8,["tileMapRef"])],64)}}});export{ie as default};
