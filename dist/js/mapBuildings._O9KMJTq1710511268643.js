import{be as S,bc as P,bd as E,b0 as _,bm as j,$ as C,k as z,bL as k,ak as L,a5 as D,a4 as O,o as x,c as G,W as m,K as s,aO as N,aw as w,b1 as $,a0 as R,a as g,a7 as W,ab as H,E as q,a1 as F,a2 as V,a3 as U,v as T,D as B,a8 as Z,ag as A}from"./vendor.St8dZPm41710511268643.js";import{C as I}from"./vanilla-307d3a93.esm.C6agbWHs1710511268643.js";import{L as K,a as Q,b as J}from"./LineSegments2.2Z5cv9ym1710511268643.js";import{T as X}from"./TilesRenderer.8fGVh1oq1710511268643.js";import{U as Y,M as ee,P as oe,a as te,T as ne,l as ae}from"./TerrainMeshProvider.3A_qVJrC1710511268643.js";import{_ as re,a as ie}from"./radraB.vue_vue_type_script_setup_true_lang.azTARHbl1710511268643.js";import"./_commonjsHelpers.5-cIlDoe1710511268643.js";import"./BufferGeometryUtils.FQtqKwMn1710511268643.js";const se=(a,o)=>{const i=new j,t=new _().crossVectors(a,o);return i.x=t.x,i.y=t.y,i.z=t.z,i.w=1+a.clone().dot(o),i.normalize(),i},le=a=>{a.onLoadTileSet=o=>{const i=new S,t=new P,e=new E;let r=null,f=0;a.getOrientedBounds(i,e)?(r=new _().setFromMatrixPosition(e),f=r.length()):a.getBoundingSphere(t)&&(r=t.center.clone(),f=r.length());const d=r==null?void 0:r.normalize(),p=new _(0,1,0),n=se(d,p);a.group.quaternion.x=n.x,a.group.quaternion.y=n.y,a.group.quaternion.z=n.z,a.group.quaternion.w=n.w,a.group.position.y=-f}},ue="varying vec4 vPosition;\nvoid main(){\n	vPosition=modelMatrix*vec4(position,1.);\n	csm_Position=position*vec3(1.);\n}",ce="uniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor; // 顶部颜色\nuniform bool uGradient;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main() {\n  // 转世界坐标\n  uMax_world = modelMatrix * vec4(uMax, 1.);\n  uMin_world = modelMatrix * vec4(uMin, 1.);\n  vec3 distColor = uColor;\n  float residue = uTime - floor(uTime / uCircleTime) * uCircleTime;\n  float rate = residue / uCircleTime;\n  float lightOffset = rate * (uMax_world.y - uMin_world.y);\n\n  if (uMin_world.y + lightOffset < vPosition.y &&\n      uMin_world.y + lightOffset + uBorderWidth > vPosition.y) {\n    csm_DiffuseColor = vec4(uLightColor, uOpacity);\n  } else {\n    csm_DiffuseColor = vec4(distColor, uOpacity);\n  }\n\n  // 根据高度计算颜色\n  if (uGradient) {\n    float rateHight =\n        (vPosition.y - uMin_world.y) / (uMax_world.y - uMin_world.y);\n    // vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, rateHight * 0.6);\n    float mixNumber = clamp(rateHight * 2.3 - 1.5, 0., 1.);\n    vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, mixNumber);\n\n    csm_DiffuseColor = vec4(outColor, uOpacity);\n  }\n}",pe=["object"],fe=C({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0}},setup(a){const o=a,i=z(0),t=n=>{const{geometry:u}=n;u.computeBoundingBox(),u.computeBoundingSphere();const{max:c,min:l}=u.boundingBox,v=new I({baseMaterial:new N,vertexShader:ue,fragmentShader:ce,silent:!0,uniforms:{uMax:{value:c},uMin:{value:l},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new w(o.bulidingsColor)},uOpacity:{value:o.opacity},uLightColor:{value:new w("#ffffff")},uTopColor:{value:new w(o.topColor)},uTime:i,uGradient:{value:o.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:$});n.material.dispose(),n.material=v},e=new X("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");e.errorTarget=2,e.onLoadModel=n=>{n.traverse(l=>{if(l.isMesh){t(l),l.receiveShadow=!1,l.castShadow=!1;const v=new k(l.geometry.clone());let h=new K().fromEdgesGeometry(v),y=new Q({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});y.resolution.set(window.innerWidth,window.innerHeight);const b=new J(h,y);b.applyMatrix4(l.matrix.clone()),l.parent.add(b)}});const u=new S,c=new P;e.getBoundingBox(u)?(u.getCenter(e.group.position),e.group.position.multiplyScalar(-1)):e.getBoundingSphere(c)&&(e.group.position.copy(c.center),e.group.position.multiplyScalar(-1))},le(e);const{camera:r,renderer:f,sizes:d}=L();D(()=>{d.width.value&&(e.setCamera(r.value),e.setResolutionFromRenderer(r.value,f.value))});const{onBeforeLoop:p}=O();return p(({delta:n})=>{i.value+=n*2,r.value&&d.width.value&&(r.value.updateMatrixWorld(),e.update())}),(n,u)=>(x(),G("TresGroup",null,[m("primitive",{object:s(e).group},null,8,pe)]))}}),de=["object","rotation"],me=C({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20}},setup(a){const o=a,i=R({enableDamping:!0,dampingFactor:.05}),t=z(),{camera:e,renderer:r,scene:f}=L(),d=new oe;d.coordType=Y;const p=new te;p.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",p.showTileNo=!1,p.useWorker=!0;const n=new ne(d,p);n.showBoundingBox=!1,n.wireframe=!1,n.flatShading=!1,n.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let u=new w("#4688b5");n.filter.monochrome={r:u.r,g:u.g,b:u.b};const c=new ee;c.provider=n,c.bbox=o.bbox,c.maxZoom=o.maxZoom;let l=!1,v=!1;D(()=>{e.value&&!l&&(l=!0,c.camera=e.value),t.value&&!v&&(v=!0,t.value.value.target.x=e.value.position.x,t.value.value.target.y=0,t.value.value.target.z=e.value.position.z)});const{onLoop:M}=O();return M(()=>{if(r.value){const h=Math.abs(e.value.position.y)*50;e.value.far=h+5e3,e.value.updateProjectionMatrix(),t.value&&(t.value.value.target.y=0),c.update(),r.value.render(f.value,e.value)}}),(h,y)=>(x(),G(q,null,[g(s(H),W(i,{ref_key:"orbitControlRef",ref:t}),null,16),m("primitive",{object:s(c),rotation:[-Math.PI/2,0,0]},null,8,de)],64))}}),ve=["position"],ge=m("TresAmbientLight",{color:"#ffffff"},null,-1),he=m("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1),we=m("TresGridHelper",{args:[1e4,10]},null,-1),_e=m("TresAxesHelper",{args:[1e5]},null,-1),Pe=C({__name:"mapBuildings",setup(a){const o=ae(113.942639739199,22.53171672540276,50),i=R({clearColor:"#000000",disableRender:!0,alpha:!1,shadowMapType:F,outputColorSpace:V,toneMapping:U}),t=[o[0],o[1],4700];return(e,r)=>(x(),T(s(Z),W(i,{"window-size":""}),{default:B(()=>[m("TresPerspectiveCamera",{position:new _(t[0],t[2],-t[1]),fov:60,near:1,far:1e8,up:[0,1,0]},null,8,ve),ge,he,g(s(fe),{position:[s(o)[0],1,-s(o)[1]+228]},null,8,["position"]),(x(),T(A,null,{default:B(()=>[g(s(me),{bbox:[104.955976,20.149765,120.998419,30.528687]})]),_:1})),g(s(re),{color:"#00c0ff",radius:300,size:300,position:[s(o)[0],8,-s(o)[1]]},null,8,["position"]),g(s(ie),{position:[s(o)[0]+700,10,-s(o)[1]+300],color:"#ffff00",height:180,maxRadius:400},null,8,["position"]),we,_e]),_:1},16))}});export{Pe as default};
