import{be as L,bc as D,bd as $,b0 as w,bm as O,$ as M,k as W,bL as E,ak as B,a5 as z,a4 as S,o as u,c as P,W as v,K as n,aO as G,aw as y,b1 as k,a as m,v as p,D as f,ag as d,E as j,a0 as H,a1 as N,a2 as R,a3 as q,bk as F,a7 as A,a8 as V}from"./vendor.Whz5JOL71710727997925.js";import{C as Z}from"./vanilla-307d3a93.esm.oDMQ5mjs1710727997925.js";import{L as U,a as I,b as K}from"./LineSegments2.VW83iRZ61710727997925.js";import{T as Q}from"./TilesRenderer.9Jzn1_YL1710727997925.js";import{U as X,M as Y,P as J,a as ee,T as oe,O as ie,l as ne}from"./TerrainMeshProvider.5K_NPgN51710727997925.js";import{_ as te,a as ae}from"./radraB.vue_vue_type_script_setup_true_lang.MhxocKJF1710727997925.js";import{_ as re}from"./precipitation.vue_vue_type_script_setup_true_lang.51zootEO1710727997925.js";import{_ as se}from"./cloudMesh.vue_vue_type_script_setup_true_lang.uiJC_woG1710727997925.js";import{_ as T}from"./buildingsMarkA.vue_vue_type_script_setup_true_lang.0Du3hql01710727997925.js";import{_ as le}from"./fireA.vue_vue_type_script_setup_true_lang.y7ZO9gC41710727997925.js";import{_ as ue}from"./fireB.vue_vue_type_script_setup_true_lang.f8oW_2Cx1710727997925.js";import{_ as ce}from"./smokeA.vue_vue_type_script_setup_true_lang.JPg715jX1710727997925.js";import"./_commonjsHelpers.5-cIlDoe1710727997925.js";import"./BufferGeometryUtils.c6umBKMC1710727997925.js";import"./SPE.gx951f7j1710727997925.js";const me=(t,e)=>{const i=new O,c=new w().crossVectors(t,e);return i.x=c.x,i.y=c.y,i.z=c.z,i.w=1+t.clone().dot(e),i.normalize(),i},pe=t=>{t.onLoadTileSet=e=>{const i=new L,c=new D,r=new $;let s=null,l=0;t.getOrientedBounds(i,r)?(s=new w().setFromMatrixPosition(r),l=s.length()):t.getBoundingSphere(c)&&(s=c.center.clone(),l=s.length());const g=s==null?void 0:s.normalize(),a=new w(0,1,0),o=me(g,a);t.group.quaternion.x=o.x,t.group.quaternion.y=o.y,t.group.quaternion.z=o.z,t.group.quaternion.w=o.w,t.group.position.z=-l}},fe="varying vec4 vPosition;\nvoid main(){\n	vPosition=modelMatrix*vec4(position,1.);\n	csm_Position=position*vec3(1.);\n}",de="uniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor; // 顶部颜色\nuniform bool uGradient;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main() {\n  // 转世界坐标\n  uMax_world = modelMatrix * vec4(uMax, 1.);\n  uMin_world = modelMatrix * vec4(uMin, 1.);\n  vec3 distColor = uColor;\n  float residue = uTime - floor(uTime / uCircleTime) * uCircleTime;\n  float rate = residue / uCircleTime;\n  float lightOffset = rate * (uMax_world.y - uMin_world.y);\n\n  if (uMin_world.y + lightOffset < vPosition.y &&\n      uMin_world.y + lightOffset + uBorderWidth > vPosition.y) {\n    csm_DiffuseColor = vec4(uLightColor, uOpacity);\n  } else {\n    csm_DiffuseColor = vec4(distColor, uOpacity);\n  }\n\n  // 根据高度计算颜色\n  if (uGradient) {\n    float rateHight =\n        (vPosition.y - uMin_world.y) / (uMax_world.y - uMin_world.y);\n    // vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, rateHight * 0.6);\n    float mixNumber = clamp(rateHight * 2.3 - 1.5, 0., 1.);\n    vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, mixNumber);\n\n    csm_DiffuseColor = vec4(outColor, uOpacity);\n  }\n}",ge=["object"],_e=M({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(t){const e=t,i=W(0),c=a=>{const{geometry:o}=a;o.computeBoundingBox(),o.computeBoundingSphere();const{max:_,min:h}=o.boundingBox,C=new Z({baseMaterial:new G,vertexShader:fe,fragmentShader:de,silent:!0,uniforms:{uMax:{value:_},uMin:{value:h},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new y(e.bulidingsColor)},uOpacity:{value:e.opacity},uLightColor:{value:new y("#ffffff")},uTopColor:{value:new y(e.topColor)},uTime:i,uGradient:{value:e.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:k});a.material.dispose(),a.material=C},r=new Q("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");r.errorTarget=2,r.onLoadModel=a=>{a.traverse(o=>{if(o.isMesh){c(o),o.receiveShadow=!1,o.castShadow=!1;const _=new E(o.geometry.clone());let C=new U().fromEdgesGeometry(_),b=new I({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});b.resolution.set(window.innerWidth,window.innerHeight);const x=new K(C,b);x.applyMatrix4(o.matrix.clone()),o.parent.add(x)}})},pe(r);const{renderer:s,sizes:l}=B();z(()=>{l.width.value&&(r.setCamera(e.camera),r.setResolutionFromRenderer(e.camera,s.value))});const{onBeforeLoop:g}=S();return g(({delta:a})=>{i.value+=a*2,e.camera&&l.width.value&&(e.camera.updateMatrixWorld(),r.update())}),(a,o)=>(u(),P("TresGroup",null,[v("primitive",{object:n(r).group},null,8,ge)]))}}),he=["object","rotation"],we=M({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(t){const e=t,{renderer:i,scene:c}=B(),r=new J;r.coordType=X;const s=new ee;s.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",s.showTileNo=!1,s.useWorker=!0;const l=new oe(r,s);l.showBoundingBox=!1,l.wireframe=!1,l.flatShading=!1,l.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let g=new y("#4688b5");l.filter.monochrome={r:g.r,g:g.g,b:g.b};const a=new Y;a.provider=l,a.bbox=e.bbox,a.maxZoom=e.maxZoom,e.camera.up=new w(0,1,0),e.camera.position.set(e.mapCenter[0],e.mapCenter[2],-e.mapCenter[1]+2e3),e.camera.lookAt(new w(e.camera.position.x,0,e.camera.position.z-3e3)),a.camera=e.camera;let o=null;z(()=>{i.value&&(o=new ie(e.camera,i.value.domElement),o.enableDamping=!0,o.dampingFactor=.05,o.minDistance=600,o.position0.set(e.camera.position.x,e.camera.position.y,e.camera.position.z),o.target.set(e.camera.position.x,0,e.camera.position.z-2e3))});const{onLoop:_}=S();return _(()=>{if(i.value){const h=Math.abs(e.camera.position.y)*50;e.camera.far=h+5e3,e.camera.updateProjectionMatrix(),o&&(o.update(),o.target.y=0),a.update(),i.value.render(c.value,e.camera)}}),(h,C)=>(u(),P("primitive",{object:n(a),rotation:[-Math.PI/2,0,0]},null,8,he))}}),ve=M({__name:"mapBuildingsMoreMeshes",props:{cPosition:{}},setup(t){return(e,i)=>(u(),P(j,null,[m(n(te),{color:"#00c0ff",radius:300,size:300,position:[e.cPosition[0],8,-e.cPosition[1]]},null,8,["position"]),(u(),p(d,null,{default:f(()=>[m(n(T),{position:[e.cPosition[0],8,-e.cPosition[1]],scale:.13,img:"./plugins/digitalCity/image/znsba.png",foremost:!1},null,8,["position"])]),_:1})),m(n(ae),{position:[e.cPosition[0]+700,10,-e.cPosition[1]+300],color:"#ffff00",height:180,maxRadius:400},null,8,["position"]),(u(),p(d,null,{default:f(()=>[m(n(T),{position:[e.cPosition[0]+700,10,-e.cPosition[1]+300],scale:200,img:"./plugins/digitalCity/image/znsb-err.png",sizeAttenuation:!0,foremost:!0},null,8,["position"])]),_:1})),(u(),p(d,null,{default:f(()=>[m(n(le),{fireScale:80,magnitude:1.3,lacunarity:2,gain:1,position:[e.cPosition[0]+280,1,-e.cPosition[1]+120]},null,8,["position"])]),_:1})),(u(),p(d,null,{default:f(()=>[m(n(ue),{position:[e.cPosition[0]+388,6,-e.cPosition[1]+330]},null,8,["position"])]),_:1})),(u(),p(d,null,{default:f(()=>[m(n(ce),{position:[e.cPosition[0]+388,6,-e.cPosition[1]+330]},null,8,["position"])]),_:1})),(u(),p(d,null,{default:f(()=>[m(n(re),{speed:12,size:20,count:26e3,color:"#fff",type:"snow",position:[e.cPosition[0],0,-e.cPosition[1]],areaX:6e3,areaY:3e3,areaZ:6e3},null,8,["position"])]),_:1})),(u(),p(d,null,{default:f(()=>[m(n(se),{cPosition:[e.cPosition[0],600,-e.cPosition[1]]},null,8,["cPosition"])]),_:1}))],64))}}),Ce=v("TresAmbientLight",{color:"#ffffff"},null,-1),ye=v("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1),Me=v("TresGridHelper",{args:[1e4,10]},null,-1),Pe=v("TresAxesHelper",{args:[1e5]},null,-1),He=M({__name:"mapBuildings",setup(t){const e=ne(113.942639739199,22.53171672540276,50),i=H({clearColor:"#000000",disableRender:!0,alpha:!1,shadowMapType:N,outputColorSpace:R,toneMapping:q}),c=[e[0],e[1],1700],r=new F(60,window.innerWidth/window.innerHeight,1,1e7*10);return(s,l)=>(u(),p(n(V),A(i,{"window-size":""}),{default:f(()=>[Ce,ye,m(n(_e),{position:[n(e)[0],1,-n(e)[1]+228],camera:n(r)},null,8,["position","camera"]),(u(),p(d,null,{default:f(()=>[m(n(we),{bbox:[104.955976,20.149765,120.998419,30.528687],mapCenter:c,camera:n(r)},null,8,["camera"])]),_:1})),(u(),p(d,null,{default:f(()=>[m(ve,{cPosition:n(e)},null,8,["cPosition"])]),_:1})),Me,Pe]),_:1},16))}});export{He as default};
