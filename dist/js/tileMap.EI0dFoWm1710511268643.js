var I=Object.defineProperty;var Z=(n,e,t)=>e in n?I(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>(Z(n,typeof e!="symbol"?e+"":e,t),t);import{ar as x,as as g,$ as S,a0 as h,k as L,ak as R,aw as d,a5 as U,w as y,a4 as j,o as f,c as E,a as T,a7 as b,K as w,ab as A,W as P,E as D,an as V,a2 as $,a3 as F,v as B,D as C,a8 as G,b0 as N,ag as O}from"./vendor.St8dZPm41710511268643.js";import{U as Q,b as Y,c as W,M as K,P as q,a as H,T as J,d as X}from"./TerrainMeshProvider.3A_qVJrC1710511268643.js";function ee(n){return new Worker(""+new URL("../static/MartiniWorker-8mf_OiU3.js",import.meta.url).href,{name:n==null?void 0:n.name})}class te{constructor(){l(this,"maxZoom",12);l(this,"coordType",Q);l(this,"utmZone",50);l(this,"_worker");l(this,"_useWorker",!0);l(this,"source","https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp")}set useWorker(e){var t;this._useWorker=e,this._useWorker||((t=this._worker)==null||t.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(e){return this._useWorker?this.getInWorkerThread(e):this.getInMainThread()}async getInMainThread(){return new x}async getInWorkerThread(e){this._worker||(this._worker=new Y(ee));const t={tileNo:e,id:this.getId(e),url:this.getUrl(e),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},r=await this._worker.postMessage(t),o=new x;return o.setAttribute("position",new g(r.positions,3)),o.setAttribute("uv",new g(r.uv,2)),o.setIndex(new g(r.triangles,1)),o}async abort(e){var t;this._useWorker&&((t=this._worker)==null||t.postMessage({id:this.getId(e),abort:!0}))}async dispose(e,t){var r;t.dispose(),this._useWorker&&((r=this._worker)==null||r.postMessage({id:this.getId(e),dispose:!0}))}getId(e){return e.join("-")}getUrl(e){const[t,r,o]=e;return this.source.replace("[x]",t+"").replace("[y]",r+"").replace("[z]",o+"")}}const re=["object"],oe=S({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1}},setup(n){const e=n,t=h({enableDamping:!0,dampingFactor:.05}),r=L(),{camera:o,renderer:i,scene:v}=R(),_=new q;_.coordType=W;const m=new te;m.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",m.coordType=W;const c=new H;c.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",c.showTileNo=!1,c.useWorker=!0;const s=new J(m,c);if(s.showBoundingBox=!1,s.wireframe=!1,s.flatShading=!0,s.useStandardMaterial=!0,s.filter={opposite:e.opposite,monochrome:e.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:e.genBright,genContrast:e.genContrast,genSaturation:e.genSaturation},e.monochrome){let a=new d(e.monochrome);s.filter.monochrome={r:a.r,g:a.g,b:a.b}}const u=new K;u.provider=s,u.bbox=e.bbox,u.maxZoom=e.maxZoom;let k=!1,M=!1;U(()=>{if(o.value&&!k&&(k=!0,u.camera=o.value),r.value&&!M&&(M=!0,r.value.value.target.x=o.value.position.x,r.value.value.target.y=o.value.position.y,r.value.value.target.z=0),e.genBright&&(s.filter.genBright=e.genBright),e.genContrast&&(s.filter.genContrast=e.genContrast),e.genSaturation&&(s.filter.genSaturation=e.genSaturation),e.isMonochrome&&e.monochrome){let a=new d(e.monochrome);s.filter.monochrome={r:a.r,g:a.g,b:a.b}}}),y(()=>e.opposite,a=>{s.filter.opposite=a}),y(()=>e.isMonochrome,a=>{let p=new d(e.monochrome);s.filter.monochrome=a?{r:p.r,g:p.g,b:p.b}:null});const{onLoop:z}=j();return z(()=>{if(i.value){const a=Math.abs(o.value.position.z)*50;o.value.far=a+5e3,o.value.updateProjectionMatrix(),r.value&&(r.value.value.target.z=0),u.update(),i.value.render(v.value,o.value)}}),(a,p)=>(f(),E(D,null,[T(w(A),b(t,{ref_key:"orbitControlRef",ref:r}),null,16),P("primitive",{object:w(u)},null,8,re)],64))}}),ae=["position","look-at"],le=S({__name:"tileMap",setup(n){const e=h({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5"}),t=new V({title:"参数"});t.addBinding(e,"opposite",{label:"反色"}),t.addBinding(e,"genBright",{label:"高亮",min:.1,max:3,step:.1}),t.addBinding(e,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),t.addBinding(e,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),t.addBinding(e,"isMonochrome",{label:"单色滤镜"}),t.addBinding(e,"monochrome",{label:"滤镜颜色"});const r=h({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,disableRender:!0,outputColorSpace:$,toneMapping:F,precision:"highp"}),o=X(118.779958,32.017136),i=[o[0],o[1],5e3];return(v,_)=>(f(),B(w(G),b(r,{"window-size":""}),{default:C(()=>[P("TresPerspectiveCamera",{position:new N(i[0],i[1],i[2]),fov:60,near:1,far:1e8,"look-at":[i[0],i[1],0],up:[0,0,1]},null,8,ae),(f(),B(O,null,{default:C(()=>[T(oe,b({bbox:[104.955976,20.149765,120.998419,30.528687]},e),null,16)]),_:1}))]),_:1},16))}});export{le as default};
