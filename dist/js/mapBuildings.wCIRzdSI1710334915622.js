import{be as D,bc as W,bd as E,b0 as y,$ as M,k as T,bL as G,ak as B,a5 as z,a4 as S,o as g,c as P,W as v,K as h,aO as R,aw as _,b1 as j,a0 as L,a as x,a7 as O,ab as k,E as N,a1 as F,a2 as H,a3 as $,v as C,D as b,a8 as V,ag as Z}from"./vendor.aMIuUFG31710334915622.js";import{C as U}from"./vanilla-307d3a93.esm.VH0MKk0Q1710334915622.js";import{L as q,a as A,b as I}from"./LineSegments2.zNQLTf-F1710334915622.js";import{T as K}from"./TilesRenderer.2_lipRkA1710334915622.js";import{U as J,M as Q,P as X,a as Y,T as ee}from"./TerrainMeshProvider.ecDUMRy31710334915622.js";import"./_commonjsHelpers.5-cIlDoe1710334915622.js";import"./BufferGeometryUtils.2uTRhmto1710334915622.js";const te=n=>{n.onLoadTileSet=i=>{const s=new D,o=new W,e=new E;let r=null,l=0;n.getOrientedBounds(s,e)?(r=new y().setFromMatrixPosition(e),l=r.length()):n.getBoundingSphere(o)&&(r=o.center.clone(),l=r.length()),n.group.matrix.copy(e).invert(),n.group.updateMatrix(),n.group.position.y=-l}},oe="varying vec4 vPosition;\nvoid main(){\n	vPosition=modelMatrix*vec4(position,1.);\n	csm_Position=position*vec3(1.);\n}",ae="uniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor;//顶部颜色\nuniform bool uGradient;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main(){\n	// 转世界坐标\n	uMax_world=modelMatrix*vec4(uMax,1.);\n	uMin_world=modelMatrix*vec4(uMin,1.);\n	vec3 distColor=uColor;\n	float residue=uTime-floor(uTime/uCircleTime)*uCircleTime;\n	float rate=residue/uCircleTime;\n	float lightOffset=rate*(uMax_world.z-uMin_world.z);\n	\n	if(uMin_world.z+lightOffset<vPosition.z&&uMin_world.z+lightOffset+uBorderWidth>vPosition.z){\n		csm_DiffuseColor=vec4(uLightColor,uOpacity);\n	}else{\n		csm_DiffuseColor=vec4(distColor,uOpacity);\n	}\n	\n	//根据高度计算颜色\n	if(uGradient){\n		float rateHight=(vPosition.z-uMin_world.z)/(uMax_world.z-uMin_world.z);\n		// if(rateHight<=.007){\n			// 	rateHight=1.;\n		// }\n		float mixNumber=clamp(rateHight*2.3-1.5,0.,1.);\n		vec3 outColor=mix(csm_DiffuseColor.xyz,uTopColor,mixNumber);\n		csm_DiffuseColor=vec4(outColor,uOpacity);\n	}\n}",re=["object"],ne=M({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0}},setup(n){const i=n,s=T(0),o=a=>{const{geometry:t}=a;t.computeBoundingBox(),t.computeBoundingSphere();const{max:c,min:f}=t.boundingBox,p=new U({baseMaterial:new R,vertexShader:oe,fragmentShader:ae,silent:!0,uniforms:{uMax:{value:c},uMin:{value:f},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new _(i.bulidingsColor)},uOpacity:{value:i.opacity},uLightColor:{value:new _("#ffffff")},uTopColor:{value:new _(i.topColor)},uTime:s,uGradient:{value:i.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:j});a.material.dispose(),a.material=p},e=new K("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");e.errorTarget=2,e.onLoadModel=a=>{a.traverse(t=>{if(t.isMesh){o(t),t.receiveShadow=!1,t.castShadow=!1;const c=new G(t.geometry.clone());let p=new q().fromEdgesGeometry(c),m=new A({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});m.resolution.set(window.innerWidth,window.innerHeight);const w=new I(p,m);w.applyMatrix4(t.matrix.clone()),t.parent.add(w)}})},te(e);const{camera:r,renderer:l,sizes:d}=B();z(()=>{d.width.value&&(e.setCamera(r.value),e.setResolutionFromRenderer(r.value,l.value))});const{onBeforeLoop:u}=S();return u(({delta:a})=>{s.value+=a*2,r.value&&d.width.value&&(r.value.updateMatrixWorld(),e.update())}),(a,t)=>(g(),P("TresGroup",null,[v("primitive",{object:h(e).group},null,8,re)]))}}),ie=["object"],se=M({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20}},setup(n){const i=n,s=L({enableDamping:!0,dampingFactor:.05}),o=T(),{camera:e,renderer:r,scene:l}=B(),d=new X;d.coordType=J;const u=new Y;u.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",u.showTileNo=!1,u.useWorker=!0,u.filter="invert(100%) hue-rotate(321deg) grayscale(80%) brightness(120%)";const a=new ee(d,u);a.showBoundingBox=!1,a.wireframe=!1,a.flatShading=!1;const t=new Q;t.provider=a,t.bbox=i.bbox,t.maxZoom=i.maxZoom;let c=!1,f=!1;z(()=>{e.value&&!c&&(c=!0,t.camera=e.value),o.value&&!f&&(f=!0,o.value.value.target.x=e.value.position.x,o.value.value.target.y=e.value.position.y,o.value.value.target.z=0)});const{onLoop:p}=S();return p(()=>{if(r.value){const m=Math.abs(e.value.position.z)*50;e.value.far=m+5e3,e.value.updateProjectionMatrix(),o.value&&(o.value.value.target.z=0),t.update(),r.value.render(l.value,e.value)}}),(m,w)=>(g(),P(N,null,[x(h(k),O(s,{ref_key:"orbitControlRef",ref:o}),null,16),v("primitive",{object:h(t)},null,8,ie)],64))}}),le=["position"],ue=v("TresAmbientLight",{color:"#ffffff"},null,-1),ce=v("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1),we=M({__name:"mapBuildings",setup(n){const i=L({clearColor:"#000000",disableRender:!0,alpha:!1,shadowMapType:F,outputColorSpace:H,toneMapping:$}),s=[185098.52598346426,2494608945635518e-9,4712.578125399592];return(o,e)=>(g(),C(h(V),O(i,{"window-size":""}),{default:b(()=>[v("TresPerspectiveCamera",{position:new y(s[0],s[1],s[2]),fov:60,near:1,far:1e8,up:[0,0,1]},null,8,le),ue,ce,x(ne,{position:[185507.52598346426,2494899945635518e-9,21]}),(g(),C(Z,null,{default:b(()=>[x(se,{bbox:[104.955976,20.149765,120.998419,30.528687]})]),_:1}))]),_:1},16))}});export{we as default};
