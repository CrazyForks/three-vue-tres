var xt=Object.defineProperty,Pt=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var vt=Object.prototype.hasOwnProperty,Ot=Object.prototype.propertyIsEnumerable;var fe=(i,o,n)=>o in i?xt(i,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[o]=n,Ie=(i,o)=>{for(var n in o||(o={}))vt.call(o,n)&&fe(i,n,o[n]);if(Le)for(var n of Le(o))Ot.call(o,n)&&fe(i,n,o[n]);return i},Ne=(i,o)=>Pt(i,Et(o));var u=(i,o,n)=>(fe(i,typeof o!="symbol"?o+"":o,n),n);import{bq as jt,a$ as Ct,aQ as _t,cA as kt,b0 as j,cB as V,cC as Q,bf as Fe,ck as Be,aE as N,cj as Ge,bn as St,at as Me,cD as Rt,bd as K,ar as le,b_ as Dt,br as At,as as Lt,a2 as It,au as Nt,cE as Ft,b9 as Bt,cF as Wt,$ as Yt,k as Ut,w as zt,o as Xt,c as Zt,t as We,cG as Ht,_ as Kt}from"./vendor.pwBCpSCs1710755963586.js";import{c as qt,d as Gt,a as Vt}from"./ExtensionUtilities.TxB3WdHZ1710755963586.js";const Ye={type:"change"},ge={type:"start"},Ue={type:"end"},he=new jt,ze=new Ct,Qt=Math.cos(70*_t.DEG2RAD);class Oo extends kt{constructor(o,n){super(),this.object=o,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new j,this.cursor=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:V.ROTATE,MIDDLE:V.DOLLY,RIGHT:V.PAN},this.touches={ONE:Q.ROTATE,TWO:Q.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",me),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",me),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Ye),e.update(),r=a.NONE},this.update=function(){const t=new j,s=new Fe().setFromUnitVectors(o.up,new j(0,1,0)),d=s.clone().invert(),f=new j,_=new Fe,H=new j,I=2*Math.PI;return function(wt=null){const Ae=e.object.position;t.copy(Ae).sub(e.target),t.applyQuaternion(s),c.setFromVector3(t),e.autoRotate&&r===a.NONE&&L(X(wt)),e.enableDamping?(c.theta+=h.theta*e.dampingFactor,c.phi+=h.phi*e.dampingFactor):(c.theta+=h.theta,c.phi+=h.phi);let Y=e.minAzimuthAngle,U=e.maxAzimuthAngle;isFinite(Y)&&isFinite(U)&&(Y<-Math.PI?Y+=I:Y>Math.PI&&(Y-=I),U<-Math.PI?U+=I:U>Math.PI&&(U-=I),Y<=U?c.theta=Math.max(Y,Math.min(U,c.theta)):c.theta=c.theta>(Y+U)/2?Math.max(Y,c.theta):Math.min(U,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(m,e.dampingFactor):e.target.add(m),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor),e.zoomToCursor&&A||e.object.isOrthographicCamera?c.radius=P(c.radius):c.radius=P(c.radius*p),t.setFromSpherical(c),t.applyQuaternion(d),Ae.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,m.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),m.set(0,0,0));let se=!1;if(e.zoomToCursor&&A){let te=null;if(e.object.isPerspectiveCamera){const oe=t.length();te=P(oe*p);const ce=oe-te;e.object.position.addScaledVector(R,ce),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const oe=new j(C.x,C.y,0);oe.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix(),se=!0;const ce=new j(C.x,C.y,0);ce.unproject(e.object),e.object.position.sub(ce).add(oe),e.object.updateMatrixWorld(),te=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;te!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(te).add(e.object.position):(he.origin.copy(e.object.position),he.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(he.direction))<Qt?o.lookAt(e.target):(ze.setFromNormalAndCoplanarPoint(e.object.up,e.target),he.intersectPlane(ze,e.target))))}else e.object.isOrthographicCamera&&(se=p!==1,se&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix()));return p=1,A=!1,se||f.distanceToSquared(e.object.position)>l||8*(1-_.dot(e.object.quaternion))>l||H.distanceToSquared(e.target)>0?(e.dispatchEvent(Ye),f.copy(e.object.position),_.copy(e.object.quaternion),H.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Re),e.domElement.removeEventListener("pointerdown",Ce),e.domElement.removeEventListener("pointercancel",ee),e.domElement.removeEventListener("wheel",_e),e.domElement.removeEventListener("pointermove",pe),e.domElement.removeEventListener("pointerup",ee),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",me),e._domElementKeyEvents=null)};const e=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=a.NONE;const l=1e-6,c=new Be,h=new Be;let p=1;const m=new j,y=new N,g=new N,v=new N,E=new N,T=new N,x=new N,b=new N,k=new N,S=new N,R=new j,C=new N;let A=!1;const M=[],D={};let z=!1;function X(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function B(t){const s=Math.abs(t*.01);return Math.pow(.95,e.zoomSpeed*s)}function L(t){h.theta-=t}function w(t){h.phi-=t}const Z=function(){const t=new j;return function(d,f){t.setFromMatrixColumn(f,0),t.multiplyScalar(-d),m.add(t)}}(),O=function(){const t=new j;return function(d,f){e.screenSpacePanning===!0?t.setFromMatrixColumn(f,1):(t.setFromMatrixColumn(f,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(d),m.add(t)}}(),W=function(){const t=new j;return function(d,f){const _=e.domElement;if(e.object.isPerspectiveCamera){const H=e.object.position;t.copy(H).sub(e.target);let I=t.length();I*=Math.tan(e.object.fov/2*Math.PI/180),Z(2*d*I/_.clientHeight,e.object.matrix),O(2*f*I/_.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Z(d*(e.object.right-e.object.left)/e.object.zoom/_.clientWidth,e.object.matrix),O(f*(e.object.top-e.object.bottom)/e.object.zoom/_.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function J(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?p/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ie(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?p*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function re(t,s){if(!e.zoomToCursor)return;A=!0;const d=e.domElement.getBoundingClientRect(),f=t-d.left,_=s-d.top,H=d.width,I=d.height;C.x=f/H*2-1,C.y=-(_/I)*2+1,R.set(C.x,C.y,1).unproject(e.object).sub(e.object.position).normalize()}function P(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function q(t){y.set(t.clientX,t.clientY)}function at(t){re(t.clientX,t.clientX),b.set(t.clientX,t.clientY)}function we(t){E.set(t.clientX,t.clientY)}function it(t){g.set(t.clientX,t.clientY),v.subVectors(g,y).multiplyScalar(e.rotateSpeed);const s=e.domElement;L(2*Math.PI*v.x/s.clientHeight),w(2*Math.PI*v.y/s.clientHeight),y.copy(g),e.update()}function rt(t){k.set(t.clientX,t.clientY),S.subVectors(k,b),S.y>0?J(B(S.y)):S.y<0&&ie(B(S.y)),b.copy(k),e.update()}function st(t){T.set(t.clientX,t.clientY),x.subVectors(T,E).multiplyScalar(e.panSpeed),W(x.x,x.y),E.copy(T),e.update()}function ct(t){re(t.clientX,t.clientY),t.deltaY<0?ie(B(t.deltaY)):t.deltaY>0&&J(B(t.deltaY)),e.update()}function lt(t){let s=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?w(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(0,e.keyPanSpeed),s=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?w(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(0,-e.keyPanSpeed),s=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?L(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(e.keyPanSpeed,0),s=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?L(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(-e.keyPanSpeed,0),s=!0;break}s&&(t.preventDefault(),e.update())}function xe(t){if(M.length===1)y.set(t.pageX,t.pageY);else{const s=G(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);y.set(d,f)}}function Pe(t){if(M.length===1)E.set(t.pageX,t.pageY);else{const s=G(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);E.set(d,f)}}function Ee(t){const s=G(t),d=t.pageX-s.x,f=t.pageY-s.y,_=Math.sqrt(d*d+f*f);b.set(0,_)}function ht(t){e.enableZoom&&Ee(t),e.enablePan&&Pe(t)}function ut(t){e.enableZoom&&Ee(t),e.enableRotate&&xe(t)}function ve(t){if(M.length==1)g.set(t.pageX,t.pageY);else{const d=G(t),f=.5*(t.pageX+d.x),_=.5*(t.pageY+d.y);g.set(f,_)}v.subVectors(g,y).multiplyScalar(e.rotateSpeed);const s=e.domElement;L(2*Math.PI*v.x/s.clientHeight),w(2*Math.PI*v.y/s.clientHeight),y.copy(g)}function Oe(t){if(M.length===1)T.set(t.pageX,t.pageY);else{const s=G(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);T.set(d,f)}x.subVectors(T,E).multiplyScalar(e.panSpeed),W(x.x,x.y),E.copy(T)}function je(t){const s=G(t),d=t.pageX-s.x,f=t.pageY-s.y,_=Math.sqrt(d*d+f*f);k.set(0,_),S.set(0,Math.pow(k.y/b.y,e.zoomSpeed)),J(S.y),b.copy(k);const H=(t.pageX+s.x)*.5,I=(t.pageY+s.y)*.5;re(H,I)}function dt(t){e.enableZoom&&je(t),e.enablePan&&Oe(t)}function pt(t){e.enableZoom&&je(t),e.enableRotate&&ve(t)}function Ce(t){e.enabled!==!1&&(M.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",pe),e.domElement.addEventListener("pointerup",ee)),Mt(t),t.pointerType==="touch"?Se(t):mt(t))}function pe(t){e.enabled!==!1&&(t.pointerType==="touch"?bt(t):ft(t))}function ee(t){switch(Tt(t),M.length){case 0:e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",pe),e.domElement.removeEventListener("pointerup",ee),e.dispatchEvent(Ue),r=a.NONE;break;case 1:const s=M[0],d=D[s];Se({pointerId:s,pageX:d.x,pageY:d.y});break}}function mt(t){let s;switch(t.button){case 0:s=e.mouseButtons.LEFT;break;case 1:s=e.mouseButtons.MIDDLE;break;case 2:s=e.mouseButtons.RIGHT;break;default:s=-1}switch(s){case V.DOLLY:if(e.enableZoom===!1)return;at(t),r=a.DOLLY;break;case V.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;we(t),r=a.PAN}else{if(e.enableRotate===!1)return;q(t),r=a.ROTATE}break;case V.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;q(t),r=a.ROTATE}else{if(e.enablePan===!1)return;we(t),r=a.PAN}break;default:r=a.NONE}r!==a.NONE&&e.dispatchEvent(ge)}function ft(t){switch(r){case a.ROTATE:if(e.enableRotate===!1)return;it(t);break;case a.DOLLY:if(e.enableZoom===!1)return;rt(t);break;case a.PAN:if(e.enablePan===!1)return;st(t);break}}function _e(t){e.enabled===!1||e.enableZoom===!1||r!==a.NONE||(t.preventDefault(),e.dispatchEvent(ge),ct(gt(t)),e.dispatchEvent(Ue))}function gt(t){const s=t.deltaMode,d={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(s){case 1:d.deltaY*=16;break;case 2:d.deltaY*=100;break}return t.ctrlKey&&!z&&(d.deltaY*=10),d}function yt(t){t.key==="Control"&&(z=!0,e.domElement.getRootNode().addEventListener("keyup",ke,{passive:!0,capture:!0}))}function ke(t){t.key==="Control"&&(z=!1,e.domElement.getRootNode().removeEventListener("keyup",ke,{passive:!0,capture:!0}))}function me(t){e.enabled===!1||e.enablePan===!1||lt(t)}function Se(t){switch(De(t),M.length){case 1:switch(e.touches.ONE){case Q.ROTATE:if(e.enableRotate===!1)return;xe(t),r=a.TOUCH_ROTATE;break;case Q.PAN:if(e.enablePan===!1)return;Pe(t),r=a.TOUCH_PAN;break;default:r=a.NONE}break;case 2:switch(e.touches.TWO){case Q.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;ht(t),r=a.TOUCH_DOLLY_PAN;break;case Q.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;ut(t),r=a.TOUCH_DOLLY_ROTATE;break;default:r=a.NONE}break;default:r=a.NONE}r!==a.NONE&&e.dispatchEvent(ge)}function bt(t){switch(De(t),r){case a.TOUCH_ROTATE:if(e.enableRotate===!1)return;ve(t),e.update();break;case a.TOUCH_PAN:if(e.enablePan===!1)return;Oe(t),e.update();break;case a.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;dt(t),e.update();break;case a.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;pt(t),e.update();break;default:r=a.NONE}}function Re(t){e.enabled!==!1&&t.preventDefault()}function Mt(t){M.push(t.pointerId)}function Tt(t){delete D[t.pointerId];for(let s=0;s<M.length;s++)if(M[s]==t.pointerId){M.splice(s,1);return}}function De(t){let s=D[t.pointerId];s===void 0&&(s=new N,D[t.pointerId]=s),s.set(t.pageX,t.pageY)}function G(t){const s=t.pointerId===M[0]?M[1]:M[0];return D[s]}e.domElement.addEventListener("contextmenu",Re),e.domElement.addEventListener("pointerdown",Ce),e.domElement.addEventListener("pointercancel",ee),e.domElement.addEventListener("wheel",_e,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",yt,{passive:!0,capture:!0}),this.update()}}var $t=Math.PI/180,Jt=180/Math.PI;function Ve(i){var o=Xe(i[0]+1,i[2]),n=Xe(i[0],i[2]),e=Ze(i[1]+1,i[2]),a=Ze(i[1],i[2]);return[n,e,o,a]}function eo(i){var o=Ve(i),n={type:"Polygon",coordinates:[[[o[0],o[3]],[o[0],o[1]],[o[2],o[1]],[o[2],o[3]],[o[0],o[3]]]]};return n}function Xe(i,o){return i/Math.pow(2,o)*360-180}function Ze(i,o){var n=Math.PI-2*Math.PI*i/Math.pow(2,o);return Jt*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function ye(i,o,n){var e=ot(i,o,n);return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e}function Qe(i){return[[i[0]*2,i[1]*2,i[2]+1],[i[0]*2+1,i[1]*2,i[2]+1],[i[0]*2+1,i[1]*2+1,i[2]+1],[i[0]*2,i[1]*2+1,i[2]+1]]}function $e(i){return[i[0]>>1,i[1]>>1,i[2]-1]}function Je(i){return Qe($e(i))}function to(i,o){for(var n=Je(i),e=0;e<n.length;e++)if(!et(o,n[e]))return!1;return!0}function et(i,o){for(var n=0;n<i.length;n++)if(tt(i[n],o))return!0;return!1}function tt(i,o){return i[0]===o[0]&&i[1]===o[1]&&i[2]===o[2]}function oo(i){for(var o="",n=i[2];n>0;n--){var e=0,a=1<<n-1;i[0]&a&&e++,i[1]&a&&(e+=2),o+=e.toString()}return o}function no(i){for(var o=0,n=0,e=i.length,a=e;a>0;a--){var r=1<<a-1,l=+i[e-a];l===1&&(o|=r),l===2&&(n|=r),l===3&&(o|=r,n|=r)}return[o,n,e]}function ao(i){var o=ye(i[0],i[1],32),n=ye(i[2],i[3],32),e=[o[0],o[1],n[0],n[1]],a=io(e);if(a===0)return[0,0,0];var r=e[0]>>>32-a,l=e[1]>>>32-a;return[r,l,a]}function io(i){for(var o=28,n=0;n<o;n++){var e=1<<32-(n+1);if((i[0]&e)!==(i[2]&e)||(i[1]&e)!==(i[3]&e))return n}return o}function ot(i,o,n){var e=Math.sin(o*$t),a=Math.pow(2,n),r=a*(i/360+.5),l=a*(.5-.25*Math.log((1+e)/(1-e))/Math.PI);return r=r%a,r<0&&(r=r+a),[r,l,n]}var ue={tileToGeoJSON:eo,tileToBBOX:Ve,getChildren:Qe,getParent:$e,getSiblings:Je,hasTile:et,hasSiblings:to,tilesEqual:tt,tileToQuadkey:oo,quadkeyToTile:no,pointToTile:ye,bboxToTile:ao,pointToTileFraction:ot};class Te extends Ge{constructor(){super();u(this,"map");u(this,"tileNo");u(this,"isDisposed",!1);u(this,"isReady",!1);u(this,"parentTile");u(this,"childrenTiles",[]);u(this,"boundingBoxWorld",new St);u(this,"content")}init(n,e,a){this.tileNo=n,Object.freeze(this.tileNo),this.map=e,this.parentTile=a,this.visible=!1,this.renderOrder=n[2],this.ready()}async ready(){if(this.content=await this.map.provider.getTile(this.tileNo),!this.isDisposed){if(this.add(this.content),this.boundingBoxWorld.setFromObject(this.content).applyMatrix4(this.matrixWorld.makeRotationX(-Math.PI/2)),this.map.add(this),this.visible=!0,this.isReady=!0,this.parentTile){const n=this.parentTile.childrenTiles;let e=0;for(let a=0;a<n.length;a++)n[a].isReady&&e++;e===4&&(this.parentTile.visible=!1)}this.update()}}update(){if(!this.isReady||this.isDisposed)return;const{cameraFrustum:n,cameraWorldPosition:e}=this.map;if(!n.intersectsBox(this.boundingBoxWorld)){this.simplify();return}this.content instanceof Me&&this.map.provider.filter&&(this.content.material.uniforms.t_Matrix.value=this.map.provider.getTranMatrix());let a=this.boundingBoxWorld.distanceToPoint(e);const r=this.tileNo[2];a/=Math.pow(2,this.map.provider.maxZoom-r),a<60&&this.subdivide(),a>80&&this.simplify(),this.childrenTiles.sort((c,h)=>c.boundingBoxWorld.distanceToPoint(e)-h.boundingBoxWorld.distanceToPoint(e)).forEach(c=>c.update())}subdivide(){const{isReady:n,tileNo:e,map:a,childrenTiles:r}=this,l=e[2];if(!n||r.length>0||l>=a.maxZoom)return;ue.getChildren(e).forEach(h=>{const p=new Te;p.init(h,a,this),r.push(p)})}simplify(){this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.visible=!0}dispose(){this.map.remove(this),this.map.provider.abort(this.tileNo),this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.parentTile=void 0,this.content&&(this.map.provider.dispose(this.tileNo,this.content),this.content=void 0),this.isDisposed=!0}}let jo=class extends Ge{constructor(){super();u(this,"provider");u(this,"bbox",[74.390592,6.900905,134.071423,54.318199]);u(this,"maxZoom",20);u(this,"rootForward",0);u(this,"camera");u(this,"cameraFrustum",new Rt);u(this,"cameraWorldPosition",new j);u(this,"cameraProjectionMatrix",new K);u(this,"lastCameraProjectionMatrix",new K);u(this,"lastCameraWorldPosition",new j);u(this,"rootTiles",[]);u(this,"lastUpdateTime",0);le.prototype.computeBoundsTree||(le.prototype.computeBoundsTree=qt),le.prototype.disposeBoundsTree||(le.prototype.disposeBoundsTree=Gt),Me.prototype.raycast=Vt}initRootTiles(){this.rootForward>3&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=3),this.rootForward<0&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=0);const n=[];let e=[ue.bboxToTile(this.bbox)],a=this.rootForward;for(;a>0;){const r=[...e];e=[],r.forEach(l=>{const c=ue.getChildren(l);e.push(...c)}),a--}n.push(...e),n.forEach(r=>{const l=new Te;l.init(r,this),this.rootTiles.push(l)})}update(){if(!this.visible||!this.camera)return;const n=Date.now();if(!(n-this.lastUpdateTime<300)){if(this.rootTiles.length===0){this.initRootTiles();return}this.camera.getWorldPosition(this.cameraWorldPosition),this.cameraProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),!(this.cameraWorldPosition.equals(this.lastCameraWorldPosition)&&this.cameraProjectionMatrix.equals(this.lastCameraProjectionMatrix))&&(this.cameraFrustum.setFromProjectionMatrix(this.cameraProjectionMatrix),this.rootTiles.forEach(e=>e.update()),this.lastCameraProjectionMatrix.copy(this.cameraProjectionMatrix),this.lastCameraWorldPosition.copy(this.cameraWorldPosition),this.lastUpdateTime=n)}}dispose(){throw new Error("[Map.dispose] Method not implemented.")}regenerate(){throw new Error("[Map.regenerate] Method not implemented.")}};const $=class ${constructor(){u(this,"_controller",new AbortController);u(this,"listeners",new Set)}fetch(o,n={}){$.pendings.has(o)||($.pendings.set(o,this),fetch(o,Ne(Ie({},n),{signal:this._controller.signal})).then(e=>{this.listeners.forEach(a=>a.resolve(e.clone()))}).catch(e=>{this.listeners.forEach(a=>a.reject(e))}).finally(()=>{$.pendings.delete(o)}))}abort(){this._controller.abort()}};u($,"pendings",new Map);let ae=$;class ro{constructor(o,n){u(this,"resolve");u(this,"reject");u(this,"promise");this.url=o,this.init=n,this.promise=new Promise((e,a)=>{this.resolve=e,this.reject=a})}ready(){let o=ae.pendings.get(this.url);return o||(o=new ae,o.fetch(this.url,this.init)),o.listeners.add(this),this.promise}abort(){this.reject("User abort.");const o=ae.pendings.get(this.url);o&&(o.listeners.delete(this),o.listeners.size===0&&o.abort())}}let ne;async function so(i,o,n=!1){const a=await(await o.ready()).blob(),r=await createImageBitmap(a,n?void 0:{imageOrientation:"flipY"});if(!n)return r;ne||(ne=new OffscreenCanvas(256,256));const l=ne.getContext("2d");if(!l)throw new Error('Offscreencanvas.getContext("2d") error!');const{width:c,height:h}=ne;return l.drawImage(r,0,0),l.rect(0,0,c,h),l.strokeStyle="#00FFFF",l.font="20px Arial",l.stroke(),l.fillStyle="#FF4444",l.fillText("".concat(i[0]),10,30),l.fillStyle="#44FF44",l.fillText("".concat(i[1]),10,55),l.fillStyle="#66AAFF",l.fillText("".concat(i[2]),10,80),await createImageBitmap(ne,{imageOrientation:"flipY"})}class co{constructor(o){u(this,"worker");u(this,"terminated",!0);u(this,"map",new Map);this.worker=new o,this.worker.onmessage=this.onMessage.bind(this),this.terminated=!1}async postMessage(o){if(!this.terminated)return this.worker.postMessage(o),new Promise((n,e)=>{this.map.set(o.id,n)})}onMessage(o){const{id:n,error:e}=o.data,a=this.map.get(n);a&&!e&&a(o.data),this.map.delete(n)}terminate(){this.worker.onmessage=null,this.worker.terminate(),this.terminated=!0,this.map.clear()}}function lo(i){return new Worker(""+new URL("../static/MapWorker-P8uJfnMJ.js",import.meta.url).href,{name:i==null?void 0:i.name})}class _o{constructor(){u(this,"maxZoom",20);u(this,"source","https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s&x=[x]&y=[y]&z=[z]");u(this,"showTileNo",!1);u(this,"_useWorker",!1);u(this,"_worker");u(this,"fetching",new Map)}set useWorker(o){var n;this._useWorker=o,this._useWorker||((n=this._worker)==null||n.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(o){const n=this.getUrl(o),e=new Dt;if(this._useWorker){this._worker||(this._worker=new co(lo));const a=this.getId(o),r=await this._worker.postMessage({id:a,tileNo:o,url:n,debug:this.showTileNo});e.image=r.bitmap}else{const a=new ro(n,{cache:"force-cache",mode:"cors"});this.fetching.set(o,a);try{e.image=await so(o,a,this.showTileNo)}finally{this.fetching.delete(o)}}return e.needsUpdate=!0,e.anisotropy=4,e}abort(o){var n;if(this._useWorker)(n=this._worker)==null||n.postMessage({id:this.getId(o),abort:!0});else{const e=this.fetching.get(o);e&&e.abort(),this.fetching.delete(o)}}dispose(o,n){n.dispose()}getId(o){return o.join("-")}getUrl(o){const[n,e,a]=o;return this.source.indexOf("[x]")===-1?this.source.replace("{x}",n+"").replace("{y}",e+"").replace("{z}",a+""):this.source.replace("[x]",n+"").replace("[y]",e+"").replace("[z]",a+"")}}const be="utm",ho="merc",de=6378137,He=Math.PI/180;function Ke(i,o){const n=de*i*He,e=de*Math.log(Math.tan(Math.PI*.25+o*He*.5));return[n,e]}function uo(i,o){let n=i/(de*Math.PI)*180,e=o/(de*Math.PI)*180;return e=180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2),[n,e]}function F(i){return i*Math.PI/180}function qe(i){return i*180/Math.PI}const nt={a:6378137,b:6356752314245e-6,f:1/298.257223563},po="CDEFGHJKLMNPQRSTUVWXX",mo=5e5,fo=1e7;function go(i,o,n){if(!(-80<=o&&o<=84))throw new RangeError("latitude ‘".concat(o,"’ outside UTM limits"));let e=n||Math.floor((i+180)/6)+1,a=F((e-1)*6-180+3);const r=po.charAt(Math.floor(o/8+10));e===31&&r==="V"&&i>=3?(e++,a+=F(6)):e===32&&r==="X"&&i<9?(e--,a-=F(6)):e===32&&r==="X"&&i>=9?(e++,a+=F(6)):e===34&&r==="X"&&i<21?(e--,a-=F(6)):e===34&&r==="X"&&i>=21?(e++,a+=F(6)):e===36&&r==="X"&&i<33?(e--,a-=F(6)):e===36&&r==="X"&&i>=33&&(e++,a+=F(6));const l=F(o),c=F(i)-a,{a:h,f:p}=nt,m=.9996,y=Math.sqrt(p*(2-p)),g=p/(2-p),v=g*g,E=g*v,T=g*E,x=g*T,b=g*x,k=Math.cos(c),S=Math.sin(c),R=Math.tan(l),C=Math.sinh(y*Math.atanh(y*R/Math.sqrt(1+R*R))),A=R*Math.sqrt(1+C*C)-C*Math.sqrt(1+R*R),M=Math.atan2(A,k),D=Math.asinh(S/Math.sqrt(A*A+k*k)),z=h/(1+g)*(1+1/4*v+1/64*T+1/256*b),X=[null,1/2*g-2/3*v+5/16*E+41/180*T-127/288*x+7891/37800*b,13/48*v-3/5*E+557/1440*T+281/630*x-1983433/1935360*b,61/240*E-103/140*T+15061/26880*x+167603/181440*b,49561/161280*T-179/168*x+6601661/7257600*b,34729/80640*x-3418889/1995840*b,212378941/319334400*b];let B=M;for(let O=1;O<=6;O++)B+=X[O]*Math.sin(2*O*M)*Math.cosh(2*O*D);let L=D;for(let O=1;O<=6;O++)L+=X[O]*Math.cos(2*O*M)*Math.sinh(2*O*D);let w=m*z*L,Z=m*z*B;return w=w+mo,Z<0&&(Z=Z+fo),[w,Z]}function yo(i,o,n){const a=n||50,r=5e5,{a:l,f:c}=nt,h=.9996,p=i-r,m=o,y=Math.sqrt(c*(2-c)),g=c/(2-c),v=g*g,E=g*v,T=g*E,x=g*T,b=g*x,k=l/(1+g)*(1+1/4*v+1/64*T+1/256*b),S=p/(h*k),R=m/(h*k),C=[null,1/2*g-2/3*v+37/96*E-1/360*T-81/512*x+96199/604800*b,1/48*v+1/15*E-437/1440*T+46/105*x-1118711/3870720*b,17/480*E-37/840*T-209/4480*x+5569/90720*b,4397/161280*T-11/504*x-830251/7257600*b,4583/161280*x-108847/3991680*b,20648693/638668800*b];let A=R;for(let P=1;P<=6;P++)A-=C[P]*Math.sin(2*P*R)*Math.cosh(2*P*S);let M=S;for(let P=1;P<=6;P++)M-=C[P]*Math.cos(2*P*R)*Math.sinh(2*P*S);const D=Math.sinh(M),z=Math.sin(A),X=Math.cos(A),B=z/Math.sqrt(D*D+X*X);let L=null,w=B;do{const P=Math.sinh(y*Math.atanh(y*w/Math.sqrt(1+w*w))),q=w*Math.sqrt(1+P*P)-P*Math.sqrt(1+w*w);L=(B-q)/Math.sqrt(1+q*q)*(1+(1-y*y)*w*w)/((1-y*y)*Math.sqrt(1+w*w)),w+=L}while(Math.abs(L)>1e-12);const O=Math.atan(w);let W=Math.atan2(D,X);const J=F((a-1)*6-180+3);W+=J;const ie=Number(qe(O).toFixed(14));return[Number(qe(W).toFixed(14)),ie]}class ko{constructor(){u(this,"utmZone",50);u(this,"coordType",be);u(this,"maxZoom",20)}async getTile(o){const n=new At,e=ue.tileToBBOX(o),a=this.convertCoordinate(e[0],e[3]),r=this.convertCoordinate(e[2],e[3]),l=this.convertCoordinate(e[0],e[1]),c=this.convertCoordinate(e[2],e[1]),h=new Float32Array([a[0],a[1],0,r[0],r[1],0,l[0],l[1],0,c[0],c[1],0]);return n.setAttribute("position",new Lt(h,3)),n}abort(o){}dispose(o,n){n.dispose()}convertCoordinate(o,n){switch(this.coordType){case be:return go(o,n,this.utmZone);case ho:return Ke(o,n);default:return Ke(o,n)}}}class bo extends Me{constructor(n){super(n);u(this,"center",new j)}}class So{constructor(o,n){u(this,"maxZoom",20);u(this,"showBoundingBox",!1);u(this,"wireframe",!1);u(this,"flatShading",!1);u(this,"useStandardMaterial",!1);u(this,"filter",null);this.geometryProvider=o,this.textureProvider=n}getTranMatrix(){var n,e,a,r,l;let o=new K;if((n=this.filter)!=null&&n.opposite){let c=new K;c.set(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),o.multiply(c)}if((e=this.filter)!=null&&e.monochrome){let c=new K;const h=this.filter.monochrome.r,p=this.filter.monochrome.g,m=this.filter.monochrome.b;c.set(h,p,m,0,h,p,m,0,h,p,m,0,0,0,0,1),o.multiply(c)}if((a=this.filter)!=null&&a.genBright){let c=new K;const h=this.filter.genBright;c.set(h,0,0,0,0,h,0,0,0,0,h,0,0,0,0,1),o.multiply(c)}if((r=this.filter)!=null&&r.genContrast){let c=new K;const h=this.filter.genContrast,p=.5*(1-h);c.set(h,0,0,0,0,h,0,0,0,0,h,0,p,p,p,1),o.multiply(c)}if((l=this.filter)!=null&&l.genSaturate){let c=new K;const h=this.filter.genSaturate,p=.3*(1-h),m=.6*(1-h),y=.1*(1-h);c.set(p+h,p,p,0,m,m+h,m,0,y,y,y+h,0,0,0,0,1),o.multiply(c)}return o}async getTile(o){const n=[this.geometryProvider.getTile(o),this.textureProvider.getTile(o)],e=await Promise.all(n),a=e[0],r=e[1];r.colorSpace=It;const{wireframe:l,flatShading:c}=this;let h=null;const p=o[0]+o[1]+o[2];this.filter?h=new Nt({wireframe:l,depthTest:!0,depthWrite:!1,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:1,uniforms:{e_Texture:{value:r},t_Matrix:{value:this.getTranMatrix()}},vertexShader:"\n                varying vec2 v_Uv;    //顶点纹理坐标\n                void main () {\n                    v_Uv = uv;\n                    // gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 ); 着色器会抖动\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n                ",fragmentShader:"\n                uniform sampler2D e_Texture;     //纹理图像\n                varying vec2 v_Uv;               //片元纹理坐标\n                uniform mat4 t_Matrix;     //接收变换矩阵\n                void main () {\n                    // gl_FragColor = texture2D( e_Texture, v_Uv );\n\n                    // vec4 textureColor = texture2D( e_Texture, v_Uv );\n                    // //计算加权平均值\n                    // float w_a = textureColor.r * 0.3 + textureColor.g * 0.6 + textureColor.b * 0.1;\n                    // gl_FragColor = vec4(w_a, w_a, w_a, 1.0);\n\n                    vec4 textureColor = texture2D( e_Texture, v_Uv );\n                    //变换矩阵乘以 vec4(R,G,B,1)    --->vec4(R,G,B,1) 是齐次坐标，原本是n维的向量用一个n+1维向量来表示\n                    //vec4(R,G,B,1)第四个分量不是透明度\n                    vec4 transColor =  vec4(textureColor.r, textureColor.g, textureColor.b, 1.0)*t_Matrix; \n                    //设置透明度\n                    transColor.a = 1.0;\n                    gl_FragColor = transColor;\n                }"}):h=this.useStandardMaterial?new Ft({map:r,wireframe:l,flatShading:c}):new Bt({map:r,wireframe:l});const m=new bo;if(m.renderOrder=p,a.computeBoundingBox(),a.boundingBox.getCenter(m.center),a.center(),a.computeBoundingSphere(),a.computeBoundsTree(),m.position.copy(m.center),m.geometry=a,m.material=h,this.showBoundingBox){const y=new Wt(a.boundingBox);m.add(y)}return m}abort(o){this.geometryProvider.abort(o),this.textureProvider.abort(o)}dispose(o,n){const e=n.geometry,a=n.material;e&&this.geometryProvider.dispose(o,e),a&&a.map&&this.textureProvider.dispose(o,a.map),a==null||a.dispose()}}const Mo={class:"lonLatDiv"},To=Yt({__name:"raycasterEvent",props:{tileMapRef:{}},setup(i){const o=i,n=Ut([0,0]);return zt(()=>o.tileMapRef,(e,a)=>{if(!a&&e){let c=function(h){l.x=h.clientX/window.innerWidth*2-1,l.y=-(h.clientY/window.innerHeight)*2+1,r.setFromCamera(l,e.camera);var p=r.intersectObjects(e.map.children);if(p.length>0){var m=p[0];e.map.provider.geometryProvider.coordType===be?n.value=yo(m.point.x,-m.point.z):n.value=uo(m.point.x,-m.point.z),n.value[0]=n.value[0].toFixed(4),n.value[1]=n.value[1].toFixed(4)}};console.log("raycasterEvent:",e);var r=new Ht,l=new N;document.addEventListener("mousemove",c,!1)}}),(e,a)=>(Xt(),Zt("div",Mo," lon:"+We(n.value[0])+" lat:"+We(n.value[1]),1))}}),Ro=Kt(To,[["__scopeId","data-v-462a60f8"]]);export{jo as M,Oo as O,ko as P,So as T,be as U,_o as a,co as b,ho as c,Ke as d,go as l,Ro as r};
