import{P as x}from"./trescientos-a922f233.js";import{C as g,_ as w,l as B,b as C}from"./pagesShow.vue_vue_type_style_index_0_lang-abc71cba.js";import{b as _,T as A,D as M}from"./three.module-cbea6429.js";import{h as D}from"./heatmap-d02141de.js";import{Y as b,ae as S,o as y,c as U,j as P,ak as L,a9 as d,s as T,B as X,a as h,aa as f,I as v}from"./vendor-19b019cc.js";import"./_commonjsHelpers-725317a4.js";const m=(a,t)=>Math.round((Math.random()*(a-t+1)+t)*10)/10,Y=(a,t)=>{if(!t){let e=0;for(t=[];e<2e3;)t.push({x:m(1,a._config.width),y:m(1,a._config.height),value:m(1,6)}),e++}a.setData({max:12,data:t})},k=(a=250,t=250,o=!0)=>{const e=document.createElement("heatmap-canvas");return e.style.position="absolute",o||(e.style.display="none"),e.style.top="0",e.style.left="0",document.body.appendChild(e),D.create({container:e,width:a,height:t,blur:".8",radius:10})},F=a=>{a.computeBoundingBox();const{max:t,min:o}=a.boundingBox;a.deleteAttribute("uv");const e=t.x-o.x,n=t.y-o.y,i=[];for(let r=0;r<a.attributes.position.count;r++)i.push((a.attributes.position.getX(r)-o.x)/e),i.push((a.attributes.position.getY(r)-o.y)/n);const s=new Float32Array(i);a.setAttribute("uv",new _(s,2))},E=(a,t)=>{t.computeBoundingBox(),t.deleteAttribute("uv"),a.computeBoundingBox();const{max:o,min:e}=a.boundingBox,n=o.x-e.x,i=o.y-e.y,s=[];for(let c=0;c<t.attributes.position.count;c++)s.push((t.attributes.position.getX(c)-e.x)/n),s.push((t.attributes.position.getY(c)-e.y)/i);const r=new Float32Array(s);t.setAttribute("uv",new _(r,2))},N=["object"],O=b({__name:"buildingsHeatmap",props:{model:{},opacity:{default:1}},setup(a){const t=a,o=k();Y(o);const e=new A(o._renderer.canvas);e.needsUpdate=!0;const n=(u,l)=>new g({baseMaterial:u,vertexShader:"\n		varying vec2 vUv;\n		void main() {\n			csm_Position = position * vec3(1.0);\n			vUv = uv;\n		}\n		",fragmentShader:"\n		uniform sampler2D heightMap;\n		uniform float uOpacity;\n		varying vec2 vUv;\n		void main() {\n			csm_DiffuseColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n    }\n		",silent:!0,uniforms:{uOpacity:{value:t.opacity},heightMap:{type:"t",value:l}},depthWrite:!0,depthTest:!0,transparent:!0,side:M}),i=t.model.city,s=t.model.land,r=()=>{const{geometry:u}=s;F(u);const l=n(s.material,e);s.material.dispose(),s.material=l},c=()=>{const u=s.geometry,{geometry:l}=i;E(u,l);const p=n(i.material,e);i.material.dispose(),i.material=p};return r(),c(),S(()=>{t.opacity&&(s.material.uniforms.uOpacity.value=t.opacity)}),(u,l)=>(y(),U("primitive",{object:t.model.model.clone()},null,8,N))}}),W=b({__name:"heatmap2",async setup(a){let t,o;const e=P(!1),n=([t,o]=L(()=>B()),t=await t,o(),t);e.value=!0;const i=d({width:1,color:"#000",opacity:1,show:!0}),s=d({opacity:.9});return new x({title:"参数",expanded:!0}).addBinding(s,"opacity",{label:"透明度",min:0,max:1,step:.1}),(c,u)=>(y(),T(w,{showBuildings:!1},{ability:X(()=>[h(O,f({model:v(n)},s),null,16,["model"]),h(C,f(i,{builds:v(n).city}),null,16,["builds"])]),_:1}))}});export{W as default};
