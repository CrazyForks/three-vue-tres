import{n as E,P as U,l as V,r as L}from"./trescientos-01522e33.js";import{H as T,S as z,P as H,D as A}from"./three.module-eabffd14.js";import{c as k,g as j}from"./_commonjsHelpers-725317a4.js";import{Y as W,o as q,s as J,B as K,a8 as Q,I,a as Z,U as S,a9 as $,aa as N}from"./vendor-4c6c5ef6.js";var G={exports:{}};(function(P){(function(f,C,y){P.exports?P.exports=y():C[f]=y()})("h337",k,function(){var f={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},C=function(){var v=function(e){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=e.xField||e.defaultXField,this._yField=e.yField||e.defaultYField,this._valueField=e.valueField||e.defaultValueField,e.radius&&(this._cfgRadius=e.radius)},h=f.defaultRadius;return v.prototype={_organiseData:function(n,e){var t=n[this._xField],a=n[this._yField],i=this._radi,r=this._data,o=this._max,s=this._min,l=n[this._valueField]||1,g=n.radius||this._cfgRadius||h;r[t]||(r[t]=[],i[t]=[]),r[t][a]?r[t][a]+=l:(r[t][a]=l,i[t][a]=g);var d=r[t][a];return d>o?(e?this.setDataMax(d):this._max=d,!1):d<s?(e?this.setDataMin(d):this._min=d,!1):{x:t,y:a,value:l,radius:g,min:s,max:o}},_unOrganizeData:function(){var n=[],e=this._data,t=this._radi;for(var a in e)for(var i in e[a])n.push({x:a,y:i,radius:t[a][i],value:e[a][i]});return{min:this._min,max:this._max,data:n}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var n=arguments[0],e=n.length;e--;)this.addData.call(this,n[e]);else{var t=this._organiseData(arguments[0],!0);t&&(this._data.length===0&&(this._min=this._max=t.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[t]}))}return this},setData:function(n){var e=n.data,t=e.length;this._data=[],this._radi=[];for(var a=0;a<t;a++)this._organiseData(e[a],!1);return this._max=n.max,this._min=n.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(n){return this._max=n,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(n){return this._min=n,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(n){this._coordinator=n},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},v}(),y=function(){var v=function(t){var a=t.gradient||t.defaultGradient,i=document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var o=r.createLinearGradient(0,0,256,1);for(var s in a)o.addColorStop(s,a[s]);return r.fillStyle=o,r.fillRect(0,0,256,1),r.getImageData(0,0,256,1).data},h=function(t,a){var i=document.createElement("canvas"),r=i.getContext("2d"),o=t,s=t;if(i.width=i.height=t*2,a==1)r.beginPath(),r.arc(o,s,t,0,2*Math.PI,!1),r.fillStyle="rgba(0,0,0,1)",r.fill();else{var l=r.createRadialGradient(o,s,t*a,o,s,t);l.addColorStop(0,"rgba(0,0,0,1)"),l.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=l,r.fillRect(0,0,2*t,2*t)}return i},n=function(s){for(var a=[],i=s.min,r=s.max,o=s.radi,s=s.data,l=Object.keys(s),g=l.length;g--;)for(var d=l[g],_=Object.keys(s[d]),w=_.length;w--;){var u=_[w],p=s[d][u],x=o[d][u];a.push({x:d,y:u,value:p,radius:x})}return{min:i,max:r,data:a}};function e(t){var a=t.container,i=this.shadowCanvas=document.createElement("canvas"),r=this.canvas=t.canvas||document.createElement("canvas");this._renderBoundaries=[1e4,1e4,0,0];var o=getComputedStyle(t.container)||{};r.className="heatmap-canvas",this._width=r.width=i.width=t.width||+o.width.replace(/px/,""),this._height=r.height=i.height=t.height||+o.height.replace(/px/,""),this.shadowCtx=i.getContext("2d"),this.ctx=r.getContext("2d"),r.style.cssText=i.style.cssText="position:absolute;left:0;top:0;",a.style.position="relative",a.appendChild(r),this._palette=v(t),this._templates={},this._setStyles(t)}return e.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(n(t)),this._colorize())},_updateGradient:function(t){this._palette=v(t)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,a){this._width=t,this._height=a,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=a},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=t.blur==0?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=(t.opacity||0)*255,this._maxOpacity=(t.maxOpacity||t.defaultMaxOpacity)*255,this._minOpacity=(t.minOpacity||t.defaultMinOpacity)*255,this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(r){for(var a=this._min=r.min,i=this._max=r.max,r=r.data||[],o=r.length,s=1-this._blur;o--;){var l=r[o],g=l.x,d=l.y,_=l.radius,w=Math.min(l.value,i),u=g-_,p=d-_,x=this.shadowCtx,m;this._templates[_]?m=this._templates[_]:this._templates[_]=m=h(_,s);var D=(w-a)/(i-a);x.globalAlpha=D<.01?.01:D,x.drawImage(m,u,p),u<this._renderBoundaries[0]&&(this._renderBoundaries[0]=u),p<this._renderBoundaries[1]&&(this._renderBoundaries[1]=p),u+2*_>this._renderBoundaries[2]&&(this._renderBoundaries[2]=u+2*_),p+2*_>this._renderBoundaries[3]&&(this._renderBoundaries[3]=p+2*_)}},_colorize:function(){var t=this._renderBoundaries[0],a=this._renderBoundaries[1],i=this._renderBoundaries[2]-t,r=this._renderBoundaries[3]-a,o=this._width,s=this._height,l=this._opacity,g=this._maxOpacity,d=this._minOpacity,_=this._useGradientOpacity;t<0&&(t=0),a<0&&(a=0),t+i>o&&(i=o-t),a+r>s&&(r=s-a);for(var w=this.shadowCtx.getImageData(t,a,i,r),u=w.data,p=u.length,x=this._palette,m=3;m<p;m+=4){var D=u[m],b=D*4;if(b){var B;l>0?B=l:D<g?D<d?B=d:B=D:B=g,u[m-3]=x[b],u[m-2]=x[b+1],u[m-1]=x[b+2],u[m]=_?x[b+3]:B}}this.ctx.putImageData(w,t,a),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var a,i=this.shadowCtx,r=i.getImageData(t.x,t.y,1,1),o=r.data[3],s=this._max,l=this._min;return a=Math.abs(s-l)*(o/255)>>0,a},getDataURL:function(){return this.canvas.toDataURL()}},e}(),O=function(){var v=!1;return f.defaultRenderer==="canvas2d"&&(v=y),v}(),F={merge:function(){for(var c={},v=arguments.length,h=0;h<v;h++){var n=arguments[h];for(var e in n)c[e]=n[e]}return c}},R=function(){var v=function(){function t(){this.cStore={}}return t.prototype={on:function(a,i,r){var o=this.cStore;o[a]||(o[a]=[]),o[a].push(function(s){return i.call(r,s)})},emit:function(a,i){var r=this.cStore;if(r[a])for(var o=r[a].length,s=0;s<o;s++){var l=r[a][s];l(i)}}},t}(),h=function(e){var t=e._renderer,a=e._coordinator,i=e._store;a.on("renderpartial",t.renderPartial,t),a.on("renderall",t.renderAll,t),a.on("extremachange",function(r){e._config.onExtremaChange&&e._config.onExtremaChange({min:r.min,max:r.max,gradient:e._config.gradient||e._config.defaultGradient})}),i.setCoordinator(a)};function n(){var e=this._config=F.merge(f,arguments[0]||{});if(this._coordinator=new v,e.plugin){var t=e.plugin;if(f.plugins[t]){var a=f.plugins[t];this._renderer=new a.renderer(e),this._store=new a.store(e)}else throw new Error("Plugin '"+t+"' not found. Maybe it was not registered.")}else this._renderer=new O(e),this._store=new C(e);h(this)}return n.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(e){return this._config=F.merge(this._config,e),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(e){return this._store.getValueAt?this._store.getValueAt(e):this._renderer.getValueAt?this._renderer.getValueAt(e):null}},n}(),M={create:function(c){return new R(c)},register:function(c,v){f.plugins[c]=v}};return M})})(G);var Y=G.exports;const X=j(Y),tt=S("TresPerspectiveCamera",{position:[21,34,55],fov:60,near:1,far:1e3},null,-1),at=S("TresAmbientLight",{color:"#cccccc",intensity:.4},null,-1),et=S("TresPointLight",{color:"#ffffff",intensity:.8},null,-1),rt=S("TresGridHelper",{args:[50,25],position:[0,0,0]},null,-1),it={position:[0,0,0]},nt=["rotate-x"],dt=W({__name:"heatmapExample",setup(P){const f={clearColor:"#030311",shadows:!0,alpha:!1,outputColorSpace:z,shadowMapType:H,useLegacyLights:!0,antialias:!0};let C=null;const y=(h,n)=>Math.round((Math.random()*(h-n+1)+n)*10)/10,O=()=>{let h=0;const n=10,e=[];for(;h<2e3;)e.push({x:y(1,256),y:y(1,256),value:y(1,6)}),h++;C.setData({max:n,data:e})},F=()=>{const h=document.createElement("heatmap-canvas");return h.width=100,h.height=100,h.style.position="absolute",h.style.top="0",h.style.left="0",document.body.appendChild(h),C=X.create({container:h,width:256,height:256,blur:".8",radius:10}),O(),C},R=new T(F()._renderer.canvas);R.needsUpdate=!0;let M=!0;E().onLoop(({elapsed:h})=>{!M&&parseInt(h)%2==1&&(M=!0,O(),R.needsUpdate=!0),M&&parseInt(h)%2==0&&(M=!1)});const c={transparent:!0,side:A,vertexShader:"\n	uniform sampler2D heightMap;\n	uniform float heightRatio;\n	varying vec2 vUv;\n	varying float hValue;\n	varying vec3 cl;\n	void main() {\n	  vUv = uv;\n	  vec3 pos = position;\n	  cl = texture2D(heightMap, vUv).rgb;\n	  hValue = texture2D(heightMap, vUv).r;\n	  pos.y = hValue * heightRatio;\n	  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos,1.0);\n	}",fragmentShader:"\n	varying float hValue;\n	varying vec3 cl;\n	void main() {\n		float v = abs(hValue - 1.);\n		gl_FragColor = vec4(cl, .8 - v * v) ; \n	}",uniforms:{heightMap:{type:"t",value:R},heightRatio:{value:5}}};return new U({title:"参数",expanded:!0}).addBinding(c.uniforms.heightRatio,"value",{label:"高度",min:1,max:10,step:1}),(h,n)=>(q(),J(I(V),Q(f,{"window-size":""}),{default:K(()=>[tt,Z(I(L),{autoRotate:!0,autoRotateSpeed:2}),at,et,rt,S("TresMesh",it,[S("TresPlaneGeometry",{args:[50,50,1e3,1e3],"rotate-x":-Math.PI*.5},null,8,nt),S("TresShaderMaterial",$(N(c)),null,16)])]),_:1},16))}});export{dt as default};
